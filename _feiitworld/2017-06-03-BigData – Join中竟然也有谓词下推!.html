---
title: BigData – Join中竟然也有谓词下推!?
author: 何李夫、范欣欣
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1496458980&src=3&ver=1&signature=Nemr66ffk*GtagkzYwHqqlmJ5WeSmafIdPJ-alsq-dcTEXbo3POrqRzZvse3RZLBvKN5rYTYQKlsSCm23cgEIEC0VC3WwBpig6TkWNF-S0OWCeWlaMf82RxRDwfRRjbe0xKtzqCgSj0Q-vqWLBDodUWcgU2MWWw706raCd6J-Q4=
date: '2017-06-03 00:00:00 +0000'

---

{% raw  %}
<p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; box-sizing: border-box !important; word-wrap: break-word !important;">本文由数据管理公众号授权转发。系同一系列的第二篇。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">在之前的文章中简要介绍了Join在大数据领域中的使用背景以及常用的几种算法－broadcast hash join 、shuffle hash join以及sort merge join等，对每一种算法的核心应用场景也做了相关介绍，这里再重点说明一番：大表与小表进行join会使用broadcast hash join，一旦小表稍微大点不再适合广播分发就会选择shuffle hash join，最后，两张大表的话无疑选择sort merge join。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">好了，问题来了，说是这么一说，但到底选择哪种算法归根结底是SQL执行引擎干的事情，按照上文逻辑，SQL执行引擎肯定要知道参与Join的两表大小，才能选择最优的算法喽！那么斗胆问一句，怎么知道两表大小？衡量两表大小的是物理大小还是纪录多少抑或两者都有？其实，这是另一门学问－基于代价优化（Cost Based&nbsp;Optimization，简称CBO），它不仅能够解释Join算法的选择问题，更重要的，它还能确定多表联合Join场景下的Join顺序问题。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">是不是对CBO很期待呢？好吧，这里先刨个坑，下一个话题我们再聊。那今天要聊点什么呢？Join算法选择、Join顺序选择确实对Join性能影响极大，但，还有一个很重要的因素对Join的性能至关重要，那就是Join算法优化！无论是broadcast hash join、shuffle hash join还是sort merge join，都是最基础的join算法，有没有什么优化方案呢？还真有，这就是今天要聊的主角－Runtime Filter（下文简称RF）。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><section class="" style="max-width: 100%; box-sizing: border-box; border-width: 0px; border-style: none; border-color: initial; word-wrap: break-word !important;"><section class="" style="margin: 10px auto; padding: 15px 5px; max-width: 100%; box-sizing: border-box; width: 333.594px; border-top: 1px solid rgb(191, 191, 191); border-left-width: 0px; border-bottom: 1px solid rgb(191, 191, 191); line-height: 25px; text-align: center; border-right-color: rgb(191, 191, 191); border-left-color: rgb(191, 191, 191); color: rgb(242, 100, 124); word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">RF预备知识：bloom filter</p></section></section><p><span style="color: rgb(161, 161, 161); font-size: 14px; text-align: justify;">RF说白了是使用bloomfilter对参与join的表进行过滤，减少实际参与join的数据量。为了下文详细解释整个流程，有必要先解释一下bloomfilter这个数据结构（对之熟悉的看官可以绕道）。Bloom Filter使用位数组来实现过滤，初始状态下位数组每一位都为0，如下图所示：</span><br></p><p style="margin-bottom: 10px; max-width: 100%; box-sizing: border-box; min-height: 1em; color: rgb(107, 107, 107); word-wrap: break-word !important;"><img src="/feiitworld/images/2988cc802b1d0c3be6c2e3c561e6c12d800a5a37.png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 558px !important; height: 80px !important;"><span style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"></span></p><p style="margin-bottom: 10px; max-width: 100%; box-sizing: border-box; min-height: 1em; color: rgb(107, 107, 107); word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; word-wrap: break-word !important;">假如此时有一个集合S = {x1,x2,...,xn}，Bloom Filter使用k个独立的hash函数，分别将集合中的每一个元素映射到{1,…,m}的范围。对于任何一个元素，被映射到的数字作为对应的位数组的索引，该位会被置为1。比如元素x1被hash函数映射到数字8，那么位数组的第8位就会被置为1。下图中集合S只有两个元素x和y，分别被3个hash函数进行映射，映射到的位置分别为(0,3,6)和(4,7,10)，对应的位会被置为1:</span><span style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"></span></p><p style="margin-bottom: 10px; max-width: 100%; box-sizing: border-box; min-height: 1em; color: rgb(107, 107, 107); word-wrap: break-word !important;"><img src="/feiitworld/images/b579e2aab886cdd318a06a5c466145cb47f8e4fe.png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 558px !important; height: 128px !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; word-wrap: break-word !important;">现在假如要判断另一个元素是否是在此集合中，只需要被这3个hash函数进行映射，查看对应的位置是否有0存在，如果有的话，表示此元素肯定不存在于这个集合，否则有可能存在。下图所示就表示z肯定不在集合<span style="max-width: 100%;">{x,y}</span>中：</span></p><p style="margin-bottom: 10px; max-width: 100%; box-sizing: border-box; min-height: 1em; color: rgb(107, 107, 107); word-wrap: break-word !important;"><img src="/feiitworld/images/764933d05d4ca28aa7a2a69162fd2e32cfe14bf2.png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 575px !important; height: 153px !important;"></p><p style="margin-bottom: 10px; max-width: 100%; box-sizing: border-box; min-height: 1em; color: rgb(107, 107, 107); word-wrap: break-word !important;"><br></p><section class="" style="max-width: 100%; box-sizing: border-box; border-width: 0px; border-style: none; border-color: initial; word-wrap: break-word !important;"><section class="" style="margin: 10px auto; padding: 15px 5px; max-width: 100%; box-sizing: border-box; width: 333.594px; border-top: 1px solid rgb(191, 191, 191); border-left-width: 0px; border-bottom: 1px solid rgb(191, 191, 191); line-height: 25px; text-align: center; border-right-color: rgb(191, 191, 191); border-left-color: rgb(191, 191, 191); color: rgb(242, 100, 124); word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">RF算法理论</p></section></section><p><span style="color: rgb(161, 161, 161); font-size: 14px; text-align: justify;">为了更好地说明整个过程，这里使用一个SQL示例对RF算法进行完整讲解，SQL：select item.name,order.* from order,item where order.item_id = item.id and item.category = ‘book’，其中order为订单表，item为商品表，两张表根据商品id字段进行join，该SQL意为取出商品类别为书籍的所有订单详情。假设商品类型为书籍的商品并不多，join算法因此确定为broadcast hash join。整个流程如下图所示：</span><br></p><p style="max-width: 100%; min-height: 1em; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/feiitworld/images/8be47a37863796cdc299ab73ac9561e612fc9bad.png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 479px !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(161, 161, 161); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;">Step 1：将item表的join字段（item.id）经过多个hash函数映射处理为一个bloomfilter（如果对bloomfilter不了解，自行google）；</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">Step 2：将映射好的bloomfilter分别广播到order表的所有partition上，准备进行过滤；</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">Step 3：以Partition2为例，存储进程（比如DataNode进程）将order表中join列（order.item_id）数据一条一条读出来，使用bloomfilter进行过滤。淘汰该订单数据不是书籍相关商品的订单，这条数据直接跳过；否则该条订单数据有可能是待检索订单，将该行数据全部扫描出来；</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">Step 4：将所有未被bloomfilter过滤掉的订单数据，通过本地socket通信发送到计算进程（impalad）；</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">Step 5：再将所有书籍商品数据广播到所有Partition节点与step4所得订单数据进行真正的hashjoin操作，得到最终的选择结果。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><section class="" style="max-width: 100%; box-sizing: border-box; border-width: 0px; border-style: none; border-color: initial; word-wrap: break-word !important;"><section class="" style="margin: 10px auto; padding: 15px 5px; max-width: 100%; box-sizing: border-box; width: 333.594px; border-top: 1px solid rgb(191, 191, 191); border-left-width: 0px; border-bottom: 1px solid rgb(191, 191, 191); line-height: 25px; text-align: center; border-right-color: rgb(191, 191, 191); border-left-color: rgb(191, 191, 191); color: rgb(242, 100, 124); word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">RF算法分析</p></section></section><p><span style="color: rgb(161, 161, 161); font-size: 14px; text-align: justify;">上面通过一个SQL示例简单演示了整个RF算法在broadcast hash join中的操作流程，根据流程对该算法进行一下理论层次分析：</span><br></p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">RF本质：通过谓词（&nbsp;bloomfilter）下推，在存储层通过bloomfilter对数据进行过滤，可以从三个方面实现对Join的优化。其一，如果可以跳过很多记录，就可以减少了数据IO扫描次数。这点需要重点解释一下，许多朋友会有这样的疑问：既然需要把数据扫描出来使用BloomFilter进行过滤，为什么还会减少IO扫描次数呢？这里需要关注一个事实：大多数表存储行为都是列存，列之间独立存储，扫描过滤只需要扫描join列数据（而不是所有列），如果某一列被过滤掉了，其他对应的同一行的列就不需要扫描了，这样减少IO扫描次数。其二，减少了数据从存储层通过socket(甚至TPC）发送到计算层的开销，其三，减少了最终hash join执行的开销。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">RF代价：对照未使用RF的Broadcast Hash Join来看，前者主要增加了bloomfilter的生成、广播以及大表根据bloomfilter进行过滤这三个开销。通常情况下，这几个步骤在小表较小的情况下代价并不大，基本可以忽略。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">RF优化效果：基本取决于bloomfilter的过滤效果，如果大量数据被过滤掉了，那么join的性能就会得到极大提升；否则性能提升就会有限。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">RF实现：和常见的谓词下推（’=‘，’&gt;’，’&lt;‘等）一样，RF实现需要在计算层以及存储层分别进行相关逻辑实现，计算层要构造bloomfilter并将bloomfilter下传到存储层，存储层要实现使用该bloomfilter对指定数据进行过滤。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><section class="" style="max-width: 100%; box-sizing: border-box; border-width: 0px; border-style: none; border-color: initial; word-wrap: break-word !important;"><section class="" style="margin: 10px auto; padding: 15px 5px; max-width: 100%; box-sizing: border-box; width: 333.594px; border-top: 1px solid rgb(191, 191, 191); border-left-width: 0px; border-bottom: 1px solid rgb(191, 191, 191); line-height: 25px; text-align: center; border-right-color: rgb(191, 191, 191); border-left-color: rgb(191, 191, 191); color: rgb(242, 100, 124); word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">RF效果验证</p></section></section><p><span style="color: rgb(161, 161, 161); font-size: 14px; text-align: justify;">事实上，RF这个东东的优化效果是在组内同事何大神做impala on parquet以及impala on kudu的基准对比测试的时候分析发现的。实际测试中，impala on parquet 比之impala on kudu性能有明显优势，目测至少10倍性能提升。同一SQL解析引擎，不同存储引擎，性能竟然天壤之别！为了分析具体原因，同事就使用impala的执行计划分析工具对两者的执行计划分别进行了分析，才透过蛛丝马迹发现前者使用了RF，而后者并没有（当然可能还有其他因素，但RF肯定是原因之一）。</span><br></p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">简单复盘一下这次测试吧，基准测试使用TPCDS测试，数据规模为1T，本文使用测试过程中的一个典型SQL（Q40）作为示例对RF的神奇功效进行回放演示。下图是Q40的对比性能，直观上来看RF可以直接带来40x的性能提升，40倍哎，这到底是怎么做到的？</p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"></span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/feiitworld/images/a0c3b2d8d527bdf8fc7a0529dadbde460e3d1105.png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 362px !important; height: 217px !important;"></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(161, 161, 161); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;">先来简单看看Q40的SQL语句，如下所示，看起来比较复杂，核心涉及到3个表（catalog_sales join date_dim 、catalog_sales join warehouse 、catalog_sales join item）的join操作：</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">select&nbsp;&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; w_state<span style="max-width: 100%; background-color: inherit; color: inherit; font-family: inherit; font-size: 1em; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;">,&nbsp;i_item_id,</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; sum(case&nbsp;when&nbsp;(cast(d_date&nbsp;as&nbsp;date)&nbsp;&lt;&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span style="max-width: 100%;">&nbsp; &nbsp;&nbsp;</span></span>cast&nbsp;('1998-04-08'&nbsp;<span style="max-width: 100%; background-color: inherit; color: inherit; font-family: inherit; font-size: 1em; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;">as&nbsp;date))&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span>then&nbsp;cs_sales_price&nbsp;–&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coalesce(cr_refunded_cash,0)&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span>else&nbsp;0&nbsp;end)<span style="max-width: 100%; background-color: inherit; color: inherit; font-family: inherit; font-size: 1em; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;as&nbsp;sales_before,</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; color: inherit; font-family: inherit; font-size: 1em; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; sum(case&nbsp;when&nbsp;(cast(d_date&nbsp;as&nbsp;date)&nbsp;&gt;=</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span>cast&nbsp;('1998-04-08' as&nbsp;date))&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; then&nbsp;cs_sales_price&nbsp;–&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; coalesce(cr_refunded_cash,0)&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else&nbsp;0&nbsp;end)&nbsp;as&nbsp;sales_after</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">from</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;</span>catalog_sales&nbsp;left&nbsp;outer&nbsp;join&nbsp;catalog_returns&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; on</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;<span style="max-width: 100%;">&nbsp; &nbsp;&nbsp;</span></span>(catalog_sales.cs_order_number&nbsp;=</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; catalog_returns.cr_order_number&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span>and catalog_sales.cs_item_sk&nbsp;=&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; catalog_returns.cr_item_sk),</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;</span>warehouse, item, date_dim</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">where</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;</span>i_current_price&nbsp;between&nbsp;0.99&nbsp;and&nbsp;1.49</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; and&nbsp;item.i_item_sk =&nbsp;catalog_sales.cs_item_sk</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; and&nbsp;catalog_sales.cs_warehouse_sk =</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;<span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</span>warehouse.w_warehouse_sk&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; and&nbsp;catalog_sales.cs_sold_date_sk =&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; date_dim.d_date_sk</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; and&nbsp;date_dim.d_date&nbsp;between&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '1998-03-09' and '1998-05-08'</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;">group&nbsp;by w_state, i_item_id</p><p style="max-width: 100%; min-height: 1em; color: rgb(255, 255, 255); font-size: 14px; background-color: rgb(170, 166, 149); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; color: inherit; font-family: inherit; font-size: 1em; text-decoration: inherit; box-sizing: border-box !important; word-wrap: break-word !important;">order&nbsp;by&nbsp;w_state,&nbsp;i_item_id&nbsp;</span>limit&nbsp;100;</p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(161, 161, 161); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;">典型的星型结构，其中catalog_sales是事实表，其他表为纬度表。本次分析选择其中catalog_sales join item这个纬度的join。因为对比测试中两者的SQL解析引擎都是使用impala，所以SQL执行计划基本都相同。在此基础上，来看看执行计划中单个执行节点在执行catalog_sales join item操作时由先到后的主要阶段耗时，其中只贴出来重要耗时阶段（Q40中Join算法为shuffle hash join，与上文所举broadcast hash join示例略有不同，不过不影响结论）：</span></p><p><br></p><section data-id="47" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><table data-width="100%" align="left" interlaced="enabled" width="670"><tbody style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><tr class="ue-table-interlace-color-single" style="max-width: 100%; border-top: 3px solid rgb(102, 142, 104); color: rgb(102, 142, 104); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><td width="83" style="margin: 5px 10px; word-break: break-all; border-top-width: 0px; border-top-style: none; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><span style="max-width: 100%; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #</span></td><td width="187" style="margin: 5px 10px; word-break: break-all; border-top-width: 0px; border-top-style: none; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">impala on kudu</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(without runtime filter)</span></p></td><td width="185" style="margin: 5px 10px; word-break: break-all; border-top-width: 0px; border-top-style: none; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">impala on parquet</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(with runtime filter)</span></p></td></tr><tr class="ue-table-interlace-color-double" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><td width="71" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">total</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">time&nbsp;</span></p></td><td width="187" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">43s996ms</span></td><td width="185" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">2s385ms</span></td></tr><tr class="ue-table-interlace-color-single" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><td width="71" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">bloom</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">filter</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">生成</span></p></td><td align="left" valign="top" width="187" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><br></td><td width="185" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 0 arrival:857ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 1 arrival:879ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 2 arrival:939ms</span></p></td></tr><tr class="ue-table-interlace-color-double" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><td width="71" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; background-color: rgb(245, 245, 245); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">大表</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; background-color: rgb(245, 245, 245); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">scan</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; background-color: rgb(245, 245, 245); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">扫描</span></p></td><td align="center" valign="middle" width="187" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">HDFS_SCAN_NODE (id=0):</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(Total: 3s479ms）</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsRead:72.01M</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">–&nbsp;RowsReturned:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); color: rgb(107, 107, 107); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">72.01M&nbsp;</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturnedRate:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); color: rgb(107, 107, 107); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">20.69 M/s</span></p></td><td width="185" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">HDFS_SCAN_NODE(id=0):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(Total: 2s011ms）<br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – RowsRead:72.01M&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; –&nbsp;RowsReturned: 35.92K&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – RowsReturnedRate:17.86 K/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 0 (1.00 MB):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows processed:72.01M</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows rejected:71.43M&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows total:72.01M</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 1 (1.00 MB):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows processed:49.15K&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows rejected:126&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;&nbsp;– Rows total:49.15K&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Filter 2 (1.00 MB):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows processed:584.38K&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;&nbsp;– Rows rejected:548.46K&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp; – Rows total:584.38K</span></p></td></tr><tr class="ue-table-interlace-color-single" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><td colspan="1" rowspan="1" width="71" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: center; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">数据加</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">载计算</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">进程内</span></p><p style="max-width: 100%; min-height: 1em; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">存</span></p></td><td colspan="1" rowspan="1" width="187" style="margin: 5px 10px; word-break: break-all; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">DataStreamSender (dst_id=11):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(Total: 15s984ms)<span style="max-width: 100%; background-color: inherit; font-size: 13px;"></span></span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– NetworkThroughput(*):298.78 MB/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– OverallThroughput:100.85 MB/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturned:72.01M</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">–&nbsp;SerializeBatchTime:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">10s567ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">–&nbsp;TransmitDataRPCTime:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">5s395ms</span></p></td><td colspan="1" rowspan="1" width="185" style="margin: 5px 10px; word-break: break-all; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">DataStreamSender (dst_id=11):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">(Total: 10.725ms<span style="max-width: 100%; background-color: inherit;">）</span></span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;– NetworkThroughput(*):244.06 MB/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;– OverallThroughput: 71.23 MB/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;– RowsReturned: 35.92K</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;<span style="max-width: 100%; background-color: rgb(191, 191, 191);">– SerializeBatchTime:</span></span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">7.544ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; font-family: Times; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;– TransmitDataRPCTime:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">3.130ms</span></p></td></tr><tr class="ue-table-interlace-color-double" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><td colspan="1" rowspan="1" width="71" style="margin: 5px 10px; word-break: break-all; max-width: 100%; text-align: justify; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Hash</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">Join</span></p></td><td colspan="1" rowspan="1" width="187" style="margin: 5px 10px; word-break: break-all; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">HASH_JOIN_NODE (id=5):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-family: 微软雅黑;">(Total:&nbsp;19s104ms</span><span style="max-width: 100%;">)</span></span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildPartitionTime:862.560ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildRows:8.99M&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildRowsPartitioned:8.99M</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildTime:373.855ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ……&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ProbeRows:90.00M&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ProbeRowsPartitioned:0 (0)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">–&nbsp;ProbeTime:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">17s628ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturned:90.00M</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturnedRate:985.85 K/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– SpilledPartitions:0 (0)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– UnpinTime:960.000ns</span></p></td><td colspan="1" rowspan="1" width="185" style="margin: 5px 10px; word-break: break-all; max-width: 100%; word-wrap: break-word !important; box-sizing: border-box !important;"><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">HASH_JOIN_NODE (id=6):</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">(Total:&nbsp;21.707ms)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildPartitionTime:3.487ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildRows:18.81K (18814)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildRowsPartitioned:18.81K</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– BuildTime:646.817us</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ……&nbsp;</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ProbeRows:85.28K (85278)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– ProbeRowsPartitioned:0 (0)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 12px; background-color: rgb(191, 191, 191); box-sizing: border-box !important; word-wrap: break-word !important;">–&nbsp;ProbeTime:</span><span style="max-width: 100%; background-color: rgb(191, 191, 191); font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">6.396ms</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturned: 85.27K</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– RowsReturnedRate:38.88 K/s</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– SpilledPartitions:0 (0)</span></p><p style="margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(107, 107, 107); font-family: 微软雅黑; font-size: 14px; background-color: inherit; text-align: justify; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; background-color: inherit; font-size: 12px; box-sizing: border-box !important; word-wrap: break-word !important;">– UnpinTime:915.000ns</span></p></td></tr></tbody></table></section><p><br></p><p><br></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"></span></p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">经过对两种场景执行计划的解析，可以基本验证上文所做的基本理论结果：</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">1. 确认经过RF之后大表的数据量得到大量滤除，只剩下少量数据参与最终的HashJoin。参见第二行大表scan扫描结果，未使用rf的返回结果有7千万行＋纪录，而经过RF过滤之后满足条件的只有3w＋纪录。3万相比7千万，性能优化效果自然不言而喻。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">2. 经过RF滤除之后，少量数据经过网络从存储进程加载到计算进程内存的网络耗时大量减少。参见第三行“数据加载到计算进程内存”，前者耗时15s，后者耗时仅仅11ms。主要耗时分为两部分，其中数据序列化时间占到2/3－10s左右，数据经过RPC传输时间占另外1/3 －5s左右。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">3. 最后，经过RF滤除之后，参与到最终Hash Join的数据量大幅减少，Hash Join耗时前者是19s，后者是21ms左右。主要耗时在于大表Probe Time，前者消耗了17s左右，而后者仅需6ms。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><section class="" style="max-width: 100%; box-sizing: border-box; border-width: 0px; border-style: none; border-color: initial; word-wrap: break-word !important;"><section class="" style="margin: 10px auto; padding: 15px 5px; max-width: 100%; box-sizing: border-box; width: 333.594px; border-top: 1px solid rgb(191, 191, 191); border-left-width: 0px; border-bottom: 1px solid rgb(191, 191, 191); line-height: 25px; text-align: center; border-right-color: rgb(191, 191, 191); border-left-color: rgb(191, 191, 191); color: rgb(242, 100, 124); word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">说好的谓词下推？</p></section></section><p><span style="color: rgb(161, 161, 161); font-size: 14px; text-align: justify;">讲真，刚开始接触RF的时候觉得这简直是一个实实在在的神器，崇拜之情溢于言表。然而，经过一段时间的探索消化，直至把这篇文章写完，也就是此时此刻，忽然觉得它并不高深莫测，说白了就是一个谓词下推，不同的是这里的谓词稍微奇怪一点，是一个bloomfilter而已。</span><br></p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">提到谓词下推，这里再引申一下下。以前经常满大街听到谓词下推，然而对谓词下推却总感觉懵懵懂懂，并不明白的很真切。经过RF的洗礼，现在确信有了更进一步的理解。这里拿出来和大家交流交流。个人认为谓词下推有两个层面的理解：</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">其一是逻辑执行计划优化层面的说法，比如SQL语句：select * from order ,item where item.id = order.item_id and item.category =&nbsp;‘book’，正常情况语法解析之后应该是先执行Join操作，再执行Filter操作。通过谓词下推，可以将Filter操作下推到Join操作之前执行。即将where item.category =&nbsp;‘book’下推到 item.id = order.item_id之前先行执行。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">其二是真正实现层面的说法，谓词下推是将过滤条件从计算进程下推到存储进程先行执行，注意这里有两种类型进程：计算进程以及存储进程。计算与存储分离思想，这在大数据领域相当常见，比如最常见的计算进程有SparkSQL、Hive、impala等，负责SQL解析优化、数据计算聚合等，存储进程有HDFS（DataNode）、Kudu、HBase，负责数据存储。正常情况下应该是将所有数据从存储进程加载到计算进程，再进行过滤计算。谓词下推是说将一些过滤条件下推到存储进程，直接让存储进程将数据过滤掉。这样的好处显而易见，过滤的越早，数据量越少，序列化开销、网络开销、计算开销这一系列都会减少，性能自然会提高。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">写到这里，忽然意识到笔者在上文出现了一个很严重的认知错误：RF机制并不仅仅是一个简单的谓词下推，它的精髓在于提出了一个重要的谓词－bloomfilter。当前对RF支持的系统并不多，笔者只知道目前唯有Impala on Parquet进行了支持。Impala on Kudu虽说Impala支持，但Kudu并不支持。SparkSQL on Parqeut中虽有存储系统支持，无奈计算引擎－SparkSQL目前还不支持。</p><p style="margin-top: 10px; max-width: 100%; min-height: 1em; text-align: justify; font-size: 14px; line-height: 1.8em; color: rgb(161, 161, 161); box-sizing: border-box !important; word-wrap: break-word !important;">本文主要介绍了一种类似于semi-join的优化方法，对优化细节进行了深入地探讨，并结合分析过程对谓词下推技术谈了谈自己的理解。后续将会为各位看官带来基于代价优化（CBO）相关的议题，敬请期待！</p><p><br></p><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; text-align: center; line-height: 2; letter-spacing: 1px; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><span style="font-size: 20px;"><strong style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;">欢迎打赏支持飞总的写作</strong></span></p></section></section></section><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/feiitworld/images/eb07149d782bd7223baa19381349a44cdbecfbc9.png" style="text-align: center; box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 845px !important;"><br></p><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;">&nbsp;往期精选</p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484224&amp;idx=1&amp;sn=9fced8d0ae82ab9b5a312beef90f76a2&amp;chksm=ec96d90bdbe1501d3b95a1d5aa7624f02f23c1c0f3c954a732daee20d16c41ffc8a308e9735c&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484224&amp;idx=1&amp;sn=9fced8d0ae82ab9b5a312beef90f76a2&amp;chksm=ec96d90bdbe1501d3b95a1d5aa7624f02f23c1c0f3c954a732daee20d16c41ffc8a308e9735c&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">修Bug的罪与罚(1)</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484209&amp;idx=1&amp;sn=31d449c3455262b67af730633a987e2d&amp;chksm=ec96d97adbe1506c627190ee2680aa5c2caa43269d6e3effd08c37f9bcc7dc7b7a5419f8187a&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484209&amp;idx=1&amp;sn=31d449c3455262b67af730633a987e2d&amp;chksm=ec96d97adbe1506c627190ee2680aa5c2caa43269d6e3effd08c37f9bcc7dc7b7a5419f8187a&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">做人不能太无耻之微软build大会的宇宙数据库</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484060&amp;idx=1&amp;sn=975148338bf2296a6c0f89fa3c94bae1&amp;chksm=ec96d8d7dbe151c155f417ee05c22b8cb15797bfd7ad891771e5bdecf6ddbc1ca9f89b87eb90&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484060&amp;idx=1&amp;sn=975148338bf2296a6c0f89fa3c94bae1&amp;chksm=ec96d8d7dbe151c155f417ee05c22b8cb15797bfd7ad891771e5bdecf6ddbc1ca9f89b87eb90&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">缺失的价值回报体系</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484047&amp;idx=1&amp;sn=4efac37195a779579ddfa999e13e8079&amp;chksm=ec96d8c4dbe151d2042d9bce729537b2c6d71b12c0dc4f3e7a6c74b14ef4e87b07a8cd265ace&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484047&amp;idx=1&amp;sn=4efac37195a779579ddfa999e13e8079&amp;chksm=ec96d8c4dbe151d2042d9bce729537b2c6d71b12c0dc4f3e7a6c74b14ef4e87b07a8cd265ace&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">血淋淋的Cloudera上市路</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483893&amp;idx=1&amp;sn=7a0251137bcca186d5fac0e0eb669f53&amp;chksm=ec96dbbedbe152a8e83b3c2684ef693d5ebf14da9fe7ac1c6f9e209c72a13f9642fd3ee96554&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483893&amp;idx=1&amp;sn=7a0251137bcca186d5fac0e0eb669f53&amp;chksm=ec96dbbedbe152a8e83b3c2684ef693d5ebf14da9fe7ac1c6f9e209c72a13f9642fd3ee96554&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">陆奇为什么去百度？</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484099&amp;idx=1&amp;sn=a18b7f0e9dd0fe596bdf80e3a1f9709e&amp;chksm=ec96d888dbe1519ec1d69a1e9bd4081eb6492ed99e93387a59e8d2438abf27a537a468252889&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247484099&amp;idx=1&amp;sn=a18b7f0e9dd0fe596bdf80e3a1f9709e&amp;chksm=ec96d888dbe1519ec1d69a1e9bd4081eb6492ed99e93387a59e8d2438abf27a537a468252889&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">Log:被BigData遗忘的奠基者</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483786&amp;idx=1&amp;sn=94b99648f9c2761ecc3fe0205e4ae575&amp;chksm=ec96dbc1dbe152d7ed246eac13807e627d1d8b89742460fefcd7a01eedc4d0daec3fb9c54ae1&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483786&amp;idx=1&amp;sn=94b99648f9c2761ecc3fe0205e4ae575&amp;chksm=ec96dbc1dbe152d7ed246eac13807e627d1d8b89742460fefcd7a01eedc4d0daec3fb9c54ae1&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">大数据的那些事（1）：Google的后悔药</a><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p></section><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483757&amp;idx=1&amp;sn=78d24e0bc43c1e27627b59d3adb1c236&amp;chksm=ec96db26dbe152300bc8320c215368d8a2ae5baa45ca474240bc27ed28c9454e666b577a4da2&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzI5OTM3MjMyNA==&amp;mid=2247483757&amp;idx=1&amp;sn=78d24e0bc43c1e27627b59d3adb1c236&amp;chksm=ec96db26dbe152300bc8320c215368d8a2ae5baa45ca474240bc27ed28c9454e666b577a4da2&amp;scene=21#wechat_redirect" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">SAP HANA神话（一）：Michael Stonebraker梦碎</a></p></section></section><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; text-align: center; line-height: 2; letter-spacing: 1px; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;">加飞总小密圈和大咖嘉宾聊天</strong></p></section></section></section><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; text-align: center; word-wrap: break-word !important;"><img src="/feiitworld/images/c0e4ed134075d1e75ad1b0deda4e12f05de1e907.jpeg" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 401.984px !important; height: 416.753px !important;"></section></section></section></section></section><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 18px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; display: inline-block; width: 670px; vertical-align: top; word-wrap: break-word !important;"><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; box-sizing: border-box; min-height: 1em; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"></p></section></section></section><section class="" powered-by="xiumi.us" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; box-sizing: border-box; text-align: center; word-wrap: break-word !important;"><img src="/feiitworld/images/e167ac491157b1876062b9aeef3e035ffb6dc1a2.jpeg" style="box-sizing: border-box; vertical-align: middle; word-wrap: break-word !important; visibility: visible !important; width: 66.9844px !important; height: 56.8784px !important;"></section></section></section></section></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1496458980&src=3&ver=1&signature=Nemr66ffk*GtagkzYwHqqlmJ5WeSmafIdPJ-alsq-dcTEXbo3POrqRzZvse3RZLBvKN5rYTYQKlsSCm23cgEIEC0VC3WwBpig6TkWNF-S0OWCeWlaMf82RxRDwfRRjbe0xKtzqCgSj0Q-vqWLBDodUWcgU2MWWw706raCd6J-Q4=">微信地址</a>
{% endraw  %}

