---
title: '大数据那些事(33):SparkSQL'
author: 飞总
date: '2017-03-30 00:00:00 +0000'

---

{% raw  %}
<p><img src="/feiitworld/images/dcc55d65c733f0a651dfb4c51fd7cce0827ba723.jpeg" style="width: 576px !important; height: 330px !important; visibility: visible !important;"></p><p><br></p><p>SparkSQL是Spark新推出来的一个模块。关于SparkSQL的八卦其实知道的不多，但是技术上倒能说几句。</p><p><br></p><p>早先我文章提到了Shark是个失败的作品。这个观点从Shark出来不久我就这样觉得了。SparkSQL的论文承认Spark团队也认为Shark是一条胡同走到黑的选择。既不能够对本地的RDD做查询，也不能有效和其他的Spark的模块交互。英雄所见略同。当然狗熊所见也差不多。至于是英雄还是狗熊，各位看官自己判断。</p><p><br></p><p>SparkSQL最主要的东西有两个，一个是DataFrame全面取代了RDD。我必须为这个叫声好。作为一个根红苗正的关系数据库思想熏陶出来的人，带有RDD的Spark总给我一种干爹干妈做的数据处理的产品的感觉。用上DataFrame顿时有回到亲爹亲妈做的产品的感觉。期间的差距，可能是无法言语表达的。</p><p><br></p><p>DataFrame看起来像表了，有metadata了，既打开了做optimization的空间，又能够很好的和其他的Spark模块结合起来。的确是Spark一步领先步步领先的必然选择，是大杀器。DataFrame一出，Spark的地位就真的牢固起来了。</p><p><br></p><p>第二个东西就是SparkSQL有了一个optimizer。这个optimizer粗看起来其实也没什么特殊的。作为在好几个optimizer里改过code的人，这个optimizer一看就是关系数据库的套路。有logical的pass有physical的pass。但是我觉得有几点是不同的。第一点是rule本身是用Scala写的。作为一个functional programming的语言，写tree matching写起来是得心应手。用Scala来写rule的确是非常的有意思和有意义的一个选择。第二是它有很多extension point。这就使得它用起来可获展性好。至于CodeGen成JVM bytecode，自从有了LLVM在数据库里面折腾，就算不上特别的惊艳了。但是起码的好处是不管什么语言无论是python还是java用SparkSQL，性能差距都不大了。</p><p><br></p><p>至于这个东西的未来发展，我觉得optimization现在在SQL相关的操作和其他操作之间还是要间断的。如果前面一堆sql的操作，中间有个machine learning的call，接下来又有一个sql的操作，optimization其实很难说把这三个捆在一起，做一个global的optimization。User-defined operator掺和的优化是很有意思又很难的。</p><p><br></p><p>另外我很能理解为什么现在系统是rule-based。Cost-based的东西在这种大规模分布式的系统下，很多时候怎么去cost就是个问题，不如Rule来得实用。能做固然是牛逼，但是其实能起作用的地方有限。我想如果我来，也会先上rule看看再说，也许这辈子都不上cost-based了。当然我听说在Spark Summit上，华为来的同学们上了一个cost-based optimizer。我不知道是不是华为的底蕴非常的牛，还是人有多大胆，地有多大产了。</p><p><br></p><p><br></p><p></p><section class="" style="max-width: 100%; box-sizing: border-box; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; text-align: center; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section class="" style="margin-top: 76px; margin-right: 8px; margin-left: 8px; padding-right: 22px; padding-bottom: 29px; padding-left: 22px; max-width: 100%; box-sizing: border-box; border-width: 1px; border-style: solid; border-color: rgb(81, 81, 81); border-radius: 4px; word-wrap: break-word !important;"><section class="" style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><img src="/feiitworld/images/07a96f9d44986d2787794b2b229933af23015108.jpeg" style="margin-top: -45px; margin-right: auto; margin-left: auto; padding: 3px; box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; display: block; word-wrap: break-word !important; visibility: visible !important; width: 90px !important; height: 90px !important;"></section><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><h6 style="margin-top: 17px; margin-bottom: 16px; font-size: 18px; max-width: 100%; box-sizing: border-box; font-family: inherit; line-height: 1em; color: rgb(60, 112, 198); word-wrap: break-word !important;">飞总的IT世界面面观</h6><p style="padding: 10px 8px 23px; max-width: 100%; box-sizing: border-box; min-height: 1em; line-height: 1.75em; white-space: pre-line; border-bottom: 1px solid rgb(81, 81, 81); word-wrap: break-word !important;">飞总，旅居西雅图的浙江人，IT人士，08年起从事大数据相关的基础构架的研究和开发，素爱读书，博闻强识，对计算机行业和前沿技术的发展有深刻和独到的见解，希望通过这个平台分享他关于IT世界的的心得体会。</p><p class="" style="padding-top: 16px; padding-bottom: 23px; max-width: 100%; box-sizing: border-box; min-height: 1em; line-height: 1.75em; border-left: none; white-space: pre-line; border-bottom: 1px solid transparent; color: rgb(91, 172, 235); word-wrap: break-word !important;">微信ID:feiitworld<span style="max-width: 100%; box-sizing: border-box; display: block; clear: both; word-wrap: break-word !important;"></span></p><img src="/feiitworld/images/71eccf09c7ceaa7472e510faa1e633629eea8928.jpeg" style="margin-right: auto; margin-left: auto; box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; display: block; word-wrap: break-word !important; visibility: visible !important; width: 137px !important; height: 137px !important;"></section></section></section></section></section><p></p><p><br></p><p><br></p>
{% endraw  %}

