---
title: 有信VoIP语音质量评测实践
author: 王欣
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1498052897&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ7-8QvqdVS8MW3jRrcyNomW8ZclZ9pUNhaTXFh-isL85d2dYoGQD3XUeAmjjysz8xcR1J4OcnzfGLtXNgMetIPqa4CaiHWmIqzBjcZ93Yk1tSyGB8Aao7dk84wKHlYePkhotgzSYC4Na1M-umw94bwU=
date: '2017-06-19 00:00:00 +0000'

---

{% raw  %}
<section style="color: rgb(63, 63, 63); font-size: 14px; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; box-sizing: border-box;"><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">&nbsp; &nbsp;版权声明	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		本文为作者方投稿，转载请联系作者。	</section><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UH8Vic7czicPQiaUCdiaXce2O3Vd41sHibz8AWeF2n25CxXVK8ibpe61xvLEA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">1 背景介绍</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">VoIP(Voice over IP) 即 IP 电话，是将话音编码、压缩转换成数据包，在 IP 网络中进行传输的技术。语音通信因其特有的可靠性和高 QoS（Quality of Service）一直被大家广发使用。但现在的人们通过手机通话时已经不仅仅满足于信息的获取，而更多地关注语音质量如何，是否能高保真地还原声音的效果，并表达最真实的情感。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">有信以实时语音通话为核心，经过几年的深耕细作，用户总注册量已经超 1.2 亿，日活跃用户达 600 万。能够获得这么多的用户与有信电话高水平的语音通话质量密不可分，语音质量也是有信电话与传统电话公司竞争的一项关键因素。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">业界各方为了提高 VoIP 语音质量各显其能，语音质量的评测方案层出不穷，但都以主观评测为主流。我们在对有信 VoIP 网络电话做评测时，会从抗时延、抗丢包、噪声抑制以及音量大小等多种维度去考虑，本文主要介绍了客观评测语音质量的一些方法和案例。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UH8Vic7czicPQiaUCdiaXce2O3Vd41sHibz8AWeF2n25CxXVK8ibpe61xvLEA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">2 测试环境搭建</span>
	</section><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">2.1 测试设备</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">测试设备：PC + 测试手机 2 部 + 音频线 2 条 + 耳机麦克风二合一转接线。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">以上设备按照图 2-1 方式连接后，在 PC 上播放音频，声音从 PC 的扬声器通过音频线和转接线传入到主叫 A 的麦克里，然后主叫 A 中的通话软件采集声音并经过网络传到被叫 B，之后声音从被叫 B 通过音频线连接 PC 的麦克风传入到 PC 上，在 PC 上进行音频录制操作。这里需要注意的是，由于主叫和被叫都有麦克风权限，为了保证测试过程中数据的准确性，不受外界声音的影响，连接电脑 mic 端的被叫 B 一定要保持静音，主叫 A 一定要插出耳机模式。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UhjUJUoLvbtQbMVjpy1tLrZTu0I1wwLurX1DEnicIGfppJJV1ts42OUg/0?wx_fmt=png" style="width: 754px !important; height: 665.904px !important;">图 2-1</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">2.2 网络环境模拟</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">VoIP 决定了对网络的强依赖性，因此需要评定在不同网络状态下的语音质量的各项指标。这里推荐使用网络模拟软件 Network Emulator Toolkit 模拟网络丢包、抖动等网络异常情况。在电脑上安装网络模拟软件，然后将电脑网络作为 WiFi 热点 (可以使用 360 随身 wifi 等工具实现)，测试机连接热点 wifi，通过设置不同的参数实现丢包和网络抖动等网络异常的情况。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">网络丢包设置方法：可以通过设置 Periodic Loss （周期性丢包）参数实现（如设置参数为 10，表示每 10 个包丢一个包，即丢包率为 10%），也可以设置 Random Loss（随机丢包）参数实现（Random Loss 中的数值若填写 0.05，则表示随机丢包率为 5%），一般随机丢包更贴近真实的网络情况。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">网络抖动设置方法：可以通过设置变化的延时 Linear 参数来实现，Linear 设置项表示在设置时间内 period，延时会从设置的最小值 Min 逐渐变化到设置的最大值 Max （如设置 min 为 0，max 为 100，表示抖动幅度为 100ms），也可以设置 Normal Distributed 的参数来模拟。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">2.3 音频文件以及分析工具的选择</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">分析音频的软件有很多，本文采用 Cool Edit Pro，方便易用。将音频文件在 Cool Edit Pro 中打开，可以看到音频是否满足测试条件，例如，在音质测试时，要保证波形适中，振幅分布均匀。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">由于 PESQ 算法的特殊性，对声音源文件的选择有一定的要求。</p><ol style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">源声音文件的长度在 6s～8s 之间，过长或过短都会影响计算结果。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">静音区和非静音区的比例要适中，尽量保正［非静音：静音＝6:4 ］或 ［非静音：静音＝5:5 ］或［非静音：静音＝4:6 ］。使用 PESQ 计算 MOS 分时，要用纯净的不带噪声的文件。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">使用 Cool Edit Pro 录音时，应保证输出的波形适中，可通过调节音频播放音量和 PC 录音音量来控制。</p></li></ol><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UH8Vic7czicPQiaUCdiaXce2O3Vd41sHibz8AWeF2n25CxXVK8ibpe61xvLEA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">3 测试指标以及测试方法</span>
	</section><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">3.1 音质（QV）</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">音质（Quality of Voice）是指经传输、处理后 音频信号的保真度，是对音量音高、音调、音色等一些列影响因素的综合评价。本文所用的音质的测试方法，是利用 python 的音频插件 pyAudio 来输入源文件以及录制输出音频，通过国际通用的 PESQ（Perceptual evaluation of speech quality）算法来对比两个输入和输出的音频，最终计算出 MOS（Mean Opinion Score）值。以上整个过程都是通过脚本完成，避免了人工参与引入的误差。如 1.1 中的示意图连接好设备后，两台手机通过 AppA 进行通话，通话过程中执行脚本，脚本中一些变量的值，例如执行次数、采样率、Delay 时长等都可以根据测试对象的实际情况进行灵活调整，以尽量找到测试对象的天花板。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">3.2 语音时延（DV）</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">语音时延（Delay of Voice），两个移动终端进行通话过程中，主观感受的时延是指输出音频的时间减去输入音频的时间，即被叫听到声音的时间减去主叫发出声音的时间。DV 过大，比较容易出现响应迟缓、或者双讲的情况，非常影响通话体验。本文中对 DV 的测试方法是，如 1.1 中的示意图连接好设备后，两台手机通过 AppA 进行通话，通过脚本来计算音频输入的时间和录制音频的输出时间，这个过程相比主观测试，排除了人耳的差异性带来的误差，使得测试结果更精准。通过脚本跑出的时延数据，取 50～100 组延时数据算平均值即可。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">3.3 噪声抑制（NS）</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">大多数情况下，VoIP 通信系统的输入端不可能接受到纯净的原始语音，只能接受到被背景噪声干扰后的含噪语音。背景噪声极大地干扰了语音通信的质量，降低了语音的清晰度和可懂性。噪声抑制（Noise Suppression）的主要目的在于从含噪语音中提取尽可能纯净的原始语音。但是，过度的 NS 可能会产生降低语音音量等级、处理后的语音中的噪声不均匀，导致体验差等的负面效应。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果是分析同一个 app 不同版本的降噪效果，可以使用语音音量和噪声音量的 Average RMS Power 差值进行比对，单位是 dB，一般为正数（语音音量大于噪声音量）, 差值越大，NS 效果越好。但是，如果要分析不同 app 的 NS 效果，PESQ 差距大时，则认为 PESQ 低的 NS 对音质的损伤高，NS 效果差（但有噪声的文件计算出来的 PESQ 的值并不准确，因此不建议使用该方法），我们要同时考虑到 NS 的负面影响。因此，当 PESQ 差距较小时， 我们定义</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">d1＝ RMS（产品 1 的非噪声）－RMS（产品 2 的非噪声）</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">d2＝ RMS（产品 1 的噪声）－RMS（产品 2 的噪声）</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">d1 &gt; d2，则产品 1 的 NS 优于产品 2；</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">d1 = d2，则产品 1、2 的 NS 效果基本一致；</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">d1 &lt; d2，则产品 1 的 NS 差于产品 2。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">3.4 音量大小（VV）</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">音量大小（Volume of Voice）即音频的强度和幅度。不同的群体对音量大小的适应度存在一定的差异性。因此衡量音量的大小要从不同的维度来考量。本文中音量大小的评定是在不同播放音量条件下，播放同一个源声音文件，同时录制输出的音频，分析不同文件的 Average RMS Power，单位是 dB，为负数，绝对值越大，音量越小。其中，不同的播放音量大小的定义为：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">小音量——30%；</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">正常音量——50%；</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">大音量——70%。</p></li></ul><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UH8Vic7czicPQiaUCdiaXce2O3Vd41sHibz8AWeF2n25CxXVK8ibpe61xvLEA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">4 测试结果</span>
	</section><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">4.1 抗丢包性能</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">以 5% 为步长，从无丢包率逐级递增到 30% 的随机丢包率，分别评测 AppA 和 AppB 在不同丢包率条件下的语音时延和 MOS 分。测试结果如下：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UDMbzYv33ePcEddklhjiayzHywmwKwQrSHHicribU8tFFibRl4Keiak5iaM7Q/0?wx_fmt=png" style="width: 754px !important; height: 257.39px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UJ5SFXGte2guW8tFyR78TC763zibJJU8K40cZVI859JgibH5QOO86KZ2w/0?wx_fmt=png" style="width: 754px !important; height: 413.931px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上图可以看出，随着丢包率的递增，AppA 和 AppB 的 MOS 分均没有明显的变化趋势，整体的 MOS 分，AppA 高于 AppB。随着丢包率的递增，AppA 和 AppB 的语音时延均表现出先增加后下降的趋势（由于测试时网络状态不同，导致数据结果有一定的差异性），整体的语音时延，AppA 的大于 AppB。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">4.2 抗时延性能</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">以 50ms 为步长，从 0ms 的网络时延逐级递增至 400ms，分别评测 AppA 和 AppB 在不同网络时延条件下的语音时延和 MOS 分。测试结果如下：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UD7vn1GCWr3ptzrQ8fRZQB0pzSvOqTQmwHM9t16MDzTDAtEZZVo7xvQ/0?wx_fmt=png" style="width: 754px !important; height: 254.38px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UnyAdsVkkIPPqWRKqibnCn5qeMC4l5wCmiaGlSMic7NMPoKNf58RIwVTaQ/0?wx_fmt=png" style="width: 754px !important; height: 429.98px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上图可以看出，随着网络时延的增加，AppA 的 MOS 分整体处于轻微的下降趋势，下降幅度不明显，AppB 整体趋势较平稳，MOS 分变化不大。在语音时延方面，随着网络时延的增加，AppA 的语音时延整体处于增加趋势，且增加幅度较大，无网络时延时的语音时延为 400.92ms，当网络时延 400ms 时的语音时延为 489.44ms；AppB 的语音时延随着网络时延的增加变化不大。整体看，不同网络时延下，AppA 的语音时延高于 AppB。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">4.3 通话过程中语音时延的变化情况分析</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">通过分析不同网络时延下的语音时延数据流，观察不同的网络时延条件下，从通话开始到通话结束整个过程中，不同 app 的语音时延变化情况。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4Ub21sPErmP15j8EVLQ2WVlNnPticqRckia7dYXxW6LlicbicF8Vn1Ybkbyg/0?wx_fmt=png" style="width: 754px !important; height: 410.924px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">注：上图中横坐标轴表示的是通话 20 分钟左右的语音时延数据，每通通话取 100 组数据来分析。粗略估计第 10 组数据大概在通话 5-10 分钟左右。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上图可以看出，网络时延较大的条件下，AppA 在通话开始的几分钟，语音时延一直处于较高的状态，大概通话 10 分钟左右，语音时延数据逐渐趋于平稳，并可维持平稳状态一直到通话结束，因此可以推测，AppA 在通话开始时质量不是很稳定，但是随着通话时长的增加，会逐步进入一个较好的通话质量状态。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从 AppB 的数据上来看，无论网络时延增加到多少，AppB 的语音时延从通话开始就一直处于一个平稳状态，但是在通话过程中，会有偶尔的语音时延波动，可以推测，AppB 的整体通话质量较平稳，但中间偶尔会有质量不佳的情况。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">4.4 噪声抑制</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">使用语音音量（图 4-1）和噪声音量（图 4-2）的 Average RMS Power 差值进行比对，单位是 dB，一般为正数（语音音量大于噪声音量）, 差值越大，NS 效果越好。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UdWKDmEoZMpgfR7wd9eaicFMIIjsnArMQwUtpdxkkkPxUk05N7hadb1Q/0?wx_fmt=png" style="width: 754px !important; height: 379.188px !important;">图 4-1 截取的 200ms 语音（非噪声）部分音频</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UMNIHyXuF3MqDlykvpjUneQCHRGzDH6xck9WOiav0rcq1REmpnRE93wg/0?wx_fmt=png" style="width: 754px !important; height: 382.104px !important;">图 4-2 截取的 200ms 噪声部分音频</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在竞品分析时，可用不同竞品之间的非噪音差减去噪音差，若差值大于 0，则可以认为噪声抑制效果较好。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">注：我们定义播放音量的级别分别为：小音量 =30%，正常音量 =50%，大音量 =70%。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UOdicSwDCPggG4oPq9d2giaHmVN4tg7HBTzjKPn1oBVGibnibDicGJk4JT7A/0?wx_fmt=png" style="width: 754px !important; height: 339.529px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UBOQ5q71ALsCBFGEVV2VnHlRpP6Rm1HYgh0KqBQE2EjQDHcxh4KU2fg/0?wx_fmt=png" style="width: 754px !important; height: 288.408px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上表可以看出，无论是小音量、正常音量还是大音量的条件下，AppA 的非噪声减去噪声的值均大于 AppB。音量越大，差值越大。用 AppA 的音量减去 AppB 的音量得到音量差，用 AppA 的噪声减去 AppB 的噪声得到噪音差，最后用音量差 - 噪音差，得出的值，见上表。在小音量、正常音量和大音量的条件下，所有的差值均大于 0，可以认为 AppA 的噪声抑制效果较好。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上图看出，同一个源声音文件（噪声 RMS 均值为 -32.54dB，非噪声 RMS 均值为 -23.87dB）通过 AppA 输出的音频，小音量时，噪声能量减少 1.21dB，非噪声基本保持不变，正常音量时，噪声能量减少 2.18 dB，非噪声减少 3.37 dB；大音量时，噪声减少 3.97 dB，非噪声减少 6.1 dB。可以看出，对于 AppA，播放音量越大，噪声抑制过程所减弱的音量越多。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">通过 AppB 输出的音频，小音量时，噪声能量减少 7.2dB，非噪声减少 5.87 dB，正常音量时，噪声能量减少 9.54 dB，非噪声减少 8.23 dB，大音量时，噪声能量减少 9.21 dB，非噪声能量减少 7.69 dB。可以看出，对于 AppB，不同音量下输出的噪声和非噪声能量减少相当，无明显差别。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UfEOZgGb5h6bqsGP243s9R08JZPZFUa88sZHJpHXWoEdGIb1XIsNX9g/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">4.5 音量</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">注：源声音文件的 Average RMS Power 为：-18.69dB。见图 4-3.</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UMWfZicvqpRA20ppibRrXAY6d7EH9uayRuOKx8ng8UnZEbAbr0nRXSXBA/0?wx_fmt=png" style="width: 754px !important; height: 347.888px !important;">图 4-3 输入的源音频文件</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">输出的声音文件的音量大小如下表所示：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4Uqm9AccoszOC5qLj5ZzUl4IticlHLYw7cjJj9dwviaTNd9HUDichNl4iacg/0?wx_fmt=png" style="width: 754px !important; height: 174.323px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4Ur1DCAIJWpjl2rxmpRzl4aZolSCwV0NxlDLRkoggWtib302tOZB7q4Sg/0?wx_fmt=png" style="width: 754px !important; height: 366.095px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从上图可以看出，不同的播放音量下，AppB 的输出音量均大于 AppA。其中，小音量时，AppB 比 AppA 大 4.1dB，正常音量时，差别不大，大播放音量时，AppB 比 AppA 大 2.0dB。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从变化趋势上可以看出，AppA 的播放音量越大，输出的音量也越大，AppB 在小音量和正常音量时，输出的音量无明显差别，但是在大音量时，输出的音量相应增加 2.19dB。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UH8Vic7czicPQiaUCdiaXce2O3Vd41sHibz8AWeF2n25CxXVK8ibpe61xvLEA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">&nbsp; 5 小结 &nbsp;</span></section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">影响语音质量的因素是多维度的，主要包括时延、丢包、抖动，这也预示着 VoIP 对网络的强依赖性。语音质量的好坏是影响用户体验的直接因素，因此对 VoIP 语音质量进行客观有效的分析和测量是十分重要的。本文介绍了利用脚本和工具分析时延、音质、音量、降噪等不同指标的客观评测方法，并且把具体的案例结果呈现出来以供探讨。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">活动推荐：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobZOSjfyqDyPYvONyLKQI4UVmv7gEs4m6OQmrzB4PH35AFAYkDWJsxG6469rUAtn5BDfRpLLMZnYQ/0?wx_fmt=jpeg" style="width: 770px !important; height: 372.167px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><span style="font-size: 14px; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">推荐一个不可错过的会议：ArchSummit全球架构师峰会，邀请了上百位国内外顶尖技术专家前来分享各业务的核心架构设计，从Web协议底层优化到超级App的系列魔改，这里只谈最优秀的架构实践。</span></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><span style="font-size: 14px; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">距离大会7月7日开幕仅剩两周时间，点击“<span style="font-size: 14px; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif; color: rgb(0, 122, 170);">阅读原文</span>”可获取100+落地案例，如需报名，可直接识别下方二维码联系大会售票天使豆包，欢迎骚扰。</span></p></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1498052897&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ7-8QvqdVS8MW3jRrcyNomW8ZclZ9pUNhaTXFh-isL85d2dYoGQD3XUeAmjjysz8xcR1J4OcnzfGLtXNgMetIPqa4CaiHWmIqzBjcZ93Yk1tSyGB8Aao7dk84wKHlYePkhotgzSYC4Na1M-umw94bwU=">微信地址</a> | <a href="http://sz2017.archsummit.com/speakers?utm_source=wechat&amp;utm_medium=bornmobile&amp;utm_campaign=ads9zhe">阅读原文</a>
{% endraw  %}

