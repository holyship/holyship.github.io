---
title: SDK如何进行自动化测试？
author: 吴玉强、王飞
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1512889070&src=3&ver=1&signature=0dsH*cvrb7sDcdE*f0PtKBS-dfm53e69UIAI7OFZCkuYfVmPeeq9rBeacTsaEtwx0jMr*eJ24ixB3jT9*4pUUK-vNbdc7r5MBvJ7YEoTarZtmS0i6-n3hQ*uwL6l709E4I96jKQG1NHDTUpemng3vLzZbq4TFMAOB52HzQnUiVw=
date: '2017-12-04 00:00:00 +0000'

---

{% raw  %}
<section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1em;color: rgb(145, 145, 145);margin-top: 13px;font-size: 14px;white-space: normal;background-color: rgb(255, 255, 255);padding-left: 14px;">作者｜【友盟 +】高级无线开发工程师 吴玉强、王飞</section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1em;color: rgb(145, 145, 145);margin-top: 13px;font-size: 14px;white-space: normal;background-color: rgb(255, 255, 255);padding-left: 14px;">编辑｜覃云</section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;white-space: normal;font-size: 15px;text-align: justify;line-height: 27px;color: rgb(89, 89, 89);background-color: rgb(239, 239, 239);padding: 19px;margin-top: 40px;margin-right: 8px;margin-left: 8px;">为了确保 SDK 线上运行的稳定性，我们需要在开发后进行 SDK 测试，而为了提高测试效率，而且在拓展新项目的同时能兼顾已有项目的稳定性，在有限的资源内解放测试人员到更紧急的项目中来，就需要一个自动化工具来完成工作，【友盟 +】首创自动化工具，能够自动传不同参数、抓取输出数据，并自动验证数据准确性，输出结果，保障项目顺利稳定发布。</section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">相对 App 的测试方案，市面上已经有非常多且成熟的 UI 级别的自动化测试框架，却鲜有针对 SDK 提供的自动化测试方案，原因是 SDK 属于为 App 提供服务的“插件”。一个 App 可接入一到多个 SDK 在内，而在项目中模块化是非常普遍的架构，所以 SDK 是针对细分功能提供服务的组件，有的提供数据服务、地图服务或节省开发成本的组件等等，这只能 SDK 开发者根据功能自行完成测试。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">本篇说明的 SDK 测试方案是针对数据服务的 SDK 功能覆盖，皆包含 SDK 的 API、网络数据及缓存相关的逻辑测试，即非 UI 的纯数据逻辑的覆盖。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">本篇是自动化测试基础上的延伸，相对安卓系统可以便利的通过 adb 指令控制如 App 安装、卸载、退出应用等“系统”级操作，iOS 在控制 App 层面上只能通过一些间接的手段完成上面几点需求，为了易于维护，在控制器中以有限状态机模式进行了构造，以便于后续增加更多的操作状态和测试用例。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;height: 58px;line-height: 80px;color: rgb(60, 112, 198);border-bottom: 2px solid rgb(27, 95, 160);background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoTERpGkOsp89uOFFcnKpL4n9ib4wSiaOzOpVbrXY6j6gY56ic4gbjpUoBA/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat;margin-top: 38px;margin-bottom: 10px;padding-bottom: 7px;display: inline-block;">一、测试框架概览</span></section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">1、测试框架</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">整个测试流程就如下面描述的有向图，以 Pytest 驱动客户端执行任务，然后将客户端输出的请求数据进行截取处理，而后验证是否通过测试用例。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjo2wdJpcBaE1CwWKzrYic28nHujRekibIic3E6icfzn9Fiaic0hqwabHyMv2HQ/0?wx_fmt=png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 693px !important; height: 469.219px !important;"></p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">2、Android 端测试框架</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">Android 可以使用 adb 命令与 app 进行数据上的通信，如发送广播，启动 Activity 等。同时也可以使用 shell 命令对配置文件进行修改，再进行 gradle 编译，实现对 app 级别参数的修改，从而完成不同参数对 app 程序影响的验证。</p><p style="text-align: center;"><img src="https://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoFlwb0VeeuXVOIvQWL7fWTVRv2Y5BicJfAx4bb5esN9EmrA4mmiboEAdA/0?wx_fmt=png" style="width: 770px !important; height: 648.814px !important;"></p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">3、iOS 端测试框架</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">iOS 由于系统特性，无法如安卓系统灵活运用系统命令来操作 App 或 SDK，所以以一个 Socket 连接 Server 端进行通信。另外在 iOS 系统上又可利用 Runtime 的特性，将传输的字符串转化为 API 调用，这样做的好处是将 Socket 模块和 Runtime 解析模块编入应用中就无需再次打包，只需 Python 端编好代码和测试 case，所有的功能调用都由两端约定的协议解析执行即可。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoLN4XwLktAG9BkmGTIvHIWWzzCd5ypEt5Bwu9oibafr7QaqsPfMQeaWg/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 314px !important; height: 539.914px !important;"></p><p><br></p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;height: 58px;line-height: 80px;color: rgb(60, 112, 198);border-bottom: 2px solid rgb(27, 95, 160);background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoTERpGkOsp89uOFFcnKpL4n9ib4wSiaOzOpVbrXY6j6gY56ic4gbjpUoBA/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat;margin-top: 38px;margin-bottom: 10px;padding-bottom: 7px;display: inline-block;">二、Android</span></section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">1、SDK 接口的验证</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">对于集成 SDK 的 app，如果需要在 App 运行时，触发一个行为，可以通过广播来实现。可以根据 action name 完成对行为类型的分类，根据 caseid 完成对行为的区分。如下图所示：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoHyNudfChUiahficANFdfyxO0QnJbnzbY5wiad4z03fCPSAJAVIgJPOwng/0?wx_fmt=png" style="width: 770px !important; height: 585.484px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">根据上图示例如下：</p><pre style="box-sizing: border-box;overflow: auto;font-size: 13px;padding: 9.5px;margin: 30px 8px 0px;line-height: 1.42857;word-break: break-all;word-wrap: break-word;color: rgb(91, 172, 235);background-color: rgb(50, 50, 50);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;"><code style="box-sizing: border-box;">os.system( &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"adb shell am broadcast -a com.umeng.auto.track --es param \"" + str(es) + "\" &nbsp;--ei caseId " + bytes(ei))</code></pre><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">其中 com.umeng.auto.track 为广播的 action name 用以区分类别ei 为一个 int 数，相当于图中的 caseides 为参数内容，参数的协议可以自由定义，建议使用 json 类型，方便对不同类型的数据进行处理这样，我们只需要在广播中以 ei 写一个 switch 语句，执行不同的行为，如果测试不同参数的效果，可以使用 es 传递内容。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">2、Activity 级别初始化的验证</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">如果使用广播，是没办法绑定生命周期，即如果 SDK 需要在 Activity 的<span style="color: rgb(255, 41, 65);"> onCreate() </span>中进行一些类初始化操作，是没法进行控制的。所以对于这种情况就需要使用 adb 命令中的启动 Activity 命令，基本流程与广播类似，但是 caseid 的处理在 <span style="color: rgb(255, 41, 65);">onCreate() </span>中：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoZjPcyUYh9yp3GicDJlcuJ6OobqXzbjliblY5VT4QCoGfibrYVeNPsxEyQ/0?wx_fmt=png" style="width: 770px !important; height: 568.172px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">根据上图示例如下：</p><pre style="box-sizing: border-box;overflow: auto;font-size: 13px;padding: 9.5px;margin: 30px 8px 0px;line-height: 1.42857;word-break: break-all;word-wrap: break-word;color: rgb(91, 172, 235);background-color: rgb(50, 50, 50);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;"><code style="box-sizing: border-box;"> os.system("adb shell am start -n " + self.pkgname + "/." + activity + " --es param \"" + str(es) + "\" &nbsp;--ei caseId " + bytes(ei))</code></pre><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">其中 pkgname 为包名，activity 为 activity 的名字 es 为需要传入的内容，ei 为一个 int 数，即 caseId。与广播方式类似，只是将 switch 放到了 onCreate 中，根据 ei 和 es 进行相应的操作。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">3、Application 级别的验证</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">以上说的两种方式几乎可以涵盖 SDK 测试的部分 case，但是对于部分 SDK，初始化需要在程序一启动的 Application 中执行，这时上面的两种方式显然满足不了需求。这时有两套方案可以应对。如下图所示：</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjou86LpdnVlJO5HeiaRiakicbn3518Tj4fGf82gIGIWAmjgEHk1kBODIWiaQ/0?wx_fmt=png" style="width: 770px !important; height: 690.345px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong>二次编译</strong></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">如上图所示，左边的部分，我们可以通过修改 Java 文件完成对 Appliction 中内容的修改，如在 Application 中会有一些静态常量，使用 python 修改 java 文件中的常量，并重新运行：</p><pre style="box-sizing: border-box;overflow: auto;font-size: 13px;padding: 9.5px;margin: 30px 8px 0px;line-height: 1.42857;word-break: break-all;word-wrap: break-word;color: rgb(91, 172, 235);background-color: rgb(50, 50, 50);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;"><code style="box-sizing: border-box;">def changeConstant(self, source,des):
 &nbsp; &nbsp; &nbsp; &nbsp;path = os.path.join(os.path.dirname(sys.path[0]), &nbsp;'autotestAndroid')
 &nbsp; &nbsp; &nbsp; &nbsp;gradle_path = os.path.join(path,'app','src','main','java','deep','autotest','utils','Constant.java')
 &nbsp; &nbsp; &nbsp; &nbsp;print '-----gradle_path----',gradle_path
 &nbsp; &nbsp; &nbsp; &nbsp;if os.path.exists(gradle_path):
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;build_file = open(gradle_path, 'r+')
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lines = build_file.readlines()
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for i in range(len(lines)):
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line = lines[i]
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ' '+source in line:
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;arr = line.split('=')
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line = arr[0]+ '='+des+";\n"
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lines[i] = line
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;build_file = open(gradle_path, 'w+')
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;build_file.writelines(lines)
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p = buildprocess.CompileProcess(path)
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;p.start()


 &nbsp; &nbsp; &nbsp; &nbsp;else:
print 'nonono='+ gradle_path</code></pre><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong>使用这种方式的好处是：</strong></p><ul style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">可以直接修改 Application 中的常量，如 AppKey 等，不用管是否执行了 <span style="color: rgb(255, 41, 65);">Application 的 onCreate()</span></p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">不用考虑外设情况</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">同样适配对 <span style="color: rgb(255, 41, 65);">AndroidManifest.xml </span>的测试</p></li></ul><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong>缺点是：</strong></p><ul style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">需要绑定工程路径</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">文件内容类型较多，容易出错，代码不具备通用性，有一定的二次开发难度</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">需使用 gradle 重新编译，如工程较大，耗时较长</p></li></ul><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">配置文件</strong></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">除了上述方法，也可以在 Application 中读取一个 SD 卡配置文件，根据配置文件的协议进行对应的操作。每次只需更改配置文件的内容，并通过 adb push 放入 SD 卡指定路径中，然后重启 App 即可。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">这样做的好处是：</strong></p><ul style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">配置文件的协议可以随意定义，更灵活</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">配置文件可以使用 json 格式，修改更简单</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">只需推到 SD 卡，耗时更少</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">不需要绑定工程路径</p></li></ul><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">缺点是：</strong></p><ul style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">只能在 Application 的 onCreate 之后进行，局限性较大</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">依赖外设 SD 卡</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">AndroidManifest 的测试无法使用</p></li></ul><p><br></p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(63, 63, 63);font-size: 20px;text-align: center;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;height: 58px;line-height: 80px;color: rgb(60, 112, 198);border-bottom: 2px solid rgb(27, 95, 160);background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoTERpGkOsp89uOFFcnKpL4n9ib4wSiaOzOpVbrXY6j6gY56ic4gbjpUoBA/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat;margin-top: 38px;margin-bottom: 10px;padding-bottom: 7px;display: inline-block;">三、iOS 端 SDK 自动化测试流程</span></section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">1、引入“守护”App</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">如「iOS 端测试框架」所见，此时进行通信只有一个应用，这个应用就是我们用来测试 SDK 的 Demo，通过这个宿主我们可以触发 SDK 提供的任何 API，通过 iOS runtime 我们可以触发 SDK 的类方法、实例方法甚至是私有 API，但这写都只局限于一个应用“沙盒”内，如上面说到的安装、卸载及 App 退出和切到后台就无能为力了，所以我们引入了另一个 <span style="color: rgb(255, 41, 65);">Demo(Watch Demo)</span>，通过两个 Demo 的协同操作满足“沙盒”之外的需求。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoxWHkKwb8PGuibtibZ6IvnpibxvgrRe7JpXGV9zPgdOLCcYauicG8URzhzw/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 304px !important; height: 522.719px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">两个 App 互相唤醒和通信</strong></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoDXKh2qkrBkGM0apVSRlUUZpiaZaicYIHQKYeibTpGlKBtQB2Fl760ZqwA/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 309px !important; height: 531.317px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">如上面提到的，所有功能调用都基于约定的协议来执行的，协议的设计也是不断新增的测试需求改造的。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">2、业务协议</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">最初 Server 端与客户端以测试用例的 case id 来区分需要触发的事件，后来 case id 所代表的含义太多，而且客户端也是以运行时不断调用 Server 端发送指令的形式表现执行的具体功能，所以转为一条执行序列更加灵活及方便扩展。一个测试用例可分为多条执行序列，执行序列内的协议包含了需要进行的方法调用或事件的处理。以 Dplus 为例，如下数据包含了部分操作的执行序列：</p><pre style="box-sizing: border-box;overflow: auto;font-size: 13px;padding: 9.5px;margin: 30px 8px 0px;line-height: 1.42857;word-break: break-all;word-wrap: break-word;color: rgb(91, 172, 235);background-color: rgb(50, 50, 50);border-width: 1px;border-style: solid;border-color: rgb(204, 204, 204);border-radius: 4px;"><code style="box-sizing: border-box;">"operations": {
 &nbsp; &nbsp;"$umeng_cloudayc_op9": {
 &nbsp; &nbsp; &nbsp; &nbsp;"arguments": {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"param": [
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"$umeng_cloudayc_op*"
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;]
 &nbsp; &nbsp; &nbsp; &nbsp;},
 &nbsp; &nbsp; &nbsp; &nbsp;"type": "class",
 &nbsp; &nbsp; &nbsp; &nbsp;"class": "DplusMobClick",
 &nbsp; &nbsp; &nbsp; &nbsp;"method": "track:"
 &nbsp; &nbsp;},
 &nbsp; &nbsp;"$umeng_cloudayc_op5": {
 &nbsp; &nbsp; &nbsp; &nbsp;"arguments": {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"param": []
 &nbsp; &nbsp; &nbsp; &nbsp;},
 &nbsp; &nbsp; &nbsp; &nbsp;"next": "$umeng_cloudayc_op9",
 &nbsp; &nbsp; &nbsp; &nbsp;"type": "class",
 &nbsp; &nbsp; &nbsp; &nbsp;"class": "DplusMobClick",
 &nbsp; &nbsp; &nbsp; &nbsp;"method": "clearSuperProperties"
 &nbsp; &nbsp;}
},
"type": "invoke",
"description": "401",
"first": "$umeng_cloudayc_op5"</code></pre><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">由于是针对 SDK API 测试的协议，所以协议内的格式以调用的类名、方法名及参数为主，再加上部分细节参数加以说明，如 type 是 class 则调用类方法，是 instance 是示例方法。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">需要注意的是，这个队列的结构是个字典，以标识前缀 <span style="color: rgb(255, 41, 65);">$umeng_cloudayc_op </span>作为一个子事件的 key，value 则是其执行参数。而且可以看到在参数 param 的 value 里也有和子事件的 key 类似的值，这里的设计也是为了满足部分嵌套调用的需求。举例来说，如此时需要通过一个接口验证之前缓存的数据是否发送正常，就要分三步，第一存储数据，第二将数据读出，第三将第二步的结果作为参数传入最后调用的接口即可，这样既能满足各种嵌套逻辑，又能实现远程构造客户端系统的实体对象作为参数进行接口调用。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">回到上面的字典的结构，实际上在之前的协议格式使用的是数组作为执行序列的封装格式，不过在实际应用中无法满足灵活的要求，就如上面所说的组合的调用逻辑，有部分子事件是被动调用的，通过在其他事件内的参数检测来触发调用，如果是数组则无法控制这个执行序列的依赖关系。采用字典后，增加启动字段，在后续关联的子事件内，都会说明下一个执行的子事件，如果某个子事件是作为另外子事件的参数，则不会有 next 字段，因为它是被动触发的，不在执行队列之内。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">在这个业务协议开发过程中，不断的根据测试需求进行改造、添加，从一开始的单一应用调用接口，到后面的多应用切换、前后台切换以及应用断开和重连，需要多套控制流程，在具体实现时，分散到了各个业务逻辑中，每增加一个控制都要兼容考虑是否会影响到其他模块，而且作为一个自动化测试“框架”，提前梳理好核心部分的流程会让之后更易于开发和维护，所以就引入了有限状态机的概念进行构造。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">3、有限状态机</span></section><p><br></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoXQMgMzAmA8o6ficUumMAicNtOs0xRjt8y2FFw9H2ae1NYibia9ul9Vko9g/0?wx_fmt=png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 693px !important; height: 460.887px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">有限状态机（Finite-state machine）可用于模拟很多事物逻辑，顾名思义，它是一个有限的状态的处理逻辑，有下面几个特征：</p><ol style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">状态数是有限的；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">在当前时刻只有一种状态存在；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">一个状态在满足某个条件后会切换到另一状态；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">而有限状态机整体可以归纳为四个要素：现态、条件、动作以及次态。</p></li></ol><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">现态指当前时刻所表现的状态</strong></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">条件又称为事件，即当前状态在满足这个条件后会触发一个动作，从而进行状态装换动作即在现态满足条件后需触发的一系列操作，动作完成后即状态进行迁移。动作也可以忽略，在某些情况下，现态满足条件后，也无需执行任何动作就切换到新的状态。次态是相对现态而言，表示了条件满足后迁移的状态，次态也可以与现态相同。根据业务逻辑的特性及复杂程度，合适的使用有限状态机，可以使得逻辑表达清晰、封装及维护都很直观和方便。当一个业务包含的状态越多，就越适合使用优先状态机进行封装处理。有限状态机应用非常广泛，如电子电路、编译器及网络协议 TCP 协议状态机等</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">需要注意的是要区分“动作”和“状态”，如果将“动作”也视为“状态”会导致编写状态机时产生问题。</p><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4、有限状态机应用自动化测试</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">将业务逻辑应用到有限状态机，前提是需要熟悉对应的业务，并将其中的状态、动作和条件等抽离出来，然后再做进一步的划分和关联，构造出一个完整的有向图。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">在自动化测试中，有如下几个关键词：启动测试、监听、主 App 连接、守护 App 连接、接口调用、进入后台、进入前台、应用退出、崩溃、断开连接、重连等。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">在日常开发中，如果遇到上面的”事件”，可能就顺其自然的开始写判断、写调用，可能不自觉的就写出了一个“有限状态机”，不过不会那么严格的区分什么是动作什么是状态，只要满足最后的结果就能达成目的。但现在我们有意识的利用有限状态机进行划分，分离出状态和动作以及状态迁移的条件。看上面的关键字，好像都是一个个“动作”，仔细看“监听 (中)”又可能是一个状态，但实际上我们还得需要结合业务的理解再抽象出一些状态，如“进入后台”，则是跳转到了守护 App，当前是控制守护 App 的状态；若是“进入前台”则守护 App 跳转到了“主 App”，是控制主 App 的状态。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">如下图就用刚才抽象出的关键词构造了一个简单的有限状态机：</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjoAiax0icAgXhacnghnH2qzjzlpXX9SlO0sBLM0pWsH7iahZlIxQia7Pg1kg/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 433px !important; height: 472.202px !important;"></p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">按图说明：</strong></p><ol style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">如架构图描述的，需要主 App 和守护 App 同时连接才可执行测试；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">在连接完成后，状态直接迁移到等待测试指令的状态，没有任何动作；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">有些组合状态可以合成一个状态，如运行守护 App 状态时可能主 App 断开连接，也可能保持连接，所以区分为两态分别管理；</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">当自动化测试框架启动后，除了监听两个 App 同时连接，其他状态都是在已有 App 连接完成的前提下进行的，所以大部分时间是在执行测试 case 调用及 App 切换的。</p></li></ol><section class="" style="margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);background-color: rgb(255, 255, 255);"><span style="margin-right: 10px;box-sizing: border-box;display: inline-block;width: 15px;height: 15px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobI1MiaUeOMYzg2iahCbOgEgm4VWHrXGfvpSX7goSzO7GdZo12gKkrjZ2mTwQCAPRYWKh6bJnicr0Sjw/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">移动开发前线</span></section><p style="padding-top: 23px;padding-right: 8px;padding-left: 8px;font-size: 16px;box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;"><strong>「移动开发前线</strong>」是 InfoQ 旗下关注移动开发技术的垂直社群。投稿请发邮件到 editors@cn.infoq.com，注明“移动开发前线投稿”。</p><section class="" style="white-space: normal;box-sizing: border-box;color: rgb(63, 63, 63);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;font-size: 14px;background-color: rgb(255, 255, 255);width: 429.5px;text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobI1MiaUeOMYzg2iahCbOgEgm0NfxUHdjxSq0EP2DxpJkoQEgGCcNiaqrTib6ccdv7bPDQEFOQf8icRibiaA/0?wx_fmt=jpeg" style="margin-top: 28px; margin-right: auto; margin-left: auto; padding-right: 8px; padding-left: 8px; box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 429.5px !important; height: 229.493px !important;"></section><section class="" style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;line-height: 1.1;color: rgb(60, 112, 198);margin-top: 30px;margin-left: 8px;font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box;display: inline-block;width: 15px;height: 15px;margin-right: 10px;background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjokWUa5oDoM8AwiaIGyAn38UJMMsERPsoqibDibGpaTQJ2XxtFk7fmWE5TQ/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">新时代的移动开发</span></section><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">移动工程化的本质是将复杂问题简单化，从而在业务不断增长，人员不断增加，代码不断膨胀的过程中，始终保持着研发效能的高效，实现化繁为简的过程。</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;">伴随着大前端时代的降临，12 月 8-11 日，ArchSummit 全球架构师峰会即将于北京举行，我们想给你这个时代下来自各资深技术人们在移动领域最重要的经验值：</p><ul style="" class="list-paddingleft-2"><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">阿里菜鸟技术团队全栈化之路：开发全栈前端</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">阿里 UC 浏览器容器化架构</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">饿了么移动性能可视化建设</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">滴滴国际化、跨地域 iOS 构建优化与持续集成</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">美团客户端架构演进</p></li><li><p style="box-sizing: border-box;font-size: 16px;text-align: justify;white-space: pre-line;color: rgb(74, 74, 74);line-height: 1.75em;">京东金融移动端多业务集成解决方案</p></li></ul><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><strong style="box-sizing: border-box;text-align: left;">目前大会 9 折报名最后一周</strong>，大会完整演讲目录，可识别下方二维码或点击 <strong style="box-sizing: border-box;text-align: left;">阅读原文</strong> 了解，期待和你一同进步！</p><p style="box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;background-color: rgb(255, 255, 255);font-size: 16px;text-align: justify;white-space: pre-line;padding-top: 23px;padding-right: 8px;padding-left: 8px;color: rgb(74, 74, 74);line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobuvZXS0FumC4diaVFX65sjo2TS8hicueibHIdNQSE3E5BG0z8eK6fhNs5XE9IjyYSebKfiatWhOhmMNQ/0?wx_fmt=png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 693px !important; height: 423.5px !important;"></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1512889070&src=3&ver=1&signature=0dsH*cvrb7sDcdE*f0PtKBS-dfm53e69UIAI7OFZCkuYfVmPeeq9rBeacTsaEtwx0jMr*eJ24ixB3jT9*4pUUK-vNbdc7r5MBvJ7YEoTarZtmS0i6-n3hQ*uwL6l709E4I96jKQG1NHDTUpemng3vLzZbq4TFMAOB52HzQnUiVw=">微信地址</a> | <a href="http://bj2017.archsummit.com/track?utm_source=wechat&amp;utm_medium=mobile&amp;utm_campaign=last9text&amp;utm_term=1120">阅读原文</a>
{% endraw  %}

