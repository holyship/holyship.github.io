---
title: 京东iOS客户端组件管理实践
author: 孙达威
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1502118887&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAhlMmgPuXWYQHwvhScE*LlCQQL39yrptij2vbangBIIfRSPKV6ZhFJeXaAhmJrodyb8hng3CpsVlkVS4-IjiIN0mW2YWE9SiQxZib-VPuU4zWPUBHsxBGqWrHqEgrgpWIO3x3t9Tf7Hp0Mb68Ywj*zU=
date: '2017-07-27 00:00:00 +0000'

---

{% raw  %}
<section class="preface" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">从去年开始，关于 iOS 组件化的讨论和分享非常多，也形成了几种比较成熟的方案。组件多了，它们的依赖关系、版本等的管理成为问题，但这方面的分享很少。京东 iOS 不但实施了组件化，还专门开发了一套组件管理系统。希望京东的实践可以给大家一些参考思路。</section><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">前言</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">先大概交代下背景：京东的 iOS 客户端从 2011 年 2 月发布至今已历经 6 年 + 的时间，研发团队也从最终的几个人变成了 N 多人，业务的复杂度早已不可想象。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我个人认为一个超过了 10 人的团队做组件化是合适的，也有必要。当然少于 10 个人也应该去思考一下应用框架该如何演变、组织的这件事。</p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">目标</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">对于每家应用还得结合实际业务来考虑，毕竟技术最终也是为了业务而服务。京东 iOS 组件化的目的从业务层面来讲主要是为了解决：多业务的并行集成，多部门的业务输出。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">从技术层面来讲我们做组件化的目标是为了可以做到减缓代码腐化过程，加快编译时间，模块分权管理，代码规范，bug 减少，独立开发、调试、自动化编译，集成等等工作（好像很厉害的样子）。更近一步的讲，我们需要一套自动化的系统来帮助我们完成所有的组件管理工作，让开发人员能更专注于代码层面，无需关心应用配置，渠道，以及如何集成等问题。</p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">组件管理演进之路</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">任何事物都有一个演进的过程，就像罗马不是一天建成的一样。iOS 这些年各种技术，花样层出不穷，好多公司，好多大牛在 iOS 组件化方面分享出了好多宝贵的经验，也让我们少走了许多弯路。关于 iOS 组件化的做法每家公司都大同小异，真正需要我们去深挖的应该是怎么把组件有序的管理起来，这也是我们想和大家探讨的内容，在讨论组件管理内容之前我们先简单说明下组件化实现的大概思路。</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">代码解耦</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">Cocoapods 管理</p></li></ul><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">代码解耦</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">首先入手的工作就是代码的解耦，这里其实没有太多的技术含量，只要胆大心细，有计划，一个工程总能被拆成一个个独立的模块。我们把每一个独立的模块就称之为组件，相互之间不能通过硬编码引用的方式进行调用。通信通过自定义的协议进行。</p><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">组件原则</span></section><p><br></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">组件被定义为两种类型的组件：基础组件，业务组件。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">基础组件可以被业务组件依赖，基础组件不可依赖业务组件。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">业务组件不可依赖业务组件。</p></li></ul><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">自定义协议</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">组件之间通信遵循一套自定义的协议通信，实现的方式网上有些开源的项目，我们综合各家实现考虑，最后定出的一个方案：组件间的通信应该是轻量级的，调用完就走，不留痕迹，不需要维护通信数据。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">大致实现如下：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6Ywpe00REKLboUej8K66ibR9W0AXeV307y6XYIbX46HCHZMEJTdXQ0uw/0?wx_fmt=jpeg" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 266.745px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们实现一个 JDRouter 的组件，用来实现组件与组件之间的通信。只暴露一个头文件，两个方法：输入，输出（宏规范）。</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">输入（A 调用 B）</strong></p></li></ul><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">router://JDBClass/getString?name=Steven</code></pre><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">输出（B 被 A 调用）</strong></p></li></ul><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">+(id)getDataWithString:(NSString *)name {
 &nbsp; &nbsp;NSString *str = [NSString stringWithFormat:@"HI, %@", name];
 &nbsp; &nbsp;return str;

}</code></pre><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">输入说明</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">通过 JDRouter 调用，类似于有这样一个方法，完成 a 到 b 的通信</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">id g = [JDRouter openURL:@"router://JDBClass/getString?name=steven" arg:nil error:nil completion:nil];</code></pre><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">输出统一</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">输入的方法统一了，输出也得统一，没有规矩不成方圆，但又不能通过说教的方式要求大家去提供输出方法。如果有一个统一的办法可以不需要协议注册，协议管理的机制，直接写一个类方法可以让 JDRouter 通过 URI 里的内容可以映射过去就好办了，我们使用宏替换，在 JDRouter 里提供一个输出的规范，类似这样：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">#define JDROUTER_EXTERN_METHOD(m,i,p,c) + (id) routerHandle_##m##_##i:(NSDictionary*)arg callback:(Completion)callback</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">输出规范统一，将上面的类方法变为宏替换输出：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">JDROUTER_EXTERN_METHOD(JDBClass, eat, getString, callback) {

 &nbsp; &nbsp;NSString *str = [NSString stringWithFormat:@"HI, %@", name];
 &nbsp; &nbsp;return str;

}</code></pre><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">AppDelegate 入口解耦</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">页面容器，第三方 SDK 初始化工作需要在启动时完成，我们通过 hook AppDelegate，将入口所做的工作交给一个组件完成，在该组件中注册其它需要在启动时调用 AppDelegate 方法的组件，让每个组件都可以拥有一类似 didFinishLaunchingWithOptions 方法。</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">AppDelegateModule 组件实现 hook AppDelegate</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">入口组件</p></li></ul><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">+ (void) load {
NSArray *modules = @[@"MainModule"];
NSString *url = @"router://AppDelegateModule/setDidFinishLaunchingModules";
[JDRouter openURL:url arg:modules error:nil completion:nil];

//
NSString *urlrun = @"router://AppDelegateModule/run";
[JDRouter openURL:urlrun arg:nil error:nil completion:nil];
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 MainModule 中实现 AppDelegate 的方法</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">static UIWindow *gWindow = nil;
static UIViewController *gTempViewController = nil;
+ (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions
{
 &nbsp; &nbsp;gWindow = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
 &nbsp; &nbsp;[[[UIApplication sharedApplication] delegate] setWindow:gWindow];

 &nbsp; &nbsp;gTempViewController = [[UIViewController alloc] init];
 &nbsp; &nbsp;gTempViewController.view.backgroundColor = [UIColor redColor];
 &nbsp; &nbsp;gWindow.rootViewController = gTempViewController;
 &nbsp; &nbsp;[gWindow makeKeyAndVisible];
 &nbsp; &nbsp;return YES;
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">把实例方法改为类方法</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">将需要调用 appdelegate 方法的组件，在 MainModule 中注册，这里的 modules 是个数据，可解决调用 delegate 方法的顺序问题。<code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">NSArray *modules = @[@"MainModule", @"需要调用的组件"];</code></p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">Cocoapods 管理</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">代码解耦很简单，只要遵循几个原则即可，最根本的问题就是业务与业务之间不能有耦合，不然组件化这件事就没有意义。我们通过 Cocoapods 把每一个组件都拆成独立的 pod 库。代码库管理选择 gitlab(开源，提供 API，可二次开发)，后续需要对每一个组件进行权限管理，比如有一些涉及到安全的组件只有安全组的开发人员具体源码权限，其他人只能拿到二进制，再比如组件需要具有 master 的权限才可以进行发布，集成等工作。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">关于 Cocoapods，ruby，gitlab 环境大家网上搜索一下。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">准备工作</strong></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">通过 Cocoapods 搭建私有库，创建相应的模版。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">不推荐 Cocoapods 编译二进制文件，自己写脚本编起来更灵活。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">自定义 gem，完成 podspec 源码二进制切换。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">二进制文件（组件编译为静态包）存储到内部云。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">使用工具／脚本管理 podfile。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">系统管理 pod 库。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">工程结构</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">通过 Cocoapods 搭的自定义库，自定义模版。</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">每个同学拿到的组件都是一个相同结构的工程，所需要做的工作就是在相应的 Pods/Developemnt Pods/ 组件 /Classes 下编码，组件输出类通过模版创建，可在相应的类里使用 JDROUTER_EXTERN_METHOD 提供接口。</p><p><br></p><section class="h2" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: rgb(27, 95, 160); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6XN4KpOnxIyWPUib15mhMPW3xByxGqvj2FZhQic9MibbdTGm0vzOFLH9IA/0?wx_fmt=png); background-size: 77px; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block; background-position: 50% -2px; background-repeat: no-repeat no-repeat;">iBiu 组件管理系统</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">以上是行业中对 iOS 组件化的一个大体思路。如果我们完全手动做这些工作的话，成本会很大，Cocoapods 配置说明查询，组件版本依赖，统一集成等等。为了解决这些人为干预所引发的各种问题，我们研发了组件管理系统 <strong style="box-sizing: border-box; text-align: left;">iBiu</strong>。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">主 App 解耦工作和系统设计是同时进行的，所以最初系统只是为京东 iOS 主 App 所设计，在独立出一些组件后，我们就在思考一件事，让系统可管理京东其它的 App。</p><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">去应用化</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果公司的所有应用全部都组件化，并且组件间统一协议通信，那么应用最终的输出方式应该就像工厂加工一样，加工过程就是组件组合过程，出厂时贴上标签。听起来很理想，事实上是可以做到的，从 iBiu 系统上线到目前一个月时间我们接入管理着三个应用包括主 App，超过 100 个组件。</p><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">组件配置表</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">组件如何组合被抽象出一个组件配置表，记录了不同应用的组件配置，对应到具体的组件责任人，版本，对接产品，测试以及开发，通过工具一键完成组件的发布与集成等工作。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ZX6VKGFkSQk6Wpo5MKuLiaDiaVU1YWg8EVicQaF7rxHFZyDibQZc3WlTvg/0?wx_fmt=jpeg" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 431.574px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">上图解释起来就是，假如有一个虚拟的 App-A，在它下边有包含了一系列的组件，我们可以通过“组件配置表”(配置表里记录了组件的版本，是否为二进制，依赖等) 对组件进行组合，最终输出我们想要的 App。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">再将上边的设计升级一下：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6c18icRgj9Y4svFpZzUq6qIgY5fgHMhzqtw5vlic6vs0dsw7Ej06xVicuA/0?wx_fmt=jpeg" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 386.51px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">让应用可以包含应用（这里所说的应用是一个虚拟的应用，或者叫做 Collection 更合适）。Collection 可以任意包含另外的 Collection，同时可以拿到 Collection 下的组件，如上图，App-A 这个 Collection 最终是有另外三个 Collection 下的组件所组合而成。</p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">系统设计</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">主要由三大块内容构成：</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">脚本（提供开发环境，如果 pod 管理，git 管理，文件管理等）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">iBiu 工具（可视化）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">iBiu Server（后台管理，API）</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6iaEBn7X6ZiaC5OjC7Ttfm6dMicxOabOq7BicunaBQ5HkKDuv3wRcVCcrww/0?wx_fmt=jpeg" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 511.581px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们希望化繁为简，最终开发同学只需要安装一个可视化的工具就可以做到：组件注册，组合，发布，集成等工作，但基础工作还得一步步的来。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第一步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">通过 pod 命令创建相应的组件对应库</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border: 1px solid rgb(204, 204, 204); border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; font-variant-ligatures: normal; orphans: 2; widows: 2;"><code style="box-sizing: border-box; font-family: Menlo, Monaco, Consolas, 'Courier New', monospace; font-size: inherit; color: inherit; background-color: transparent; border-top-left-radius: 0px; border-top-right-radius: 0px; border-bottom-right-radius: 0px; border-bottom-left-radius: 0px; white-space: pre-wrap;">pod lib create $lib_name --template-url=${TEMPLATE_URL}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第二步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">将创建组件的脚本封装，我们希望把脚本放到 iBiu Server 这台机器上，让这个过程成为: 开发者注册 -&gt;审核 -&gt;自动生成组件 -&gt;代码提交 Gitlab-&gt;通知开发者。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">问题一个接一个的出现了：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">坑：</strong> 由于公司网络原因，不同网段同学无法访问一台工作网络环境中的机器。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">坑：</strong> 脚本创建组件这个过程依赖 Xcode 环境。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">也就是说我们无法用一个 Mac 机器充当服务器，但又必须要 Xcode 环境。第一想法就是把 iBiu Server 部到线上环境，找一台 Mac 机器把脚本放上去，让 iBiu Server 访问这台 Mac，但线上环境是完全返向不回来工作网络的。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">坑：</strong> 换线下环境，部署 iBiu Server，还是访问不了工作网络中的这台 Mac。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">最后只能在 iBiu Server 这台机器上部了套 Jenkins，生成组件的脚本部在 Mac 这台节点上，问题解决。（这块一直是个不太理想的做法，为了解决问题也只能这么做了）</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第三步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">统一用户体系，ERP 账号与 iBiu、Gitlab 打通。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第四步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">修改 Podfile</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果是手动引入组件的话，每一个组件对应的 Podfile 可能会是下图这样，该组件所有的开发者，对该组件引入修改都有可能造成冲突。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6Gx4PwYbDu2icGk6nS8orRX5TvN9FicLiaolrANibCwhGgJUsYEqC0tJfrg/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 311.877px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果可以通过 Podfile 读取到“组件配置表”，而配置表又可以同步的话，能解决的问题就不只是冲突的问题了。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们创建了一个 biu gem，用来去处理配置表解析的工作，Podfile 最终变成下图的样子，开发者无需手动修改它。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6W4cXI5pnJiaF6DGQOhcC4jLoRVcIIJ0h6yGckHI5sq9F5a4f9tFhLEw/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 107.221px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">所有工作都通过 mekeup_pods 这个方法完成。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第五步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们需要把每个组件在发布时都对应二进制文件输出，有关 xcodebuild 打包二进制的脚本就不在这里描述了。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">将二进制统一输出为一个 xxxx.framework，也方便查看</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6GDGrgdt6v8vD0QIgcT8c3Q7rFEa0QOpQOjQicn26LQDcWbIWeTzrr2A/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 216.353px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">脚本会把每次编译的负责人信息写到 xxxx-umbrella.h 文件中，方便问题跟踪。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6WiaIx5Guq3yicNpD47LXYVl1VGicaYxibxggBrtZc2iaAts7pWpvSmA9rFw/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 158.827px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第六步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">将所有 shell 脚本通过 Packages 打包，提供给所有开发者可以直接使用。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第七步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">iBiu 可视化工具 iBiu Server 端开发，工具主体功能的开发时间并没有花了太多的时间，主要时间还是花在了梳理整个管理流程上。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">第八步：</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">合并 iBiu 脚本，可视化工具，Packages 打包。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6mzuC0RCW5k347E0qz7Oo8iaE6ERbK1Gicbq3nEymEfDUH3VClc7eftkA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 325.64px !important;"></p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">组件管理实践</span></section><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">系统及可视化工具</span></section><p><br></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">通过工具申请组件</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6pphfZwQicLHeIQHciaiaWkq3exZiaXLm8ia06QAMWSzu4Tw5ibzSrQqTRtmA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 360.319px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">开发者选择对应的 App，输入相应的组件名等信息，将注册信息提交给 iBiu Server，系统管理员会收到注册邮件，在后台完成审核。同时会系统邮件发给相应的开发者。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">审核过程通过前面提到的，系统会自动完成创建 pod 库，git 库，开发者权限分配等操作。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">组件申请人即是该组件的负责人，拥用开发者权限分配，组件发布，集成，协议管理等权限。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">后台管理开发者权限分配：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6qC5uVQUEXpjxcnE3TxDmTdasDjdeUibIvEUJovaIfksFh83vHUN4Dpg/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 324.042px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">开发调试组合安装</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">开发者收到组件审核邮件后，根据 git 地址拉取代码，通过 iBiu 可视化工具打开组件工程，勾选要组合的组件进行安装。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">所勾选的组件可以根据当前用户的权限分源码与二进制两种方式，是否依赖。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果某用户所组合的某个组件需要调试，但没有源码权限，可找该组件的负责人要求开通权限。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y65WaYRnZmSicOnKYFnTGJg3FMIUgHuBe1wkfZ0IwjHuusgJUCKpUtxeA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 283.276px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">生成组件配置表</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6uiawypSybYE1q6m1I7PgPgzDb275TN6NHTrgTiajoib6dyeJwVP5jROZA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 280.409px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">根据所勾选的组件，生成一张组件配置表，这时所组合安装生成的 App 即是一个根据配置表生成的工程。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">坑：</strong> 配置表是脱离组件工程独立存在的一个 JSON 描述文件，因为每个开发者对每一个组件所拥有的权限不一样，如果把配置表随工程代码一并提交，很可能造成表冲突，安装不了组件。解决办法就是使拥用 master 权限的用户可以将表内容同步至服务端，组件参与者下载同步表。然后在几个关键点验证表中组件对应权限，没有源码权限的提示用户自动切为二进制方式。</p><p><br></p><section class="h4" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6NX2ichzN3ibvYo49vTQIR5XfQ039pWpfyDiaT013pxWu2Oe9C3J5icNMQw/0?wx_fmt=png); background-size: 100% 100%; background-position: center center; background-repeat: no-repeat no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">组件安装过程</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6UMaQlHDOjH3nhN0hHldlTLib7guCmkCBQiaTUHibWQrzdibD2hUhHcPpfw/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 287.058px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">配置版本组合安装</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">拥有组件 master 权限的用户可以将相应组件发布，集成到某个应用下的某个版本。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们的应用迭代周期一般为一个月左右，对应到不同的项目，不同的产品，研发及测试。通过 iBiu 系统可以做到并行版以本开发，测试，集成。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">组件的发布，集成不受项目的时间限制，随时可以发布。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">App 整体集成，组件的集成需要按项目流程进行，组件需要在 App 回归测试时前两天集成。点击 iBiu 可视化工具右上角集成按扭，选择组件版本，集成到某个应用的某个版本中。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">每个应用的每个版本，在组件集成阶段生成相应的组件配置表，超过这个时间，应用版本锁定，组件将无法再集成到该应用版本中。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">例如应用“京东”当前要发布 AppStore 的版本为 6.1.3，发布时间 7 月 19，倒推时间，灰度 1 周，集成测试为 1 周，那么所有该版本的组件必须在两周前两天完成集成。过期不候，只能按组件上一个稳定版本集成，如果有特殊情况需特殊对待。</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">JDRouter 协议管理</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">每个业务组件都应该提供 JDRouter 接口，通过后台管理这些接口，方便所有开发者查询。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6udaG4iblo7tIdSV8DtbEwDkzjd8YhDyEKQ3jd1Rv0Djp07fcyZBD1YA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 311.125px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; font-variant-ligatures: normal; orphans: 2; white-space: normal; widows: 2; background-color: rgb(255, 255, 255); line-height: 1em;" class=" list-paddingleft-2"><li><p><strong style="box-sizing: border-box; font-size: 16px;">持续集成改造</strong></p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">应用以前是可以持续集成的，iBiu 系统组件管理后需要对持续集成系统做一些改造。在相应的节点机器上安装 iBiu 安装包，运行后自动安装环境。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">CI 通过 iBiu Server 所提供的 API，脚本检测创建 XXXXAppModule（空组件），获取某个应用的某个版本的组件配置表安装组件，完成打包工作。</p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">统一配置</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">组件化带来的一个问题，每个组件独立存在，工程结构类似于这样：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6wUiaOqB4uT7pd8H2HT9JMMbWjk30Vyk9WryibsnNp4kpTnav3TiaXemMQ/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 1001.12px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Example for XXXX 是当前组件在开发过程中所用来测试，验证的 demo 代码。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Pods 为最终组件输出实际工程区域。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">编译组合的组件，输出最终的 App，如果在某个版本需要更新 icon 或启动图怎么办？总不可能让每个组件在 Example 中修改这些资源或数据。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">有没有可以统一这些配置的办法，而又没必要让开发者人为的替换管理？</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">答案是肯定的，我们在 iBiu 可视化工具中加入了应用版本的配置拉取脚本功能。简单点讲就是安装组合时执行远程脚本。在 iBiu 后台针对应用版本配置相应的脚本，可以修改工程任意配置。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6bmW38A7xGsI1r79CJT6VEL4o7b7Vwqcb8Licp2ibWeKBlz9pIq3u7zFA/0?wx_fmt=png" style="box-sizing: border-box; border: 0px; vertical-align: middle; width: 613px !important; height: 307.475px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">这是一段检测替换 icon 的脚本，通过安装组件时可执行远程脚本，能做的事情不仅限于替换个图片这么简单，由于可执行远程脚本权限太大，该功能使用还是需要谨慎。</p><p><br></p><section class="h3" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; font-variant-ligatures: normal; orphans: 2; text-align: center; white-space: normal; widows: 2; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAobskMTbLuKgRGosibPjTq5Y6ADFdQOdumWakicUH1zXcUdgByvlgn9pjMkNlg4zUreSFtHibUpCibNZfA/0?wx_fmt=png); background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px; background-position: left center; background-repeat: no-repeat no-repeat;">最后</span></section><p><br></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">该文章主要描述京东 iOS 组件管理的解决思路，由于内容过多，无法展开细讲每个环节，读者朋友如果对某些细节感兴趣可以留言，我们有针对性的另开专题。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">作者介绍：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-variant-ligatures: normal; orphans: 2; widows: 2; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">孙达威，</span><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">04年参加工作，从后台开发跳跃到前端最终跳到客户端开发的火坑。 2010年加入京东，现负责京东iPhone客户端技术相关研发工作。兴趣较广泛偏文艺，休息时一般会画画，弹琴或者钓鱼。</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1502118887&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAhlMmgPuXWYQHwvhScE*LlCQQL39yrptij2vbangBIIfRSPKV6ZhFJeXaAhmJrodyb8hng3CpsVlkVS4-IjiIN0mW2YWE9SiQxZib-VPuU4zWPUBHsxBGqWrHqEgrgpWIO3x3t9Tf7Hp0Mb68Ywj*zU=">微信地址</a>
{% endraw  %}

