---
title: Fuchsia：Google 从零开始的新操作系统
author: 孙薇 译
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1493907876&src=3&ver=1&signature=jvrZY0qSmN7bPZVZ51WRRQUbNO9vHhyFME78w5MImHul*OXYONSTozrCGLIP-3ry*1pH90RWcvhN**4Dk7bWuiCUQjqYmwKFqFYofHVxf4QRWE7GQiPJdSbZ9t7WMMNR6iQ83d9to*zZfoUfVsPm18*JeH8uzRhNMTlNhlC21aM=
date: '2017-05-03 00:00:00 +0000'

---

{% raw  %}
<section style="color: rgb(63, 63, 63); font-size: 14px; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; box-sizing: border-box;"><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		<strong style="font-size: 16px;">版权声明</strong>
	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		作者：Nur Hussein	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		译者：孙薇	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		原文：<a style="color: #5baceb; word-break: break-all;">https://lwn.net/Articles/718267/</a>
	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		本文为作者授权翻译并发布，未经允许禁止转载。	</section><section class="" style="box-sizing: border-box; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">
		从去年开始，关于 Google 将开发一款新操作系统的传言不断，而本文基本可以证实这个传言了。<br>这意味着 Google 将抛弃 Android 吗？我之前分析过，这个可能性很低，但 Google 将新系统用在新硬件平台上是很有可能的。<br>对于新平台，应用开发者关注的是使用什么语言开发？文中说 Dart 可能借这个系统复活，还提到了 Flutter. 所以说大前端真的的是跨终端开发的趋势。	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Fuchsia 是 Google 开发的一个操作系统，这是一个差不多从头研发的新系统。2016 年 8 月，Fuchsia 的开发新闻在技术新闻网站上引发了轰动，不过很多细节依旧成谜。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Fuchsia 本身是开源的，托管在 Google Source 上（Github 上有个 mirror），无论开发工作还是相关的文档都还在持续完善中。除了该项目为开源之外，Google 并未透露更多信息，包括其真正用途。根据零散分布在网上的文档、源码等信息，我们可以推测：<strong style="text-align: left;">Fuchsia 是一个专为 PC、平板电脑及高端手机所开发的一套完整的操作系统</strong>。</p><section class="" style="box-sizing: border-box; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">
		Fuchsia 源码库：<br><a style="color: #5baceb; word-break: break-all;">https://fuchsia.googlesource.com/</a>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在源码库中可以下载到 Fuchsia 的源码及所有组件，如果诸位喜欢探索实验性质的操作系统，可以尝试一下这个系统——非常有趣。Fuchsia 包含一个内核，其顶层是 User Space 组件，负责提供 Library 及工具。代码仓库中，在 Fuchsia 目录的下面有许多子项目，主要都是协助开发者创建应用的资料库及工具项目。Fuchsia 大部分使用三条款 BSD 许可证（3-clause BSD license）授权，不过其内核是基于另一个项目 Little Kernel（LK）建立的，而后者使用了 MIT 许可证，因此其内核的授权协议是混合型的。Fuchsia 中包含的第三方软件都是根据其各自的开源许可证进行授权的。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAob1DzjrAkZHsISttNfdghR4ejeaGKVpWFAicArKHGiaJpQl2QibYfYUJumErljIVKvE1KVPdqPh1rftw/0?wx_fmt=png&quot;); background-position: left center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">Magenta</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Fuchsia 的核心是 Magenta 微内核，它负责管理硬件，并为系统的 User Space 组件提供抽象层，类似于 Linux 和 GNU 项目的关系。而 Magenta 建立的基础——Little Kernel 则是 Fuchasic 的开发者 Travis Geiselbrecht 在加入 Google 前所研发的一个项目。LK 的目标是要建立能在有限资源的嵌入式硬件（类似于 FreeRTOS 或 ThreadX）上运行的微型内核，而 Magenta 则是针对更复杂些的硬件——需要至少 64 bit 的 CPU，配以一块内存管理单元。因此，Magenta 在 LK 的有限功能上进行了扩展，它使用了 LK 的 “内部构造”，包含线程、互斥锁、计时器、事件（信号）、等待队列、信号及虚拟内存管理器（VMM）。在 Magenta 中，LK 原本使用的 VMM 已经有了实质提升。</p><section class="" style="box-sizing: border-box; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">
		Little Kernel（LK）：<br><a style="color: #5baceb; word-break: break-all;">https://github.com/littlekernel/lk</a> <br>Little Kernel 被广为人知的是它是 Android 系统的 BootLoader，最早为 Google 工程师实现，其后由高通，MTK 等芯片厂商做了各自平台的适配。	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Magenta 的一个关键设计在于运用了 capability，这是一个计算机科学的抽象概念，封装了访问某个对象的权限。这一概念是 1966 年由 Dennis 和 Van Horn 首次提出的，指的是一个不可伪造的数据结构，在操作系统中担任控制访问权限的基元。在 Magenta 中，开发人员使用了 capability 的模型，以定义某个进程与内核、与其他进程的互动方式。</p><section class="" style="box-sizing: border-box; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">
		Capability：<br><a style="color: #5baceb; word-break: break-all;">https://en.wikipedia.org/wiki/Capability-based_security</a> <br>一种权限设计理论，基于它在 CS 领域有诸多应用，其中 Fuchsia 使用的是 Capability-based security.	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">具体实现中，Magenta 采用了名为 handle 的构造，只要有进程请求创建内核对象，就会自动生成 handle，用于处理与该内核对象的 “会话”，几乎所有系统调用都需要通过 handle 来实现。handle 包含与其相关的权限，也就是说它们定义了在使用时允许哪些操作。此外，handle 可以通过进程复制或转移。可授予 handle 的权限包括读写相关核心对象的权限，只要是虚拟内存对象即可，无论能否被映射为可执行对象。对于沙盒中的特殊进程来说，handle 非常有用。因为经过调整，handle 可以设置为仅允许对系统的某个子集可见、可访问。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">由于我们将内存作为可通过核心对象访问的资源，各个进程可通过 handle 来获得对内存的应用。在 Fuchsia 中创建进程，代表着一个负责创建的进程（比如 shell）必须手动为子进程完成创建虚拟内存对象的工作——这一点与传统不同：在传统的 Unix 类内核，比如 Linux 中，内核会完成大部分的虚拟内存设置，自动处理进程。Magenta 的虚拟内存对象可通过多种方式来映射内存，而且在进程执行中灵活性很高。甚至可以想象完全不对内存做映射的场景，在此场景下，通过类似文件描述符之类的 handle，也可以对系统进行读写。尽管这种设置允许任何类型的创造性使用，这也意味着想要运行进程，需要通过User Space的环境完成许多的基础架构工作。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">由于 Magenta 是按照微内核来设计的，操作系统的大多主要功能组件也是当作User Space进程来运行的，其中包含驱动程序、网络堆栈以及文件系统。最初从 IwIP 引导的网络堆栈最终被 Fuchsia 团队所编写的用户网络堆栈所取代。网络堆栈是一个中间性应用，简于User Space的网络驱动，以及需要网络服务的应用之间，通过网络堆栈，系统提供了一个 BSD socket API。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">默认的 Fuchsia 文件系统被称为 minfs，也是从零开发的。驱动管理器创建了根文件系统内存，为其它安装在下面的文件系统提供虚拟文件系统层（VFS）。然而，由于文件系统是作为User Space的服务器来运行的，需通过服务器的相应协议来访问。文件系统中的各个实例都包含后台运行的服务器，以处理所有的数据访问。借助User Space的 C library，对于只进行调用以开关、读写文件的用户程序来说，协议都是透明的。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Fuchsia 的图形驱动程序也作为 User Space 的服务存在，按照逻辑分为系统驱动以及应用驱动。两者之间促进沟通的软件层被称为 Magma，是一个提供合成与缓冲区共享的框架。绘图堆栈的某部分即 Escher，这是一个基于物理的渲染器，通过 Vulkan 来提供渲染 API。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">完整的 POSIX 兼容并非 Fuchsia 项目的目标，足够的 POSIX 兼容性可通过 C library 来提供，C 库也是 musl 项目连接 Fuchsia 的端口。这样一来，将 Linux 程序移植到 Fuchsia 系统会比较方便，但本身运行在 Linux 平台上的复杂程序自然需要更多的工作。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAob1DzjrAkZHsISttNfdghR4ejeaGKVpWFAicArKHGiaJpQl2QibYfYUJumErljIVKvE1KVPdqPh1rftw/0?wx_fmt=png&quot;); background-position: left center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">实践尝试</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">可按照下面链接中的指南获取自己的 Fuchsia 安装程序并运行，方法十分简单。该脚本设置了一个 QEMU 实例，大家可自行尝试。它可以在模拟 x86-64 系统的 q35 或 “标准 PC”的机器上，以及模拟 ARM-64 系统的 virt 或 Qemu ARM-64 虚拟机上运行，也可以在真机上运行。可按照指南来安装，针对机型包括配有 Intel Skylake 的 Acer Switch 12 寸笔记本、Broadwell 超迷你电脑 NUC（next unit of computing）以及 Raspberry Pi 3。就目前来说，虽然通过兼容外设也能在类似的硬件上运行，但对这三款机器的物理硬件支持也十分有限。</p><section class="" style="box-sizing: border-box; font-size: 15px; text-align: justify; line-height: 27px; color: rgb(89, 89, 89); background-color: rgb(239, 239, 239); padding: 19px; margin-top: 40px; margin-right: 8px; margin-left: 8px;">
		Fuchsia Getting Started：<br><a style="color: #5baceb; word-break: break-all;">https://fuchsia.googlesource.com/docs/+/HEAD/getting_started.md</a>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">目前，针对 Fuchsia 系统编写应用的支持还不充分，还需要很长时间的开发和文档构建。据了解，<strong style="text-align: left;">Google 的 Dart 编程语言在该系统中有着广泛应用，而基于 Dart、针对 iOS 和 Android 的移动应用框架 Flutter 的 SDK 就被移植到了这个系统中，似乎是创建图形应用程序的主要方式之一</strong>。负责窗口绘制以及用户输入的 compositor 叫做 Mozart，基本上相当于 Linux 上的 Wayland/weston。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">当引导 Fuchsia OS 进入图形模式时，我们可以看到在带有选项卡的图形环境中包含了五个 Dash shell。第一个标签展示的是系统消息，后面三个是可以在 Fuchsia 环境中启动应用程序的 shell。最后一个标签是 Magenta shell，里面的内容更为基础简单，由于缺少 Fuchsia 环境，无法通过它来运行图形应用。标签可以通过 Alt-Tab 来切换。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">目前这套操作系统能够运行的程序并不多，用户组件的大多内容仍在积极地开发中。可以运行的案例应用包括一些命令行程序，比如经典的 Unix fortune，还有一个能在屏幕上绘制旋转方块的图形应用，叫做 spinning_square_view。尽管目前来说内容确实有限，不过敬请持续关注 Fuchsia 的资源库，开发者正在积极更新，以便让这个系统功能更加丰富。相信很快就有更多功能可以尝试。</p><section class="" style="box-sizing: border-box; font-size: 16px;">
		<span style="display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAob1DzjrAkZHsISttNfdghR4ejeaGKVpWFAicArKHGiaJpQl2QibYfYUJumErljIVKvE1KVPdqPh1rftw/0?wx_fmt=png&quot;); background-position: left center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 45px; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">结论</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">看到有新的操作系统出现、并且还需要很多开发工作才能逐渐完善、并投入使用，这种过程总是颇有趣味。Fuchsia 还不完善，但目前看来发展的方向是正确的。由于 Google 在这个项目中投入了许多资源，目前针对 Magenta 以及其它 Fuchsia 组件的开发都非常活跃。对大众来说，所有承诺的功能都是能够实现的。不过目前信息还不够，想要了解项目的确切方向也有些困难。敬请大家关注这个新的开源项目，相信很快就有更多内容填充进来。</p><p style="padding-top: 23px; padding-right: 8px; padding-left: 8px; max-width: 100%; box-sizing: border-box; min-height: 1em; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em; word-wrap: break-word !important;">活动推荐：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAob1DzjrAkZHsISttNfdghR45AEf6rGIx6Sk9Rdac7juPb7AMSa5hicsQKBYXFGGwGfjoYTMKfvv4MA/0?wx_fmt=jpeg" style="width: 770px !important; height: 427.778px !important;"></p><p style="padding-top: 23px; padding-right: 8px; padding-left: 8px; max-width: 100%; box-sizing: border-box; min-height: 1em; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; color: rgb(51, 51, 51); box-sizing: border-box !important; word-wrap: break-word !important;">由InfoQ主办的第二届GMTC全球移动技术大会即将来袭！大会将于6月9-10日在北京举行。</span><span style="max-width: 100%; font-size: 14px; border-width: 0px; border-style: initial; border-color: initial; vertical-align: baseline; color: rgb(51, 51, 51); box-sizing: border-box !important; word-wrap: break-word !important;">本届大会，我们将探讨智能时代的大前端，2017年都有哪些值得关注的大前端趋势和实践？<span style="max-width: 100%; vertical-align: baseline; color: rgb(0, 122, 170); box-sizing: border-box !important; word-wrap: break-word !important;">扫描二维码</span>或点击<span style="max-width: 100%; vertical-align: baseline; color: rgb(0, 122, 170); box-sizing: border-box !important; word-wrap: break-word !important;">阅读原文</span>进入大会官网，现在报名享8折优惠！</span></p></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1493907876&src=3&ver=1&signature=jvrZY0qSmN7bPZVZ51WRRQUbNO9vHhyFME78w5MImHul*OXYONSTozrCGLIP-3ry*1pH90RWcvhN**4Dk7bWuiCUQjqYmwKFqFYofHVxf4QRWE7GQiPJdSbZ9t7WMMNR6iQ83d9to*zZfoUfVsPm18*JeH8uzRhNMTlNhlC21aM=">微信地址</a> | <a href="http://gmtc.geekbang.org/?utm_source=bornmobile&amp;utm_campaign=post0503&amp;utm_medium=bottombanner">阅读原文</a>
{% endraw  %}

