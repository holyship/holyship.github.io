---
title: Android 项目代码质量保证实践
author: 张云龙
date: '2017-03-30 00:00:00 +0000'

---

{% raw  %}
<blockquote><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong><span style="font-size: 14px;">版权声明</span></strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><span style="font-size: 14px;">作者：张云龙</span></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><span style="font-size: 14px;">本文为作者授权发布，未经允许禁止转载。</span></p></blockquote><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom: 2px solid rgb(27, 95, 160); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdHI0FpXs2AAntxMm7yIfsU7qXr3v3sSicBGCtcE4LFV0xics3RkFZaNg/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block;">&nbsp; 1 背景 &nbsp;</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">一个项目开发必然会涉及团队协作，而工程质量就需要团队去保证。一般我们期望的代码：无潜在风险、无重复逻辑、风格无差异、可阅读性好、新人上手速度快等。为了达到上述目标，一般团队都会制定一套自己认可的编码规范，并且周期性进行 code review。然而编码规范的制定，那么一套编码规范需要包含哪些内容，另外编码规范仅仅是一套软规范，实际程序员同学能遵守到什么程序还是一个未知数，所以需要我们进行人肉 code review，而这种人肉排查方式，很容易遗漏部分问题，保障性还是有些不足。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为此，我们从编码前期、编码中期和编码后期保证进行了初步尝试。</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom: 2px solid rgb(27, 95, 160); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdHI0FpXs2AAntxMm7yIfsU7qXr3v3sSicBGCtcE4LFV0xics3RkFZaNg/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block;">2 编码前期 - 编码规范</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">对于一个 Android 项目，一般需要涉及的编码规范有：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">普通 java 编码风格规范</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如每个方法最大行数，每个类文件的最大行数，每个方法最大参数数等</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">普通 java 编码最佳实践</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如if、for、try 等嵌套深度规范，变量初始化规范等</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">通用 Android 编码规范</strong>（java 部分和 xml 部分），</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">包含 Android java 部分和 Android xml 部分，如避免使用普通内部类定义handler，避免 layout xml 中存在无用结点等</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">Gradle 编码规范</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如尽量避免 lib 使用 module，独立工程可以通过 aar 或 mvn 方式导入</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">具体项目相关的编码规范等</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如项目团队规定使用自定义 LogUtil 打日志，Activity、Fragment 等重要类的继承关系，Activity 对应的 xml 文件必须以 activity_ 开头等</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">制定了这些内容可以一定程度上规范程序猿的编码，配合团队进行了周期性的 code review (一般是一个版本一次，大概 4 个星期一次)，会有比较好的效果。然而即使这么做，还是存在一定的问题，距离我们期望的目标还是比较远。比如各个单例类的定义五花八门，使用 LogUtil 代替 Log 的使用，Message.Obtain() 代替 new Message()，Activity 部分文件命名，甚至 Activity、Fragment 的基类定义规则还是很容易发生错误，并没有被发现。随着编码规范的完善充实，多个开发的编码规范如何保证，就会成为一个显而易见的问题。</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom: 2px solid rgb(27, 95, 160); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdHI0FpXs2AAntxMm7yIfsU7qXr3v3sSicBGCtcE4LFV0xics3RkFZaNg/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block;">3 编码中期 - 编码模板</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为了实现公用代码复用，我们定义了一些 util 工具类，但随着各个开发的补充，这套 util 工具类也越来越多，如 LogUtil、KeyboardUtil 等，而这些类一部分是为了统一入口，如统一使用 LogUtil，可以统一做到测试服打开本地日志，线上服关闭日志；KeyboardUtil 方便使用者控制键盘的弹出隐藏等操作。虽然定义了这些工具类，但终究存在应该使用而没有使用的情况。当然这些工具代码并不难，开发在自己的模块也能很容易的实现和使用，一般也不会出问题。然而上述讲的优点都会消失掉。而这些问题依赖 code review 也是件头疼的问题。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">此外，RecycleView 的编码方式，单例模式的实现方式等等，各个开发可能写出各式代码，甚至实现的单例模式并不是线程安全的。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">提了这么多，另一方面，要求开发在繁忙的业务中严格遵守这些规范，也有些强人所难。所幸，Android Studio 为我们提供了编码模板来解放开发的工作，并一定程度上统一编码风格。</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">3.1 Live Template</span></section><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">3.1.1 系统模板</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看一个使用 Android Studio 中很常见的例子，输入 for，出现下拉列表如下：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmkzNgKIvAGuWAyB6oSt4UU9rdU5BlLaxhkw1PrdXrwy2kBEvv3VMnicg/0?wx_fmt=jpeg" style="width: 379px !important; height: 67px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">当选择 fori，出现编码片段：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmjbT51Vncico1POM5W73nriclbSgKdiaKUxLklK0IIBvN7EOobQSxOfia4Q/0?wx_fmt=jpeg" style="width: 237px !important; height: 52px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">确认循环变量 i，跳入循环结果值的输入：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmXIkGzM6npYkGiak1Zd3iaqGG0P6w6TWoF5qf015qym0AwneEXjpAribmg/0?wx_fmt=jpeg" style="width: 266px !important; height: 49px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">上例，就是 Android Studio 中系统提供的 Live Template 一个实例。这个类似于 iOS 中的 Code Snippets，提供了代码片段的能力。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Android Studio (Mac) 进入 Settings/Preferences -&gt; Editor -&gt; Live Templates，可以看到已定义的模板组：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmgTib7aibY8PHftp7bCVtCmVSfvknPnTUkwz1BLSib5bWIiazwT0WUXAPNQ/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 454.553px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看 fori 编码模板的实现：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmtk3hxZwzAWgkM8m0t9aUflOhCDZ8RtWODMeFgJpCicL1u7Nrt61rMoQ/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 334.251px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">A: 完成模板的快捷键 Tab</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">B: 位置分类 iterations</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">C: 编码模板对应的缩写 fori</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">D: 模板的内容</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">E: 模板应用环境</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">3.1.2 自定义模板</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">1.构建项目 group</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmK4ejuGUm7SLQZbMOaHxywRfrPaHT9Jniafey0f717yzbKyMfankv02g/0?wx_fmt=jpeg" style="width: 147px !important; height: 65px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">输入 group 的名称</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmqasYfiaNBxibGyl9gBRARJko3y7W0iaomqbas3USKPhSTrCsX9AYkWiaqg/0?wx_fmt=jpeg" style="width: 293px !important; height: 271px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">2.构建具体编码模板</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmowtbhC15KIqC6PHMzAMjIePIhUZK0DsBoB2DcnW3AsEBJZgKd68O4g/0?wx_fmt=jpeg" style="width: 518px !important; height: 517px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>Abbreviation：触发编码模板的缩写</p></li><li><p>Description：模板的具体描述</p></li><li><p>Template Text：具体的模板内容</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">3.变量定义</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">变量形式为 <code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">$&lt;variable_name&gt;$</code>，点击 Edit variables 可设置变量具体内容：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmRKiacFv2jvU5ricw2Y9sb046CwW5oDVsib2y6fciarLJNy3oQic7nibDOqDw/0?wx_fmt=jpeg" style="width: 447px !important; height: 171px !important;"></p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>Name：变量名</p></li><li><p>Expression：变量表现</p></li><li><p>Default value：默认值</p></li><li><p>Skip if defined：是否跳过编辑已经定义的值</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">4.模板应用环境</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">点击 No application contexts yet. Define，设置为 java 环境：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmUI8jjxyQwwQb2Et0kNMbTj9phIUVtsB2Ra73FzvJWOiaz4o4CXenKMw/0?wx_fmt=jpeg" style="width: 253px !important; height: 443px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">5.模板文件</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">构建了模板 group 后，在 android studio config\templates 目录下查看到 yanxuan.xml。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">windows：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">C:\Users\<user style="box-sizing: border-box;">\.AndroidStudiox.x\config\templates（user 为你的计算机用户名）</user></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">mac：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">~/Library/Preferences/AndroidStudiox.x/templates</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">&lt;templateSet group="test"&gt;
 &nbsp;&lt;template name="yxtest" value="testMethod($a$, $b$);" description="这是一个测试模板" toReformat="false" toShortenFQNames="true"&gt;
 &nbsp; &nbsp;&lt;variable name="a" expression="lineNumber()" defaultValue="2" alwaysStopAt="false" /&gt;
 &nbsp; &nbsp;&lt;variable name="b" expression="" defaultValue="" alwaysStopAt="true" /&gt;
 &nbsp; &nbsp;&lt;context&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_CODE" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_STATEMENT" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_EXPRESSION" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_DECLARATION" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_COMMENT" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="JAVA_STRING" value="true" /&gt;
 &nbsp; &nbsp; &nbsp;&lt;option name="COMPLETION" value="true" /&gt;
 &nbsp; &nbsp;&lt;/context&gt;
 &nbsp;&lt;/template&gt;
&lt;/templateSet&gt;</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">设置完毕，实践查看：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_gif/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm0eP2bHSlTr7XTqItKSribSXcibCvAn0GHmOsPPwxToWSNRRApSZDgDxw/0?wx_fmt=gif" style="width: 418px !important; height: 62px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">yxtest</code></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_gif/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmZwgvgFk3Q7C29W5AmoyAnAPeKK9Pmia2dXxI6EVia18QfvPzia0qYYKbA/0?wx_fmt=gif" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 179.711px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">singleton</code></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">3.2 Android Studio Template</span></section><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">背景</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">除了 Live Template 之外，工程项目中很多新建的类也有很多机械的代码，如我们定义的 Activity 要么继承自 BaseBlankActivity，要么继承自 BaseActionBarActivity，另外项目中采用 MVP 模式，因此一个 Activity 基本上会有一个对应的 presenter 类，一个 layout 文件，同时很多时候，一个页面中会有一个需要支持刷新的 RecycleView 等。除此之外，ViewHolder、HttpTask 等代码也是固定模式的代码。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">这些都是固定机械的代码，而如果是人肉去写的话，难免会出现代码风格不一致、不规范的情况，同时也浪费了一部分的时间。所幸，Android Studio 提供了工程类模板，方便我们实现这样的功能。</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">系统模板</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看 Android Studio 系统类模板，我们能发现有很多定义好的类模板：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmm0C26Py3JdNkHlpAkoFicS91vcQ30WE2ddLdchocTIznYstdnU0lfoQ/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 424.044px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如需要创建一个空的 Activity 页面，可以选择 Empty Activity，并填写类名，layout 名称等信息，之后就能出现对应的添加或修改：MainActivity.java、activity_main.xml、AndroidManifest.xml：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmoBCFpDUP3kicOcr7LOlpIx3UE7YVfz2U8Ybx6QCECzibA7ghvJMPSKJw/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 491.535px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">而这些模板定义，可以在相关路径文件中找到：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Windows:</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">${Android Studio 的安装目录}/plugins/android/lib/templates/</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Mac:</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Android Studio.app/Contents/plugins/android/lib/templates/</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm0FJMAnBmI4lq0KZmiaQkZaj1L1h7N28wkQVvjnV0992aErwNndyxINA/0?wx_fmt=jpeg" style="width: 285px !important; height: 556px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">针对 EmpytActivity 这里需要定义的文件有：</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>globals.xml.ftl：定义当前模板的一些全局变量</p></li><li><p>recipe.xml.ftl：定义模板拷贝的逻辑等</p></li><li><p>template.xml：定义模板对话框的样式</p></li><li><p>template_blank_activity.png：定义模板的图标</p></li><li><p>root/src/app_package/SimpleActivity.java.ftl：具体的模板文件</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdUb4XY3Esfsx5BER2dZpx7Kl02nOh44B3daGzxVJicczrPw98StTdOQ/0?wx_fmt=png" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 435.317px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">图片来自：<a style="box-sizing: border-box; background-color: transparent; color: rgb(91, 172, 235); word-break: break-all;">http://www.slideshare.net/murphonic/custom-android-code-templates-15537501</a></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">自定义模板</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">而针对我们需要自定义的模板，可以在模板定义路径下新建文件夹和文件即可，细节内容可查看 Tutorial How To Create Custom Android Code Templates</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">项目的模板文件内容：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmz1KgywvDo7WfJB0e1gNfFUTR3ReEkvWYNEyN32NvX5mXMREFVxP8hw/0?wx_fmt=jpeg" style="width: 210px !important; height: 177px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">设置完模板文件之后，重启 Android Studio，可以生效模板文件，使用模板文件如下：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibms8etKouXaZpY94NAYZWj3aBxN4seeqoRsbaVdibDUbqJVjhSTywyKeg/0?wx_fmt=png" style="width: 770px !important; height: 409.237px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_gif/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmcSu9WvX42fY54kL2ibUficY1uA1XvPB4plmpNf31DEvSRGv8xgW2cVCw/0?wx_fmt=gif" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 8.59624px !important;"><br></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom: 2px solid rgb(27, 95, 160); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdHI0FpXs2AAntxMm7yIfsU7qXr3v3sSicBGCtcE4LFV0xics3RkFZaNg/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block;">4 编码后期 - 静态代码检查</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">由上，我们定义了编码规范，定义了 Live Template 和 Android Studio Template 方便程序猿更好的准守我们的项目编码规范。然后编码规范毕竟只是软规范，而提供编码模板更多的解决大量 util 的使用问题和便利小伙伴完成机械编码，并不能完全保证程序猿严格按照全部的规范来编码。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为此，我们需要一套静态代码检查机制能检查已有的代码是否遵守规范。总结已有的规范，可以将规范类型归纳为普通 Java 规范、普通 Android 规范、具体项目规范等。而这些检查点，可以配合不同的检查工具进行检查。</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4.1 检查 java 代码风格 - CheckStyle</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">对于 java 规范，checkstyle 帮助开发者实现常用的检查。这里 CheckStyle 能检查的内容有：</p><ol style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>Javadoc 注释</p></li><li><p>命名约定</p></li><li><p>标题</p></li><li><p>Import 语句</p></li><li><p>体积大小</p></li><li><p>空白</p></li><li><p>修饰符</p></li><li><p>块</p></li><li><p>代码问题</p></li><li><p>类设计</p></li><li><p>混合检查（包活一些有用的比如非必须的System.out和printstackTrace）</p></li></ol><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">检查内容很多，而检查项需要和具体的项目规范做结合。如，每行代码字符数控制在 80，单页代码行数控制在 800 等。因此需要结合配置文件，来检查项目中的 java 代码。在 Android Studio 上配置 CheckStyle 流程如下：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 Android Studio 中添加 gradle Plugin</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">apply plugin: 'checkstyle'</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">设置 CheckStyle 版本</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">checkstyle {
 &nbsp; &nbsp;toolVersion '6.1.1'
 &nbsp; &nbsp;showViolations true
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">配置 CheckStyle 检查项</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">task checkstyle(type: Checkstyle) {
 &nbsp; &nbsp;configFile file("$configDir/checkstyle/checkstyle.xml")
 &nbsp; &nbsp; &nbsp; &nbsp;configProperties.checkstyleSuppressionsPath = file("$configDir/checkstyle/suppressions.xml").absolutePath
 &nbsp; &nbsp;source 'src'
 &nbsp; &nbsp;include '**/*.java' // 检查 java 代码
 &nbsp; &nbsp;exclude '**/gen/**' // 排除生成的代码
 &nbsp; &nbsp;classpath = files()
 &nbsp; &nbsp;ignoreFailures true &nbsp;// 忽略检查失败的情况，避免gradle命令执行中止
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">配置自定义的检查项：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">checkstyle.xml：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">&lt;!--单个文件方法数上限最多为 30--&gt;
&lt;module name="MethodCount"&gt;
 &nbsp; &nbsp;&lt;property name="maxTotal" value="30"/&gt;
&lt;/module&gt;
&lt;!--方法名的首字母是小写--&gt;
&lt;module name="MethodName"&gt;
 &nbsp; &nbsp;&lt;property name="format" value="^[a-z][a-zA-Z0-9]*$"/&gt;
 &nbsp; &nbsp;&lt;/module&gt;
 &nbsp; &nbsp;&lt;!--静态变量名的首字符是 s--&gt;
 &nbsp; &nbsp;&lt;module name="StaticVariableName"&gt;
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;property name="format" value="^[a-z][a-zA-Z0-9]*$"/&gt;
 &nbsp; &nbsp;&lt;property name="applyToPublic" value="true"/&gt;
 &nbsp; &nbsp;&lt;property name="applyToProtected" value="true"/&gt;
 &nbsp; &nbsp;&lt;property name="applyToPackage" value="true"/&gt;
 &nbsp; &nbsp;&lt;property name="applyToPrivate" value="true"/&gt;
&lt;/module&gt;
&lt;!--只有私有构造函数的类需要定义成 final 类型--&gt;
&lt;module name="FinalClass"/&gt;
...</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">具体其他的检查项配置可以查看 检查配置链接:</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><a style="box-sizing: border-box; background-color: transparent; color: rgb(91, 172, 235); word-break: break-all;">http://checkstyle.sourceforge.net/checks.html</a></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">执行 checkstyle 检查</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">./gradlew checkstyle</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看检查结果</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">命令执行结束，查看检查结果文件：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">${project}/app/build/reports/checkstyle/checkstyle.html</code></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmHVy0LyYYApm6FKK3EicBb69kH2TiarCOpVuHEYxnZwJIsFEf9ibYjFp8w/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 317.332px !important;"></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">4.2 检查 java 代码质量 - FindBugs</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">与 CheckStyle 工具不同的是，FindBugs 不注重样式或者格式，而是试图寻找出真正的缺陷或者现在的性能问题。FindBugs 检查类和 Jar 文件，不是通过分析类文件的形式或结构来分析程序，而是使用 Visitor 模式，将字节码与一组缺陷模式进行对比以发现可能的问题。而这些问题比如如下：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">忽略返回值</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmcwEu48DRT0Bsib4icqANUWE2SKp8xPaiaQQDiaNWQEs2nibaoEmQUUyIlmw/0?wx_fmt=jpeg" style="width: 234px !important; height: 51px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">上述代码执行结束之后，并没有什么意义，变量 a 的值也不会变成 dddbbbccc。因此，上述代码很可能是程序猿的 bug。为此 FindBugs 能找出这种问题</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">空指针示例</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdnLKGxutbvbw23jDLE2DKYN5XicdaQ41N9fsjmqDlUt69BP6r6DNEfg/0?wx_fmt=jpeg" style="width: 438px !important; height: 126px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">上述最后一行代码，很明显在执行的时候会发生空指针异常，这里因为 FindBugs 无法知道变量 strMaps 是否确实有 aaa 这个 key，为此这里会检查出错误。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">未初始化的成员变量使用</strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmCuLhwicdZjNUfmhzpiaic95y7NiceTIn5FTc78icr3KEJzYH7TrxxvPXFFw/0?wx_fmt=jpeg" style="width: 285px !important; height: 80px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">这里由于类成员变量 actions 并未初始化，因此当 actions.add("TEST") 被执行的时候会发生异常。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Android Studio 上 FindBugs 的集成如下：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 gradle 中引入插件</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">apply plugin: 'findbugs'</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 gradle 中配置 findbugs task</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">task findbugs(type: FindBugs, dependsOn: "assembleDebug") {
 &nbsp; &nbsp;ignoreFailures = false
 &nbsp; &nbsp;effort = "max"
 &nbsp; &nbsp;reportLevel = "high"
 &nbsp; &nbsp;excludeFilter = new File("$configDir/findbugs/findbugs-filter.xml")
 &nbsp; &nbsp; &nbsp; &nbsp;classes = files("${project.rootDir}/app/build/intermediates/classes")
 &nbsp; &nbsp;source 'src'
 &nbsp; &nbsp;include '**/*.java'
 &nbsp; &nbsp;exclude '**/gen/**'
 &nbsp; &nbsp;reports {
 &nbsp; &nbsp; &nbsp; &nbsp;xml.enabled = false
 &nbsp; &nbsp; &nbsp; &nbsp;html.enabled = true
 &nbsp; &nbsp; &nbsp; &nbsp;xml {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination "$reportsDir/findbugs/findbugs.xml"
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;html {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;destination "$reportsDir/findbugs/findbugs.html"
 &nbsp; &nbsp; &nbsp; &nbsp;}
 &nbsp; &nbsp;}
 &nbsp; &nbsp;classpath = files()
 &nbsp; &nbsp;ignoreFailures true &nbsp;// 避免检查失败 gradle 执行中止
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">执行 findbugs 检查</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">./gradlew findbugs</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看检查结果</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">查看检查结果文件：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">${project}/app/build/reports/findbugs/findbugs.html</code></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibme6vxrPdT94OAcial4tku5iaic1Nlo3EBkfKjo3UFib2mSTuic42r6fyyUUg/0?wx_fmt=jpeg" style="width: 499px !important; height: 248px !important;"></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">4.3 检查 Android 代码质量 - Lint</span></section><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4.3.1 基本介绍</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">前面 FindBugs 的检查实例(忽略返回值, 未初始化的成员变量使用)，可以发现在 Android Studio IDE 上，已经出现了标黄提示，我们把光标放上去，就能看到具体的提示了：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmnwp3wBcrAsgacCRibA9jok0qphZCFNqBgdGRibcxI7hQSGQenCXOHg3g/0?wx_fmt=jpeg" style="width: 352px !important; height: 78px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">按 cmd + F1 可以看到具体的错误提示：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmn09BTLEqwdPWeSny7GsDjocpXELmz2slT0ia7jCug6I0PIn0puvDB4w/0?wx_fmt=jpeg" style="width: 770px !important; height: 76.4802px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">这就原生 Lint 给我们提供的错误提示功能。除了和 FindBugs 重复的纯 java 代码检查之外，Lint 能检查很多其他工具无法检查的内容，也更贴合 Android：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmQ9q7ELfBFZFaZrgPzlbykwCg3gUXnOdtfXsfcxwu8k6EAbLhic2SmDQ/0?wx_fmt=jpeg" style="width: 674px !important; height: 177px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 Activity 内定义非静态内部类 Handler 的报警</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmyW2UqYvuJLyNNT6OebEhd0ia5FAmauDLXA8VPic2cSWJj9eRaib4vcQeA/0?wx_fmt=jpeg" style="width: 671px !important; height: 100px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 AndroidManifest.xml 中定义 export 为 true 的广播接受器，但没有定义权限，Lint 检查认为是不安全的</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmVJr9SYEcxpHzWQJw0P92nbsC0sAeibxG7ErKJ01EsjWVglNs2MhQqGQ/0?wx_fmt=jpeg" style="width: 688px !important; height: 52px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">build.gradle 文件中引用的 support 包的版本低的提示</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Android Lint 是一个静态代码检查工具，能够对潜在的 bug，可能的安全性、性能、可用性、可访问性、国际化等优化内容做出监测：</p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmx1DsZCnn8lha3vvjRRQzhCcHxHoSQezfrjbsd88MUaZacR8icgqAgPA/0?wx_fmt=png" style="width: 604px !important; height: 287px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">来自官方文档 Improve Your Code with Lint:</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><a style="box-sizing: border-box; background-color: transparent; color: rgb(91, 172, 235); word-break: break-all;">https://developer.android.com/studio/write/lint.html#gradle</a></p><ol style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>App Source Files：工程中的源文件，包括 java 代码、资源 xml 代码、gradle 文件，图片资源文件以及 progroud 等文件</p></li><li><p>lint.xml：配置文件，配置哪些 lint 检查可以排除，自定义问题的严重级别</p></li><li><p>lint Tool：静态代码检查工具，可以是命令行或者集成在 Android Studio 上</p></li><li><p>lint Output：代码检查结果，可以直接显示在 Console 上，也可以是 lint-result.html</p></li></ol><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4.3.2 原生 Lint 检查</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 Android SDK Tools 16 及更高的版本中，Lint 工具会自动安装。原生 Lint 的检查项已经有 200 多项 (包括前面示例的 5 项内容)，因此使用原生的功能点，就能检查开发中的大部分通用问题。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">Android Studio IDE 上配置 Lint 检查偏好设置</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">(Mac 下) Preferences → Editor → Inspections 进入 Android Studio 的 Lint 配置界面</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmpJ0AQ6YHLBHIhRSQNc4po3Y6a9tkd8LydWh2Kibcp47JWGutwSDU8Iw/0?wx_fmt=jpeg" style="width: 770px !important; height: 470.28px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">A：配置 Profile，方便不同项目或者不同情况下使用不同的 Profile 进行检查</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">B：Lint 检查点 Group</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">C：Lint 检查点具体描述</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">D：Lint 检查点警告级别设置</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">E：Lint 检查点开关</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">lint.xml 上配置 Lint</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">除了可以通过 IDE 配置 Lint，还可以通过直接 lint.xml 为单个项目配置检查规则</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;lint&gt;
 &nbsp; &nbsp;&lt;!-- Disable the given check in this project --&gt;
 &nbsp; &nbsp;&lt;issue id="IconMissingDensityFolder" severity="ignore" /&gt;
 &nbsp; &nbsp;&lt;!-- Ignore the ObsoleteLayoutParam issue in the specified files --&gt;
 &nbsp; &nbsp;&lt;issue id="ObsoleteLayoutParam"&gt;
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;ignore path="res/layout/activation.xml" /&gt;
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;ignore path="res/layout-xlarge/activation.xml" /&gt;
 &nbsp; &nbsp;&lt;/issue&gt;
 &nbsp; &nbsp;&lt;!-- Ignore the UselessLeaf issue in the specified file --&gt;
 &nbsp; &nbsp;&lt;issue id="UselessLeaf"&gt;
 &nbsp; &nbsp; &nbsp; &nbsp;&lt;ignore path="res/layout/main.xml" /&gt;
 &nbsp; &nbsp;&lt;/issue&gt;
 &nbsp; &nbsp;&lt;!-- Change the severity of hardcoded strings to "error" --&gt;
 &nbsp; &nbsp;&lt;issue id="HardcodedText" severity="error" /&gt;
&lt;/lint&gt;</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">gradle 中配置 Lint task</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">android {
 &nbsp; &nbsp;lintOptions {
 &nbsp; &nbsp; &nbsp; &nbsp;abortOnError false // 配置 lint 过程中出错，不中止 gradle 任务
 &nbsp; &nbsp; &nbsp; &nbsp;xmlReport false
 &nbsp; &nbsp; &nbsp; &nbsp;htmlReport true
 &nbsp; &nbsp; &nbsp; &nbsp;lintConfig file("$configDir/lint/lint.xml") // 配置 lint 检查规则
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;htmlOutput file("$reportsDir/lint/lint-result.html") // 配置 lint 输出文件
 &nbsp; &nbsp; &nbsp; &nbsp;xmlOutput file("$reportsDir/lint/lint-result.xml") // 配置 lint 输出文件
 &nbsp; &nbsp;}
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">执行检查</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在工程根目录执行以下命令 (Mac)，以执行检查任务</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">./gradlew lint</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">检查结果</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">生成的检查结果在 ${项目工程}/app/build/reports/lint/lint-result.html</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmsQXSg2vHGI5EEFgFjxic65Gs1CInqVasoPxg1wn5xNn19qvCbgBehjA/0?wx_fmt=jpeg" style="width: 657px !important; height: 490px !important;"></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);">&nbsp;<span style="box-sizing: border-box;">4.3.3 自定义 Lint 检查</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">虽然原生的 Lint 检查已经很强大了，检查项也已经很多，然而还是无法满足项目中的特有需求：</p><ol style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>log 统一使用 LogUtil</p></li><li><p>对应 Activity 的 layout 命名为 activity_XXX</p></li><li><p>对应 Fragment 的 layout 命名为 fragment_XXX</p></li><li><p>Activity 必须派生自 BaseBlankActivity 或 BaseActionBarActivity</p></li></ol><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">对于以上这些需求，原生 Lint 检查（包括 CheckStyle，FindBugs）就已经无能为力了，我们必须编码支持自定义检查。以项目中集成的 Lint 检查为例，讲述流程：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.1 配置 Gradle，引入 lint 库</strong></p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">dependencies {
 &nbsp; &nbsp;...
 &nbsp; &nbsp;compile 'com.android.tools.lint:lint-api:24.5.0'
 &nbsp; &nbsp;compile 'com.android.tools.lint:lint-checks:24.5.0'
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">lint-api: 官方给出的API，API并不是最终版，官方提醒随时有可能会更改API接口。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">lint-checks：已有的检查。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.2 定义 IssueRegistry 类</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">新建一个 MyIssueRegistry 类，继承自 IssueRegistry。用来注册我们自定义的全部 issue</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">public class MyIssueRegistry extends IssueRegistry {
 &nbsp; &nbsp;@Override
 &nbsp; &nbsp;public List&lt;Issue&gt; getIssues() {
 &nbsp; &nbsp; &nbsp; &nbsp;System.out.println("********YXLint rules works!!!********");
 &nbsp; &nbsp; &nbsp; &nbsp;return Arrays.asList(
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LogUsageDetector.ISSUE,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ToastUsageDetector.ISSUE,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ActivitySuperClassDetector.ACTIVITY_SUPER_CLASS_ISSUE,
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;...
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BuildGradleVersionDetector.ISSUE);
 &nbsp; &nbsp;}
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">其中：</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>LogUsageDetector.ISSUE：用于检查不允许直接使用 Log.* 方式输出本地日志的代码</p></li><li><p>ToastUsageDetector.ISSUE：用于检查直接用 Toast 方式显示 toast 的代码</p></li><li><p>ActivitySuperClassDetector.ACTIVITY_SUPER_CLASS_ISSUE：用于检查 Activity 的基类</p></li><li><p>BuildGradleVersionDetector.ISSUE：用于检查 gradle 文件中不允许直接写数字版本号的代码</p></li></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.3 gradle 清单项中注册前面定义的 IssueRegistry 类</strong></p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">jar {
 &nbsp; &nbsp;manifest {
 &nbsp; &nbsp; &nbsp; &nbsp;attributes('Lint-Registry': 'com.netease.htlint.lintrules.MyIssueRegistry')
 &nbsp; &nbsp;}
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.4 定义 Detector</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">MyIssueRegistry 类中声明注册了各个 Detector 的 Issue。Issue 由 Detector 发现并报告，是 Android 程序代码可能存在的风险。而这里就需要真正实现这些 Detector，以检查 Activity 的基类为例。</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmtY0edKImhfnEicPPvF6VCT5ic2fE5nGSkUZUe5XsGgy5H2tWmdh1ibEYA/0?wx_fmt=jpeg" style="width: 770px !important; height: 489.542px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">ACTIVITY_SUPER_CLASS_ISSUE</code> 这个 Issue 的定义需要使用 Issue.create(...) 方式实现，同时需要传入 6 个参数分别如下：</p><ul style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p>A：一个固定的唯一的 id 代表这个 Issue</p></li><li><p>B：对于问题的简短总结，描述问题而不是修复措施</p></li><li><p>C：完整的问题解释和修复建议</p></li><li><p>D：问题类别，现在已有的问题类别有如下</p></li><ul style="list-style-type: square;" class="list-paddingleft-2"><li><p>Lint</p></li><li><p>Correctness (incl. Messages)</p></li><li><p>Security</p></li><li><p>Performance</p></li><li><p>Usability (incl. Icons, Typography)</p></li><li><p>Accessibility</p></li><li><p>Internationalization</p></li><li><p>Bi-directional text</p></li></ul><li><p>E：优先级，必须在1到10之间，10为最重要/最严重。</p></li><li><p>F：严重级别，可选值有 Fatal, Error, Warning, Informational, Ignore</p></li><li><p>G：为 Issue 和 Detector 提供映射关系，Detector 就是当前类。声明扫描检测的范围 Scope，描述 Detector 需要分析时需要考虑的文件集，包括：Resource 文件或目录、Java 文件、Class 文件ActivitySuperClassDetector 继承自 Detector，并实现 Detector.JavaScaner。这里主要自定义实现的方法如上图 H，I。</p></li><li><p>H：检查类的基类是 "android.support.v4.app.Activity" 或 "android.app.Activity"</p></li><li><p>I：具体检查类的方法，这里需要排除非 yanxuan 包名下的代码，判断当前类的基类是否是 BaseBlankActivity 或 BaseActionBarActivity？如果都不是的话，则报告错误</p></li><li><p>J：报出问题的方法：该方法中指定参数有：</p></li><ul style="list-style-type: square;" class="list-paddingleft-2"><li><p>需要报错的 Issue</p></li><li><p>发生问题的代码在语法树上的节点</p></li><li><p>发生问题的代码位置</p></li><li><p>警告的信息</p></li></ul></ul><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.5 生成 jar 包</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">完成上述步骤，可以在控制台中通过命令 ../../gradlew assemble 来执行编译任务，就可以输出我们需要的 jar 文件 (htlintrules_jar-0.0.1.jar) 了</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.6 jar 的使用</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">按照 Google 方法，可以将 htlintrules_jar-0.0.1.jar 拷贝到 ~/.android/lint 中，但缺点是针对会影响一台机器其他的工程。很明显，我们的自定义 Lint 检查有很多是项目中特有的一些编码规范。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为此，我们采用 LinkedIn 方案：将 jar 放到一个 aar 中。这样我们就可以针对工程进行自定义 Lint，lint.jar 只对当前工程有效。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在现有的 htlintrules_jar 工程的 build.gradle 中添加代码，整体看起来如下：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">apply plugin: 'java'
apply plugin: 'maven'
dependencies {
 &nbsp; &nbsp;compile 'com.android.tools.lint:lint-api:24.5.0'
 &nbsp; &nbsp;compile 'com.android.tools.lint:lint-checks:24.5.0'
}
jar {
 &nbsp; &nbsp;manifest {
 &nbsp; &nbsp; &nbsp; &nbsp;attributes('Lint-Registry': 'com.netease.htlint.lintrules.MyIssueRegistry')
 &nbsp; &nbsp;}
}
configurations {
 &nbsp; &nbsp;lintJarOutput
}
dependencies {
 &nbsp; &nbsp;lintJarOutput files(jar)
}
defaultTasks 'assemble'</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">同时新建另一个工程 htlint，在其 build.gradle 文件中添加如下代码：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">/*
 * rules for including "lint.jar" in aar
 */
configurations {
 &nbsp; &nbsp;lintJarImport
}
dependencies {
 &nbsp; &nbsp;lintJarImport project(path: ':htlintrules_jar', configuration: "lintJarOutput")
}
task copyLintJar(type: Copy) {
 &nbsp; &nbsp;from (configurations.lintJarImport) {
 &nbsp; &nbsp; &nbsp; &nbsp;rename {
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;String fileName -&gt;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;'lint.jar'
 &nbsp; &nbsp; &nbsp; &nbsp;}
 &nbsp; &nbsp;}
 &nbsp; &nbsp;into 'build/intermediates/lint/'
}
project.afterEvaluate {
 &nbsp; &nbsp;def compileLintTask = project.tasks.find { it.name == 'compileLint' }
 &nbsp; &nbsp;compileLintTask.dependsOn(copyLintJar)
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">最后在 app 工程的 build.gradle 中添加 htlint 引用，配置完成</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">dependencies {
 &nbsp; &nbsp;compile project(':htlint') // lint 检查库
 &nbsp; &nbsp;...
}</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.7 自定义 Lint 检查执行及结果检查</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">在 ${项目工程}/app/ 目录下执行 ../gradlew lint：</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm1dful6dqm3qHbs7HGcBEsEvSwZMfMdcmKTHz4OFfaofGNdosrnqCpg/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 123.997px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">根据提示查看 lint-result.html 文件，可以查看到前面编写的</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">ActivitySuperClassDetector.ACTIVITY_SUPER_CLASS_ISSUE</code> 已经生效，并且检查出了相关的非规范代码。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmIYETTvul6VrBYTP73juWYMGOBe0jknHwSicq5ZfNS6I9icKicIsHfQnhg/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 183.463px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmfXCUUw2qEX4RYBO7Shrkl9TE0Q0SQcpVhXSz72amaFusDTsPSicmibkw/0?wx_fmt=jpeg" style="box-sizing: border-box; border-width: 0px; border-style: initial; border-color: initial; vertical-align: middle; width: 594px !important; height: 264.33px !important;"></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;"><strong style="box-sizing: border-box; text-align: left;">4.3.3.8 排除错误的检查结果</strong></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">前面很好的给出了检查结果了，然而我们会发现，FullScreenVideoActivity 确实是需要的错误检查结果，而 WXEntryActivity 却不是，这个类是有集成微信分享时需要的，并且按照微信开放平台的文档来编写，因此并不需要按照项目规范，继承 BaseBlankActivity 或 BaseActionBarActivity。为此，我们期望 WXEntryActivity 不应该被检查出 WrongActivitySuperClass 错误</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为此，我们可以在 WXEntryActivity 类名签名添加 SuppressLint 注解：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">@SuppressLint("WrongActivitySuperClass")
public class WXEntryActivity extends Activity implements IWXAPIEventHandler{
 &nbsp; &nbsp;...
}</code></pre><blockquote style="box-sizing: border-box; padding-left: 0px; font-size: 15px; border-left: none; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box; margin-top: 27px; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 1.75em; padding-right: 20px; padding-left: 20px; color: rgb(91, 172, 235);">排除 java 类或者方法的 Lint 检查</p><span style="box-sizing: border-box; display: block; clear: both;"></span></blockquote><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">若需要抑制某个 Issue 检查，可以在类定义签名或者方法定义签名，添加注解 @SuppressLint(${IssueId})。这里设置的就是具体某个 Issue 的 id 值</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">若需要抑制全部的 Issue 检查，可以使用 all 关键字，比如：@SuppressLint("all")</p><blockquote style="box-sizing: border-box; padding-left: 0px; font-size: 15px; border-left: none; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><p style="box-sizing: border-box; margin-top: 27px; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 1.75em; padding-right: 20px; padding-left: 20px; color: rgb(91, 172, 235);">排除 xml 资源的 Lint 检查</p><span style="box-sizing: border-box; display: block; clear: both;"></span></blockquote><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如项目中引入微博分享 sdk，按照官方文档，需要在 AndroidManifest 中声明 com.sina.weibo.sdk.net.DownloadService 这个 Service，而这个 Service 会被 Lint 检查为未定义，为此需要 xml 文件中也过滤部分代码的 Lint 的检查：</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">&lt;manifest xmlns:android="http://schemas.android.com/apk/res/android"
 &nbsp; &nbsp;xmlns:tools="http://schemas.android.com/tools"
 &nbsp; &nbsp;package="com.netease.yanxuan"&gt;
 &nbsp; &nbsp;...
 &nbsp; &nbsp;&lt;service
 &nbsp; &nbsp; &nbsp; &nbsp;android:name="com.sina.weibo.sdk.net.DownloadService"
 &nbsp; &nbsp; &nbsp; &nbsp;android:exported="false"
 &nbsp; &nbsp; &nbsp; &nbsp;tools:ignore="MissingRegistered" /&gt;
&lt;/manifest&gt;</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">这里对于单个 Issue 过滤的规则为：tools:ignore=${IssueId}</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">如果需要过滤全部的 Issue，可以使用 all 关键字：tools:ignore="all"</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">4.4 其他代码检查工具</span></section><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4.4.1 360 火线</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">360 火线 是 360 公司和信息安全部门深度合作，定制的适用于 360 公司产品的安卓 APP 安全检查规则。总共覆盖 61 项代码检查。使用也非常方便，细节看 使用文档，可以直接使用 jar 包并执行命令或集成 Android Studio Plugin 执行检查</p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmgOd3iaTBhO2x2dBrhHl4uMIg6jvfpG84OQMzJ7pnCGPg4olCvG4ugOQ/0?wx_fmt=jpeg" style="width: 770px !important; height: 434.862px !important;"></p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(60, 112, 198); margin-top: 30px; margin-left: 8px; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; width: 15px; height: 15px; margin-right: 10px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmmibiakTHse4uHPVTBQib7VtW8Glnt9Nly2AXNCapO7qS2rx8Tfd5aONPA/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat;"></span>&nbsp;<span style="box-sizing: border-box;">4.4.2 pmd</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">pmd 代码检查工具，包含 16 个规则集，涵盖了 Java 的各种常见问题。其中规则集包含 基本（rulesets/basic.xml），终结函数（finalizer），未使用的代码（rulesets/unusedcode.xml），设计（rulesets/design.xml） 等。</p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">相比 FindBugs，pmd 的一些规则更具争议，但 pmd 支持我们构建自己的规则集</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">&lt;?xml version="1.0"?&gt;
&lt;ruleset name="customruleset"&gt;
 &nbsp;&lt;description&gt;
 &nbsp;Sample ruleset for developerWorks article
 &nbsp;&lt;/description&gt;
 &nbsp;&lt;rule ref="rulesets/design.xml"/&gt;
 &nbsp;&lt;rule ref="rulesets/naming.xml"/&gt;
 &nbsp;&lt;rule ref="rulesets/basic.xml"/&gt;
&lt;/ruleset&gt;</code></pre><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; display: inline-block; height: 38px; line-height: 42px; color: rgb(60, 112, 198); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibm79JhNI9qukeHS5ibAx9ialuySVHnjsqiayE0V5Z08iaZ1sTHzucSEDy4JA/0?wx_fmt=png&quot;) left center / 45px no-repeat; padding-left: 30px; margin-top: 38px; margin-bottom: 10px;">4.5 代码检查工具整合及集成 jenkins</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">为整合这些检查工具，在 gradle 中自定义 check 命名，并依赖其他的 task。在执行检查的时候，可以通过 ./gradlew check 来执行全部的检查命令。</p><pre style="box-sizing: border-box; overflow: auto; font-size: 13px; padding: 9.5px; margin: 30px 8px 0px; line-height: 1.42857; word-break: break-all; word-wrap: break-word; color: rgb(91, 172, 235); background-color: rgb(50, 50, 50); border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204); border-radius: 4px;"><code style=" box-sizing: border-box; ; ; ; ; ; ; ; ">check.dependsOn 'checkstyle', 'findbugs', 'pmd', 'lint'</code></pre><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">另一方面，这种代码检查，如果等到开发完成的时候再去执行，很可能问题积累了很多，甚至导致产品上线前，开发并不能来得及修正全部的问题。为此，可以将代码检查的命令集成 jenkins，保证开发每天都能看到当前的代码的缺陷，能及时的修改</p><p></p><section class="" style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; line-height: 1.1; color: rgb(63, 63, 63); font-size: 20px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255);"><span style="box-sizing: border-box; height: 58px; line-height: 80px; color: rgb(60, 112, 198); border-bottom: 2px solid rgb(27, 95, 160); background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/ibnDKD3ktAoa9gX7UfBicUXChnMhyAXUibmdHI0FpXs2AAntxMm7yIfsU7qXr3v3sSicBGCtcE4LFV0xics3RkFZaNg/0?wx_fmt=png&quot;) 50% -2px / 77px no-repeat; margin-top: 38px; margin-bottom: 10px; padding-bottom: 7px; display: inline-block;">5 总结</span></section><p></p><p style="box-sizing: border-box; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; background-color: rgb(255, 255, 255); font-size: 16px; text-align: justify; white-space: pre-line; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74); line-height: 1.75em;">我们从编码前的编码规范，编码进行中的编码模板，编码结束后的代码静态检查，保障了程序小伙伴们的代码。除此之外，还有很多不完善的地方需要我们做进一步处理：</p><ol style="box-sizing: border-box; margin-top: 10px; color: rgb(63, 63, 63); font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; font-size: 14px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1em;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">和特定项目相关的自定义 Lint 检查项，仅支持了一部分的编码规范，自定义 Lint 检查项需要后续完成</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; color: rgb(74, 74, 74); line-height: 1.75em;">虽然检查工具很多，检查的结果内容也很多，而很明显，这些检查工具相互之间是有重复的情况（主要是纯 java 代码部分的检查），因此如果整理检查结果，并过滤出我们真正关心的问题，也是后续需要完成的内容</p></li></ol><p><br></p>
{% endraw  %}

