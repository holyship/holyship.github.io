---
title: 微信(WeChat)电脑端多开分析+源码
author: Angelxf
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1499131012&src=3&ver=1&signature=iU4hCwtQzyv2pey6SDTnZ62YXf1MWi8Zh8usUjq2T6Tp8olMm-6I1I4qsl-rYUzkEslKlH6cxolxoLxftDKuPjrUl6bAu3rmkufYlAO*bph9YLmdoQZoEEcI0c150zaOf06jg2SJW7sjcz3g5owKDJeW*mDgSQeQGIutz19HU*s=
date: '2017-06-26 00:00:00 +0000'

---

{% raw  %}
<h1 style="line-height: 1.75em; margin-top: 25px; margin-bottom: 25px;"><span style="background-color: rgb(0, 0, 0); color: rgb(255, 251, 0); font-size: 18px;"><strong>0x00 前言</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">不知道大家有没有多个微信号，我反正有一两三个。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">现在电脑端微信使用频率也比较高，主要用于大文件传输，或者手机电脑文件互传等等，除了不能收红包和看朋友圈，貌似电脑端没其他毛病。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">哦，还有个毛病，只能开一个微信，只能开一个，开一个，一个…</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">不管这些有的没的，今天的主题是，怎么样在电脑上开多个微信客户端！</span></p><h1 style="line-height: 1.75em; margin-top: 25px; margin-bottom: 25px;"><span style="background-color: rgb(0, 0, 0); color: rgb(255, 251, 0); font-size: 18px;"><strong><span style="color: rgb(255, 251, 0); background-color: rgb(0, 0, 0);">0x01 分析</span></strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">了解过单实例的同学，应该都知道大概是怎么实现的单开。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">简单说下，大都通过判断Mutex、Event、File等等是否已经存在，存在则退出当前开启进程（说明已经有一个进程了），这样也就是单实例了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">那只要找到微信是通过什么标志来实现单实例的，然后干掉这个标志即可。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">然后…基于这个思路，我们上工具。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">使用procexp找到微信进程，然后翻了一遍句柄。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">找到疑是的一段句柄。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8ETMDQibibic1MkRtNCDXqUKiaruBCQWaXYrQjY3qsvQbGTt6j5lKGZTjdzwZdCjf3PgibjAmVJS6Dm4uQ/0?wx_fmt=png" style="margin: 0px; padding: 0px; font-weight: inherit; font-style: inherit; font-family: inherit; width: 574px !important; height: 194px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">感觉这两个都像，不管了，上pchunter，kill掉句柄试一下。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">经过尝试，发现_WeChat_App_Instance_Identity_Mutex_Name是单实例标志（kill句柄后可以开第二个客户端），WeChat_GlobalConfig_Multi_Process_Mutex没用。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">既然如此，那开始码代码吧。</span></p><h1 style="line-height: 1.75em; margin-top: 25px; margin-bottom: 25px;"><span style="background-color: rgb(0, 0, 0); color: rgb(255, 251, 0); font-size: 18px;"><strong><span style="color: rgb(255, 251, 0); background-color: rgb(0, 0, 0);">0x02 代码</span></strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">可能的方案：</span></p><ol style="margin: 10px 0px; padding: 0px 0px 0px 20px; border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; font-family: none; color: rgb(0, 0, 0);" class="list-paddingleft-2"><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">找微信判断标识的代码位置，然后直接patch掉，或者整个dll进去patch。然后大致去翻了一下，貌似代码在wechatwin.dll，然后加了vmp壳，所以就不折腾这个了。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">直接通过代码kill掉这个Mutex的句柄（类似Pchunter操作），然后就可以开启第二个实例了，貌似明显更有优势啊。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">额，如果觉得无所谓，每次开之前用pchunter关一次句柄也行，下面就不用看了…</span></p></li></ol><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这里选择第二个方案，开始代码。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">流程：</span></p><ol style="margin: 10px 0px; padding: 0px 0px 0px 20px; border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; font-family: none; color: rgb(0, 0, 0);" class="list-paddingleft-2"><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">枚举句柄，找到_WeChat_App_Instance_Identity_Mutex_Name的mutant</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">duplicate句柄到本进程，然后close</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">启动微信</span></p></li></ol><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">下面是主要代码：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8ETMDQibibic1MkRtNCDXqUKiarEdicoOxHMSNvmwZ514ax05x6v7EYrtWNBMGWn7OeznY19RAoADcACjQ/0?wx_fmt=png" style="width: 719px !important; height: 1001px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">代码就这样，有注释，就不再啰嗦。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">完整代码，请看后面的地址。</span></p><h1 style="line-height: 1.75em; margin-top: 25px; margin-bottom: 25px;"><span style="color: rgb(255, 251, 0); background-color: rgb(0, 0, 0); font-size: 18px;"><strong><span style="color: rgb(255, 251, 0); background-color: rgb(0, 0, 0);">0x03 总结</span></strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一个小玩意，供大家一笑。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">编译好的可执行文件：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">https://github.com/anhkgg/multi_wechat_pc/raw/master/WeChat%E5%A4%9A%E5%BC%80.exe</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">源码地址：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">https://github.com/anhkgg/multi_wechat_pc</span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);">本文由 看雪论坛 Angelxf 原创，</span><span style="font-size: 15px; color: rgb(136, 136, 136);">转载请注明来自看雪学院<br></span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(255, 104, 39);">如果你喜欢的话，不要忘记点个赞哦！</span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">热门阅读文章：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank">看雪 CTF 2017 攻击篇 6月强势来袭！</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283658&amp;idx=2&amp;sn=f8870520fd3f842e489ce6bf2cb780ae&amp;chksm=b1815e0086f6d71634f6a1437dc638b4405bf263d45b27aabe77a67b9f99a583ea9211df63d5&amp;scene=21#wechat_redirect" target="_blank">娱乐War3 随机函数 GetRandomInt 懒人利用法</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283635&amp;idx=3&amp;sn=5ac5c1643f079d82894bdb0c484332dd&amp;chksm=b1815ef986f6d7efa34c863c9ea942331025a40a839f7b0fa6ada50dd657e0606eccc63e06c3&amp;scene=21#wechat_redirect" target="_blank">记一次安卓系统源码编译刷机过程</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283627&amp;idx=2&amp;sn=1ed3120f3b060dc5cccfd37add8fce45&amp;chksm=b1815ee186f6d7f75a6d74837204683da588dc1d4fa8fe1f94b4399eb54e4e08c097267556f1&amp;scene=21#wechat_redirect" target="_blank">黑掉SQL Server数据库链接：实验的设置和攻击指南（二）</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283585&amp;idx=3&amp;sn=a7dc01fb0dca60054a4cd8aba4f3e9a8&amp;chksm=b1815ecb86f6d7ddbe2fb1f42592fe3c27aa814cf1e7fd1695e524af437f781ec48cd27efadd&amp;scene=21#wechat_redirect" target="_blank">黑掉SQL Server数据库链接：实验的设置和攻击指南</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8F7ckRiaZtp76v0KXiaibibdH9bCfZtDdhqeqbk5LToic1TlqZZJ05wLxqexpbloufvSCKbUEPbEtFUzzQ/640?wx_fmt=jpeg" style="visibility: visible !important; width: 640px !important; height: 427px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1499131012&src=3&ver=1&signature=iU4hCwtQzyv2pey6SDTnZ62YXf1MWi8Zh8usUjq2T6Tp8olMm-6I1I4qsl-rYUzkEslKlH6cxolxoLxftDKuPjrUl6bAu3rmkufYlAO*bph9YLmdoQZoEEcI0c150zaOf06jg2SJW7sjcz3g5owKDJeW*mDgSQeQGIutz19HU*s=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217610.htm">阅读原文</a>
{% endraw  %}

