---
title: CVE-2012-0158 两种 PoC 分析
author: TKMoma
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1496016642&src=3&ver=1&signature=1Hp-JGX68UwholXKdYsHgG9Oe2Y4Txgw7FIHUz2sSP2AphHbOB7c*JU7liblQGWtMVZen7MuttjQKfDcEubrQPf57WBV9XMQ5WzLDElsoYEQP-O5APVMWuHiCHyG22HiVB*zSvvuU-xZ4YS8rT2GQjngXq8qfxTDJi1B9BT*wc0=
date: '2017-05-28 00:00:00 +0000'

---

{% raw  %}
<p style="margin: 15px 0px; border-width: medium medium medium 10px; border-color: currentcolor currentcolor currentcolor rgb(233, 233, 233); -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none none none solid; padding: 10px; font-size: 16px; color: rgb(153, 153, 153); background-color: rgb(243, 243, 243); box-shadow: 1px 1px 2px rgb(153, 153, 153); line-height: 1.75em;"><span style="font-size: 15px;">环境：windows xp sp3 pro<br> 工具：windbg(dbgx866.11.1.404) &nbsp; ida &nbsp;office2003(standard)<br> 样本来源：《漏洞战争》，看雪论坛</span></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">漏洞原理简介<br></p></section></section><blockquote><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">The
 (1) ListView, (2) ListView2, (3) TreeView, and (4) TreeView2 ActiveX 
controls in MSCOMCTL.OCX in the Common Controls in Microsoft Office 2003
 SP3, 2007 SP2 and SP3, and 2010 Gold and SP1; Office 2003 Web 
Components SP3; SQL Server 2000 SP4, 2005 SP4, and 2008 SP2, SP3, and 
R2; BizTalk Server 2002 SP1; Commerce Server 2002 SP4, 2007 SP2, and 
2009 Gold and R2; Visual FoxPro 8.0 SP1 and 9.0 SP2; and Visual Basic 
6.0 Runtime allow remote attackers to execute arbitrary code via a 
crafted (a) web site, (b) Office document, or (c) .rtf file that 
triggers "system state" corruption, as exploited in the wild in April 
2012, aka "MSCOMCTL.OCX RCE Vulnerability."《NVD》 非常经典的栈溢出漏洞</span></p></blockquote><p><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">PoC 分析一<br></p></section></section><p style="line-height: 1.75em; margin-bottom: 15px; margin-top: 20px;"><span style="font-size: 15px;">此 poc 来自《漏洞战争》中的。分析流程如下：<br> 1. 分析 poc 的行为<br> 2. 综合利用 windbg 和 ida 进行动态和静态分析。<br> 首先直接打开 windbg 和 word.exe，然后 windbg 中快捷键 F6 附件 word.exe 如下图所示： <br></span><img src="/ikanxue/images/1066dfa1f68ef57775186a4a0130b71450cc31ef.jpeg" style="width: 500px !important; height: 272px !important;"><span style="font-size: 15px;"> &nbsp;<br> 如下图当载入 poc.doc 的<br></span><img src="/ikanxue/images/0f2b3db7425837f2d1f81bec7f1d8f7e49c07661.jpeg" style="width: 500px !important; height: 249px !important;"><br><span style="font-size: 15px;"> 在上图中关键信息已经标注出来，当载入 poc.exe 时候，最终在 EIP = 41414141处段下，当利用 kb 命令查看堆栈的时候，发现堆栈已经被破坏掉啦。利用 dps 查看详细的栈信息.<br></span><img src="/ikanxue/images/aee0a140947b82aedade7c8fbcde20fd36635ed2.jpeg" style="width: 500px !important; height: 329px !important;"><br><span style="font-size: 15px;"> 根据上图的栈信息 0x127b30 = 41414141 &nbsp; 而0x127afc = 275c8a0a 此处的值，直接在查看0x275c8a0a地址处的反汇编代码如下如所示： &nbsp;<br></span><img src="/ikanxue/images/ef1602395ac079cfc0f2bdd4d9e13586eb5aea79.jpeg" style="width: 500px !important; height: 175px !important;"> <br><span style="font-size: 15px;"> 从上图中可以获取获取到 0x275c8a0a 是函数的返回地址，地址0x275c8a05处的函数调用极可能就是溢出函数，根据函数的信息可知道，<br> MSCOMCTL!DLLGetClassObject+0x41a29，此函数调用发生在 mscomctl.ocx 中，此组件是打开 doc 文件时动态加载的，所以只在下 bp 断点是断不下来的。<br> 接下来再上图的基础上持续向上查找，查找到 0x275c8a0a 函数调用的起始处，如下图所示：<br></span><img src="/ikanxue/images/3d9f5b644ec07297a2a3a33593ec2703ccb1c520.jpeg" style="width: 500px !important; height: 300px !important;"><span style="font-size: 15px;"> &nbsp;</span></p><p style="margin-top: 10px; margin-bottom: 10px; line-height: normal;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">调试此处函数的方法<br></p></section></section><h4 style="margin-top: 10px; margin-bottom: 10px; line-height: normal;"><strong><span style="font-size: 15px;"></span></strong><br></h4><blockquote><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">利用sxe ld mscomctl.ocx在动态加载的时候段下来。断下来之后直接在 地址0x275c89c7的地址出下int3 断点即可。</span></p></blockquote><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">重新加载 poc 文件，如下图所示：</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/80a2621e298dd59a743d91bd97d2a760e8b53b29.jpeg" style="width: 500px !important; height: 157px !important;"><span style="font-size: 15px;"> &nbsp; <br> 此时程序已经来到啦溢出函数的被调函数处，同时此时用 ida 打开 mscomctl.ocx 文件 （此文件在 system32 文件目录下 ） ，直接在函数窗口中打开 sub 0x275c89c7 函数地址如图所示：<br></span><img src="/ikanxue/images/d4c2ff299d2faf1652ad8160dbb536cd230911cd.jpeg" style="width: 500px !important; height: 332px !important;"><span style="font-size: 15px;"> &nbsp; &nbsp;<br> 从上图中我们可以直接获取到函数参数，以及函数的调用信息。 &nbsp;这里我们先主要依靠 windbg 进行分析。<br> 接下来直接利用 &nbsp;u 0x275c89c7 L64 命令 查看 100 条反汇编指令如下图所示：<br></span><img src="/ikanxue/images/36b320d2c7c7885b65a5992242141906b2c186bb.jpeg" style="width: 500px !important; height: 306px !important;"> <br><span style="font-size: 15px;"> 如图所示 重点部分已经标注，接下来直接使用命令 uf MSCOMCTL!DllGetClassObject+0x41a29 进行查看函数完整的反汇编指令。其实仔细观察会发现，在溢出的被调用函数中，总共发生过两次相同的函数调用如下图所示： <br></span><img src="/ikanxue/images/a4dc709734a28745b98d9db569ed5455d7594613.jpeg" style="width: 500px !important; height: 442px !important;"><span style="font-size: 15px;"> &nbsp;</span></p><h4 style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 16px; color: rgb(255, 251, 0); background-color: rgb(0, 0, 0);"><strong>下面对溢出函数进行分析</strong></span></h4><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">单步运行到 0x275c8a05 然后 dd esp 查看函数参数值。如图：<br></span><img src="/ikanxue/images/a231657b662c264f906fb098123a44dd7c3a621e.jpeg" style="width: 500px !important; height: 387px !important;"><br><span style="font-size: 15px;"> 如上图，函数三个参数分别是 0x127b24 0xbfe06b0 0x8282 &nbsp;以及进入溢出函数前的ebp = 0x127b2c 进入函数后 ebp = 127af8 &nbsp;接下来继续单步运行程序直接来到地址275c87cb 地址处如图所示： <br></span><img src="/ikanxue/images/5cfdc382733b3826917ac7ae2b8f4e2ec5ea3adc.jpeg" style="width: 500px !important; height: 321px !important;"><span style="font-size: 15px;"> &nbsp;<br> 如图所示当执行到地址 275c87cb 地址处的时候，可以观察 esi 内存中包含 41414141 而 ecx = ox20a0 因此当执行 此指令时后，即可表明程序的执行已经被用户控制啦。</span></p><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.5em;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">溯源<br></p></section></section><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.5em;"><span style="font-size: 15px;"><br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">接下来分别对 0x275c87cb 地址处相关的寄存器（ecx esi edi ）进行值溯源，详细分析程序。</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">当程序执行到 地址 0x275c87cb 地址处的时候，再上图中可以观察到。 ecx = 20a0 &nbsp;edi = 127b24 &nbsp; esi = 
5602008 &nbsp;从此地址向上翻看，也就是向低地址寻找的时候，发现 shr ecx,2 右移位指令，相当于将 ecx/=4==20a0 的操作。 
20a0 * 4 = &nbsp;8280，此处暂且谨记。 &nbsp;接下来重新在如 poc 样本，分别在地址 0x275c89c7 
第一次调用调用溢出函数时的 0x275c876e 这两地址出下断点。&nbsp; <br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">当程序段在地址 0x275c89c7 的时候，可以查看到 <br></span><img src="/ikanxue/images/149c3dcdd3f5b094b7a325211f0520b1d45c21eb.jpeg" style="width: 500px !important; height: 127px !important;"> <br><span style="font-size: 15px;"> 此时上层函数的返回地址是 0x275e701a 此层函数的 ebp= 127b2c (执行完 mov ebp,esp 后的 ebp 的值) &nbsp;接下来单步运行程序。来到地址 0x275c89da 地址出，查看栈空间，在此处特别要谨记函数调用中的三个参数（分别是：0x127b18 0x0c4e06b0 0xc） <br></span><img src="/ikanxue/images/05af9f982b7fb75a605055243c91f75e5edabe97.jpeg" style="width: 500px !important; height: 395px !important;"><br><span style="font-size: 15px;"> 结合着汇编指令很容易理解上图中的内容。接下来进入此函数。 <br></span><img src="/ikanxue/images/460e274cbd7898e06817f4f69a0e8f7237e8ad18.jpeg" style="width: 500px !important; height: 269px !important;"><span style="font-size: 15px;"> &nbsp;<br> 如上图所示 地址 27589df 是此函数的返回地址，0x127b2c 是上层函数 ebp 的值。此层函数 ebp = 0x127af8.继续单步运行， <br> 当执行完地址：0x 275c8783处的指令后，观察前后栈区数值的变化如下图所示（此函数的作用是从源地址：0xbd706b0处向0x127af4 处读取四个字节内容）： &nbsp;<br></span><img src="/ikanxue/images/d5f5dddf130f3be7c359476d53724a85a437628f.jpeg" style="width: 500px !important; height: 194px !important;"><br><span style="font-size: 15px;"> 此处的变化仅仅是地址 0127af4 地址处的值由原来的 275b2480-&gt;0x0000000c &nbsp;程序运行到地址 0x275c878d处时，此函数的第三个参数与地址 0x127af4 处的值进行比较。如下图所示： &nbsp; &nbsp;<br></span><img src="/ikanxue/images/d3e2f93fae74d544f42c81086c881481fe180b3a.jpeg" style="width: 500px !important; height: 224px !important;"><br><span style="font-size: 15px;"> 接下来继续单步运行来到堆内存申请函数出，可以观测出申请的内存大小是0xc字节。并且函数的返回句柄保存在 eax 中（此处需要谨记）<br></span><img src="/ikanxue/images/d63cb8d183162ac190f3af0cc796177d99dd1205.jpeg" style="width: 500px !important; height: 141px !important;"><span style="font-size: 15px;"> &nbsp;<br> 接下来继续单步执行到地址：0x275c87b5 地址出 此函数作用仍然是从 poc 的文件内容中读取 0xc 字节的数据到申请的堆区内存中。当执行玩以后如下图所示表明此时： <br></span><img src="/ikanxue/images/251ff563ccaa7834a10d4ef6bcc07c5fb9ee542b.jpeg" style="width: 475px !important; height: 118px !important;"> <br><span style="font-size: 15px;"> 接下来继续单步运行如下图所示： &nbsp;<br></span><img src="/ikanxue/images/c7dc432005c3e88cef754de889555639f7a12f51.jpeg" style="width: 500px !important; height: 108px !important;"> <br><span style="font-size: 15px;"> 接下来直接执行到地址 0x275c87cb 地址处。 &nbsp;此时观察 edi esi ecx 的值，如下图所示：<br></span><img src="/ikanxue/images/c9b15d0abaef5a8789c46a65686a9a75e43f1ede.jpeg" style="width: 500px !important; height: 380px !important;"><br><span style="font-size: 15px;"> 从上图中观察出 edi = 00127b8 （即函数的第一个参数） esi 的值就是申请堆内存时返回的句柄。ecx = 3 &nbsp;是 shr ecx，2后的值，通过向上翻看指令可知，ecx 值来自edi 来自函数调用中第三个参数的值。</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">至此可以得到的是在溢出函数的被调函数中（也就是从地址0x275c89c7开始的函数中），当在栈中申请 0x14 字节内存后（内存地址是0x127b18-127b2c）
 当在地址 0x275c89da 处第一次执行函数的时候，在栈区申请的0x14字节的内存已经用掉啦 0xc 字节，并且进行了复制如下图所示：<br></span><img src="/ikanxue/images/8cb29bc07aee2843e8893ee72a3164f106655c13.jpeg" style="width: 500px !important; height: 138px !important;"><span style="font-size: 15px;"> 地址275c89da 此函数的作用是：间接利用堆内存，从 poc 文件中复制内容到栈区中。复制内容的多少由函数的第三个参数决定。（这个是重点） &nbsp;</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">接着从地址 0x275c89df 开始继续进行分析单步运行程序：<br></span><img src="/ikanxue/images/1d06f7ff70cb42aff680d598c3c50bb3c3effa76.jpeg" style="width: 500px !important; height: 367px !important;"><br><span style="font-size: 15px;">
 从地址0x275c89df 到地址 275c89f7 
处，其中两条cmp的比较指令尤为重要，决定啦是否执行esp。并且第二条cmp指令的值决定啦在0x275c8a05处第三个参数的大小。以上分析可知，0x127b18
 - 127b2c中间内存的值是从poc样本中复制出来的。因此只需构造一下即可满足此两个条件。</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">接下来进入275c8a05地址出进行分析。（其实和地址 275c89da地址处的分析一样，只不过是数据发生啦变化） &nbsp;进入函数后，如下图所示：<br></span><img src="/ikanxue/images/0ae62e1c79cfaebf53516277d3347d8af548fcab.jpeg" style="width: 500px !important; height: 204px !important;"><br><span style="font-size: 15px;"> 如上图所示：在函数返回地址后面紧跟的三个数值即为函数参数。<br> 当执行到 0x275c8786 地址处的时候，如下如所示：<br></span><img src="/ikanxue/images/e0477d01e16884aebb0588766393b355074864a3.jpeg" style="width: 500px !important; height: 230px !important;"><br><span style="font-size: 15px;"> 如上图所示，在地址 275c8783 地址处的函数调用中，成功读取到啦四个字节的值（0x127af4= 0x00008282）&nbsp; <br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">当执行完 0x275c879e 处指令后记下返回值 eax= 0x04ed9008，接着继续执行到地址：275c87b8 地址处，如下图所示：<br></span><img src="/ikanxue/images/355dda377a37c7b5fc4b82cf004c5e6268210113.jpeg" style="width: 500px !important; height: 170px !important;"><br><span style="font-size: 15px;"> 地址 275c87b5 地址出的指令作用是向堆区进行复制 0x8282 字节的内容，源文件来自 poc 样本，地址是（bd706bo）&nbsp; <br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">接下来直接执行到地址 0x275c87cb 地址出，如下图所示：<br></span><img src="/ikanxue/images/79dbb81f1812ae030d837705fa8e94efc1073f62.jpeg" style="width: 500px !important; height: 101px !important;"><br><span style="font-size: 15px;"> 如上图所示一目了然啦已经很，ecx = exc&gt;&gt;2 == 20a0 &nbsp;edi 仍然是参数，esi 仍然是堆区首地址。此时查看堆区内容如下图：<br></span><img src="/ikanxue/images/91e69e680b6a9423a342b88e573cde351a2e0f0a.jpeg" style="width: 500px !important; height: 158px !important;"><br><span style="font-size: 15px;"> 此时应该很清晰啦吧。当执行 275c87cb 地址出的指令的时候，eip肯定会被poc样本控制。</span></p><p style="margin-top: 5px; margin-bottom: 5px; line-height: 1.5em;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">ida 分析<br></p></section></section><p style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><span style="font-size: 15px;"><br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">ida 分析起来就比较简单啦，直接将 mscomctl.ocx 拖进 ida 查找到 0x2785c89c7 地址出的函数，如图所示： </span><img src="/ikanxue/images/6c06fd571a2bfbc284360b27b87da17219b3f368.jpeg" style="width: 500px !important; height: 222px !important;"><span style="font-size: 15px;"><br> 查看伪代码<br></span><img src="/ikanxue/images/ec208b0a069efc8135011db4b1867966edb56fc5.jpeg" style="width: 500px !important; height: 357px !important;"><br><span style="font-size: 15px;"> 直接进入溢出函数查看伪代码：<br></span><img src="/ikanxue/images/eafc1883ca0a68673dcce46b6424adc861c0b7b0.jpeg" style="width: 500px !important; height: 275px !important;"><br><span style="font-size: 15px;"> 集合这汇编指令是不是很是一目了然</span></p><p style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">漏洞原因<br></p></section></section><p style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><span style="font-size: 15px;"><br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">mscomctl.ocx 0x275c89c7中， <br></span><img src="/ikanxue/images/0da3b4b23cbd8bb0cf042af559aa81398d9dbbd5.jpeg" style="width: 500px !important; height: 66px !important;"><br><span style="font-size: 15px;"> 此处的判断条件存在错误 &nbsp;不应该是 &gt;=8 而是小于等于 8</span></p><p style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">PoC 分析二<br></p></section></section><h4 style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><strong><span style="font-size: 15px;"></span></strong><br></h4><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">样本来源： </span><a style="font-size: 15px; text-decoration: underline;"><span style="font-size: 15px;">样本来源（阅读原文查看）</span></a> <br><span style="font-size: 15px;"> 此处 poc 的利用效果是打开当打开 poc 时弹出计算器。（但是使用过一次样本后需要从新载入一个新的样本，因此使用的时候请先进行备份） &nbsp;<br> 同样的直接在 msconctl.ocx 地址出下断点： 当程序执行到地址 0x275c89df地址处的时候可以看到，如下图所示：<br></span><img src="/ikanxue/images/78652dc7809a5edd664a0a25d6c537337ad4c944.jpeg" style="width: 500px !important; height: 191px !important;"><br><span style="font-size: 15px;"> 如上图所示【ebp-0xc】的值是 0x8282 同样大于 &nbsp;0x8 &nbsp; 接着执行程序：来到地址 0x275c87cb地址出如下图：<br></span><img src="/ikanxue/images/d8968d3b2cacd067298edf18fdd24afa1870454d.jpeg" style="width: 500px !important; height: 193px !important;"> <br><span style="font-size: 15px;"> 如上图所示，很明显的 0x7ffa4512(jmp esp)指令 跳转到 shellcode</span></p><p style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">总结</p></section></section><h4 style="margin-top: 5px; margin-bottom: 5px; line-height: normal;"><span style="font-size: 16px;"></span><br></h4><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">第一次分析 CVE 不清楚的地方请大家直接指出来共同进步<br> 本文参考啦很多篇文章，感谢各位前辈的辛苦付出 下面附上参考文章的链接</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">参考文章链接：&nbsp;</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;">http://bbs.pediy.com/search-cve202012200158-1.htm</span></p><p style="text-align: center; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px; color: rgb(136, 136, 136);">本文由看雪论坛 <span class="">TKMoma</span><span class=""> </span>原创</span><span style="font-size: 15px;"><br></span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;"></span><br></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 15px;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">你可能对以下内容感兴趣：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282630&amp;idx=1&amp;sn=61fcbc708235dec5d7897a0d7c315756&amp;chksm=b1815a0c86f6d31a50ba1f9a39d876e28f2c71096100b28e961df185f7be94ec77b9199efd51&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">等你来挑战！| 看雪 CTF 2017 攻击篇</a></span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282621&amp;idx=1&amp;sn=15f5bc0fa2b0b34ae241668b23a3939b&amp;chksm=b1815af786f6d3e1fd4bad2c336d725ec600551a6477bbc4c6af93167074ac83873aeba89938&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">【终于等到你！】看雪 CTF 2017</a></span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283039&amp;idx=2&amp;sn=7965f942fd1629eb4b0502b01a522998&amp;chksm=b1815c9586f6d583b224490858104e7a5e5affad9542fe33da744c091ec234c3a55016f41690&amp;scene=21#wechat_redirect" target="_blank">MS17-010 SMB 远程命令执行漏洞利用分析</a><br></span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283033&amp;idx=2&amp;sn=7a0d3fa2c8c5e2bdcac6379351269330&amp;chksm=b1815c9386f6d585439b2186c5fc7099c74ce5398483563db182f868911a3a2c6c4be7500021&amp;scene=21#wechat_redirect" target="_blank">新手逆向学习--Win7 下 64 位扫雷逆向以及辅助制作</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283005&amp;idx=2&amp;sn=2fc411b70549c789085e517ef6dfc3e9&amp;chksm=b1815b7786f6d261975cd000d4ddf2c4cffe3cf2d8ab06d870e7971e862c29c7278996bdfb6c&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283017&amp;idx=3&amp;sn=745024d678707b6dcf0cdc94ff5472a5&amp;chksm=b1815c8386f6d59538bfeeb8d3837007f07b0b4d3cd77b439f7856edd391127b6b2f36fb105d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;">Ring3 注入总结及编程实现【有码】</span></a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283003&amp;idx=1&amp;sn=bcfd852aea24f274bf8fda85f9300a85&amp;chksm=b1815b7186f6d26758f7f0f1cb0c7ec9da888ab0d80a7b2e2850453bfc03f05640443839d7bf&amp;scene=21#wechat_redirect" target="_blank">【原创】WannaCry勒索软件中“永恒之蓝”漏洞利用分析</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><img src="/ikanxue/images/a0942aca19665d63c4ee222be971a37cd63dc1e4.jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important; line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p style="line-height: 1.75em; margin-top: 15px; margin-bottom: 15px;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1496016642&src=3&ver=1&signature=1Hp-JGX68UwholXKdYsHgG9Oe2Y4Txgw7FIHUz2sSP2AphHbOB7c*JU7liblQGWtMVZen7MuttjQKfDcEubrQPf57WBV9XMQ5WzLDElsoYEQP-O5APVMWuHiCHyG22HiVB*zSvvuU-xZ4YS8rT2GQjngXq8qfxTDJi1B9BT*wc0=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217890.htm">阅读原文</a>
{% endraw  %}

