---
title: 虚拟机逃逸——QEMU的案例分析（二）
author: Green奇
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1496829841&src=3&ver=1&signature=IbkGB-IUv3NGRNGRf6IuJDEcuRy1*zESqpfOL5NuObERGQ*gbLaFfQ8X2IuMqNyfrhAtNGHPvT-wKPXl9IJKjOpnMQNm3fPORJ3kr42g9*dnW2AUZNxprIng84-7ehY9hnc7u4CQ9xiP*59kwbuGgNcFdoleXEHGt*7tzEL5le8=
date: '2017-06-03 00:00:00 +0000'

---

{% raw  %}
<section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">G3. 内存泄露的利用</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">本节中，我们将利用CVE-2015-5165——一个影响RTL8139</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">网卡仿真的内存泄露漏洞——来重现QEMU的内存泄露。更确切的说，我们需要泄露（1）.text字段的基地址，用于构建shellcode（2）用户物理内存的基地址，用于得到一些虚拟结构的准确地址。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">3.1 漏洞代码</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">REALTEK 网卡支持两种接收/传送模式：C 模式和 C+ 模式。当网卡配置成 C+ 模式时，NIC 设备仿真器会错误计算IP数据包的长度并在结束时发送更多的数据。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">漏洞出现在 hw/net/rtl8139.c 文件中的 rtl8139_cplus_transmit_one 函数：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdH3HiazVnibJs7IEfyvfjpTqYEDI60nDLRHWdNLgaGm860bwiaGDwdGsAQ/0?wx_fmt=png" style="width: 382px !important; height: 446px !important; visibility: visible !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">IP 头包括两个参数：hlen 表示 ip 数据包长度，ip-&gt;ip_len 表示 IP 头的长度（一个包20字节，不包括可选字段），数据包的总长度包括ip头的长度。如下所示的代码片段最后，在计算IP数据长度（ip_data_len）时没有检查确保 ip-&gt;ip_len 不小于hlen。因为 ip_data_len 参数类型为 unsigned short，这会导致发送比传送缓冲区实际更多的数据。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">更确切的说，ip_data_len 会被复制用于之后计算 TCP 数据的长度——如果数据超过了 MTU 的长度将会一直传送下去——最后进入一个 malloced 缓冲区：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdGWTRoNUHszIc8JO7yAsnhqSBZnb10cj902BGHVUdL3IC4kOJ4BZcPQ/0?wx_fmt=png" style="width: 419px !important; height: 358px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">所以，如果我们伪造一个长度错误的包（比如长度ip-&gt;ip_len = hlen - 1），那我们就可以从QEMU的内存中泄露大约64KB的数据。这样，网卡就不会发送一个简单的包了，而是在结束时发送43个分散的包。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">3.2 配置网卡</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">为了传送我们伪造的包并读取泄露的数据，我们需要配置网卡的接收缓冲和发送缓冲，并设置一些标记来确保我们的包经过漏洞代码的路径传输。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">下图是RTL8139的寄存器。这不是所有的寄存器，只列出与漏洞利用有关的寄存器。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdHnNG3p1FicYKcyqU2sIWceZ0SD5YB0OjCyI53MEfiaMYHTVTomPiaxZ7w/0?wx_fmt=png" style="width: 428px !important; height: 284px !important;"></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">TxConfig：开启/关闭Tx的标记，比如TxLoopBack（开启loopback测试模式），TxCRC（Tx包不添加冗余校验码）等。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">RxConfig：开启/关闭Rx的标记，比如AcceptBroadcast（接收广播包）， AcceptMulticast（接收组播包）等。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">CpCmd：C+指令寄存器用来执行一些函数，比如 CplusRxEnd（允许接收），CplusTxEnd（允许发送）等。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">TxAddr0：Tx表的物理内存地址。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">RxRingAddrLO：Rx表的物理内存地址的低32位。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">RxRingAddrHI：Rx表的物理内存地址的高32位。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">TxPoll：告诉网卡检查Tx。</span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一个 Rx/Tx-descriptor 定义有如下特征：buf_lo 和 buf_hi 分别表示 Tx/Rx 缓冲的物理内存地址的低 32 位和高 32 位。这些地址指向存储要发送/接收的包的缓冲区，必须与页面大小对齐。变量 dw0 表示缓冲区的长度加上额外的标记，比如用来标记缓冲区归网卡还是驱动所有的 ownership 标记。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdjHIPGsukU2hIWBbq7PNOB8xAXENXtVoib7gey8K6WFaHphkO6l3r0NA/0?wx_fmt=png" style="width: 217px !important; height: 95px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">网卡通过in*()和out*()（定义在sys/io.h）进行配置。配置需要 CAP_SYS_RAWIO 特权。以下代码段配置网卡并构建一个简单的 Tx descriptor。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icduhtRpE5uBib2Mm1pBVVOicH41aZI9V971f3LVCDvcHHIPibUY5gbNVcUA/0?wx_fmt=png" style="width: 428px !important; height: 415px !important;"></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">3.3 漏洞利用</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">完整的漏洞利用代码（cve-2015-5165.c）可参见附录的源代码压缩包。首先配置会用到的网卡寄存器并构建了Tx和Rx缓冲。然后伪造一个IP包并发送给网卡的MAC地址。这让我们能在配置的Rx缓冲中读到泄露的数据。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">当分析泄露的数据时，会出现很多函数指针。仔细分析后发现，这些函数指针都有相同的QEMU内部结构：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdEVHmA8AuR4kBeGZw9Oib5x1w5gnznO7vVcoU6gZeiaPaRr7ljg7wN07w/0?wx_fmt=png" style="width: 267px !important; height: 189px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">QEMU遵循一个对象模型来管理设备、内存等。QEMU在启动时会创建一些对象并分配属性。例如，以下调用会给一个内存对象添加属性“may-overlap”。该属性通过getter方法获得一个布尔值。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdP8kib8FImDDU88D4cJicwm4qoZ3PPjZ4LU2ibVAz1KiaCptgp41P9YRzKg/0?wx_fmt=png" style="width: 466px !important; height: 74px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">RTL8139网卡需要在头中分配64KB的空间来重组包。很有可能这个空间与对象属性撤销后的空间正好合适。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在漏洞利用中，我们在溢出内存中搜索已知的对象属性。更确切的说，我们搜索至少有一个函数指针被设置（获取、设置、解决或释放）的80字节的内存块（一个自由ObjectProperty结构的块）。即使这些地址有ASLR（一种针对</span><a style="font-size: 15px; text-decoration: underline;"><span style="font-size: 15px;">缓冲区溢出</span></a><span style="font-size: 15px;">的</span><a style="font-size: 15px; text-decoration: underline;"><span style="font-size: 15px;">安全保护技术</span></a><span style="font-size: 15px;">）保护，但我们仍可以猜.text字段的基地址。实际上，他们的页偏移地址是确定的（12个最小有效位或虚地址都不是随机的）。我们可以计算获得一些QEMU函数的地址。我们还可以得到一些LibC函数的地址，比如从PLT入口获得mprotect()和system()的地址。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们还发现PHY_MEM + 0x78的地址多次泄露，PHY_MEM表示分配给用户的物理内存空间的首地址。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">目前的漏洞利用是搜索泄露的内存并尝试找到（1）.text字段的基地址（2）物理内存的基地址。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">4. 堆溢出的利用</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这部分讨论漏洞CVE-2015-7504并利用漏洞获得%rip寄存器的控制权。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><span style="font-size: 16px;"><strong>4.1 漏洞代码</strong></span><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><span style="font-size: 15px;">AMD PCNET网卡仿真器在loopback测试模式下接收大型包时有一个堆溢出漏洞。PCNET用4KB的缓冲区存储包。如果开启了Tx缓冲的ADDFCS标记，网卡会给接收到的包添加一个冗余校验码，如下代码段所示，定义于hw/net/pcnet.c</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">的pcnet_receive()函数。如果接收到的包长度小于4096-4字节）就不会出现问题，然而，如果包长度正好是4096字节，我们就可以溢出目的缓冲区4个字节的数据。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdEiaJEEZAwrDWensNfH5ClwU301icibtgurZ1MFoURml7yW97ibydSdtdeg/0?wx_fmt=png" style="width: 376px !important; height: 321px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">上述代码中s指向 PCNET的主结构体，可以看到通过漏洞缓冲区的溢出，我们得到 irq 变量的值：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdze3ZXMArOOqwLMVYj0u8yUv53SL4txMGefEdFacANnTEicEdR8EBYGw/0?wx_fmt=png" style="width: 433px !important; height: 327px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp; irq 变量是一个指针，指向 IRQState 结构体表示一个用于执行的处理程序。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdhZAx6CpMzxx77gc5cPy2nl6KTmu1vN1tSTIOicVG6O2IEa98TPicicSFA/0?wx_fmt=png" style="width: 471px !important; height: 125px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这个处理程序被PCNET网卡多次调用，比如在pcnet_receive()函数的最后，调用pcnet_update_irq()时会调用qemu_set_irq()函数：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icd3Iq1vnSGoxIKvKP3f4gaawbXbL9bqeiaITXXmaWyjy4Vnf86RbykvyA/0?wx_fmt=png" style="width: 302px !important; height: 110px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">所以，为了利用这个漏洞，我们需要做：</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;构造一个假的IRQState结构体用于执行的处理程序（比如 system()函数）。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;计算该结构体的准确地址。多亏于精确内存泄露，我们准确的知道了该结构体在QEMU进程内存的准确地址（在用户物 &nbsp; &nbsp;理内存的基地址的一些偏移地址处）。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;构造一个4KB的恶意包。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;给该恶意包打补丁，让其冗余校验码与我们构造的假IRQState结构体相匹配。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;发送恶意包。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;当PCNET接收到该恶意包时，调用pcnet_receive function()处理包，执行以下操作：</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;复制接收包的内容到缓冲区变量。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;计算一个冗余校验码并添加到缓冲区中。缓冲区溢出4字节数据并泄露出irq变量。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;调用pcnet_update_irq()时会调用使用irq变量的qemu_set_irq()函数。然后输出处理程序执行。</span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">注意我们可以控制替换处理程序的前两个参数（irq-&gt;opaque和irq-&gt;n），但多亏于我们之后会说到的小技巧，我们可以控制第三个参数（level参数）。这在调用 mprotect()函数是必须的。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">还要注意我们用4字节泄露了一个8字节的指针。这足够在我们的测试环境中成功控制%rip寄存器、然而，这会在没有设置CONFIG_ARCH_BINFMT_ELF_RANDOMIZE_PIE参数的内核上出现问题。这个问题会在5.4中讨论。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;"><span style="font-size: 15px;">&nbsp;<span style="font-size: 16px;">4.2 配置网卡</span></span></span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在继续进行之前，我们需要配置 PCNET 网卡用以配置需要的参数、构造 Tx 和 Rx 缓冲和分配循环缓冲区用来保存发送和接收的数据包。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">AMD PCNET 网卡有 16 位和 32 位两种模式。这取决于 DWIO（存储在网卡上的变量）的实际值。下面，我们详细列出了 PCNET 网卡在 16 位模式下的主要寄存器，该模式是网卡重启后的默认模式：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdEqwOicXhFeoVtkyMDLlSYFDpkficNh6Lwq5ku6NZOib41XSDBibBZwzRcQ/0?wx_fmt=png" style="width: 357px !important; height: 182px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">通过访问复位寄存器让网卡复位到默认状态。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">网卡有两种内部寄存器：CSR（控制和状态寄存器）和BCR（总线控制寄存器）。两种寄存器都通过首先设置对应的我们要访问的RAP（寄存器地址端口）寄存器来访问。比如，如果我们想启动并重置网卡，我们需要设置CSR0寄存器的bit0和bit1为1。可以通过写0进RAP寄存器来选择CSRO寄存器，然后设置CSR寄存器为0x3：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdjFcO1C1flk1iaibwfAGJibuVfh9pXlZK8pzeibH1pFwYjozGcy3UmOkuLg/0?wx_fmt=png" style="width: 240px !important; height: 53px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">网卡的配置可以通过填充一个初始化结构体，并将该结构体的物理地址传送到网卡（通过CSR1和CSR2代码）来完成：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdUwkdmuwgN508oPT01M2pWArMHUhgbkrYMNrdFyqzLSH5lFLFoUVu8w/0?wx_fmt=png" style="width: 465px !important; height: 151px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><strong><span style="font-size: 16px;">4.3 逆向冗余校验码</span></strong><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">如前面所说，我们需要给包打补丁，让其冗余校验码与我们构造的假结构体相匹配。幸运的是，冗余校验码是可以逆向的。得益于文章[6]的方法，我们可以打一个 4 字节的补丁让冗余校验码与我们的选择相匹配。源码 reverse-crc.c 添加了一个补丁到一个预填充缓冲区来让冗余校验码与 0xdeadbeef 相等。</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">---[&nbsp;reverse-crc.c&nbsp;]---</span></p><p style="line-height: normal;"><span style="font-size: 14px;">#include&nbsp;&lt;stdio.h&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">#include&nbsp;&lt;stdint.h&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">#define&nbsp;CRC(crc,&nbsp;ch)&nbsp; &nbsp;(crc&nbsp;=&nbsp;(crc&nbsp;&gt;&gt;&nbsp;8)&nbsp;^&nbsp;crctab[(crc&nbsp;^&nbsp;(ch))&nbsp;&amp;&nbsp;0xff])</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">/*&nbsp;generated&nbsp;using&nbsp;the&nbsp;AUTODIN&nbsp;II&nbsp;polynomial</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;* x^32&nbsp;+&nbsp;x^26&nbsp;+&nbsp;x^23&nbsp;+&nbsp;x^22&nbsp;+&nbsp;x^16&nbsp;+</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;* x^12&nbsp;+&nbsp;x^11&nbsp;+&nbsp;x^10&nbsp;+&nbsp;x^8&nbsp;+&nbsp;x^7&nbsp;+&nbsp;x^5&nbsp;+&nbsp;x^4&nbsp;+&nbsp;x^2&nbsp;+&nbsp;x^1&nbsp;+&nbsp;1</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;*/</span></p><p style="line-height: normal;"><span style="font-size: 14px;">static&nbsp;const&nbsp;uint32_t&nbsp;crctab[256]&nbsp;=&nbsp;{</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x00000000,&nbsp;0x77073096,&nbsp;0xee0e612c,&nbsp;0x990951ba,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x076dc419,&nbsp;0x706af48f,&nbsp;0xe963a535,&nbsp;0x9e6495a3,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x0edb8832,&nbsp;0x79dcb8a4,&nbsp;0xe0d5e91e,&nbsp;0x97d2d988,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x09b64c2b,&nbsp;0x7eb17cbd,&nbsp;0xe7b82d07,&nbsp;0x90bf1d91,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x1db71064,&nbsp;0x6ab020f2,&nbsp;0xf3b97148,&nbsp;0x84be41de,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x1adad47d,&nbsp;0x6ddde4eb,&nbsp;0xf4d4b551,&nbsp;0x83d385c7,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x136c9856,&nbsp;0x646ba8c0,&nbsp;0xfd62f97a,&nbsp;0x8a65c9ec,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x14015c4f,&nbsp;0x63066cd9,&nbsp;0xfa0f3d63,&nbsp;0x8d080df5,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x3b6e20c8,&nbsp;0x4c69105e,&nbsp;0xd56041e4,&nbsp;0xa2677172,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x3c03e4d1,&nbsp;0x4b04d447,&nbsp;0xd20d85fd,&nbsp;0xa50ab56b,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x35b5a8fa,&nbsp;0x42b2986c,&nbsp;0xdbbbc9d6,&nbsp;0xacbcf940,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x32d86ce3,&nbsp;0x45df5c75,&nbsp;0xdcd60dcf,&nbsp;0xabd13d59,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x26d930ac,&nbsp;0x51de003a,&nbsp;0xc8d75180,&nbsp;0xbfd06116,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x21b4f4b5,&nbsp;0x56b3c423,&nbsp;0xcfba9599,&nbsp;0xb8bda50f,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x2802b89e,&nbsp;0x5f058808,&nbsp;0xc60cd9b2,&nbsp;0xb10be924,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x2f6f7c87,&nbsp;0x58684c11,&nbsp;0xc1611dab,&nbsp;0xb6662d3d,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x76dc4190,&nbsp;0x01db7106,&nbsp;0x98d220bc,&nbsp;0xefd5102a,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x71b18589,&nbsp;0x06b6b51f,&nbsp;0x9fbfe4a5,&nbsp;0xe8b8d433,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x7807c9a2,&nbsp;0x0f00f934,&nbsp;0x9609a88e,&nbsp;0xe10e9818,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x7f6a0dbb,&nbsp;0x086d3d2d,&nbsp;0x91646c97,&nbsp;0xe6635c01,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x6b6b51f4,&nbsp;0x1c6c6162,&nbsp;0x856530d8,&nbsp;0xf262004e,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x6c0695ed,&nbsp;0x1b01a57b,&nbsp;0x8208f4c1,&nbsp;0xf50fc457,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x65b0d9c6,&nbsp;0x12b7e950,&nbsp;0x8bbeb8ea,&nbsp;0xfcb9887c,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x62dd1ddf,&nbsp;0x15da2d49,&nbsp;0x8cd37cf3,&nbsp;0xfbd44c65,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x4db26158,&nbsp;0x3ab551ce,&nbsp;0xa3bc0074,&nbsp;0xd4bb30e2,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x4adfa541,&nbsp;0x3dd895d7,&nbsp;0xa4d1c46d,&nbsp;0xd3d6f4fb,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x4369e96a,&nbsp;0x346ed9fc,&nbsp;0xad678846,&nbsp;0xda60b8d0,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x44042d73,&nbsp;0x33031de5,&nbsp;0xaa0a4c5f,&nbsp;0xdd0d7cc9,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x5005713c,&nbsp;0x270241aa,&nbsp;0xbe0b1010,&nbsp;0xc90c2086,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x5768b525,&nbsp;0x206f85b3,&nbsp;0xb966d409,&nbsp;0xce61e49f,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x5edef90e,&nbsp;0x29d9c998,&nbsp;0xb0d09822,&nbsp;0xc7d7a8b4,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x59b33d17,&nbsp;0x2eb40d81,&nbsp;0xb7bd5c3b,&nbsp;0xc0ba6cad,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xedb88320,&nbsp;0x9abfb3b6,&nbsp;0x03b6e20c,&nbsp;0x74b1d29a,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xead54739,&nbsp;0x9dd277af,&nbsp;0x04db2615,&nbsp;0x73dc1683,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xe3630b12,&nbsp;0x94643b84,&nbsp;0x0d6d6a3e,&nbsp;0x7a6a5aa8,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xe40ecf0b,&nbsp;0x9309ff9d,&nbsp;0x0a00ae27,&nbsp;0x7d079eb1,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xf00f9344,&nbsp;0x8708a3d2,&nbsp;0x1e01f268,&nbsp;0x6906c2fe,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xf762575d,&nbsp;0x806567cb,&nbsp;0x196c3671,&nbsp;0x6e6b06e7,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xfed41b76,&nbsp;0x89d32be0,&nbsp;0x10da7a5a,&nbsp;0x67dd4acc,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xf9b9df6f,&nbsp;0x8ebeeff9,&nbsp;0x17b7be43,&nbsp;0x60b08ed5,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xd6d6a3e8,&nbsp;0xa1d1937e,&nbsp;0x38d8c2c4,&nbsp;0x4fdff252,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xd1bb67f1,&nbsp;0xa6bc5767,&nbsp;0x3fb506dd,&nbsp;0x48b2364b,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xd80d2bda,&nbsp;0xaf0a1b4c,&nbsp;0x36034af6,&nbsp;0x41047a60,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xdf60efc3,&nbsp;0xa867df55,&nbsp;0x316e8eef,&nbsp;0x4669be79,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xcb61b38c,&nbsp;0xbc66831a,&nbsp;0x256fd2a0,&nbsp;0x5268e236,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xcc0c7795,&nbsp;0xbb0b4703,&nbsp;0x220216b9,&nbsp;0x5505262f,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xc5ba3bbe,&nbsp;0xb2bd0b28,&nbsp;0x2bb45a92,&nbsp;0x5cb36a04,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xc2d7ffa7,&nbsp;0xb5d0cf31,&nbsp;0x2cd99e8b,&nbsp;0x5bdeae1d,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x9b64c2b0,&nbsp;0xec63f226,&nbsp;0x756aa39c,&nbsp;0x026d930a,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x9c0906a9,&nbsp;0xeb0e363f,&nbsp;0x72076785,&nbsp;0x05005713,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x95bf4a82,&nbsp;0xe2b87a14,&nbsp;0x7bb12bae,&nbsp;0x0cb61b38,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x92d28e9b,&nbsp;0xe5d5be0d,&nbsp;0x7cdcefb7,&nbsp;0x0bdbdf21,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x86d3d2d4,&nbsp;0xf1d4e242,&nbsp;0x68ddb3f8,&nbsp;0x1fda836e,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x81be16cd,&nbsp;0xf6b9265b,&nbsp;0x6fb077e1,&nbsp;0x18b74777,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x88085ae6,&nbsp;0xff0f6a70,&nbsp;0x66063bca,&nbsp;0x11010b5c,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0x8f659eff,&nbsp;0xf862ae69,&nbsp;0x616bffd3,&nbsp;0x166ccf45,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xa00ae278,&nbsp;0xd70dd2ee,&nbsp;0x4e048354,&nbsp;0x3903b3c2,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xa7672661,&nbsp;0xd06016f7,&nbsp;0x4969474d,&nbsp;0x3e6e77db,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xaed16a4a,&nbsp;0xd9d65adc,&nbsp;0x40df0b66,&nbsp;0x37d83bf0,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xa9bcae53,&nbsp;0xdebb9ec5,&nbsp;0x47b2cf7f,&nbsp;0x30b5ffe9,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xbdbdf21c,&nbsp;0xcabac28a,&nbsp;0x53b39330,&nbsp;0x24b4a3a6,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xbad03605,&nbsp;0xcdd70693,&nbsp;0x54de5729,&nbsp;0x23d967bf,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xb3667a2e,&nbsp;0xc4614ab8,&nbsp;0x5d681b02,&nbsp;0x2a6f2b94,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;0xb40bbe37,&nbsp;0xc30c8ea1,&nbsp;0x5a05df1b,&nbsp;0x2d02ef8d,</span></p><p style="line-height: normal;"><span style="font-size: 14px;">};</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">uint32_t&nbsp;crc_compute(uint8_t&nbsp;*buffer,&nbsp;size_t&nbsp;size)</span></p><p style="line-height: normal;"><span style="font-size: 14px;">{</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;fcs&nbsp;=&nbsp;~0;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;*p&nbsp;=&nbsp;buffer;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(p&nbsp;!=&nbsp;&amp;buffer[size])</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CRC(fcs,&nbsp;*p++);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fcs;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">uint32_t&nbsp;crc_reverse(uint32_t&nbsp;current,&nbsp;uint32_t&nbsp;target)</span></p><p style="line-height: normal;"><span style="font-size: 14px;">{</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;size_t&nbsp;i&nbsp;=&nbsp;0,&nbsp;j;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;*ptr;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;workspace[2]&nbsp;=&nbsp;{&nbsp;current,&nbsp;target&nbsp;};</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;2;&nbsp;i++)</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;workspace[i]&nbsp;&amp;=&nbsp;(uint32_t)~0;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;ptr&nbsp;=&nbsp;(uint8_t&nbsp;*)(workspace&nbsp;+&nbsp;1);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;4;&nbsp;i++)&nbsp;{</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j&nbsp;=&nbsp;0;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while(crctab[j]&nbsp;&gt;&gt;&nbsp;24&nbsp;!=&nbsp;*(ptr&nbsp;+&nbsp;3&nbsp;-&nbsp;i))&nbsp;j++;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*((uint32_t&nbsp;*)(ptr&nbsp;-&nbsp;i))&nbsp;^=&nbsp;crctab[j];</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(ptr&nbsp;-&nbsp;i&nbsp;-&nbsp;1)&nbsp;^=&nbsp;j;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;*(uint32_t&nbsp;*)(ptr&nbsp;-&nbsp;4);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">int&nbsp;main()</span></p><p style="line-height: normal;"><span style="font-size: 14px;">{</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;fcs;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint32_t&nbsp;buffer[2]&nbsp;=&nbsp;{&nbsp;0xcafecafe&nbsp;};</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;uint8_t&nbsp;*ptr&nbsp;=&nbsp;(uint8_t&nbsp;*)buffer;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;fcs&nbsp;=&nbsp;crc_compute(ptr,&nbsp;4);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;printf("[+]&nbsp;current&nbsp;crc&nbsp;=&nbsp;%010p,&nbsp;required&nbsp;crc&nbsp;=&nbsp;\n",&nbsp;fcs);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;fcs&nbsp;=&nbsp;crc_reverse(fcs,&nbsp;0xdeadbeef);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;printf("[+]&nbsp;applying&nbsp;patch&nbsp;=&nbsp;%010p\n",&nbsp;fcs);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;buffer[1]&nbsp;=&nbsp;fcs;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;fcs&nbsp;=&nbsp;crc_compute(ptr,&nbsp;8);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(fcs&nbsp;==&nbsp;0xdeadbeef)</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("[+]&nbsp;crc&nbsp;patched&nbsp;successfully\n");</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p></blockquote><p><br></p><p><br></p><section class="" data-tools="135编辑器" data-id="89811" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section class="" data-tools="135编辑器" data-id="89025" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><section style="text-align: center;"><section data-bglessp="30%" data-bgless="lighten" style="display: inline-block; border-radius: 5px; line-height: 2; border-width: 1px; border-style: solid; border-color: rgb(26, 227, 0); padding: 0px 20px; font-size: 14.56px; color: rgb(4, 190, 2); background-color: rgb(224, 250, 204); box-sizing: border-box;"><p style="box-sizing: border-box; white-space: normal;"><span style="font-size: 16px;"><strong>4.4 漏洞利用</strong></span><br></p></section></section></section><section class="" data-tools="135编辑器" data-id="89808" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px; box-sizing: border-box;"><br></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">漏洞利用的代码（附录源代码压缩包中cve-2015-7504.c文件）重置网卡到默认设置，然后配置Tx和Rx并设置需要的参数，最后启动并重启网卡来让设置生效。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">剩下的就是用一个简单的包来触发漏洞。如下所示，qemu_set_irq被一个泄露的指向0x7f66deadbeef的irq变量调用。QEMU因在这个地址中没有可用的的处理程序而发生泄露。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8HeITaKZ4ia1yZqDFpI1U8icdbEiaxxIpicnMnrskrmh9NJ6rL7jL5EOk8P9EzBficS2KWbqgwTricL774A/0?wx_fmt=png" style="width: 427px !important; height: 132px !important;"></p><p><br></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 14px; color: rgb(136, 136, 136);">本文由 看雪翻译小组 Green奇 编译，来源 Mehdi Talbi和Paul Fariello@phrack</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">你可能对以下内容感兴趣：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank">看雪 CTF 2017 攻击篇 6月强势来袭！</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=3&amp;sn=edffb175ea03c6c9598ba8e1d2d694cd&amp;chksm=b1815cfd86f6d5eb33a788e8a9fa2e4e77f81ea74dfa4832beb439285bdcbf9e2f60c770b7be&amp;scene=21#wechat_redirect" target="_blank">CVE-2011- 0104 栈溢出漏洞在Excel 2003下利用分析</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283121&amp;idx=1&amp;sn=f695db785889733713d011ba913e0c28&amp;chksm=b1815cfb86f6d5ed4d7fff73df9d6d5e5c2f32d935164b918b11d478b46821e2667166ac17d6&amp;scene=21#wechat_redirect" target="_blank">聊聊游戏辅助那些事上部第一篇——过掉那些讨厌的游戏保护</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283005&amp;idx=2&amp;sn=2fc411b70549c789085e517ef6dfc3e9&amp;chksm=b1815b7786f6d261975cd000d4ddf2c4cffe3cf2d8ab06d870e7971e862c29c7278996bdfb6c&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283017&amp;idx=3&amp;sn=745024d678707b6dcf0cdc94ff5472a5&amp;chksm=b1815c8386f6d59538bfeeb8d3837007f07b0b4d3cd77b439f7856edd391127b6b2f36fb105d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283117&amp;idx=1&amp;sn=cb56cb1cb6e128609b5bcd84534f5caa&amp;chksm=b1815ce786f6d5f1a914e74b3080c4f1c2d4e186e62fdb252fbb99d791dd5af7038e95d48303&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;">【OSG】macOS 10.12.2本地提权和XNU port 堆风水</span></a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283114&amp;idx=3&amp;sn=fc763099faeb53bb8407bce865b403c1&amp;chksm=b1815ce086f6d5f60970b9c550518d07199c77e380cee90791c91a6ade3f5abd2b4c3f9588cd&amp;scene=21#wechat_redirect" target="_blank">CVE-2012-0158 两种 PoC 分析</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8E4ItLe4LX3YbLUffeV86icpcBApdQiakmEMuy4q8mVAaBjA0P1wez6NzO52zvKNlQQQ4siaztZDYhBg/640?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1496829841&src=3&ver=1&signature=IbkGB-IUv3NGRNGRf6IuJDEcuRy1*zESqpfOL5NuObERGQ*gbLaFfQ8X2IuMqNyfrhAtNGHPvT-wKPXl9IJKjOpnMQNm3fPORJ3kr42g9*dnW2AUZNxprIng84-7ehY9hnc7u4CQ9xiP*59kwbuGgNcFdoleXEHGt*7tzEL5le8=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217999.htm">阅读原文</a>
{% endraw  %}

