---
title: 【原创】WannaCry勒索软件中“永恒之蓝”漏洞利用分析
author: 展博
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1495451790&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZeeBDuFUhCzsMu*BB0SOQM33MAgARkNLSZo0jyCA7SaUudhiQ0fHPlvS7dX48MRKYXWpOBdPN9Ky4FUQ5FGTpkJcswUzN8DAHNkIJMzGhFJ31EgwyFPrwS1q*155BMvOpL*aMkYeN6ED6vpk1KtCjQVs=
date: '2017-05-19 00:00:00 +0000'

---

{% raw  %}
<p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">WannaCry 勒索软件中，利用了 NSA 泄露工具中的“永恒之蓝”漏洞，关于这个漏洞，之前已经有一些分析，在我看的文章中，http://blogs.360.cn/360safe/2017/04/17/nsa-eternalblue-smb/ 说得最详细，该文章中针对 win7 32 位的系统的漏洞触发过程进行了分析。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">但是在整个网络上，我没有看到关于 64 位系统的分析，因此我在该文章的基础上，对 win7 64 位的触发，以及触发后的 shellcode 的行为进行了分析整理成此文。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">其中若有疏漏，还请大家指教。最后感谢武汉科锐，感谢钱老师的悉心教学，钱老师严谨的治学作风和渊博的知识深深的影响着我，使我受益终身。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 18px;">搭建测试环境</span></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"></span><span style="font-size: 15px;"><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">因为样本的原有行为，是随机产生 IP 地址，并对目标进行发包。这非常不方便我们测试。因此，需要先在特定的位置断下，将IP地址改为我们的测试目标，并拍快照记录。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong><br></strong></span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;">具体步骤如下：<br></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">1.&nbsp;在 0x00407982 处下断，该处为拼接 IP 字符串，在此处将该字符串修改为自己的测试目标值。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/6146e9f00646140f2aa17def7adc39015d75eb76.png" style="width: 554px !important; height: 227px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">2.&nbsp;单步（如果不单步可能会因为多线程的原因造成测试不成功，因此推荐单步）至下方的线程创建函数，并在该线程回调处下断点。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/1f37551b722fda4cdf77ebc858abedb97ac65fa3.png" style="width: 554px !important; height: 225px !important;"><span style="font-size: 15px;"> <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">3.&nbsp;在上一步的线程回调函数中，有两处关键点，一处为该样本的第一波发包攻击，攻击结果为:在远程电脑上安装一个后门；第二处为第二波发包攻击，攻击结果为：利用第一波攻击安装的后门，在远程电脑上的系统进程中注入一个dll。他们的调用位置如下图所示：&nbsp; </span><img src="/ikanxue/images/ce4db6f2085d482c46acd9aee53e4ee21fc58fc8.png" style="width: 554px !important; height: 390px !important;"><span style="font-size: 15px;">&nbsp;</span></p><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 16px;"></span>漏洞的原理<br></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在 Srv.sys 中的 SrvOs2FeaListToNt 函数中，会有以下调用关系：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">SrvOs2FeaListToNt</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp;&nbsp;&nbsp;call SrvOs2FeaListSizeToNt</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp;&nbsp;&nbsp;call SrvOs2FeaToNt</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">其中在 SrvOs2FeaListSizeToNt 中因为有一个 DWORD* 转 WORD* 并赋值的 bug，造成在 SrvOs2FeaListToNt 的一个循环中，SrvOs2FeaToNt 被调用的次数会多于预期，而造成 SrvOs2FeaToNt 中的一个 memmove 拷贝越界。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/784b5638172d4540de81fd1bf5e8d6102e58193d.png" style="width: 554px !important; height: 254px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">可以看到，运行到下图时，对大小为 0x11000：&nbsp;&nbsp; &nbsp; <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/e66ccf465ffeff14fbd7ce744990872ab3431033.png" style="width: 554px !important; height: 306px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">通过 !pool 指令查看： <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/b562cbd8bc88035b2781a42cb28a7cb4aad2b092.png" style="width: 554px !important; height: 87px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">而实际运行时：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/cb8e0af6068b7820a1683e12872c7d06c1340499.png" style="width: 554px !important; height: 295px !important;"><span style="font-size: 15px;"> 不过，越界覆盖后，最终pool中的地址+0xa8处的数据，会作为一个指针被当作数据接受缓冲区，这是为什么，这其中的原理我没有完全搞明白，还请熟悉的朋友指教。&nbsp;&nbsp; </span><img src="/ikanxue/images/6d3bb968cd1167d4ca076d51ac4aec306478cd7f.png" style="width: 553px !important; height: 243px !important;"><span style="font-size: 15px;"> <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 18px;">定位第一轮发包的 shellcode 触发点</span></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">尝试定位 shellcode，要知道一个前提，这在其它报告中也已经提到，那就是</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">该样本的第一次发包，会安装一个后门，该后门的实现方式是在srv模块中，挂钩SrvTransaction2DispatchTable表中的一个表项，可以通过命令。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我之后就是利用这一点，来检验自己的测试机是否已经被触发漏洞，并一步步定位到触发点的(见下文分析)。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">kd&gt; dps srv!SrvTransaction2DispatchTable 查看：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">挂钩前：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e760 &nbsp;fffff880`03088780 srv!SrvSmbOpen2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e768 &nbsp;fffff880`0304fb20 srv!SrvSmbFindFirst2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e770 &nbsp;fffff880`03085f40 srv!SrvSmbFindNext2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e778 &nbsp;fffff880`03051650 srv!SrvSmbQueryFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e780 &nbsp;fffff880`0307ad20 srv!SrvSmbSetFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e788 &nbsp;fffff880`0304f670 srv!SrvSmbQueryPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e790 &nbsp;fffff880`03088cb0 srv!SrvSmbSetPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e798 &nbsp;fffff880`0304d420 srv!SrvSmbQueryFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7a0 &nbsp;fffff880`0304e080 srv!SrvSmbSetFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7a8 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7b0 &nbsp;fffff880`03088ae0 srv!SrvSmbIoctl2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7b8 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7c0 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7c8 &nbsp;fffff880`0307b4f0 srv!SrvSmbCreateDirectory2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7d0 &nbsp;fffff880`0306f460 srv!SrvTransactionNotImplemented</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7d8 &nbsp;fffff880`0306f460 srv!SrvTransactionNotImplemented</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;挂钩后：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e760 &nbsp;fffff880`03088780 srv!SrvSmbOpen2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e768 &nbsp;fffff880`0304fb20 srv!SrvSmbFindFirst2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e770 &nbsp;fffff880`03085f40 srv!SrvSmbFindNext2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e778 &nbsp;fffff880`03051650 srv!SrvSmbQueryFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e780 &nbsp;fffff880`0307ad20 srv!SrvSmbSetFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e788 &nbsp;fffff880`0304f670 srv!SrvSmbQueryPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e790 &nbsp;fffff880`03088cb0 srv!SrvSmbSetPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e798 &nbsp;fffff880`0304d420 srv!SrvSmbQueryFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7a0 &nbsp;fffff880`0304e080 srv!SrvSmbSetFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7a8 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7b0 &nbsp;fffff880`03088ae0 srv!SrvSmbIoctl2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7b8 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7c0 &nbsp;fffff880`0306f660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7c8 &nbsp;fffff880`0307b4f0 srv!SrvSmbCreateDirectory2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7d0 &nbsp;fffff880`053e2060</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`0301e7d8 &nbsp;fffff880`0306f460 srv!SrvTransactionNotImplemented</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">可以发现第 0xe 项会被 hook。这个表项的 hook 是由一段 shellcode 代码所完成的，具体如何定位到 shellcode 的入口，见以下分析。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">因为已知漏洞会在 srvnet!&nbsp;SrvNetWskReceiveComplete 中完成触发，只是不确认win 7 64位的 shellcode 写入点是否与前辈 win 7 32 位地址一样（通常不一样），因此一开始通过下断点并打印内存情况摸索规律：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; u</span></p><p style="line-height: normal;"><span style="font-size: 12px;">srvnet!SrvNetWskReceiveComplete+0x15:</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`02d3cdc5 488bca &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;rcx,rdx</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`02d3cdc8 498bf8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;rdi,r8</span></p><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; ba e1 srvnet!SrvNetWskReceiveComplete+0x15 "dq r8 r8+0x48;gc"</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">得到以下结果：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`049236b0 &nbsp;00000000`00000003 fffffa80`042fd800</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`049236c0 &nbsp;fffffa80`042fd800 000059b4`918947fc</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`049236d0 &nbsp;fffffa80`049237f0 00000000`00000810</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`049236e0 &nbsp;fffffa80`04923710 fffffa80`00000000</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`049236f0 &nbsp;00000000`00000438 fffffa80`0568d730</span></p><p style="line-height: normal;"><span style="font-size: 12px;">……</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`04a9b010 &nbsp;00000000`0000ffff 00000000`0000ffff</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`04a9b020 &nbsp;00000000`00000000 00000000`00000000</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`04a9b030 &nbsp;00000000`ffdff100 ffdff020`00000000</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`04a9b040 &nbsp;ffffffff`ffdff100 00000000`10040060</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffffa80`04a9b050 &nbsp;00000000`ffdfef80&nbsp;ffffffff`ffd00010</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">经过比对，发现以上标红内容特殊，是 x86 报告所记录的溢出时机断点。因此重启环境，下条件断点：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; ba e1 srvnet!SrvNetWskReceiveComplete+0x15 ".if(poi(@r8+0x48) ==&nbsp;0xffffffffffd00010){}.else{gc}"</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">结合以上所知的，SrvTransaction2DispatchTable 会被 shellcode 挂钩，因此在该表项处下断点：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; ba w8 srv!SrvTransaction2DispatchTable+0x8*0xe</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">经过验证，在以上第一个断点触发后，继续运行，会触发第二个断点：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/232694bda655e7830ba52c4e4d7245b2048f1702.png" style="width: 554px !important; height: 105px !important;"><span style="font-size: 15px;"> 但是，当步入 ffffffff`ffd00b77 后，栈已经被破坏，难以定位到该段 shellcode 的触发点。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在我所看到的其它的分析文章中，均没有提及具体是个位置转移到 shellcode 的，因此只有自己定位。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">考虑到 shellcode 一般均需要间接 call，因此，通过寻找 SrvNetWskReceiveComplete中的间接call，并下断点排查。最终，定位到 shellcode 触发点 srvnet!SrvNetCommonReceiveHandler+0xb7：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; u srvnet!SrvNetCommonReceiveHandler+0xb3</span></p><p style="line-height: normal;"><span style="font-size: 12px;">srvnet!SrvNetCommonReceiveHandler+0xb3:</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017e3 89742420 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;dword ptr [rsp+20h],esi</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017e7 41ff5208 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call &nbsp;&nbsp;&nbsp;qword ptr [r10+8]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017eb 8be8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;ebp,eax</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017ed 488b0d1cc90100 &nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;rcx,qword ptr [fffff880`0281e110]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017f4 493bcf &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmp &nbsp;&nbsp;&nbsp;&nbsp;rcx,r15</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017f7 740b &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srvnet!SrvNetCommonReceiveHandler+0xd4 (fffff880`02801804)</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017f9 0fba612c09 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dword ptr [rcx+2Ch],9</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`028017fe 0f82be840000 &nbsp;&nbsp;&nbsp;jb &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;srvnet! ?? ::FNODOBFM::`string'+0x1341 (fffff880`02809cc2)</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在该处下断点验证：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; bp srvnet!SrvNetCommonReceiveHandler+0xb7</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">确实可以截取到 shellcode 的进入入口：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/509431977bb42eaaf527fdc29e4abe545301cc32.png" style="color: rgb(0, 0, 0); font-family: Courier; font-size: 12px; width: 554px !important; height: 516px !important;"><span style="font-size: 15px;"> <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"><br></span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 18px;">第一轮 shellcode 的行为分析</span></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">为了测试方便，可以下以下条件断点，这样运行 win7 测试机器后，断下的地点就是 shellcode 的入口：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">ba e1 srvnet!SrvNetWskReceiveComplete+0x15 ".if(poi(@r8+0x48) ==&nbsp;0xffffffffffd00010){bp&nbsp;srvnet!SrvNetCommonReceiveHandler+0xb7;gc}.else{gc}"</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">进入shellcode后，该样本在进行奇怪的jne和call之后（我认为是防止静态分析以及弄乱栈），修改了第0C0000082h号MSR：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd00201 31c0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xor &nbsp;&nbsp;&nbsp;&nbsp;eax,eax</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd00203 4090 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xchg &nbsp;&nbsp;&nbsp;eax,eax</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd00205 7408 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;je &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ffffffff`ffd0020f</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd0020f e8a7000000 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;call &nbsp;&nbsp;&nbsp;ffffffff`ffd002bb</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002bb b9820000c0 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;ecx,0C0000082h</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002c0 0f32 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rdmsr</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002c2 48bbf80fd0ffffffffff mov rbx,0FFFFFFFFFFD00FF8h</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002cc 895304 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;dword ptr [rbx+4],edx</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002cf 8903 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;dword ptr [rbx],eax</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002d1 488d050a000000 &nbsp;lea &nbsp;&nbsp;&nbsp;&nbsp;rax,[ffffffff`ffd002e2]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002d8 4889c2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;rdx,rax</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002db 48c1ea20 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shr &nbsp;&nbsp;&nbsp;&nbsp;rdx,20h</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002df 0f30 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wrmsr</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd002e1 c3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</span></p><p style="line-height: normal;"><span style="font-size: 12px;">ffffffff`ffd00214 c3 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ret</span></p><p style="line-height: normal;"><span style="font-size: 12px;">srvnet!SrvNetCommonReceiveHandler+0xbb:</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`02cec7eb 8be8 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov &nbsp;&nbsp;&nbsp;&nbsp;ebp,eax</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这样，利用系统原有的系统调用，样本有机会时系统运行到其准备好的shellcode（ffffffff`ffd002e2）处，经实测，在该处下断点会系统崩溃，但是在其后1条指令处下断点，则不会崩溃：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; bp ffffffff`ffd002e5</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">此处开始的 shellcode，会寻找内存中的 PE 格式、定位PE文件头、定位服务表项的位置，最终将服务表项进行 hook，但是代码流程的细节需要亲自调试才能看清楚。在此我就不截图了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;</span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 18px;">病毒样本的第二轮发包攻击</span></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">先在后门处下断点：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; dps srv!SrvTransaction2DispatchTable</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302760 &nbsp;fffff880`0336c780 srv!SrvSmbOpen2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302768 &nbsp;fffff880`03333b20 srv!SrvSmbFindFirst2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302770 &nbsp;fffff880`03369f40 srv!SrvSmbFindNext2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302778 &nbsp;fffff880`03335650 srv!SrvSmbQueryFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302780 &nbsp;fffff880`0335ed20 srv!SrvSmbSetFsInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302788 &nbsp;fffff880`03333670 srv!SrvSmbQueryPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302790 &nbsp;fffff880`0336ccb0 srv!SrvSmbSetPathInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`03302798 &nbsp;fffff880`03331420 srv!SrvSmbQueryFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027a0 &nbsp;fffff880`03332080 srv!SrvSmbSetFileInformation</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027a8 &nbsp;fffff880`03353660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027b0 &nbsp;fffff880`0336cae0 srv!SrvSmbIoctl2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027b8 &nbsp;fffff880`03353660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027c0 &nbsp;fffff880`03353660 srv!SrvSmbFsctl</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027c8 &nbsp;fffff880`0335f4f0 srv!SrvSmbCreateDirectory2</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027d0 &nbsp;fffffa80`040a3060</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fffff880`033027d8 &nbsp;fffff880`03353460 srv!SrvTransactionNotImplemented</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 12px;">kd&gt; ba e1 fffffa80`040a3060</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp; 接着，触发第二轮攻击，等待断点触发。以下是行为分析。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;</span></p><section class="" data-tools="135编辑器" data-id="86516" style="border-width: 0px; border-style: none; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px;"><section style="border-bottom: 1px solid rgb(221, 221, 221); margin: 0px auto 10px;"><p class="" data-brushtype="text" style="padding: 0px 5px 6px; border-bottom: 2px solid rgb(239, 112, 96); display: inline-block; margin: 0px 0px -1px; font-weight: normal; line-height: 1.1; font-size: 18px;"><span style="font-size: 18px;">shellcode 的行为分析</span></p></section></section><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">第二轮发送的包，为 SMB2 协议的包，其 timeout 项，被作为控制 flag。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/0bdd817e805bd36784014883a8f29502c8afd5ea.png" style="width: 554px !important; height: 284px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">该域经过计算后，它只有三种值，分别对应了“检查”、“卸载”和“执行程序”，计算公式如下：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/4135fd4cdb45ff55501228a976e19e53744d8d6c.png" style="width: 554px !important; height: 92px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">域的解析判断部分如下：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/6a91c710d2142bc22c0ada1bb83ce9791e43a1a0.png" style="width: 554px !important; height: 65px !important;"><span style="font-size: 15px;"> 在经过 ping 包后，会执行 exec 包，执行的程序也包含在（拼接后并解码后的）SMB2 包中。其行为为：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">1.&nbsp;找 ntoskrnl 的基址：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/e6b25081e6fbdd3d4db544a32a7ef806222bfd7b.png" style="width: 553px !important; height: 314px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">2.&nbsp;通过 hash，找出关键的系统调用</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/a3d770188c70fdd9a31f97ab8778e158f6612282.png" style="width: 553px !important; height: 287px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">3.&nbsp;通过遍历 PID，获取 EPROCESS，在通过比对进程 EPROCESS 中进程名的HASH 值，获取指定的进程 PID</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/2a65951ae0554104f96bb6ecc9a0b211d110c626.png" style="width: 554px !important; height: 285px !important;"><span style="font-size: 15px;"> <br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/94154799d04e415a9fe7286682e9b9235e62648c.png" style="width: 553px !important; height: 279px !important;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="/ikanxue/images/88c6d491e02f1e18383763c333bd6a985271fe10.png" style="width: 554px !important; height: 286px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">最后，利用 apc 注入，将自带的 dll 注入到指定系统进程中，apc 注入看雪中已有相关文章。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/789ddccb20488e176ece947fbf9af10aa9d8b1fc.png" style="width: 553px !important; height: 284px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp; Apc 的回调函数地址是:</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/2bd421bce7b8f929145e10b433c2d68f3c3fcd55.png" style="width: 553px !important; height: 74px !important;"><span style="font-size: 15px;">也就是刚才拷贝的 apc 注入的 shellcode，用于内存加载 dll，并执行其唯一的导出函数 PlayGame，该 shellcode 及dll我均已经 dump 出，大家可以从附件下载：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><img src="/ikanxue/images/cc10f3aa583549890191056cfdae0d93c201e04b.png" style="width: 553px !important; height: 70px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">PlayGame 运行后，会释放并执行母体，溢出攻击到此结束,但是悲剧将在新的机器上循环上演。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(136, 136, 136);">本文由看雪论坛 展博 原创</span><span style="font-size: 15px;"><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">你可能对以下内容感兴趣：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282630&amp;idx=1&amp;sn=61fcbc708235dec5d7897a0d7c315756&amp;chksm=b1815a0c86f6d31a50ba1f9a39d876e28f2c71096100b28e961df185f7be94ec77b9199efd51&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">等你来挑战！| 看雪 CTF 2017 攻击篇</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282621&amp;idx=1&amp;sn=15f5bc0fa2b0b34ae241668b23a3939b&amp;chksm=b1815af786f6d3e1fd4bad2c336d725ec600551a6477bbc4c6af93167074ac83873aeba89938&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">【终于等到你！】看雪 CTF 2017</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=1&amp;sn=7ed476d577172ff4b4a93807dae2667c&amp;chksm=b1815a4586f6d35373f6c5d783fa99a7bb7cf2fc35da914761a9cf2d9943a09c1aefb9febfbf&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">春风十里，我在等你</span></a></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282923&amp;idx=1&amp;sn=be6293777eace8c4579dfa2688d014bf&amp;chksm=b1815b2186f6d237a72ae3dee7e29c4c2ec7a140b110daa7eb808723f58bf852e191eebcbdfc&amp;scene=21#wechat_redirect" target="_blank">蠕虫勒索软件WannaCrypt0r的行为分析</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282923&amp;idx=2&amp;sn=97b766ca3c3ed53d3135be937135e789&amp;chksm=b1815b2186f6d237e580205d6de5dae235d77732aa6eed5a4f124c042b59da07abcfe1c61081&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;">还能和wannacry的黑客讨价还价？</span></a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282903&amp;idx=1&amp;sn=ba8828786e9717016b399020a2427850&amp;chksm=b1815b1d86f6d20b9a60848ac2165b8ecacc8809f91851f2ffefc2bcd49f2007c07f42620f99&amp;scene=21#wechat_redirect" target="_blank">谁动了我的论文？我们来扒一扒勒索软件的前世今生</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="/ikanxue/images/a0942aca19665d63c4ee222be971a37cd63dc1e4.jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span><span style="font-size: 15px;"></span><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1495451790&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZeeBDuFUhCzsMu*BB0SOQM33MAgARkNLSZo0jyCA7SaUudhiQ0fHPlvS7dX48MRKYXWpOBdPN9Ky4FUQ5FGTpkJcswUzN8DAHNkIJMzGhFJ31EgwyFPrwS1q*155BMvOpL*aMkYeN6ED6vpk1KtCjQVs=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217734.htm">阅读原文</a>
{% endraw  %}

