---
title: 嵌入式设备硬件PCB级逆向
author: StrokMitream
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1502116456&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAqzwJV-51HguOx4pnyGlqXjJ10eFEeoZU*4ykBfJ5DfCcbB*9QgBsAKzwmoYzWJII43Bnp9RxZws*ZfIweVZpH21FBNlxDlsrM9seHQBuIdpNxUd3C8DbXBVbk3k*1xnupYLsMEaxIfPiLmdS*V0k40=
date: '2017-08-03 00:00:00 +0000'

---

{% raw  %}
<p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">本文介绍一些实用的PCB级硬件逆向的基础技术，可用于研究者和白帽团体分析未知的硬件。SEC Consult运营的硬件安全专用实验室是SEC Consult安全实验室的一部分。下面展示的研究只是硬件实验室众多研究中的冰山一角。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">今天，我们生活在一个被嵌入式设备统治的世界中。每个人都可能生活在各种各样的窥探、监控中。受安全漏洞影响的路由器、网络摄像头、智能手机和其他嵌入式设备，是极易被攻击的。最近爆发的Mirai病毒事件和其他LoT恶意软件更加说明了这一点。无论是出于好奇还是应顾客要求进一步提高产品的安全性，想要深度审计该类设备的固件，我们都需要拆卸下来，好找到调试接口。只有通过对系统进行调试和运行，才能揭示其中的隐秘之处。由于该过程具有一定的破坏性，故通常会对设备造成损坏。因此，要想进行深入的分析，仅准备一台设备是不够的！</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="margin-top: 10px; margin-bottom: 10px; text-align: center; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section class="" style="display: inline-block; vertical-align: middle; padding: 0px 6px; box-sizing: border-box;"><section class="" style="border-bottom: 2px solid rgb(53, 56, 55); transform: rotate(0deg); padding: 0px 10px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="box-sizing: border-box;"><span style="font-size: 16px; color: rgb(0, 0, 0);">如何从熟知的设备开始？</span></section></section><section style="margin-top: -7px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -6px; border-left: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -6px; border-right: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"></section></section><section style="margin-top: -9px; display: inline-block; vertical-align: top; width: 100%; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -4px; border-left: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -4px; border-right: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"><br><br></section></section></section></section></section></section><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">为了节省昂贵的嵌入式分析费用，一个简单快捷方法是替换固件。大型公司很容易在引进大批IoT设备之前委托安全咨询公司对该产品的内置固件进行测试，以此最大程度地降低系统的安全风险。不过，对用户和业余爱好者来说，选择并不多，他们能安装的固件多来源于第三方如</span><span style="font-size: 15px; color: rgb(63, 63, 63);">OpenWRT</span><span style="font-size: 15px; color: rgb(63, 63, 63);">。尽管这些固件的性能不见得一定比原生的（原生固件是针对该专有芯片指令集开发的）更加出色，但在安全性方面，确实如此。当我们在完成对已知设备的安全审计的任务时，硬件分析的部分通常简化为在网上的相关论坛（通常是</span><span style="font-size: 15px; color: rgb(63, 63, 63);">OpenWRT Wiki</span><span style="font-size: 15px; color: rgb(63, 63, 63);">）寻找相关资料。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="margin-top: 10px; margin-bottom: 10px; text-align: center; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section class="" style="display: inline-block; vertical-align: middle; padding: 0px 6px; box-sizing: border-box;"><section class="" style="border-bottom: 2px solid rgb(53, 56, 55); transform: rotate(0deg); padding: 0px 10px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="box-sizing: border-box;"><span style="color: rgb(0, 0, 0); font-size: 16px;">硬件黑客——识别无文档设备的调试接口</span></section></section><section style="margin-top: -7px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -6px; border-left: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -6px; border-right: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"></section></section><section style="margin-top: -9px; display: inline-block; vertical-align: top; width: 100%; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -4px; border-left: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -4px; border-right: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"><br><br></section></section></section></section></section></section><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">要对一个完全未知的普通设备刷写固件，简直就是一个难以完成的任务。故而，我们需要逐步剖析硬件电路，以便检查其所用的固件及检测固件的安全漏洞。不过，对硬件电路进行逆向工程并不是一件简单的事，尤其是专有芯片集电路，好在一些基本的分析技术还是适用的。在我们的例子中，Broadcom（博通公司）的SoC作为Belkin F9 K1106as（Belkin:贝尔金公司）无线中继器的核心部件。我们用该设备作为例子并不是我们对它别有兴趣，而是它的芯片集也用在众多社区支持的其他设备上。为了识别该SoC的引脚，我们将它接上专用电源。打开设备的外壳，便是PCB板了。我们第一个目的是串行连接到设备，以获得shell或至少访问到引导装载程序。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjCPQ1spoDpb4n1nYlibJI5bncVfNOBN0tzHFNrsTvRxUouTTTxzrSrNw/0?wx_fmt=jpeg" style="width: 640px !important; height: 577px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136);"><em><span style="font-size: 14px;">图：Belkin F9 K1106as PCB图及其不同模块</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">要识别金属防护罩保护的模块，最简单的办法是拆掉防护罩。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjgXROf8dPcszJlFTjCmCduNIfHDma3e299XBXdx0l2zgoyw4nVVzXGQ/0?wx_fmt=jpeg" style="width: 640px !important; height: 438px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136);"><em><span style="font-size: 14px;">图：用钳子打开静电防护罩</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">仅为了逆向分析出隐藏在PCB板上的调试引脚接口，我们不必将全部的防护罩拆除。借助暴露在PCB上的UART接口（译者注：通用异步收发器，详见</span><span style="font-size: 15px; color: rgb(63, 63, 63);">百度百科</span><span style="font-size: 15px; color: rgb(63, 63, 63);">）可以实现最初的调试，因为把UART直接接到以11520 Baud 8n1为终端的FT2322H板上，可以获取得root shell。相比于其他接口，很容易就可以辨认出UART，它只有两个针脚，接收端及发送端。进行串行通信并非总是UART，但这能帮助我们缩小可能性。一组3-5针的引脚通常是UART接口，这是开发PCB时预留的。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">UART通常的引脚排布为（GND|RX|TX|VCC）或（GND|TX|RX|VCC）。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">那JTAG（译者注：联合测试工作组，详见</span><span style="font-size: 15px; color: rgb(63, 63, 63);">百度百科</span><span style="font-size: 15px; color: rgb(63, 63, 63);">）在哪呢？该标准允许开发者或有经验的黑客轻易地控制CPU、在运行阶段调试SoC和对flash进行读取和编程以及运行自检测试。这个问题可以如此作答：用JTAG暴力工具。SEC Consult开发的工具（包括硬件和软件）附带有该功能，当然，网络上也有许多用于该目的的工具。由于有效的调试针脚为4-5针，PCB板上部的10个针脚看起来像是JTAG。</span></p><p><br></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"></span><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mj3NIN5ibjGdq4NnDnIftvPMI1y2SCYBSCXopAlRUibcAicLQAeib5XZlnuA/0?wx_fmt=jpeg" style="width: 640px !important; height: 480px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><em><span style="color: rgb(136, 136, 136); font-size: 14px;">图：暴力检测JTAG针脚</span></em></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mjh4o2kZA7cIiaETSNiaPHGCRCdJazPbxXeicfz1EjEWCFTMcibIRMZ5XUjQ/0?wx_fmt=jpeg" style="width: 640px !important; height: 480px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><em><span style="color: rgb(136, 136, 136); font-size: 14px;">图：SEC Consult安全实验室开发的硬件分析工具“SEC Xtractor”</span></em></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">经过暴力检测后，终于找出了针脚！为了保持完整性，也标记了UART接口。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjEAJqrAhhMk67vicejgjIicteE3DZCSTXTjBf9evr7aniaTvMjumibOphSw/0?wx_fmt=jpeg" style="width: 480px !important; height: 640px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：JTAG引脚</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">至于JTAG适配器，用的是廉价的迷你FT2322H模块。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjWDbDiaggJU8gibvpLayK2jrY0QrZyj4nfRsf93wx46AFzgwBIRIFYoNw/0?wx_fmt=jpeg" style="width: 640px !important; height: 350px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：通过迷你FT2232H模块连接到JTAG</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">连接到</span><span style="font-size: 15px; color: rgb(63, 63, 63);">OpenOCD</span><span style="font-size: 15px; color: rgb(63, 63, 63);">的请求给出了如下结果：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjXcZtycTuD3Nbv8icsdY9Tv5GDGEZZqN27lngzd4pdWFKjDtwSb9qqicA/0?wx_fmt=png" style="width: 640px !important; height: 142px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：OpenOCD输出</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">该芯片似乎有一个ID为0x2535717f的32位的指令寄存器。此前，我们所知的仅是该Broadcom SoC标签为BCM5358UB0KFBG。现在，我们有更多的了解了——不过是针对该具体的设备；JTAG接口可以用来控制芯片及对系统底层的访问。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="margin-top: 10px; margin-bottom: 10px; text-align: center; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section class="" style="display: inline-block; vertical-align: middle; padding: 0px 6px; box-sizing: border-box;"><section class="" style="border-bottom: 2px solid rgb(53, 56, 55); transform: rotate(0deg); padding: 0px 10px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="box-sizing: border-box;">硬件黑客——抓取固件<br></section></section><section style="margin-top: -7px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -6px; border-left: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -6px; border-right: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"></section></section><section style="margin-top: -9px; display: inline-block; vertical-align: top; width: 100%; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -4px; border-left: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -4px; border-right: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"><br><br></section></section></section></section></section></section><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">提取固件，是完善该SoC信息池的最后一步。一个Macronix的串行flash芯片安装在PCB背面。花几分钟用</span><span style="font-size: 15px; color: rgb(63, 63, 63);">flashrom</span><span style="font-size: 15px; color: rgb(63, 63, 63);">和FT2322H即可读取出其中的内容。从</span><span style="font-size: 15px; color: rgb(63, 63, 63);">datasheet</span><span style="font-size: 15px; color: rgb(63, 63, 63);">上可以快速找出其引脚定义：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mj4W70NycCVRZhBicCj4ypE6dy2pgOoxUaI3PTLqcunxr3IZzDCtZrUpQ/0?wx_fmt=jpeg" style="width: 640px !important; height: 480px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：Macronix SPI flash芯片引脚</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">将flash芯片从PCB板上取下后，置于转接器上并启动flashrom：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mjc01umQKQ6eVSSTQ0ibN6KqmVolHgPCudxUCHviaUa9ia5kWdlGLURXJ3w/0?wx_fmt=png" style="width: 640px !important; height: 146px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：用flashrom读取SPI存储器</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">转储文件包括整个程序存储器和暂存数据（NVRAM）。用flashrom重写固件并芯片焊接回去是刷第三方固件的另一种方法。通过调用“binwalk-Adump.bin”，得到许多的“MIPSEL”（MIPS little endian）指令，这让我们不禁假设：该Broadcom SoC 是基于通用MIPSEL32 CPU的。SOP封装的串行flash芯片是最容易读取的flash，更具挑战性的NAND和NOR flash芯片，由于其复杂的接口、狭小的封装和数目众多的引脚，操作起来甚是困难。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">通过</span><span style="font-size: 15px; color: rgb(63, 63, 63);">IoT Inspector</span><span style="font-size: 15px; color: rgb(63, 63, 63);">对转储文件进行初步分析显示，该固件存在一些基本的安全风险，同时也获取到该设备使用的软件信息。由于我们分析的是老旧设备，一些安全漏洞可以追溯到2007年：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjCal1tPg3SDjAibGEYCGnl3y5HMyetMNwWhhYmoiceON5reib6P4ib3YgDQ/0?wx_fmt=png" style="width: 640px !important; height: 528px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：IoT Inspector报告摘录</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="margin-top: 10px; margin-bottom: 10px; text-align: center; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section class="" style="display: inline-block; vertical-align: middle; padding: 0px 6px; box-sizing: border-box;"><section class="" style="border-bottom: 2px solid rgb(53, 56, 55); transform: rotate(0deg); padding: 0px 10px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="box-sizing: border-box;">硬件黑客——逆向SoC引脚<br></section></section><section style="margin-top: -7px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -6px; border-left: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -6px; border-right: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"></section></section><section style="margin-top: -9px; display: inline-block; vertical-align: top; width: 100%; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -4px; border-left: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -4px; border-right: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"><br><br></section></section></section></section></section></section><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">正如先前所述，如果得到了SoC的引脚定义，那么我们将可以对任何使用BCM5358UB0KFBG的设备进行逆向。为此，大多数情况下我们可以用热风枪将BGA封装的芯片拆焊下来。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mjn4XtiaA8dibaSmmpgf3MVsbxpgmsHrk30UaSkOY1ngVO8Hiabtq1NR3Kg/0?wx_fmt=jpeg" style="width: 640px !important; height: 480px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：热风枪返修台</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjCtxOSuBb8kWMRK6BYGSRGNicP6tVquAdIJA4phAGVpgNPBRJyLM1lgQ/0?wx_fmt=jpeg" style="width: 585px !important; height: 640px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：拆下SoC后的Belkin PCB</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">根据SoC的引脚连接情况，结合datasheet的相关资料以及针脚对地/电源（GND/VCC）电压的测定和逻辑推断，我们得出该芯片部分重要引脚的功能定义。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mja334pXAVUByicqCd0P3QdEx2e8cL84IsOVk1HHic3TicuVIQvAAt1eZfg/0?wx_fmt=png" style="width: 636px !important; height: 640px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：BCM5358U0KFBG芯片部分引脚功能定义</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">显然，BCM535x系列芯片有着相似的引脚定义。</span><span style="font-size: 15px; color: rgb(63, 63, 63);">https://wikidevi.com</span><span style="font-size: 15px; color: rgb(63, 63, 63);">网站收集有计算机硬件的相关信息，当然也包括Broadcom SoC系列。我们找到了下面的条目：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mj1A5bm52fec1PTbSPpgNFPN7ia5NJKJcyuOhHNRNb5w41W40a5zp1U3w/0?wx_fmt=png" style="width: 640px !important; height: 61px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：来源: https://wikidevi.com</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">观察包含该类芯片的其他路由器的图片可以发现，芯片的引脚功能都是大同小异。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">Wikidei网站包含众多硬件的相关信息，除此之外，制造商提供的相关文档也非常详尽。中国似乎是唯一一个各个品牌路由器的生产国。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="margin-top: 10px; margin-bottom: 10px; text-align: center; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section class="" style="display: inline-block; vertical-align: middle; padding: 0px 6px; box-sizing: border-box;"><section class="" style="border-bottom: 2px solid rgb(53, 56, 55); transform: rotate(0deg); padding: 0px 10px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="box-sizing: border-box;">硬件黑客——来自中国的供应链<br></section></section><section style="margin-top: -7px; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -6px; border-left: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -6px; border-right: 10px solid rgb(53, 56, 55); border-top: 6px solid rgb(255, 255, 255); border-bottom: 6px solid rgb(255, 255, 255); box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"></section></section><section style="margin-top: -9px; display: inline-block; vertical-align: top; width: 100%; box-sizing: border-box; background-color: rgba(1, 0, 0, 0);"><section style="float: left; width: 0px; margin-left: -4px; border-left: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="float: right; width: 0px; margin-right: -4px; border-right: 3px solid rgb(255, 255, 255); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"></section><section style="clear: both; box-sizing: border-box;"><br><br></section></section></section></section></section></section><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">所有这些中国制造的电子产品，芯片、外围设备、路由器等，经常是由同一家工厂组装完成的。结果很明显，这些产品的质量都在一个等级，一些工厂也为相互竞争的市场供应商生产产品。我们来看看两张华硕RT-N53路由器和Belkin F9 K1106无线中继器的内部图片。这PCB板上的标识简直就是一摸一样，是不是？</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0MjWd6kkjoMBYqj8IOc44man2blIXE1KEOX271t8fhM1TJrE5QhxqqoVg/0?wx_fmt=png" style="width: 640px !important; height: 342px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：华硕PCB，来源：https://apps.fcc.gov/</span></em></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GRy4lzB9EaoiaYBhIrqh0Mj7ATtzkrwpZRlNpNO5kxH7MZQR9DkibMrES9tYu4mgr3NFD7r3plywmw/0?wx_fmt=jpeg" style="width: 640px !important; height: 391px !important;"></p><p style="margin: 0em 1em; text-align: center; letter-spacing: 2px; line-height: 1.75em;"><span style="color: rgb(136, 136, 136); font-size: 14px;"><em><span style="color: rgb(136, 136, 136);">图：Belkin PCB </span></em></span><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">巧合吗？并不像啊。这些标识的字体是ELCAD（电脑辅助电子设计）软件默认设置的，如果不是强制要求，开发者是不会去改动的。这意味着相同的模板重用于华硕PCB的开发，甚至更多其他供应商。因此，同一家ODM（原设计制造商）负责设计制造包括Belkin在内各品牌的产品。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">在嵌入式设备生产中，这并不是什么不常见的生产形式，尤其是对于来自US的公司。其中的固件多半也是亚洲供应商基于标准的亦或是定制的SDK开发的。</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">愈演愈烈的后门事件大都是逻辑上的缺陷——正如我们之前看到过的：</span></p><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);"><br></span></p><ul style="list-style-type: square;" class="list-paddingleft-2"><li><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 12px;"><em><span style="color: rgb(63, 63, 63);">http://blog.sec-consult.com/2017/06/ghosts-from-past-authentication-bypass.html</span></em></span></p></li><li><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 12px;"><em><span style="color: rgb(63, 63, 63); font-size: 14px;">http://blog.sec-consult.com/2016/12/backdoor-in-sony-ipela-engine-ip-cameras.html</span></em></span></p></li><li><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 12px;"><em><span style="color: rgb(63, 63, 63); font-size: 14px;">http://blog.trendmicro.com/trendlabs-security-intelligence/netis-routers-leave-wide-open-backdoor/</span></em></span></p></li><li><p style="margin: 0em 1em; text-align: justify; letter-spacing: 2px; line-height: 1.75em;"><span style="font-size: 12px;"><em><span style="color: rgb(63, 63, 63); font-size: 14px;">http://www.devttys0.com/2013/10/from-china-with-love/</span></em></span></p></li></ul><p><br></p><section label="Copyright © 2014 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 5px 0px 0px; padding: 10px 0px; background: rgba(0, 0, 0, 0) none repeat scroll 0% 0%;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8G9B6YFlthnv1h3cWDDXGAmK9wQfy6pod114tTuOSIFVeVd0vd1PEwicksgBGmxL0iaC0icX7B9EQzNg/640?wx_fmt=png" style="margin: 0px auto; display: block; visibility: visible !important; width: 160px !important; height: 8.44575px !important;"></section><p><br></p><p class=""><br></p><p style="letter-spacing: 1px; margin: 15px 1em; text-align: center; line-height: 1.75em;"><span style="font-size: 15px; color: rgb(63, 63, 63);">本文由看雪翻译小组 StrokMitream 编译，来源SecConsult@Thomas Weber，转载请注明来自看雪社区</span></p><p style="text-align: center;"><br></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8HFWP586ic3Pf4F6hD1rnmHpScQgCs4x9dJWoHHNnoiamW5RMTq8alBq5UiahM3G1W9TK3RPXQHXWZUQ/640?wx_fmt=jpeg" style="visibility: visible !important; width: 770px !important; height: 381.992px !important;"></p><p style="text-align: center;"><br></p><p style="letter-spacing: 1px; margin: 15px 1em; text-align: left; line-height: 1.75em;"><span style="font-size: 16px; color: rgb(63, 63, 63);">热门阅读</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><p style="letter-spacing: 1px; margin: 15px 1em; text-align: left; line-height: 1.75em;"><span style="font-size: 15px; text-decoration: none; color: rgb(63, 63, 63);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458284266&amp;idx=1&amp;sn=4e3714835ada031a3ae3c86e44753194&amp;chksm=b181406086f6c97636d7e05ef95256655b529267c0e9702d6e6f8848c2357ad5626d079a9ad1&amp;scene=21#wechat_redirect" target="_blank">使用x64dbg+VS2015 Spy++去除广告弹框</a><br></span></p></li><li><p style="letter-spacing: 1px; margin: 15px 1em; text-align: left; line-height: 1.75em;"><span style="font-size: 15px; text-decoration: none; color: rgb(63, 63, 63);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458284236&amp;idx=1&amp;sn=2b9e3b3cc4de69e91d5572a8961f572b&amp;chksm=b181404686f6c95030550e3e20f16a3923c719671b14d00391cc8879b944f9840bfac6c8139d&amp;scene=21#wechat_redirect" target="_blank">从 Android 源码看 SO 的加载</a></span></p></li><li><p style="letter-spacing: 1px; margin: 15px 1em; text-align: left; line-height: 1.75em;"><span style="font-size: 15px; text-decoration: none; color: rgb(63, 63, 63);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458284229&amp;idx=2&amp;sn=61720f3a096b2e759adbdea8a96a189a&amp;chksm=b181404f86f6c959c89c32d3cc35be7546e0619e6f5ee61aec9dd1472daec95fb997d5c5e332&amp;scene=21#wechat_redirect" target="_blank">一个lpk.dll病毒的分析报告</a></span></p></li><li><p style="letter-spacing: 1px; margin: 15px 1em; text-align: left; line-height: 1.75em;"><span style="font-size: 15px; text-decoration: none; color: rgb(63, 63, 63);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458284255&amp;idx=1&amp;sn=a07808a74f61d543163a309214775b46&amp;chksm=b181405586f6c9438606b0c36e56e0c41b5b089e587b9dd991f59fffe72558259a752ddf981d&amp;scene=21#wechat_redirect" target="_blank">虚拟机保护技术浅谈</a><br></span></p></li></ul><p style="text-align: center;"><br></p><p style="text-align: center;"><br></p><p style="text-align: center;"><span style="font-size: 15px; background-color: rgb(178, 178, 178); color: rgb(63, 63, 63);">点击阅读原文/read，还有更多干货等着你~</span></p><p><br></p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1502116456&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAqzwJV-51HguOx4pnyGlqXjJ10eFEeoZU*4ykBfJ5DfCcbB*9QgBsAKzwmoYzWJII43Bnp9RxZws*ZfIweVZpH21FBNlxDlsrM9seHQBuIdpNxUd3C8DbXBVbk3k*1xnupYLsMEaxIfPiLmdS*V0k40=">微信地址</a> | <a href="http://bbs.pediy.com/thread-220031.htm">阅读原文</a>
{% endraw  %}

