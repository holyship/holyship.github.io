---
title: 记一次安卓系统源码编译刷机过程
author: 倔强石头
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1498051979&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQyx1hdTxM6K*VNtcxOeUN354nW26WI5lTIy9FI3*gxCaEHwjjiMY16zPEkDRPZ*5EAfFMZ61tFx5fctC8Cr-NbcbuX3nhBF5oItQLYTrrMxIQhQsN8rGAybNKXakR-Gu4BnViA7oH1QOJBkwOSq-aY0=
date: '2017-06-17 00:00:00 +0000'

---

{% raw  %}
<p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在记一次安卓系统源码下载过程&nbsp;一文中，我们配置好了编译环境以及下载好了系统源码，下面我们我们来实战系统源码的编译。Google官方教程https://source.android.com/source/building</span></p><h1 style="line-height: 1.75em; margin-top: 20px; margin-bottom: 20px;"><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 18px;"><strong>一、下载专有的二进制文件</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">目前网络上的中文教程以及出版的书籍大部分都是直接编译AOSP源码用模拟器加载启动镜像。但是要想让用AOSP源码编译出的系统镜像在特定的设备中运行，仅仅编译AOSP分支的源代码是不够的，必须下载相应的与硬件相关的其他专有库。</span></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><strong><span style="font-size: 15px;">下载专用的二进制源码</span></strong></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">由于我使用的是NEXUS 5 设备，并且打算编译Android 4.4.4_r1版本，所以去官方 Nexus 和 Pixel 设备的二进制驱动下载页面：https://developers.google.com/android/drivers&nbsp;下载了相应的二进制驱动。&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrrnq8flWSIKN8zgQFV4CuEn1MqG45ToBtIUTzLsCKBFN5j3f8XNQcvA/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 327.183px !important; visibility: visible !important;"><span style="font-size: 15px;">&nbsp;三个链接下载的三个驱动文件&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocr5D81BKPZ4XVF42uAdC7Y5ia9GKabBlod9NArYKmanFZhrhreEmhibInQ/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 696px !important; height: 123px !important;"></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">解压专有二进制文件</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">将三个压缩包解压出的自解压脚本放在源码树的根目录下并运行&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrmb0BAGwjduXuFYaiaTPQATCCcE8wgqX3EzAPwhhqicGhhVHIEj2OHwfg/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 189.173px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">运行后，会提示你查看证书，按Enter键一行行的查看，出现下面的输入提示时，输入&nbsp;I ACCEPT，解压到了vendor&nbsp;目录下。其它两个自解压脚本也是这样执行&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrH8z3kbehYs8r6VQ940IHaKfmozdPvjUnRcxTc0dl3U7tLLEJFeWJwg/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 763px !important; height: 338px !important;"><span style="font-size: 15px;">解压后的目录：&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrmd4SubkicmyunqxibCkVQAia1saErRK7Icq9QyA1PvJAXntKssDFpWkDQ/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 723px !important; height: 133px !important;"><span style="font-size: 15px;">&nbsp;这三个.sh自解压文件执行下来按Enter按的痛苦么？很痛苦！！！于是我看了看这三个文件的结构:</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">echoecho The license for this software will now be displayed.echo You must agree to this license before using this software.echoecho -n Press Enter to view the license</span></p><p style="line-height: normal;"><span style="font-size: 12px;">read dummyechomore &lt;&lt; __EOF__</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; ......</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; 证书信息</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; ......</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; __EOF__if test $? != 0then &nbsp;echo ERROR: Couldn\'t display license file 1&gt;&amp;2 &nbsp;exit 1fiechoecho -n Type \"I ACCEPT\" if you agree to the terms of the license:\&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 12px;">read typed</span></p><p><br></p><p style="line-height: normal;"><span style="font-size: 12px;">第254行 if test "$typed" != I\ ACCEPT</span></p><p style="line-height: normal;"><span style="font-size: 12px;">then &nbsp;echo &nbsp;echo You didn\'t accept the license. Extraction aborted. &nbsp;exit 2fiechotail -n +276 $0 | tar zxvif test $? != 0then &nbsp;echo &nbsp;echo ERROR: Couldn\'t extract files. 1&gt;&amp;2 &nbsp;exit 3else &nbsp;echo &nbsp;echo Files extracted successfully.</span></p><p style="line-height: normal;"><span style="font-size: 12px;">fiexit 0第276行xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></p><p style="line-height: normal;"><span style="font-size: 12px;">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span></p></blockquote><p><span style="font-size: 15px;"><br></span></p><p><span style="font-size: 15px;">把第254行改为'if test "$typed" = I\ ACCEPT'就可以一路Enter到底至解压了。感兴趣的可以踩踩这个坑儿，成功后告诉我~</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><strong><span style="font-size: 15px;">清理</span></strong></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">命令删除所有以前编译操作的已有输出：</span></p><blockquote><pre><p><span style="font-size: 12px;">$&nbsp;make&nbsp;clobber</span></p></pre></blockquote><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrL0UXA57DoEyEicqdczmyCLw7kMGDSRfXL1MkmiaSlu9M5L4zHGl8kMmA/0?wx_fmt=png" style="width: 668px !important; height: 392px !important;"></p><h1 style="line-height: 1.75em; margin-top: 20px; margin-bottom: 20px;"><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 18px;"><strong>二、设置环境</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">使用&nbsp;build目录中的envsetup.sh&nbsp;脚本初始化环境</span></p><blockquote><pre><p><span style="font-size: 12px;">$&nbsp;source&nbsp;build/envsetup.sh</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">或</span></p><blockquote><pre><p><span style="font-size: 12px;">$&nbsp;.&nbsp;build/envsetup.sh</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrdCGJU3d5z26eR70nRnPV0ibEuaibbQPq8VIqs7vOOe3NJVSvS9ITSyww/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 699px !important; height: 239px !important;"></p><h1 style="line-height: 1.75em; margin-top: 20px; margin-bottom: 20px;"><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 18px;"><strong>三、选择目标</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">使用lunch选择要编译的目标。确切的配置可作为参数进行传递。例如以下命令（只是举例，不用执行）：</span></p><blockquote><pre><p><span style="font-size: 12px;">$&nbsp;lunch&nbsp;aosp_arm-eng//该命令表示针对模拟器进行完整编译，并且所有调试功能均处于启用状态。</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">不设置参数直接运行lanch的话，会提示从菜单中选择一个目标&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrGaoFkPx0BHUPDlUA06vIozKpORXMfHaoebU1Oezsr1t2eeuxXjkTibw/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 553px !important; height: 381px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">所有编译目标都采用&nbsp;BUILD-BUILDTYPE形式，其中&nbsp;BUILD&nbsp;是表示特定功能组合的代号。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">BUILDTYPE&nbsp;是以下类型之一：&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocr5JZn2sEFiaIIbKVBeJpeEcudJa2QkotzScLx2ghswtJ491t1GZQOohw/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 150.943px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">三者具体差异Google也在官方文档中给出了说明：https://source.android.com/source/building&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocriaZCdBE47xyGsw9CevW7R1y5WJia0UET0ia8Y3dPFtUiawPZl4wwDQPbjg/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 479.286px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">模拟器一般选eng,调试功能全开。&nbsp;<br style="box-sizing: inherit;">调试真机的话选userdebug&nbsp;。&nbsp;<br style="box-sizing: inherit;">发行最终版本用user&nbsp;。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">官方给出了一份自己出厂设备的代号和编译配置选项&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocr6f4FR1mJaMjmNbN9Tz7YEqgJYEkgGD3ictTrVq9XXEHgUA3iclhsM7Ow/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 773.812px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们用的设备是NEXUS 5 ，所以lanch&nbsp;&nbsp;编译配置为aosp_hammerhead-userdebug&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocricN7u94bxvsmfXstNJ64VUEWDKdpetwrUaq2Cy2fUYrmZibdUjLjpz6g/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 682px !important; height: 390px !important;"></p><h1 style="line-height: 1.75em; margin-top: 20px; margin-bottom: 20px;"><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 18px;"><strong>四、编译代码</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们使用make命令来编译代码,为了提高编译速度，GNU Make 可以借助 -jN 参数处理并行任务，通常使用的任务数 N 介于编译时所用计算机上硬件线程数的 1-2 倍之间。&nbsp;<br style="box-sizing: inherit;">我们来查看自己计算机上的核心数：</span></p><blockquote><pre><p><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~$&nbsp;cat&nbsp;/proc/cpuinfo&nbsp;|&nbsp;grep&nbsp;processor</span></p></pre></blockquote><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrUgcO86wtwwb1SFbXrXib40xMJO1wr4ib9cv8yU1bSwU0ZPhy9B1DXiatw/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 660px !important; height: 116px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">可看到自己创建的虚拟机CPU核心共有 4 个，那么要实现最快的编译速度，可以使用介于&nbsp;make -j4&nbsp;到&nbsp;make -j8之间的命令。&nbsp;<br style="box-sizing: inherit;">运行下面的命令进行编译：</span></p><blockquote><p><span style="font-size: 12px;">make&nbsp;-j8</span></p></blockquote><p><span style="font-size: 15px;"><br></span></p><p><span style="font-size: 15px;"> 在虚拟机中编译了4小时左右，编译结束。&nbsp;</span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">编译后输出的文件都放在了源码根目录下的out文件中，编译后生成的文件：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrsVQ75txEP6oFFO9FJhyicO8YlwqHG3O16ufLLLHvRCicNM3mdpzKjFLA/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 305.064px !important;"></p><h1 style="line-height: 1.75em; margin-top: 20px; margin-bottom: 20px;"><span style="color: rgb(255, 255, 255); background-color: rgb(0, 0, 0); font-size: 18px;"><strong>五、刷入目标设备</strong></span></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">那么我们刷机刷入哪些生成的文件呢？</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">事实上，我之前已经下载了Nexus 5官方镜像包进行了刷机，可参考我写的这篇文章：NEXUS 5 工厂镜像刷机教程及刷机包目录解析&nbsp;，万一自己编译的系统刷机失败，可刷官方镜像包来救急。&nbsp;<br style="box-sizing: inherit;">下面是官方刷机包的目录：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrFMgZNLPnfSeyd5iaxFVFrxrdwmrpzHbo2iamkqe8yZxHIuSHUmTkLaicQ/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 382.148px !important;"><br style="box-sizing: inherit;"><span style="font-size: 15px;">对比我们编译生成的文件，我们知道编译的可刷机的文件有boot.img、system.img、recovery.img、cache.img、userdata.img五个镜像文件。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">当我们编译前执行source build/envsetup.sh&nbsp;、lanch aosp_hammerhead-userdebug&nbsp;两条命令时，脚本已经为我们自动设置好了环境变量和编译选项，其中·lanch命令为我们设置好了ANDROID_PRODUCT_OUT变量的值。adb、fastboot工具 &nbsp;的路径也被设置好了。</span></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">1. 检查输出目录变量的值</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们在刷机前输出ANDROID_PRODUCT_OUT变量的值，确保它的值和编译后镜像输出目录的路径值一致。如果不一致的话，重新设置ANDROID_PRODUCT_OUT的值与编译后镜像输出目录路径值一致。&nbsp;<br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocroibLby6D3mXU9L0J49kON3YGTvGND7XRic1iba1ybuicGIdkkvGSrBkuFw/0?wx_fmt=png" style="width: 718px !important; height: 52px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">2. 用USB数据线连接手机</span><br><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">用USB数据线连接手机连接手机与虚拟机，无法识别的话需要设置USB选项，具体参考上一篇USB环境变量配置.&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrIU8pM24iarjDGOtgNBXoVJia9OtfahrelGJ0rHNAQALSeJrqFrur3zqQ/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 723px !important; height: 93px !important;"></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">3. 以 fastboot 模式启动手机，进行设备解锁</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">默认情况下，Nexus 5是上锁无法刷入镜像的，需要我们解锁，解锁会擦除手机数据的，最好先备份用户数据。在开机的情况下，输入命令进入bootloader&nbsp;模式</span></p><blockquote><pre><p><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~/Android444_r$&nbsp;adb&nbsp;reboot&nbsp;bootloader</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocr7L5X0S4TPd4cwgqoxR2rc3N03pjBlhze4YsFfBg5shCm1Ngsj8TFzA/0?wx_fmt=jpeg" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 230px !important; height: 408px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">输入下面的命令进行解锁：</span></p><blockquote><pre><p><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~/Android444_r1$&nbsp;fastboot&nbsp;oem&nbsp;unlock</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocr2icicMuEAicTsoibpw080OwyvcicQDtibxHib9ErSyzo5kWYFH8ichYR2P71IA/0?wx_fmt=jpeg" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 230px !important; height: 408px !important;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;">按上下音量键选择YES选项，再按电源键确认就解锁成功了&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrXBMKgrJJm9IJXFbCl1vmppGZdqiaKBTlRyEnINK52fQZeuzCq4YPxtw/0?wx_fmt=jpeg" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 230px !important; height: 408px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;<br style="box-sizing: inherit;"></span><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrCcbRoHMicZt3ZXV6XIoynbAU6BKlIuYFgMCUb6tXnPSMBxb9dhibublg/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 688px !important; height: 111px !important;"></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">4.刷入镜像</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">输入下面的命令进行刷机</span></p><blockquote><pre><p><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~/Android444_r1$&nbsp;fastboot&nbsp;-w&nbsp;flashall</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这时，会刷入boot.img、system.img、recovery.img、cache.img、userdata.img五个镜像文件</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><blockquote><p style="line-height: normal;"><span style="font-size: 12px;">--------------------------------------------</span></p><p style="line-height: normal;"><span style="font-size: 12px;">Bootloader Version...: HHZ11k</span></p><p style="line-height: normal;"><span style="font-size: 12px;">Baseband Version.....: M8974A-2.0.50.1.16Serial Number........: 03a784052519107e</span></p><p style="line-height: normal;"><span style="font-size: 12px;">--------------------------------------------</span></p><p style="line-height: normal;"><span style="font-size: 12px;">checking product...</span></p><p style="line-height: normal;"><span style="font-size: 12px;">OKAY [ &nbsp;0.100s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">sending 'boot' (8700 KB)...OKAY [ &nbsp;1.127s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">writing 'boot'...OKAY [ &nbsp;0.739s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">sending 'recovery' (9284 KB)...OKAY [ &nbsp;1.296s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">writing 'recovery'...OKAY [ &nbsp;0.772s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">erasing 'system'...OKAY [ &nbsp;1.012s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">sending 'system' (291004 KB)...OKAY [ 31.360s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">writing 'system'...OKAY [ 21.154s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">erasing 'userdata'...OKAY [ 13.403s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">formatting 'userdata' partition...</span></p><p style="line-height: normal;"><span style="font-size: 12px;">Creating filesystem with parameters:</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Size: 29236371456</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Block size: 4096</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Blocks per group: 32768</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Inodes per group: 8192</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Inode size: 256</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Journal blocks: 32768</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Label:&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Blocks: 7137786</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Block groups: 218</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Reserved block group size: 1024Created filesystem with 11/1785856 inodes and 156120/7137786 blocks</span></p><p style="line-height: normal;"><span style="font-size: 12px;">sending 'userdata' (139109 KB)...writing 'userdata'...OKAY [ 38.506s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">erasing 'cache'...OKAY [ &nbsp;0.550s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">formatting 'cache' partition...</span></p><p style="line-height: normal;"><span style="font-size: 12px;">Creating filesystem with parameters:</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Size: 734003200</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Block size: 4096</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Blocks per group: 32768</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Inodes per group: 7472</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Inode size: 256</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Journal blocks: 2800</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Label:&nbsp;</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Blocks: 179200</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Block groups: 6</span></p><p style="line-height: normal;"><span style="font-size: 12px;">&nbsp; &nbsp; Reserved block group size: 47Created filesystem with 11/44832 inodes and 5813/179200 blocks</span></p><p style="line-height: normal;"><span style="font-size: 12px;">sending 'cache' (13348 KB)...writing 'cache'...OKAY [ &nbsp;3.243s]</span></p><p style="line-height: normal;"><span style="font-size: 12px;">rebooting...</span></p><p><br></p><p style="line-height: normal;"><span style="font-size: 12px;">finished. total time: 113.788s</span></p><p style="line-height: normal;"><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~/Android444_r1$</span></p></blockquote><p><span style="font-size: 15px;"><br></span></p><p><span style="font-size: 15px;">然后手机会重启1-2次，直至进入系统界面。原汁原味~&nbsp;</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrNvyicyTa57g0DWwOx9unPZ4HxGZYLIaibuwkn2gjV7YNJhPibpbP3ddEg/0?wx_fmt=jpeg" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 230px !important; height: 408px !important;"></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">5.以 fastboot 模式启动手机，进行设备上锁</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在开机的情况下，再次输入命令进入bootloader&nbsp;模式，进行设备上锁</span></p><blockquote><pre><p><span style="font-size: 12px;">aosp444@aosp444-virtual-machine:~/Android444_r1$&nbsp;adb&nbsp;reboot&nbsp;bootloader
aosp444@aosp444-virtual-machine:~/Android444_r1$&nbsp;fastboot&nbsp;oem&nbsp;lock</span></p></pre></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrCEpsUaKj32PxGagy7lU4nVAmFvjYx1hYTXcMMRg8vnjFXdreiahunwA/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 702px !important; height: 113px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrbpKbiatlW4hobAGfOVPR4QTn6JAg16ktciaHpr3RW2CQfQcG5UicBtTzQ/0?wx_fmt=jpeg" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 230px !important; height: 408px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">上锁成功后按电源键启动设备。至此我们编译android系统4.4.4_r1源码刷入Nexus 5 设备。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8FTu8vB1hT4T6UfuyKic8ocrIa791ZibPOibRSkFBLiaib9kQKmNVDbWHHT51icicPicHYJYDFOOlQgAZcxHA/0?wx_fmt=png" style="box-sizing: inherit; border-style: none; vertical-align: middle; width: 770px !important; height: 381.131px !important;"></p><p style="text-align: center;"><span style="font-size: 15px; color: rgb(136, 136, 136);">本文由看雪论坛倔强石头编译，转载请注明来自看雪论坛</span></p><p style="text-align: center;"><span style="font-size: 15px; color: rgb(136, 136, 136);"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; color: rgb(255, 104, 39); box-sizing: border-box !important; word-wrap: break-word !important;">如果你喜欢的话，不要忘记点个赞哦！</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">热门阅读文章：<br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">看雪 CTF 2017 攻击篇 6月强势来袭！</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283175&amp;idx=1&amp;sn=c799c0b1773dea71c74457c446cb2c59&amp;chksm=b1815c2d86f6d53b6e6722395e4d3d4cfdd2af00131e0462b3a19767bf4e271dd8ead5c8e35b&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">选择看雪企业 SRC 的 5 大理由</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283585&amp;idx=3&amp;sn=a7dc01fb0dca60054a4cd8aba4f3e9a8&amp;chksm=b1815ecb86f6d7ddbe2fb1f42592fe3c27aa814cf1e7fd1695e524af437f781ec48cd27efadd&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">黑掉SQL Server数据库链接：实验的设置和攻击指南</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283372&amp;idx=2&amp;sn=667897f27a1a4327164e179f7efd70ac&amp;chksm=b1815de686f6d4f0e42672beece10320af227b03091fc2b746d2bcee7b749502a33153b21aed&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">SQL注入新手教程（第一部分）2</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283363&amp;idx=1&amp;sn=ab837d12482aa4092204664301720b31&amp;chksm=b1815de986f6d4fff83647e7ff6d85bc3c31ff58384fbdf5c43ec2b9ab35ba1dc657a8076119&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">SQL注入新手教程（第一部分）1</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8E4ItLe4LX3YbLUffeV86icpcBApdQiakmEMuy4q8mVAaBjA0P1wez6NzO52zvKNlQQQ4siaztZDYhBg/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><p style="text-align: center;"><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1498051979&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQyx1hdTxM6K*VNtcxOeUN354nW26WI5lTIy9FI3*gxCaEHwjjiMY16zPEkDRPZ*5EAfFMZ61tFx5fctC8Cr-NbcbuX3nhBF5oItQLYTrrMxIQhQsN8rGAybNKXakR-Gu4BnViA7oH1QOJBkwOSq-aY0=">微信地址</a> | <a href="http://bbs.pediy.com/thread-218513.htm">阅读原文</a>
{% endraw  %}

