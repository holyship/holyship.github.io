---
title: frame busting 各种姿势，防护总结（二）
author: wangrin
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1497276357&src=3&ver=1&signature=aHg31JU*BGTH2xoiR2ftYl-Za4Tj4F9-ES3676R*Lz9d4Q2l*LGr82CxAl3XSPMV3mvK5fPXVrwmme1QdzvmJc8v3qJRJDVqQwvddLl2da8vBzF78I8DIGIhisW4pGpqBPue2YSim2kBZArcORb9I5R4ZtsSwX6ARoU6HmQ*LMg=
date: '2017-06-09 00:00:00 +0000'

---

{% raw  %}
<section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">04</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">指定站点攻击<br></p></section></section></section><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">虽然多数站点使用如前面所谈到的流行的framebusting技术，但是一些站点选择开发自身的framebusting技术，在这部分，我们将讨论一些在调查中发现的很有趣的防御手段，并且展示一些相关的技术来挫败他们。</span></p><p style="line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">4.1</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">黑暗中的一束光<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Facebook的framebusting方法和流行的方法大不相同。它不是在自身框架外进行破坏，而是插入一个灰色的半透明div标签，这个标签包括了一个框架页面的所有内容，当用户点击div的任何一处，facebook就破坏框架。这个巧妙的方法允许内容被框架的同时，阻止了点击劫持攻击。以下是带漏洞的代码版本，我们已经报告给facebook。</span></p><blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 14px;">If(top!= self){</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
 Window.document.write(“&lt;divstyle=’background:black; opacity: 
0.5;filter:alpha(opacity=50);position:absolute; top:0px; left:0px; 
width:9999px;height:9999px; z-index: 
1000001’&nbsp;&nbsp;&nbsp;onClick=’top.location.href=window.location.href’&gt;&lt;/div&gt;”)</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">当被框架时，这段代码插入一个黑色的9999*9999像素，50%透明的（0，0）处的div标签。因为所有出这个div之外的facebook内容都在框架之中，这个保护可以被载入足够大的框架挫败，由此整个框架的中心久位于黑色的div区域外。内容自然地流动到框架的中心并被直接显示给用户并且没有被黑色覆盖，框架代码如下，相应的页面如图5</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;">&nbsp;&nbsp; &lt;bodys t y l e=" overflow-x : hidden ;<br>border : 0 px ; margin : 0 px ; "&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;iframe width="21800px" height="2500px"<br>s r c=" http :/ / facebook . com/"<br>frameborder="0"<br>marginheight="0" marginwidth="0" &gt;<br>&lt;/iframe&gt;<br>&lt;s c r i p t &gt;window . s c ro l l T o ( 1 0 2 0 0 , 0 ) ;<br>&lt;/s c r i p t &gt;</span></p></blockquote><p style="line-height: normal;"><span style="font-size: 14px;"><br></span></p><p style="line-height: normal;"><span style="font-size: 14px;"><br></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kIUhg8O6f7ruA4icuMjU53ODBpWTY3ytnVmBAe9ZG7dBfYfGAx6uTB3A/0?wx_fmt=png" style="width: 338px !important; height: 606px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">Figure 5:Facebook’s elegant black layer defense<br><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">注意到 scrollTo 函数动态翻转滚动到 frame 的中心，这样内容出现得很清除。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">4.2</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">域检查错误<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">USBank使用framebusting代码来检测referrer字段从而判断是否能够被框架化。工作代码如下：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">i f ( s e l f!= top ) {<br>var dom = getDom( document . r e f e r r e r ) ;<br>var okDom = /usbank j l o c a lh o s t | usbnet / ;<br>var matchDomain = dom . search (okDom ) ;<br>i f ( matchDomain == -1){ //b u s t}</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">getDomain是一个用来返回URL中的域名信息，注意到任何包含USBank的都将被允许来框架页面，这完全不是开发者所希望的。举例来说，挪威的statehousebank（http://www.husbank.no）和莫斯科银行（http://www.rusbannk.org）都可互相来被允许框架页面，因为两者的域名中都包含由字符串usbank</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"><br></span></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">4.3</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">信任问题<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Myspace.com的framebusting代码：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kBKyu1jJtGHL3V3B1e5iapDvsvBtuvC1T7pZBLLBuHcibNWRmklIPAwibg/0?wx_fmt=png" style="width: 453px !important; height: 261px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><span style="font-size: 15px;">代码被设计成允许myspace被谷歌图片所框架。然而谷歌图片谷歌图片没有framebusting，结果就是一个攻击者框架谷歌图片然后通过谷歌额图片来框架myspace。因为myspace接收到来自谷歌图片的referrer它并不会识图导出框架。结果如图六所示：</span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kzjejIvia8zzrs7I8g2lFp0p5yVWEwgJGJVRKGkpJXwfdCygfS2cQibyQ/0?wx_fmt=png" style="width: 411px !important; height: 411px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">Figure 6: Because MySpace whitelists Google in</span></p><p><br></p><p><span style="font-size: 15px;">这个例子显示在framebusting的情景下，相互的信任关系会变得很危险。一个兄弟站点不使用framebusting会导致受信页面被攻击者框架化</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">05</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">安全地framebusting<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">现在我们将角度转到防御者的角度，讨论如何是一个占地那避免被框架化。首先我们回顾相关的用户端的额特点，然后给出一段有效抵御现有攻击的framebusting代码</span></p><p style="line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">5.1</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">x-frame-options</p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">微软在IE8中为了抵抗点击劫持攻击特意引入了x-frame-options，这是一个HTTP响应报文中的报头，这个字段有两个不同的值：DENY和SAMEORIGIN。当时用DENY时，IE8将会在请求站点的框架内容中进行渲染。如果使用的是SAMEORIGIN，IE只会在顶层浏览内容来源和包含指令内容来源不同时才会禁止该页面。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;尽管这个机制很有效，但是它还是有三个主要的局限。</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">每页策略指定：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">该策略需要为每个页面指定，这可能使部署复杂化。为提供全面强制执行策略的能力，例如在登陆的时候，可以简化采用。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">多域名问题</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在目前的实现下不允许网站管理员提供允许框架网页的白名单，虽然白名单可能是危险的，但在某些情况下，管理员可能无法选择而至鞥你使用主域名。</span></p></li><li><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">代理</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">网络代理在添加，删除头部字段方面是臭名昭著的，如果一个网络代理剔除了x-frame-options字段，那网站将失去它的框架保护</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">x-frame-options已经被浏览器开发商迅速采用，出了firefox之外，每个最新版本的浏览器都使用了这个技术，danfirefox通过NoScriptfirefox插件提供此项功能。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">但是在web方面采用较慢，最新一项调查显示，在top10000中只有4个网站使用了它，这个结论是和我们的观察是一致的，我们观察到只有三个站点使用了这项技术。</span></p></li><br></ul><p style="line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">5.2</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">内容安全策略<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">内容安全策略是一个Mozilla计划，该计划向web开发人员提供了一种网站上可指定互动内容的方法，它在firefox3.7中的部署已经被提上了日程。和x-frame-options一样，策略通过HTTP响应头传送，它比x-frame-options更为通用，允许网站的所有者指定其他类型的内容互动，例如：它允许网站将脚本限制在特定的来源。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Web管理者可直接使用指定的frame-ancestors指令来指定那些来源能够被嵌入到frame或者iframe标签中去。因此不像x-frame-options，web管理者可指定允许的第三方网站嵌入到iframe中。CSP从x-frame-options的另外一些局限性中吃到了苦头。它并不提供一个强制的全局策略，到现在这个策略尚处于测试阶段还未被网站所使用。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">5.3</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">使用javascript<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">到此x-frame-options或其他基于浏览器的防护手段被广泛使用，这使web站点几乎没有选择的余地只能使用javascript来对抗点击劫持。图7中所示的是目前我们认为最有效安全的framebusting代码</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kT51lvfpGctohA5u6FCh1xcAtiajnUsd0QnJiaYSc0vwgRSR2OlYehrEQ/0?wx_fmt=png" style="width: 497px !important; height: 207px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">页面加载时，样式表会隐藏页面上的所有内容。
 如果禁用JavaScript，页面将保持为空。 类似地，如果页面被框架，它将保持空白，否则将尝试破坏框架。 
如果framebusting代码被阻止，如通过挂起卸载事件或进行204冲洗攻击，页面将保持为空。该脚本仅显示内容页面不在框架中运行的文档。 
请注意，通过浏览器设置或NoScript禁用JavaScript的用户将无法使用该站点。 如果是这样的话，设计师可能想要有一个后备机制。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在我们的示例中，整个页面最初是不可见的，但是通过让子元素不可见，这种防御可能更加地细粒度。这样，如果禁用JavaScript，则可以向用户显示一条消息。 但是，不建议激活超出该简单消息的任何功能子集。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们通过注入代码到顶部页面手工测试了一些负载重的站点。 使用Firefox的YSlow和Chrome的Speed Tracer，我们无法识别渲染或加载时间的任何显着降低</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们强调，这个代码没有被证明是框架破坏的一种安全方法。
 正如我们在整篇文章中所展示的，许多错误和漏洞可用于攻击者定位JavaScript framebusting，并且可能还有更多。 
我们的代码片段可能已经很容易受到未知攻击的影响。但据我们所知，这是当前最好的方法。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">06</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">相关工作<br></p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">第一次提到透明iframe的负面影响是2002年MozzilaFirefox浏览器的错误报告[21]。术语“劫持”[10]是由Hansen和Grossman在2008年创造的。Clickjacking与网络钓鱼[9]不同，因为它不会诱使用户将机密凭证输入假冒网站。相反，用户必须将其凭据输入真实的站点以建立认证会话。攻击能够持续到用户的会话过期。劫持可以被认为是混淆代理的一个实例[5]。
 
“混淆代理”一词是1988年由哈迪创造的[11]。另一个网络上的混淆代理问题的例子是跨站点请求伪造[2]。网络密钥认证方案[6]在URL中使用不可预知的秘密，而不是cookie进行身份验证。这种方法可以减轻混淆代理的问题，如劫持和CSRF。用于点击劫持的实验客户端防御包括ClearClick
 [18]和ClickIDS 
[1]。这些防御还没有广泛部署，所以他们不能作为网站主要的防御。他们还介绍了陈旧网站的一些兼容性成本，这可能会妨碍浏览器厂商的采用。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">07</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">结论</p></section></section></section><p style="line-height: normal;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们调查了top500网站的framebusting的做法。 通过使用已知和新颖的攻击技术，我们发现我们遇到的所有劫持防御都可以以某种方式绕过。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">许多攻击是通用的，可以用于攻击各种各样的站点。我们发现使用有针对性的攻击可以击败具有高级劫持防御（如Facebook和MySpace）的站点。在查看了可用的防御措施后，我们提出了一种基于JavaScript的防御方式，直到浏览器支持X-FRAME-OPTIONS等解决方案得到广泛部署。</span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);">本文由 看雪翻译小组 wangrin 编译，来源Stanford Web Security Research</span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(255, 104, 39);">完~</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(255, 104, 39);">如果你喜欢的话，不要忘记点个赞哦！</span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">热门阅读文章：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank">看雪 CTF 2017 攻击篇 6月强势来袭！</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283184&amp;idx=2&amp;sn=32f3a9e70e3504ed2cd68f1c0a2c8f3d&amp;chksm=b1815c3a86f6d52ca5b25dfb1b6d120712007f74f6d57d062881bcbc3b3b9b0ed31232a1c530&amp;scene=21#wechat_redirect" target="_blank">虚拟机逃逸——QEMU的案例分析（二）</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283175&amp;idx=2&amp;sn=6e8fb6db8c328707308758a8791029b0&amp;chksm=b1815c2d86f6d53b885885136b9b9c0685c72006ff6fe96150e060a6ba56aa8c63651f0daee5&amp;scene=21#wechat_redirect" target="_blank">虚拟机逃逸——QEMU的案例分析（一）</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283005&amp;idx=2&amp;sn=2fc411b70549c789085e517ef6dfc3e9&amp;chksm=b1815b7786f6d261975cd000d4ddf2c4cffe3cf2d8ab06d870e7971e862c29c7278996bdfb6c&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283017&amp;idx=3&amp;sn=745024d678707b6dcf0cdc94ff5472a5&amp;chksm=b1815c8386f6d59538bfeeb8d3837007f07b0b4d3cd77b439f7856edd391127b6b2f36fb105d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283290&amp;idx=3&amp;sn=209c746a4a7748d44fead391622be552&amp;chksm=b1815d9086f6d4863c529c675d6f8949f29274dc58513882958a7a3d786850d5209a94e113ff&amp;scene=21#wechat_redirect" target="_blank">用 Frida 入侵Android App III （一）</a></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283303&amp;idx=2&amp;sn=7a20cc7f14b0ea237aa81c6e045c5e64&amp;chksm=b1815dad86f6d4bb64d7f631ee85fbfefae13d652b25a8d79e51f47f499e2dbf24aed1865685&amp;scene=21#wechat_redirect" target="_blank">用Frida入侵Android App III （二）</a><br></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8E4ItLe4LX3YbLUffeV86icpcBApdQiakmEMuy4q8mVAaBjA0P1wez6NzO52zvKNlQQQ4siaztZDYhBg/640?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 140px !important; height: 140px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1497276357&src=3&ver=1&signature=aHg31JU*BGTH2xoiR2ftYl-Za4Tj4F9-ES3676R*Lz9d4Q2l*LGr82CxAl3XSPMV3mvK5fPXVrwmme1QdzvmJc8v3qJRJDVqQwvddLl2da8vBzF78I8DIGIhisW4pGpqBPue2YSim2kBZArcORb9I5R4ZtsSwX6ARoU6HmQ*LMg=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217315.htm">阅读原文</a>
{% endraw  %}

