---
title: WannaCry深度详细分析报告(偏重策略)
author: Angelxf
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1496016642&src=3&ver=1&signature=1Hp-JGX68UwholXKdYsHgG9Oe2Y4Txgw7FIHUz2sSP2AphHbOB7c*JU7liblQGWtMVZen7MuttjQKfDcEubrQAQL0Lk*A4GUNg2E58cwH8lWGd6DBOi50Bc-7R2rmxMcJpPQZIlKq*IpM8FxPyEHm8foU-dsZnWmiTOJkzpbO0g=
date: '2017-05-26 00:00:00 +0000'

---

{% raw  %}
<section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;"><span style="font-size: 18px;">0x00. 前言</span></p></section></section><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">最近，WannaCry是火了一把，到处都是分析文章，报告，解决方案等等。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">趁着这个热度，我也来跟风一把。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">前前后后把WannaCry详细分析了一遍。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">从文件释放、启动加密器、文件加密策略、加密算法、到解密过程中所有细节进行了详尽深入的分析。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">由于没有拿到初始样本，没有包含漏洞利用部分的分析。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">样本信息：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">MD5: 84C82835A5D21BBCF75A61706D8AB549</span></p></blockquote><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">SHA1: 5FF465AFAABCBF0150D1A3AB2C2E74F3A4426467</span></p></blockquote><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">CRC32: 4022FCAA</span></p></blockquote><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">无壳 / Visual C++ 6.0</span></p></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">下面具体看分析内容。</span></p><p><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">0×01. 概述<br></p></section></section><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">样本首先通过资源释放各种文件，包括加密器、解密器、几个辅助程序、桌面背景图、说明文件、语言文件等等。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">内存加载加密器模块，执行加密部分功能。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举目标文件（目标文件后缀列表后面给出），加密为.WNCRY文件（加密策略后面详述），删除原始文件。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">复制自身为tasksche.exe，安装启动项</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">启动解密器</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">大致流程图如图：</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/db8fc25139ff0386c37046e2a7b7a54d6b1ccbac.png" style="width: 770px !important; height: 257.514px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">下面开始详细分析各个部分细节。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;"><br></span></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">0×02. 释放文件<br></p></section></section><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">设置当前目录为工作目录，然后查找PE中资源(XIA)。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/8bd3e24d5afbf1df7ae187cb87ae7189868cf5c3.png" style="width: 603px !important; height: 65px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">直接用资源工具看一下，发现是PK开头的，多半是个压缩文件了，导出来试试。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/0e7443699727ce6f1f6e71eb483d0c9d94997a63.png" style="width: 555px !important; height: 301px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">解压还要密码，看代码密码是WNcry@2ol7，解压成功。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/d901c89bc3cd2f3e8565aeffae129dfd67fe80c3.png" style="width: 707px !important; height: 50px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">读取资源数据后，解压释放文件到当前目录。</span></p><pre><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">//部分释放文件说明：
b.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//桌面背景图片
c.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//加密相关
msg/*.wnry&nbsp;&nbsp;//语言相关文件
r.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//@Please_Read_Me@.txt
s.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//是压缩文件，打包的是Tor相关组件
taskdl.exe&nbsp;&nbsp;//删除回收站文件
taskse.exe&nbsp;&nbsp;//用于启动其他session的@WanaDecryptor@.exe
u.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//@WanaDecryptor@.exe&nbsp;解密器&nbsp;
t.wnry&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//解密后是加密器</span></p></pre><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">在三个比特币交易地址中随机选择一个，写入c.wnry</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/24944d3fd52a652cac049f547f5a3900f2c476a0.png" style="width: 640px !important; height: 122px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后设置当前目录为隐藏属性，且设置为everyone可访问</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/1302ce68e1f2d13b7f9037571a19acc1b489a09b.png" style="width: 770px !important; height: 86.0642px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后初始化Crypt相关函数，用于后面的解密操作。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">开始操作文件t.wnry，看看内容，应该是个加密文件。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/f337b6ac2e1e3ecf9aa539c62ae4f04d65c41d0d.png" style="width: 547px !important; height: 106px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后通过crypt API将t.wnry解密之后（解密后是个DLL模块，dump数据后可以用于分析），映射到内存（自己loaddll），然后找到导出接口函数TaskStart调用，开始加密工作。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/65dcf94254d93c5de95013919ae990a2ea766dc4.png" style="width: 593px !important; height: 181px !important;"></p><p class=""><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">0×03. 加密部分<br></p></section></section><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">TaskStart一进来，通过MsWinZonesCacheCounterMutexA的Mutex进行单示例检查，有则退出，没有继续工作。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后是设置工作目录，读取c.wnry信息。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">检查是否是SYSTEM账户。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/4c969c74a113d8804b408444ee1ac85b742b9ef8.png" style="width: 651px !important; height: 240px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">初始化Crypt相关函数，以及文件操作函数（增加一点分析成本）。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/dea2ab55688da98f2b6cb08905c658a209af6187.png" style="width: 460px !important; height: 286px !important;"><img src="/ikanxue/images/067b54dd86d1a07389a117446d6e35b5e480c044.png" style="width: 370px !important; height: 210px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">检查Global\MsWinZonesCacheCounterMutexW，Global\MsWinZonesCacheCounterMutexA\0是否存在，</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">存在则表示加密相关准备工作已经完成，不在进行，没有则创建Global\MsWinZonesCacheCounterMutexA\0</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">检查00000000.dky和00000000.pky是否存在，存在是否配对的密钥，是则加密相关准备工作已经完成，不在进行，没有则进行后续工作。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/7118093b0622a8a48b28ad08a2eec36773af58b5.png" style="width: 677px !important; height: 355px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">如果加密相关准备工作已经完成，创建一个线程，完成如下工作（记为工作A）：</span></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">如果不是管理员权限，并且不是SYSTEM账户，通过taskse.exe提权启动@WanaDecryptor@.exe，是则普通方式启动@WanaDecryptor@.exe</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><img src="/ikanxue/images/9c6f7820457f0048d97937ad8a3ad3e4b34079c4.png" style="width: 510px !important; height: 299px !important;"></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">安装tasksche.exe启动项（注册表Run），键名随机</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><img src="/ikanxue/images/b64bdef00bb485fc9462cb5b56dbd5b22a170988.png" style="width: 770px !important; height: 142.917px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">如果加密准备未完成，初始化密钥，保存到00000000.pky, 00000000.eky。</span></p><blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">由于时间关系，具体加密密钥产生过程不再详述，很多分析文章说的很清楚了，本文重点不在此。</span></p></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后是如果00000000.res不存在，通过CryptGenRandom产生8字节随机值，后续会写入00000000.res</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">接着创建5个工作线程，完成不同的工作。</span></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">线程1每隔25秒循环写入数据到00000000.res，包括前面CryptGenRandom生成的随机值，已经更新的当前时间，直到线程退出标记为真退出</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><img src="/ikanxue/images/34f4d2b9027d762d79aa3c228ffc19340192195e.png" style="width: 368px !important; height: 220px !important;"></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">线程2每5秒检查00000000.dky和00000000.pky是否存在，存在是否配对的密钥，是则设置全局标志，然后退出线程</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">&nbsp; &nbsp; &nbsp;&nbsp;</span><img src="/ikanxue/images/40b5f0980781c6c77debfe5f999543a0028c13f0.png" style="width: 659px !important; height: 219px !important;"></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">线程3监测新增磁盘，加密新磁盘的文件（和其他磁盘加密相同）</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">&nbsp; &nbsp; &nbsp; &nbsp;</span><img src="/ikanxue/images/45d6a261f892813c12ab0ab39c53168eeaa6f399.png" style="width: 653px !important; height: 177px !important;"></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">线程4每30秒启动taskdl.exe清除所有磁盘的回收站文件</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">线程5完成的也是前面提到的工作A的内容，不再详述</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后就是重点了，加密文件部分了。</span></p><h2 style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">加密文件部分</span></h2><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">拷贝u.wnry为@WanaDecryptor@.exe，通过写一个bat创建@WanaDecryptor@.exe.lnk快捷方式。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/22064a1fb33f5f41768a20a8b4c33d67c78d8c93.png" style="width: 770px !important; height: 194.452px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/885e95b36a5c04ce0e8401e05dbffaf348971a71.png" style="width: 604px !important; height: 80px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">读取r.wnry内容，生成@Please_Read_Me@.txt文件。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举当前用户桌面和文档目录文件，进行加密（没有设置不复写标记，删除前会复写）。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举All Users\Desktop和All Users\Documents，找到非当前用户目录进行加密（没有设置不复写标记，删除前会复写）。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">下面记为工作B:</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">通过taskkill强删Microsoft.Exchange、sql和mysql进程（加密其数据）</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">anhkgg_CreateProc_10001080(aTaskkill_exeFI,&nbsp;0,&nbsp;0);//&nbsp;taskkill.exe&nbsp;/f&nbsp;/im&nbsp;Microsoft.Exchange.*
anhkgg_CreateProc_10001080(aTaskkill_exe_0,&nbsp;0,&nbsp;0);//&nbsp;taskkill.exe&nbsp;/f&nbsp;/im&nbsp;MSExchange*
anhkgg_CreateProc_10001080(aTaskkill_exe_1,&nbsp;0,&nbsp;0);//&nbsp;'taskkill.exe&nbsp;/f&nbsp;/im&nbsp;sqlserver.exe
anhkgg_CreateProc_10001080(aTaskkill_exe_2,&nbsp;0,&nbsp;0);//&nbsp;taskkill.exe&nbsp;/f&nbsp;/im&nbsp;sqlwriter.exe
anhkgg_CreateProc_10001080(aTaskkill_exe_3,&nbsp;0,&nbsp;0);//&nbsp;taskkill.exe&nbsp;/f&nbsp;/im&nbsp;mysqld.exe</span></p></pre></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">加密磁盘中文件，每个分区重复两次（会设置不复写标记，删除前不会复写）。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举All Users\Desktop目录，复制b.wnry到目录中为@WanaDecryptor@.bmp，设置桌面背景为@WanaDecryptor@.bmp，</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">执行@WanaDecryptor@.exe co</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">更新00000000.res</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">cmd.exe /c start /b @WanaDecryptor@.exe vs</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">每个磁盘(fixed)创建x:/$Recycle/hibsys.WNCRYT（系统盘写在temp目录，x:/$Recycle被设置为系统隐藏属性），读取分区可用空间大小，大于0x40000000（1GB）的话，每10微秒循环写入0xa00000个字节的'U'，写20次，然后删除该文件，并且设置了重启后删除。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">每隔60s重复工作B，知道退出标志为真。</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h2 style="line-height: 1.75em; margin-bottom: 10px; margin-top: 25px;"><span style="font-size: 16px; color: rgb(129, 40, 187);"><strong>文件枚举</strong></span></h2></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举文件采用方式为：</span></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举当前目录中所有文件(排除文件看下文)，加入文件链表，记录所有子目录（排除目录看下文）到目录链表。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">本目录文件有加密操作（具体看下文件）</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">分析目录层级，少于等于6层的，拷贝lease_Read_Me@.txt到目录，5-6层的拷贝@WanaDecryptor@.exe.lnk，1-4层拷贝@WanaDecryptor@.exe到目录。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后遍历目录链表，枚举子目录，重复1操作。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">子目录枚举完成，所有文件记录到链表，进行后续操作。</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">目录和文件采用相同的链表结果，总结如下：</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">struct&nbsp;FILE_LIST_CONTEXT{
&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;vtable;
&nbsp;&nbsp;&nbsp;&nbsp;FILE_LIST&nbsp;*list;//
&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;file_count;//8}struct&nbsp;FILE_LIST{
&nbsp;&nbsp;&nbsp;&nbsp;FILE_LIST*&nbsp;prev;
&nbsp;&nbsp;&nbsp;&nbsp;FILE_LIST*&nbsp;next;
&nbsp;&nbsp;&nbsp;&nbsp;FILE_INFO&nbsp;file;//8}struct&nbsp;FILE_INFO{
&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;path[0x168];//
&nbsp;&nbsp;&nbsp;&nbsp;WCHAR&nbsp;name[0x104];//2d0
&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;nFileSizeLow;//4d8
&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;nFileSizeHigh;//4dc
&nbsp;&nbsp;&nbsp;&nbsp;DWORD&nbsp;type;//4e0&nbsp;&nbsp;FILE_TYPE}//0x4e4</span></p></pre></blockquote><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h2 style="line-height: 1.75em; margin-bottom: 10px; margin-top: 25px;"><span style="font-size: 16px; color: rgb(129, 40, 187);"><strong>排除目录</strong></span></h2></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举子目录时，会跳过如下目录（保证系统正常工作）：</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">\Intel&nbsp;
\ProgramData
\WINDOWS
\Program&nbsp;Files
\Program&nbsp;Files&nbsp;(x86)
\AppData\Local\Temp
\Local&nbsp;Settings\Temp
This&nbsp;folder&nbsp;protects&nbsp;against&nbsp;ransomware.&nbsp;Modifying&nbsp;it&nbsp;will&nbsp;reduce&nbsp;protection
Temporary&nbsp;Internet&nbsp;Files
Content.IE5</span></p></pre></blockquote><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><p style="margin-top: 25px;"><span style="font-size: 16px; color: rgb(129, 40, 187);"><strong>文件分类</strong></span></p></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举文件时，首先跳过 @Please_Read_Me@.txt，@WanaDecryptor@.exe.lnk， @WanaDecryptor@.bmp</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后检查文件类型，跳过0,1,6类型文件，其他文件加入链表。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">具体类型如下：</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">0&nbsp;没有后缀以及其他类型后缀
1&nbsp;.exe,&nbsp;.dll
4&nbsp;.WNCRYT&nbsp;
5&nbsp;.WNCYR
6&nbsp;.WNCRY
2.
".doc"".docx"".xls"".xlsx"".ppt"".pptx"".pst"".ost"".msg"".eml"".vsd"".vsdx"
".txt"".csv"".rtf"".123"".wks"".wk1"".pdf"".dwg"".onetoc2"".snt"".jpeg"".jpg"
3.&nbsp;
".docb"".docm"".dot"".dotm"".dotx"".xlsm"".xlsb"".xlw"".xlt"".xlm"".xlc"".xltx"".xltm"".pptm"".pot"".pps"".ppsm"".ppsx"".ppam"".potx"".potm"
".edb"".hwp"".602"".sxi"".sti"".sldx"".sldm"".sldm"".vdi"".vmdk"".vmx"".gpg"".aes"".ARC"".PAQ"".bz2"".tbk"".bak"".tar"".tgz"".gz"".7z"".rar"
".zip"".backup"".iso"".vcd"".bmp"".png"".gif"".raw"".cgm"".tif"".tiff"".nef"".psd"".ai"".svg"".djvu"".m4u"".m3u"".mid"".wma"".flv"".3g2"".mkv"
".3gp"".mp4"".mov"".avi"".asf"".mpeg"".vob"".mpg"".wmv"".fla"".swf"".wav"".mp3"".sh"".class"".jar"".java"".rb"".asp"".php"".jsp"".brd"".sch"
".dch"".dip"".pl"".vb"".vbs"".ps1"".bat"".cmd"".js"".asm"".h"".pas"".cpp"".c"".cs"".suo"".sln"".ldf"".mdf"".ibd"".myi"".myd"".frm"".odb"".dbf"
".db"".mdb"".accdb"".sql"".sqlitedb"".sqlite3"".asc"".lay6"".lay"".mml"".sxm"".otg"".odg"".uop"".std"".sxd"".otp"".odp"".wb2"".slk"".dif"".stc"
".sxc"".ots"".ods"".3dm"".max"".3ds"".uot"".stw"".sxw"".ott"".odt"".pem"".p12"".csr"".crt"".key"".pf</span><span style="font-size: 15px;">x"".der"</span></p></pre></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">总结为下面的enum</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">enum&nbsp;FILE_TYPE
{
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_NULL&nbsp;=&nbsp;0,
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_EXEDLL,
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_DOC,
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_DOCEX,
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_WNCRYT,&nbsp;//.wncryt
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_WNCYR,&nbsp;//.wncyr
&nbsp;&nbsp;&nbsp;&nbsp;FILE_TYPE_WNCRY&nbsp;//.wncry
}</span></p></pre></blockquote><h2 style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><br><span style="font-size: 16px;"></span></h2><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h2 style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 16px;"><strong><span style="font-size: 16px; color: rgb(129, 40, 187);">文件加密策略</span></strong></span></h2></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">加密文件函数中有个参数，我取做cmd（取值是1-4）。因为不同的值会有不同的操作方式。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">根据cmd和文件类型和大小等等，函数sub_10002E70返回不同的操作方式。</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">1.&nbsp;cmd&gt;=4,&nbsp;FOT_ENCRYPT_NORMAL_4
2.&nbsp;cmd&lt;=3，FILE_TYPE_NULL，FOT_NULL_1&nbsp;
3.&nbsp;cmd==3,&nbsp;非FILE_TYPE_NULL，FOT_ENCRYPT_NORMAL_4
4.&nbsp;cmd&lt;=2,&nbsp;.wncyr,&nbsp;FOT_NULL_1
5.&nbsp;cmd&lt;=2,&nbsp;.wncryt,&nbsp;FOT_DELETE_FILE_2
//用于枚举中的操作，直接操作普通文件（不加入链表）和大文件.doc（加入链表），小文件.doc,.docex加入链表，其他文件不加入链表
//枚举中完成加密操作的文件不加入链表了
6.&nbsp;cmd==1,&nbsp;.doc,&nbsp;大文件,&nbsp;FOT_ENCRYPT_WRITESRC_3&nbsp;//也要加入链表
7.&nbsp;cmd==1,&nbsp;.doc,&nbsp;普通文件,&nbsp;FOT_ENCRYPT_NORMAL_4
8.&nbsp;cmd==1,&nbsp;.doc,&nbsp;小文件，FOT_NULL_1
9.&nbsp;cmd==1,&nbsp;.docex,&nbsp;FOT_NULL_1
10.&nbsp;cmd==2,&nbsp;.doc,&nbsp;FOT_NULL_1
11.&nbsp;cmd==2,&nbsp;.docex,&nbsp;大文件，&nbsp;FOT_ENCRYPT_WRITESRC_3
12.&nbsp;cmd==2,&nbsp;.docex,&nbsp;小文件，FOT_NULL_1
13.&nbsp;cmd==2,&nbsp;.docex,&nbsp;普通文件，FOT_ENCRYPT_NORMAL_4
其他返回FOT_NULL_0</span></p></pre></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">上面提到的大文件，普通文件，小文件定义如下：</span></p><pre><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">小于0x400的是小文件，大于0xC800000的是大文件，中间的是普通文件</span></p></pre><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/2a9821a177b0f1e94bb51679f16f56178e03c0a1.png" style="width: 609px !important; height: 158px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">上面提到的作方式具体定义如下：</span></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">//返回0表示未作处理，或者处理未完成，需要插入链表或者不从链表中删除
enum&nbsp;FILE_OP_TYPE{
&nbsp;&nbsp;&nbsp;&nbsp;FOT_NULL_0&nbsp;=&nbsp;0,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//0&nbsp;未操作，返回1
&nbsp;&nbsp;&nbsp;&nbsp;FOT_NULL_1,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//1,default&nbsp;未操作，返回0
&nbsp;&nbsp;&nbsp;&nbsp;FOT_DELETE_FILE_2,&nbsp;&nbsp;&nbsp;&nbsp;//2&nbsp;//删除文件，返回1
&nbsp;&nbsp;&nbsp;&nbsp;FOT_ENCRYPT_WRITESRC_3,&nbsp;//3&nbsp;改源文件，返回0
&nbsp;&nbsp;&nbsp;&nbsp;FOT_ENCRYPT_NORMAL_4,&nbsp;//4&nbsp;只加密，返回1
}</span></p></pre></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">代码如下：</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/9be550670c17250a9bf745184e8b3e16cd926eb5.png" style="width: 553px !important; height: 336px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">对加密策略做一下总结：</span></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">在枚举文件中，cmd=1，会对普通文件直接加密为.WNCRY，不再加入链表，大文件处理为.WNCYR，以及其他未作处理文件继续加入链表等待处理。</span></p></li></ol><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/63df428b2e3ecbe830c370e6a84075b5c29828ff.png" style="width: 770px !important; height: 94.1525px !important;"></p><ol style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">枚举完成后，cmd从2-4，每个cmd遍历都遍历加密文件。</span></p></li></ol><ul style="margin-bottom: 16px; padding-left: 2em; color: rgb(51, 51, 51); font-family: none; line-height: 21px;" class="list-paddingleft-2"><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">cmd=2，加密FILE_TYPE_DOCEX普通文件为.WNCRY（移出链表），以及FILE_TYPE_DOCEX大文件为.WNCYR。</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">cmd=2, 删除.WNCRYT</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">cmd=3, 加密链表中所有文件（移出链表）</span></p></li><li><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">cmd=4, 加密可能剩余链表中的文件</span></p></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/944592256349835b6abf3f146977ea5c87028452.png" style="width: 770px !important; height: 412.158px !important;"></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h2 style="line-height: 1.75em; margin-bottom: 10px; margin-top: 25px;"><strong><span style="font-size: 16px; color: rgb(129, 40, 187);">文件内容加密过程</span></strong></h2></li></ul><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">验证文件是否未加密，或者未加密完成。已完成加密，直接退出。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/210811550128dac2ee9acf1fbfef98093097fa5e.png" style="width: 648px !important; height: 189px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">对于FOT_ENCRYPT_WRITESRC_3，按写打开源文件，将文件头0x10000字节内容移动到尾部，头部内容清零，写入加密文件头部数据，然后源文件移动为.WNCYR，完成退出。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/bcf4e98c30e6b13ed90f6e0b3e091bda31009515.png" style="width: 770px !important; height: 162.701px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">对于FOT_ENCRYPT_NORMAL_4，按读打开源文件，对于普通文件进行随机值检查，满足100倍数，且文件数据小于10，那么换本次加密算法为免费解密的算法，标记，加密完成后调用回调函数写入f.wnry中。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/e47ecb5666512c816dc8a3a384f25814e5d134ce.png" style="width: 770px !important; height: 184.266px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/d95fb367e5e15bd21fd42cddc20d061f68f7e1e4.png" style="width: 770px !important; height: 157.143px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">加密前，将文件后缀加上T变成.WNCRYT，然后创建文件。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">写入加密文件头部数据</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/f48fac10a90c8cd2d95004935c34978e3965efa6.png" style="width: 686px !important; height: 90px !important;"></p><blockquote><pre><p style="line-height: normal;"><span style="font-size: 12px;">//加密文件头部数据结构
struct&nbsp;{&nbsp;&nbsp;&nbsp;
&nbsp;char&nbsp;magic[8];//WANACRY!'
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;size;//0x100
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;key[size];//
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;type;//加密文件类型3,4
&nbsp;&nbsp;&nbsp;&nbsp;__int64&nbsp;datasize;//&nbsp;&lt;=0x6400000&nbsp;源文件大小
&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;data[1];//
&nbsp;&nbsp;&nbsp;&nbsp;}</span></p></pre></blockquote><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">对于.WNCYR文件（FOT_ENCRYPT_WRITESRC_3处理过一次），读取尾部0x10000的数据加密写入文件。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/90cde8722ceab12889161891b770497190b40995.png" style="width: 770px !important; height: 198.622px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">然后每0x1000读取加密，写入.WNCRYT文件，循环知道所有数据加密。移动.WNCRYT为.WNCRT。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><img src="/ikanxue/images/953c7d4b3a58e64b659927f12910a68ac70bd7c0.png" style="width: 770px !important; height: 271.655px !important;"></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">对于FOT_ENCRYPT_NORMAL_4，加密完成后会将源文件加入删除链表，在删除线程中文件会被复写删除。</span></p><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">复写通过生成随机值或者一片'U'，循环写入文件，细节不再阐述（桌面我的文档目录文件目录会被复写，其他目录文件不会）。</span></p><p class=""><br></p><p><br></p><section label="Copyright Reserved by ipaiban.com." style="text-align: left; margin: 5px 0px 0px; border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 10px; border-style: none;"><section style="display: inline-block; padding: 0.5em; border-radius: 3px; color: white; font-size: 1em; box-shadow: 0.1em 0.1em 0.2em rgb(165, 165, 165); background-color: rgb(0, 0, 0);"><p class="" style="color: rgb(255, 255, 255); line-height: 22px; font-size: 18px;">总结</p></section></section><p style="line-height: 1.75em; margin-top: 10px; margin-bottom: 10px;"><span style="font-size: 15px;">至此，wannacry大部分内容都分析完成，由于时间精力的关系，后续解密器就不再分析了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(136, 136, 136);">本文由看雪论坛<span class=""> Angelxf </span>原创</span><span style="font-size: 15px;"><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">你可能对以下内容感兴趣：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282630&amp;idx=1&amp;sn=61fcbc708235dec5d7897a0d7c315756&amp;chksm=b1815a0c86f6d31a50ba1f9a39d876e28f2c71096100b28e961df185f7be94ec77b9199efd51&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">等你来挑战！| 看雪 CTF 2017 攻击篇</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282621&amp;idx=1&amp;sn=15f5bc0fa2b0b34ae241668b23a3939b&amp;chksm=b1815af786f6d3e1fd4bad2c336d725ec600551a6477bbc4c6af93167074ac83873aeba89938&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">【终于等到你！】看雪 CTF 2017</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283039&amp;idx=2&amp;sn=7965f942fd1629eb4b0502b01a522998&amp;chksm=b1815c9586f6d583b224490858104e7a5e5affad9542fe33da744c091ec234c3a55016f41690&amp;scene=21#wechat_redirect" target="_blank">MS17-010 SMB 远程命令执行漏洞利用分析</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283033&amp;idx=2&amp;sn=7a0d3fa2c8c5e2bdcac6379351269330&amp;chksm=b1815c9386f6d585439b2186c5fc7099c74ce5398483563db182f868911a3a2c6c4be7500021&amp;scene=21#wechat_redirect" target="_blank">新手逆向学习--Win7 下 64 位扫雷逆向以及辅助制作</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283005&amp;idx=2&amp;sn=2fc411b70549c789085e517ef6dfc3e9&amp;chksm=b1815b7786f6d261975cd000d4ddf2c4cffe3cf2d8ab06d870e7971e862c29c7278996bdfb6c&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283017&amp;idx=3&amp;sn=745024d678707b6dcf0cdc94ff5472a5&amp;chksm=b1815c8386f6d59538bfeeb8d3837007f07b0b4d3cd77b439f7856edd391127b6b2f36fb105d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;">Ring3 注入总结及编程实现【有码】</span></a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283003&amp;idx=1&amp;sn=bcfd852aea24f274bf8fda85f9300a85&amp;chksm=b1815b7186f6d26758f7f0f1cb0c7ec9da888ab0d80a7b2e2850453bfc03f05640443839d7bf&amp;scene=21#wechat_redirect" target="_blank">【原创】WannaCry勒索软件中“永恒之蓝”漏洞利用分析</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="/ikanxue/images/a0942aca19665d63c4ee222be971a37cd63dc1e4.jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1496016642&src=3&ver=1&signature=1Hp-JGX68UwholXKdYsHgG9Oe2Y4Txgw7FIHUz2sSP2AphHbOB7c*JU7liblQGWtMVZen7MuttjQKfDcEubrQAQL0Lk*A4GUNg2E58cwH8lWGd6DBOi50Bc-7R2rmxMcJpPQZIlKq*IpM8FxPyEHm8foU-dsZnWmiTOJkzpbO0g=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217867.htm">阅读原文</a>
{% endraw  %}

