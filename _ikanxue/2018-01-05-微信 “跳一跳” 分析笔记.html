---
title: 微信 “跳一跳” 分析笔记
author: 洪荒之力&obaby
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1515984875&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siPPs-NRfvlwjuvH7xFTtLmsOPyUEuRfepE4lmADgDB-KqTGJpoTQDDroKcwkYhW3KZLGf0-3ds5TwjXn2Cn3w2nSe3UJSMdEd-EVWEQYo2DTv-sSgMknUSo58jDDgU5uy01kF*WiVc3fGbfU15m2edU=
date: '2018-01-05 00:00:00 +0000'

---

{% raw  %}
<p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="text-align: center;"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8F81pyvePpbYZhWjaSUJeD6m8JibXLb6Xicuq0hCQP0QxFAQ8BsyjCicILEHl50MT8Fr6ln9dxxxe6JA/0?wx_fmt=jpeg" style="width: 497px !important; height: 298.2px !important; visibility: visible !important;"></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong>0x00 引子</strong></span><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><hr><p style="margin-left: 8px;margin-right: 8px;"><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">目前网上已经有模拟发包上传分数的方案了，图形识别和人肉丈量都是不错的选择，此外，也有基于安卓 adb 实现的。下面给出一些这方面的分析，没别的意思，就是纯粹好玩。<br></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: 2px;font-size: 18px;"><strong><span style="letter-spacing: 2px;color: rgb(0, 81, 171);"><br></span></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: 2px;font-size: 18px;"><strong><span style="letter-spacing: 2px;color: rgb(0, 81, 171);">0x01 抓包</span></strong></span><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><hr><p style="margin-left: 8px;margin-right: 8px;"><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">抓包通常可以用 Charles 或者 Fiddler 抓小程序 https 数据，这里说下另一种方法，从安卓代码入手，找到 https 明文发包点截取封包。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">从微信的 log 中看到，每次游戏发包时都会打印 "<span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">AppBrandNetworkRequest</span>"，从 Tag 命名上猜测这是小程序代码通过微信 sdk 发包的接口，反编译微信根据该关键词定位到负责小程序 https 通信的类是 <span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">Lcom/tencent/mm/plugin/appbrand/i/c</span>;。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">分析下代码可以发现最后使用过 <span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">Lcom/tencent/mm/sdk/f/e;-&gt;post </span>发包的，打印调用这行代码的函数的各个参数就可以截取小程序通过 https 发送的 json 明文数据了。</span><br></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong>0x02 改包</strong></span><br></span></p><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">在 1 中明文发包点可以直接修改发送的数据，但是敏感数据是加密通信的，比如上传分数的接口 <span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">https://mp.weixin.qq.com/wxagame/wxagame_settlement</span> 中 action_data 字段就是在小程序内加密后再通过微信发出去的。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">既然数据是在本地加密的，加密算法肯定也在本地可以找到，所以"跳一跳"作弊的关键就是找到小程序源码。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong>0x03 寻找小程序源码<br></strong></span></span></p><hr><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">从微信小程序文档中可以知道，小程序的核心逻辑通常是用 js 写的。搜索手机中的文件并没有找到后缀为 ".js" 的源码，源码只能从内存中 dump 了。<br><br>微信 log 中搜索 ".js"，可以发现有如下 log 打印：<br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">I/MicroMsg.WxaPkgRuntimeReader(12426): [, , 12554]:openRead, appId = wx7c8d593b2c3a7703, reqURL = /game.js, null(FALSE), type = java.lang.String, cost = 6ms</span><br><br>从关键词 WxaPkgRuntimeReader 可以猜测这是 wxapp 源码加载的相关代码，通过该关键词反编译微信定位到加载 js 代码的类:<span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">Lcom/tencent/mm/plugin/appbrand/appcache/ai;</span><br>分析代码可知该类下的 <span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: normal;">public static String a(e eVar, String str)</span> 方法返回的就是js源码，把返回字串 dump 下来得到 "跳一跳" 核心源码 game.js。</span></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(0, 81, 171);font-size: 18px;"><strong><span style="color: rgb(0, 81, 171);letter-spacing: 2px;">0x04 实现作弊功能</span></strong></span><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br><br>有了源码,就可以根据上传分数的相关代码模拟上报分数了：<span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;"><br></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;"><br></span></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;">{<br>&nbsp;&nbsp;&nbsp; key: "requestSettlement",<br>&nbsp;&nbsp;&nbsp; value: function() {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var t = arguments.length &gt; 0 &amp;&amp; void 0 !== arguments[0] ? arguments[0] : 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; e = arguments.length &gt; 1 &amp;&amp; void 0 !== arguments[1] ? arguments[1] : 0,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i = arguments.length &gt; 2 &amp;&amp; void 0 !== arguments[2] ? arguments[2] : function() {},<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; n = arguments.length &gt; 3 &amp;&amp; void 0 !== arguments[3] ? arguments[3] : {};<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (a.default.sessionId) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var r = {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; score: t,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; times: e,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; game_data: JSON.stringify(n)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; o = {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; base_req: {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; session_id: a.default.sessionId,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fast: 1<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; action_data: (0, s.encrypt)(r, a.default.sessionId)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wx.request({<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; url:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; h.AJAX_URL + "/wxagame/wxagame_settlement",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; method: "POST",<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; data: o,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; success: function(t) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i(200 === t.statusCode ? 0 === t.data.base_resp.errcode ? !0 : !1 : !1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fail: function(t) {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i(!1)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; })<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } else i(!1)<br>&nbsp;&nbsp;&nbsp; }<br>},</span><br></span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">加密部分：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;">e.encrypt = function(t, e) {<br>&nbsp;&nbsp;&nbsp; var e = e.slice(0, 16),<br>&nbsp;&nbsp;&nbsp; i = n.default.enc.Utf8.parse(e),<br>&nbsp;&nbsp;&nbsp; r = n.default.enc.Utf8.parse(e),<br>&nbsp;&nbsp;&nbsp; a = t;<br>&nbsp;&nbsp;&nbsp; a = JSON.stringify(a);<br>&nbsp;&nbsp;&nbsp; var o = n.default.AES.encrypt(a, i, {<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; iv: r,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mode: n.default.mode.CBC,<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; padding: n.default.pad.Pkcs7<br>&nbsp;&nbsp;&nbsp; });<br>&nbsp;&nbsp;&nbsp; return o = o.toString()<br>};</span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">既然源码在手，直接修改源码就可以实现作弊功能了。实现的方法是修改 3 中的 js 源码载入函数的返回字符串,替换相应 js 代码。<br>比如修改每次跳跃加分 32，把 "this.score+=t" 替换成 "this.score+=32" 等等。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 18px;"><strong>0x05 基于触动精灵来实现</strong></span><br></span></p><hr><p style="margin-left: 8px;margin-right: 8px;"><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">想到了下面的识别办法：</span><br></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">1. 逐行进行扫描来识别要跳转的目标坐标。为了提高效率可以适当增加扫描步进。定义一个矩形区域，要跳转的目标相对来说位置都比较固定。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">2. 获取小人的位置，通过触动精灵的查找颜色功能进行定位坐标，虽然有一定误差，但是只要能获取到坐标，用来计算还是基本没问题的。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">3. 计算跳跃距离，通过直接三角形的勾股定理进行计算。按压时间需要根据距离进行修正，我在小米 5s上测试用的1.3 基本还算可以。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 16px;"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;color: rgb(0, 81, 171);font-size: 16px;"><strong>已知问题</strong></span>：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">1. 通过触动精灵进行颜色匹配搜索坐标的做法效率较低，需要比较长的时间。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">2. 运行一段时间之后，找色函数和获取小人坐标的函数会发生错误，导致无法获取到真正的坐标。我加了几个判断，出现问题的时候直接重新启动脚本就可以了。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">3. 由于是基于颜色进行匹配的，因而相对来时识别的坐标的准确度比上面的python版本要低很多。<br></span></p><p style="margin-left: 8px;margin-right: 8px;"><br><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;font-size: 16px;color: rgb(0, 81, 171);"><strong><br></strong></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="letter-spacing: 2px;font-size: 16px;color: rgb(0, 81, 171);"><strong>改进方式</strong></span>：</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">1. 针对搜索坐标的函数进行匹配，折半查找，如果小人在左侧，直接搜索右侧。如果小人在右侧直接搜索左侧。</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">2. 匹配到错误之后直接重启脚本，使用触动精灵的循环运行功能</span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;">3. 其他未知的功能修改？我也不知道有啥。哈哈<br><br>脚本文件：<span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;"><br></span></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;"><br></span></span></p><blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><span style="color: rgb(79, 79, 79);letter-spacing: normal;font-size: 12px;">require "TSLib"<br>require("math")<br>-----------------------------------------------<br>-- Auto jump scripy<br>-- Code by obaby<br>-- http://www.h4ck.org.cn<br>-- Findu App http://findu.co<br>-----------------------------------------------<br>&nbsp;<br>-- define scan zone with (x1,y1) (x2,y2)<br>scanZone_x1 = 50;<br>scanZone_y1 = 600;<br>scanZone_x2 = 1000;<br>scanZone_y2 = 922;<br>&nbsp;<br>&nbsp;<br>-- get the target object position<br>function getDestXY()<br>&nbsp;&nbsp; &nbsp;-- body<br>&nbsp;&nbsp; &nbsp;mSleep(1000);<br>&nbsp;&nbsp; &nbsp;isfound = 0;<br>&nbsp;&nbsp; &nbsp;dest_x = 0;<br>&nbsp;&nbsp; &nbsp;dest_y = 0;<br>&nbsp;&nbsp; &nbsp;for y = scanZone_y1,scanZone_x2,30 do<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;for x =scanZone_x1,scanZone_x2,30 do<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;colorb = getColor(x, y)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;colorc = getColor(x-30, y)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;colord = getColor(x+50, y)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;delta = math.abs(colorb -colorc)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;delta2 = math.abs(colord - colorb)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--toast(delta.." :x:"..x.." :y:"..y,1)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--mSleep(100)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if delta &gt;1000 then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--toast(delta.." :x:"..x.." :y:"..y,1)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;nLog("COLO TO::ColorB:"..colorb.." ColorC:"..colorc);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;isfound = 1;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dest_x = x;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;dest_y = y;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--mSleep(5000);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;end<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--dialog("ColorB:"..colorb.."ColorC:"..colorc, 3);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--mSleep(3000)<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--x= x+10<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;end<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;--y= y+10<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;if isfound ==1 then<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;end<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;&nbsp; &nbsp;return dest_x, dest_y<br>end<br>&nbsp;<br>-- get the <br>function getDistance(dest_x, dest_y)<br>&nbsp;&nbsp; &nbsp;-- body<br>&nbsp;&nbsp; &nbsp;--mSleep(1000);<br>&nbsp;&nbsp; &nbsp;x, y = findColorInRegionFuzzy( 0x39375f , 80, 0, 926, 1070, 1370); <br>&nbsp;&nbsp; &nbsp;if x == -1 then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;x, y = findColorInRegionFuzzy( 0x39375f , 70, 0, 926, 1070, 1370); <br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;&nbsp; &nbsp;if x == -1 then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;x, y = findColorInRegionFuzzy( 0x39375f , 80, 0, 926, 1070, 1370); <br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;&nbsp; &nbsp;if x ==-1 then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return 0;<br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;nLog("JUMP FR::src_x:"..x.." src_y:"..y);<br>&nbsp;&nbsp; &nbsp;distance = math.sqrt(math.pow(dest_x - x,2) + math.pow(dest_y-y,2));<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;if math.abs(dest_y - y) &lt; (1116-940) then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;return (1116-940)*1.4;<br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;return distance;<br>end<br>&nbsp;<br>&nbsp;<br>while (true) do<br>&nbsp;&nbsp; &nbsp;-- body<br>&nbsp;&nbsp; &nbsp;if (isColor( 581, 1626, 0xffffff, 85) and&nbsp; isColor( 558, 1714, 0x262628, 85)) then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;<br>&nbsp;&nbsp; &nbsp;end<br>&nbsp;<br>&nbsp;&nbsp; &nbsp;dest_x , dest_y = getDestXY();<br>&nbsp;&nbsp; &nbsp;dist = getDistance(dest_x,dest_y);<br>&nbsp;&nbsp; &nbsp;toast("dest_x:"..dest_x.." dest_y:"..dest_y.." distance:"..math.floor(dist),3);<br>&nbsp;&nbsp; &nbsp;--toast(dist,1)<br>&nbsp;&nbsp; &nbsp;--can not get dest position or can not get the source position<br>&nbsp;&nbsp; &nbsp;nLog("JUMP TO::dst_x:"..dest_x.." dst_y:"..dest_y.." distance:"..math.floor(dist));<br>&nbsp;&nbsp; &nbsp;if dest_x ==scanZone_x1 or dist == 0 or dest_y == scanZone_y1 or dest_x ==scanZone_x2 then<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;toast("Get posison error",1);<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;nLog("ERRO ER:: Get position error")<br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;break;<br>&nbsp;&nbsp; &nbsp;end <br>&nbsp;<br>&nbsp;&nbsp; &nbsp;touchDown(dest_x, dest_y);<br>&nbsp;&nbsp; &nbsp;mSleep(dist*1.3);<br>&nbsp;&nbsp; &nbsp;touchUp(dest_x, dest_y);<br>&nbsp;<br>end</span><br></span></p></blockquote><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></p><p style="text-align: center;"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8F81pyvePpbYZhWjaSUJeD6RuF1w11bReqibhNNEiaic3gKIW83mZ4vjmrR5CqwDZ4XLldleFA8Jtpibw/0?wx_fmt=jpeg" style="width: 518px !important; height: 734px !important;"></p><p><br></p><section label="Copyright © 2014 playhudong All Rights Reserved." style="max-width: 100%;color: rgb(62, 62, 62);"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8G9B6YFlthnv1h3cWDDXGAmK9wQfy6pod114tTuOSIFVeVd0vd1PEwicksgBGmxL0iaC0icX7B9EQzNg/?wx_fmt=png" style="margin-right: auto; margin-left: auto; display: block; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 160px !important; height: 8.44575px !important;"></section><p><br></p><p style="max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">本文由看雪论坛<span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"> 洪荒之力&amp;obaby<span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"> 原创<span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"></span></span></span></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">转载请注明来自看雪社区</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">热门阅读</span></p><p><br></p><ul class="list-paddingleft-2" style=""><li><p style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458287349&amp;idx=1&amp;sn=0763551bb2121d1aa1200a46c2483d09&amp;chksm=b1814c7f86f6c5690de4c83aa499c85bcc36f5177bf707fdffc6d43a845d4a5bed67d587cb9c&amp;scene=21#wechat_redirect" target="_blank">曝出 CPU 严重设计缺陷后，Intel 如坐针毡</a></span></p></li><li><p style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458287240&amp;idx=1&amp;sn=f7db38a5286f6b1c9ed96f4a36c876ea&amp;chksm=b1814c0286f6c514dc4540f2149751892da23a7a379ffd1e844cfc883ecaea49d1a5dada32fb&amp;scene=21#wechat_redirect" target="_blank">zbot变种木马wsnpoem脱壳笔记 part1</a></span></p></li><li><p style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458287237&amp;idx=1&amp;sn=e5aca1f271ee7f264bc96be3fc12c7b4&amp;chksm=b1814c0f86f6c51951fc2dff2aeb882d0dfc05beed0fb4af7c6c73d9be1f7d634a0b31f0b9c5&amp;scene=21#wechat_redirect" target="_blank">CVE-2017-11826在RTF文档中被利用</a></span></p></li><li><p style="margin-top: 10px;margin-bottom: 10px;max-width: 100%;min-height: 1em;line-height: 2em;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;color: rgb(63, 63, 63);font-size: 14px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458287274&amp;idx=1&amp;sn=20e615a344fdfbd636e2c766594d61f4&amp;chksm=b1814c2086f6c53643a4e583807dbebdc7edd5bbe7c42e1c0a0bdc2993eb39e880cd92a07064&amp;scene=21#wechat_redirect" target="_blank">Windows内存放血篇 | 突破物理内存的CopyOnWrite</a></span></p></li></ul><p style="margin: 15px 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span><br></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">点击阅读原文/read，</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;">更多干货等着你~</span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><span style="max-width: 100%;font-size: 15px;color: rgb(63, 63, 63);letter-spacing: 1px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"></span></p><p style="margin-right: 8px;margin-left: 8px;max-width: 100%;min-height: 1em;color: rgb(62, 62, 62);text-align: center;"><img src="https://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8HTpGlibXdQ4YIynJnSjWwOjSroH8JkP00Cpl0TvGwSCibJpPmSmcartSbQUfodq49ulaLk1Yicrem3A/?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 542px !important; height: 136.065px !important;"></p><p style="margin-left: 8px;margin-right: 8px;"><span style="font-size: 15px;color: rgb(79, 79, 79);letter-spacing: 2px;"><br></span><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1515984875&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siPPs-NRfvlwjuvH7xFTtLmsOPyUEuRfepE4lmADgDB-KqTGJpoTQDDroKcwkYhW3KZLGf0-3ds5TwjXn2Cn3w2nSe3UJSMdEd-EVWEQYo2DTv-sSgMknUSo58jDDgU5uy01kF*WiVc3fGbfU15m2edU=">微信地址</a> | <a href="https://bbs.pediy.com/thread-223677.htm">阅读原文</a>
{% endraw  %}

