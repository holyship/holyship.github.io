---
title: 娱乐War3 随机函数 GetRandomInt 懒人利用法
author: noNumber
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1498051979&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQyx1hdTxM6K*VNtcxOeUN354nW26WI5lTIy9FI3*gxCaEHwjjiMY16zPEkDRPZ*5EDahRkV9Y0RvDlydxvDRIoqXaAA-0vMfJrd5mr24g6pdPHEHDKLQ-wU7jnRJ-vM9AvESQS2I8t-dC6OCbJ7IrWs=
date: '2017-06-19 00:00:00 +0000'

---

{% raw  %}
<p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">眼睛一闭一睁，接触逆向6年过去了，技术一点没有长进，主要突出一个『<span style="font-size: 15px;"><span style="font-size: 15px; color: rgb(255, 0, 0);"><strong>懒</strong></span></span>』字。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">不是什么高难技术，纯属分享。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">起因最近被带动玩一款叫做“宠物小精灵防御战” 的 war3地图， 每个玩家“抓”精灵进行PK的游戏。&nbsp;</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">那么这里问题就来了， 抓精灵是有概率的，这就很气，很皮，似乎很大程度结果都要向运气看齐，说到这里不由想起了十连跑(小精灵逃跑)的悲伤。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">于是我就想，抓精灵的概率是否和本地时间有关?还是和游戏时间有关？ 不过这么猜那就对不起自己码农的身份了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">使用解包工具打开魔兽地图，提取出 JASS 脚本文件， 观察定位看到抓精灵的概率&nbsp;GetRandomInt(1,'d')&gt;=50 / 随机1到100的数据 大于XX时怎么怎么，就是你了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">那么魔兽的&nbsp;GetRandomInt 是怎么随机呢， 种子怎么生成，算法是什么样， 应该做一个HOOK吗，搞个DLL注入还是搞个远程调用，好像问题很多。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">先从逆向说起， 通过百度得知&nbsp;GetRandomInt 函数在 game.dll 文件内， 定位到后如下：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GhQcBREyuTnyNB7wK7ntC7EFlqK9eQv7NiaEewxPn5gfggNoecdL0icQgmib4MM8DVwDY8Qk1Pcaouw/0?wx_fmt=jpeg" style="width: 725px !important; height: 449px !important; visibility: visible !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">进入到关键算法，准备提取算法</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8GhQcBREyuTnyNB7wK7ntC7GjUoYa43RwPH7sPys9pSG71HicnqKrr7ibwq7HlULo3muhXEpjNo7wtA/0?wx_fmt=jpeg" style="width: 764px !important; height: 442px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">突然看到 程序使用了一块固定数据 参与计算， 要把这段数据复制出来再搞来搞去编程什么的，太麻烦了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">目前已知的信息，&nbsp;GetRandomInt 参数为两个数字， 其中种子保存在固定位置，且每次执行GetRandomInt后，种子会相应的变化，</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">那么，写个新程序加载game.dll ，通过搜索特征码也好，硬编码也好定位函数地址，从war3.exe内存中读取种子数据并写入自己的模块内，直接本进程调用GetRandomInt即可知道</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">war3下次执行GetRandomInt时的结果，从而知道，什么时候能抓到精灵，什么时候抓不到。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">开始编写程序，找到war3窗口，打开进程，得到模块地址，搜索到GetRandomInt地址， +$28 得到种子地址指针 ， 同时自身加载 game.dll 并找到各地址。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">然后每当需要时就读取远程内存并计算下一次随机数。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">贴个简单的关键代码</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">/////////////////////////////////////////////////////////////////////////////</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GhQcBREyuTnyNB7wK7ntC72YGZDdTuVWUe4kOn5zNHhbljYu4iaibVJ9RTFTf1xlCZoRSTSy3EFXdQ/0?wx_fmt=png" style="width: 592px !important; height: 436px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">/////////////////////////////////////////////////////////////////////////</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">同步调试后，每次运算结果与war3相同。 立刻上线对战平台测试，什么稀有神兽想抓就抓，爽，艹翻一切。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8GhQcBREyuTnyNB7wK7ntC7K6Mic1ctvNt9wemx0X3jJyeQmncWGbc29zaheF5bmX2fI5hWeoemrjA/0?wx_fmt=png" style="width: 770px !important; height: 330.458px !important;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">每次GetRandomInt的数字越小，说明越容易抓到，稀有的50以下， 半神兽15以下， 神兽5以下， 每个玩家抓精灵时都会调用GetRandomInt，观察好数字决定自己抓精灵的时机就可以了，</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我感觉我在这个游戏无敌了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">对了，去年还有个病毒利用魔兽jass漏洞，只要玩了后门地图就会在启动文件夹建立一个批处理文件， 批处理下载一个程序运行并感染用户的所有war3地图实现传播，太厉害了。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">后记：&nbsp;GetRandomInt 应该可以利用得更多， 比如 Dota Imba 每个玩家开场获得一个宝箱，宝箱开出的东西是随机的，开到好东西决定了一个好的开局甚至碾压， 如果分析一下对应地图的jass文件，应该可以控制到想开什么开什么。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(136, 136, 136);">本文由看雪论坛 noNumber 原创，转载请注明来源：转自看雪论坛</span><span style="font-size: 15px;"><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; text-align: center; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; color: rgb(255, 104, 39); box-sizing: border-box !important; overflow-wrap: break-word !important;">如果你喜欢的话，不要忘记点个赞哦！</span><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">热门阅读文章：<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">看雪 CTF 2017 攻击篇 6月强势来袭！</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283175&amp;idx=1&amp;sn=c799c0b1773dea71c74457c446cb2c59&amp;chksm=b1815c2d86f6d53b6e6722395e4d3d4cfdd2af00131e0462b3a19767bf4e271dd8ead5c8e35b&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">选择看雪企业 SRC 的 5 大理由</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283585&amp;idx=3&amp;sn=a7dc01fb0dca60054a4cd8aba4f3e9a8&amp;chksm=b1815ecb86f6d7ddbe2fb1f42592fe3c27aa814cf1e7fd1695e524af437f781ec48cd27efadd&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">黑掉SQL Server数据库链接：实验的设置和攻击指南</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283372&amp;idx=2&amp;sn=667897f27a1a4327164e179f7efd70ac&amp;chksm=b1815de686f6d4f0e42672beece10320af227b03091fc2b746d2bcee7b749502a33153b21aed&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">SQL注入新手教程（第一部分）2</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283363&amp;idx=1&amp;sn=ab837d12482aa4092204664301720b31&amp;chksm=b1815de986f6d4fff83647e7ff6d85bc3c31ff58384fbdf5c43ec2b9ab35ba1dc657a8076119&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">SQL注入新手教程（第一部分）1</a></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8E4ItLe4LX3YbLUffeV86icpcBApdQiakmEMuy4q8mVAaBjA0P1wez6NzO52zvKNlQQQ4siaztZDYhBg/640?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: 426px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><p style="text-align: center;"><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1498051979&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQyx1hdTxM6K*VNtcxOeUN354nW26WI5lTIy9FI3*gxCaEHwjjiMY16zPEkDRPZ*5EDahRkV9Y0RvDlydxvDRIoqXaAA-0vMfJrd5mr24g6pdPHEHDKLQ-wU7jnRJ-vM9AvESQS2I8t-dC6OCbJ7IrWs=">微信地址</a> | <a href="http://bbs.pediy.com/thread-218306.htm">阅读原文</a>
{% endraw  %}

