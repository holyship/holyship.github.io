---
title: frame busting 各种姿势，防护总结（一）
author: wangrin
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1497276357&src=3&ver=1&signature=aHg31JU*BGTH2xoiR2ftYl-Za4Tj4F9-ES3676R*Lz9d4Q2l*LGr82CxAl3XSPMV3mvK5fPXVrwmme1QdzvmJSiS3PhrlioiNPbM9ClfYuj4vVEF58x4CikhLRDEDfP884op6k6Tp5zQDkRxyth6q96Ww3pGTmBgFVaWf5RC6OU=
date: '2017-06-08 00:00:00 +0000'

---

{% raw  %}
<section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">00</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">摘要</p></section></section></section><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br><span style="font-size: 15px;"></span></h1><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Web 框架攻击例如使用 iframe 来劫持用户的 Web 会话。最常见的防御措施，成为framebusting，防止一个网站从功能上载入一个 frame 框架，我们研究了 Alexa Top-500 网站的 framebusting 实例，显示所有这些都可以以某种方式而绕过，一些绕过是由浏览器指定的，而其他的是跨浏览器工作的。由此我们建议使用适当的 framebusting。</span></h1><p style="line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">01</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">介绍</p></section></section></section><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h1><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Framebusing 是由旨在防止网页加载到 sub_frame 中的网页自带的代码或者注释。 Framebusing 推荐用来防御点击劫持攻击也推荐应用与基于图像的安全认证如雅虎的登陆密码。登陆密码显示用户所选择的图像用于向用户验证雅虎的登陆界面。没有使用framebusting的话，即使顶部的界面并不是真正的雅虎登陆界面，登陆界面还是能够被加载到子框架中以便正确的图像能够显示给用户。新的高级点击劫持技术使用drag-and-drop 从框架中提取和注入数据进一步显示了 framebusting 的重要性。</span></h2><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7klVxXicSXPjHCVdb0ncCO0jK8BqZx7beg5BLdUsMFKrBx43KoQqTV2Tw/0?wx_fmt=png" style="width: 355px !important; height: 191px !important; visibility: visible !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">figure1&nbsp;&nbsp;&nbsp; 一个可视化的针对推特的账户删除界面的点击劫持攻击</span></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">图一展示了一个点击劫持攻击：受害站点被嵌入到一个看起来正常页面的 iframe 上，当用户和正常界面进行交互的时候他们回无意的与受害站点进行交互。为了防御点击劫持攻击，下面这段常用的网站代码展示了简单的 framebusting 技术：</span></h2><blockquote><h2 style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp; i f ( top.location != location )</span></h2><h2 style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; top.location=self.location</span></h2></blockquote><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">frame busting 代码通常由条件申明和首页导航到正确位置的反作用组成，我们将会看到，这个基本代码相当容易绕过。我们会在论文后面谈论更为复杂的framebusting（及其规避技术）。</span></h2><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们的工作：我们首先对 alex-top500 的网站使用的 framebusting 代码进行调查，这些调查包括了银行，社交网络，电子商务，交易和游戏等领域。我们还对所有的美国顶尖的银行进行调查，因为这些都是明显的高风险的劫持目标。第二部分介绍了我们用来定位和提取 framebusting 代码的半自动化工具。结果显示平均使用了 3.5 行 javascript 代码，而最庞大的应用代码使用了25行。大多数的 framebusting 代码被构造成测试框架的条件块，然后检测框架的反作用。</span></h2><table cellspacing="0" cellpadding="0"><tbody><tr><td style="border-width: 1px; border-style: solid; border-color: windowtext; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px 7px;" width="101"><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">% of web site</span></p></td><td style="border-width: medium medium 1px; border-style: none none solid; border-color: currentcolor currentcolor windowtext; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none;" width="101"><br></td></tr><tr><td style="border-width: medium 1px 1px; border-style: none solid solid; border-color: currentcolor windowtext windowtext; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; padding: 0px 7px;" width="101"><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Top 500 <br> &nbsp;Top 100 <br> &nbsp;Top 10 </span></p></td><td style="border-width: medium 1px 1px medium; border-style: none solid solid none; border-color: currentcolor windowtext windowtext currentcolor; padding: 0px 7px;" width="101"><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">14%<br> &nbsp;37%<br> &nbsp;60%</span></p></td></tr></tbody></table><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">表1: Frame busting 在Alexa-Top 站点的使用率</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">大多数的顶部导航都指向正确的网页，少数会通过 document.write(‘‘) 来清除框架内容，有些使用外来条件和反动作。我们将在下部分描述我们我找到的 framebusting 代码。表1总结了 top500 网站上的 framebusting 的情况。明显的 framebusting 远不是普遍存在，这表明劫持攻击仍然被主要网站忽视。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">本文组织方式如下：第二部分描述了我们做的调查，第三部分我们转向对 framebusting 代码攻击的一些探讨，我们将会演示在现今的代码在主流浏览器中都能被绕过。我们会同时演示新旧两种技术。在第四部分我们会讨论针对特定网站如社交网络或零售站点的对外部 framebusting 的攻击。第五部分我们讨论了更安全的framebusting策略，同时讨论在基于 X-FRAME-OPTIONS 头部的 framebusting 的备用方法。从我们的调查来看只有三个站点使用这个字段，其他所有的 framebusting 都是基于javascript。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">02</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">对 framebusting 的调查<br></p></section></section></section><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一些 top500 站点有大量的内联或者动态加载的 javascript 代码。手工过滤这些代码来找到 framebusting 代码段非常困难，更不必说大多数站点使用的 javascript 混淆和主要源代码打包技术。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">为了定位 framebusting 代码我们使用了一个陈祚 HTMLUnit 的基于 java 的浏览器仿真器。作为一个无头部仿真器他可以用来做受限的 javascript 调试。这样给了我们动态框架页面同时中断在真正的 framebusting 代码上。尽管这款工具帮了大忙，一些人工的反混淆和追踪打包代码还是需要我们来做。在 top500 网站中，许多网站没有在主页上使用 framebusting。相反的他们实施在登陆和密码重置的页面使用了 framebusting。一些人工工作还需要去定位一些部署了 framebusting 的子页面。</span></p><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><strong><span style="font-size: 16px;">流行的 framebusting 代码</span></strong></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在我们的调查重大多数站点使用的 framebusting 代码，如表 2 和 3，一些站点部署了多重的反动作和条件作为备份。五个这站点额外地依靠 document.referer() 来测试是否框架化，更多的外部 framebustingcode 将会在第四部分讨论。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">03</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">一般攻击<br></p></section></section></section><h1 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h1><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在讨论更急奇异的 framebusting 代码之前，我们首先讨论大量的攻击方法，如表2和3 所示，在这部分最后我们在表4之中给出这类攻击的总结。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Common framebusting code</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kMupnic7WSwJ3k1uGibH6YWG69IfFB95SEnXp69sIZYCeOJUSh9ktGgIw/0?wx_fmt=png" style="width: 770px !important; height: 247.434px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><span style="font-size: 15px;">Table 2: Frame busting conditional statement</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kAIlqREE6xQu8em5tFU6BiaDtm7kq2PmSH13ucibiaNco24GOqfqKhCY7w/0?wx_fmt=png" style="width: 436px !important; height: 336px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><span style="font-size: 15px;">Table 3: Counter-action statement</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kysM8klbxQyrZFicMjwNhdicrfYdYicdiaB3fibeaOMA2S0DBbKY94BofRXw/0?wx_fmt=png" style="width: 409px !important; height: 394px !important;"><span style="font-size: 15px;"><br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">Figure 2:Double Framing Attack</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.1</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">双框架<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">在表 3 中一些计数动作通过给 parent.location 赋值来导向正确的页面，如果受害站点是单页面框架的国华这个方法工作分很好，然而，我们发现攻击者如果将目标双框架化，由此 parent.location 就变成了所有流行浏览器的一个安全违例，因为底部框架的导航策略是由我们定义且应用的。安全违例禁用了计数动作导航。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">例子：受害站点的 framebusting 代码：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">If(top.location!= self.location){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">Parent.location=self.location;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">攻击者顶部框架</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">&lt;iframesrc=”attacker2.html”&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 攻击者子框架</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;iframesrc=”http://www.victim.com”&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></p></blockquote><p><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.2</p></section>&nbsp;onBeforeUnload 事件<br></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><br><span style="font-size: 15px;"></span></h2><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">用户何以手动取消由框架页面提交的导航请求。为了利用这个页面，可注册一个由于导航无论何时都不会被框架页面加载的 onBeforeUnload 句柄。句柄返回一个回显给用户的字符串，假设攻击者框架 paypal，他注册一个不加载的句柄函数赖回显一个字符串：do you want to exit paypal？当这个字符串回显给用户的时候，用户极有可能退出导航，这样久挫败了 paypal 的 framebusting 代码。</span></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">攻击者通过在顶部页面使用以下代码来注册一个不被加载的函数来发动攻击</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">&lt;script&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">window . onbeforeunload = function(){<br>return " Asking the user n i c e l y " ;<br>}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;/script &gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;iframe src=" http :/ /www. paypal. com"&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">paypal 的 framebusting 代码将会生成一个 BeforeUnload 事件激活我们的函数并且促使用户取消导航。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.3</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">OnBeforeUnload -204 冲刷<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">虽然以前的攻击要求用户的交互但是同样的攻击必在需要了。大多数浏览器(IE7, IE8,<br>Google Chrome, and Firefox)能够使攻击者通过多次提交收到 204-无内容响应的请求自动地在一个 OnBeforeUnload 的句柄事件取消到来的导航请求。导向一个无内容站点是一个 NOP，但会冲刷请求管道，于此取消原始的导航请求。这里有一段实现代码</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">var prevent bust = 0<br>window . onbeforeunload =<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; function(){kill_bust++}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">setInerval(function()){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(kill_bust&gt; 0 ){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;kill_bust -=2;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;window.top.location=’http:no_content_204,com’</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">},1);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;iframe src=http://victim.com&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kBkM83oJicRW6tt2eWfbTelmzDMtETYibzxlzbUXiaaIuOiaic5mSN0cuicJw/0?wx_fmt=png" style="width: 408px !important; height: 236px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">Figure 3:Asking Nicely</span></p><p style="margin-top: 15px; margin-bottom: 15px; text-align: center; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.4</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">利用 XSS 过滤器<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">IE8 和 chrome 引入了反射性 XSS 过滤器来保护 web 页面存在的各种 XSS 漏洞，Nava和 Lindsay 发现这些过滤器可被用来绕过 framebusting 代码。</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h3 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong>IE8</strong></span></h3></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">IE8 的 XSS 过滤器将请求参数和一系列的正则表达式对比来识别明显的跨站脚本。使用“includeing false positives”，过滤器可被用来禁用选定的脚本。通过对比请求参数中的任意脚的开始标签，XSS 过滤器将禁用所有页面内嵌脚本，包括 framebusting 脚本。外部脚本也可作目标当外部匹配包含进来的时候，这样有效的禁用了所有外部脚本。自从 js 的加载块子部分能够函数化（内嵌或者外部的）和 cookie 可获取，这种方式对点击劫持攻击来说很是有效。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">示例：受害站点 framebusting 代码</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">&lt;script&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If(top!= self){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Top.location= self.location;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;/script&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><strong><span style="font-size: 15px;">攻击者</span></strong></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">&lt;iframe scr=</span></p><p style="line-height: normal;"><span style="font-size: 14px;">“http://www.victim.com/?v=&lt;script&gt;if”&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">XSS 过滤器会把 &lt;script&gt;if 与站点内的 framebusting 代码的起始处匹配，接着会禁用受害站点的所有内嵌代码，包括 framebusting 代码。</span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h3 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong>Googlechrome</strong></span></h3></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">内置与 chrome 的 XSS 审计器给了攻击者选择性的禁止特定代码块的能力。通过匹配所有指定的内嵌脚本，XSS 审计器会禁用掉它。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这使框架页面特定的指向包含 framebusting 代码的代码块。XSS 审计器也可用来攻击外部脚本，但过滤器只会禁用从不同来源加载的特定脚本</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">示例：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;">&nbsp; If(top!= self){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Top.location= self.location;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">攻击者</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;">&nbsp; &lt;iframesrc:”http://www.victim.com/?v=if(top+!%3D+self)+%7B+top.location%3Dself.location%3b+%7D”&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这里看到 chrome XSS 过滤器将会禁用 framebusting 脚本，但会离开页面操作的所有其他脚本。从结果来看，框架化的页面将会功能正确，并且此类攻击在 chrome 上会比 IE8 上面更为有效。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.5</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">referrer 检查问题<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一些站点允许它们的页面在本站上被框架。这通常使用检查 document.referrer 来实现，但是这样通常都会被不正确地使用。我们给出调查当中的一些例子。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">示例1：考虑下面一段来自大型零售商的代码</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">If( top.location !=location){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; If(document.referrer&amp;&amp; document.referrer.indexOf</span></p><p style="line-height: normal;"><span style="font-size: 14px;">(“walmat.com”)== -1){</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Top.location.replace</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; (document..location.href);</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">这个页面能够被拥有 walmart.com.badgy.com 域名的的攻击者框架化</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">示例 2：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">如果正则表达式是错误的，这样的匹配可能是灾难性的。请看 NYtimes 的以下代码：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 14px;"> If(window.self != window.top &amp;&amp;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; !document.referrer.match(</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /https?: n/ n/[^? n/]+ n. nytimes n.comn// ))</span></p><p style="line-height: normal;"><span style="font-size: 14px;">{top.location.replace (</span></p><p style="line-height: normal;"><span style="font-size: 14px;">windowlocation.pathname );</span></p><p style="line-height: normal;"><span style="font-size: 14px;">}</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">由于正则表达式没有要求 URL 的开头，所以在 URL 中的任何匹配https：//www.nytimes.com/将允许被框架。攻击者所要做的就是将tps://www.nytimes.com 加入到 url 参数集里就可以达到如图四所示的框架的效果。</span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kqcjTONsFUJdBh8CQibuJ8kTqNP7fiaFGv6zNpxkjPhqnXGib6d540pyWQ/0?wx_fmt=png" style="width: 408px !important; height: 399px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px;">Figure 4:Result of referrer checking attack<br></span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">需要注意的一点事referrer头部不会将https的流量转给http而是会被忽略掉。上述示例中，一个丢失的referrer可能导致错误的动作发生，因此，为了“frame&nbsp; frendly”限制无用的referre 头部的使用。</span></p><h3 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong>Referre and&nbsp;double&nbsp; framing</strong></span></h3><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">如果一个站点没有使用 framebusting 技术的话，允许特定站点框架话将会允许间接框架内容。一个有力的实例是 myspace，它允许谷歌图片来框架内容，谷歌图片搜索不会做任何的 framebusting 工作，它的深度的搜索机制被认为是开放重定向或者开放框架重定向。为了能够使用谷歌图片来框架 myspace 内容，攻击者只需要简单地在子框架下搜索想要的内容。这种双框架允许任何第三方实体来框架内容。有大量的在搜索框中隐藏不希望被看到内容的方法，包括翻滚和安放顶部元素。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.6</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">重写top.location</p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一些线代浏览器将 location 变量当作一个不变的属性然而，在 IE7 和 safari4.0.4 中 location 变量能够被重定义。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/1UG7KPNHN8Gh76zeezTU6kjrdB7KPR7kdFwdSmJxSeFbvF0QIakYZh2KD4LcxYFeiboTcqqVOdxHHLp6Eucfh6Q/0?wx_fmt=png" style="width: 756px !important; height: 219px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span><span style="font-size: 15px;">Table 4:Summary of attacks and affected browsers<br><br></span></p><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h3 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong>IE7&nbsp;&nbsp;&nbsp;</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></h3></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">一旦页面重定义了，位子框架下尝试读取top.location的framebusting代码会通过读取另一域的本地变量而发4生安全违例。相似的，任何想要复制top.location的尝试都将失败。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 示例：受害站点的framebusting代码</span></p><blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 14px;">If(top != self){</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; top.location= self.location;}</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">攻击者：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 15px;">&nbsp;</span><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;script&gt;var location =”clobbered”;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/script&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;iframesrc=”http://victim.com”&gt;&lt;/iframe&gt;</span></p></blockquote><ul style="list-style-type: disc;" class="list-paddingleft-2"><li><h3 style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 16px;"><strong>Safari 4.0.</strong></span></h3></li></ul><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">我们观察到虽然在大多数情况下location变量是定值，但当用户location配置器是通过</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">defineSetter来定义的时候，location对象就会变成未定义的状态。框架页面只需简单地这样做：</span></p><blockquote><p style="line-height: normal;"><span style="font-size: 14px;">&lt;script&gt;</span></p><p style="line-height: normal;"><span style="font-size: 14px;">Window.__defineSetter__(“location”,function(){});</span></p><p style="line-height: normal;"><span style="font-size: 14px;">&lt;/script&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">现在任何试图读取或者导向框架位置的动作都会失效。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.7</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">限制域3<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">多数框架页面的 framebusting 代码都是基于 javascript 的，以此来检测框架和“破环”自身。如果 javascript 在子框架内容中被禁用，framebusting 代码将不会运行。在IE中，受限域加载的内容会禁用 javascript 和 cookie。为了标记一个来自受限域的框架，页面会采用一个带有 security=restricted 的 iframe 标签。在早先的研究中我们了解到这个特性可以用来挫败framebusting代码</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">示例：</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">攻击者：</span></p><blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;iframesrc=”http://victim.com” security=”restricted”&gt;&lt;/iframe&gt;</span></p></blockquote><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">结果就是框架中的 javascript 代码被禁用，导致表二所示 的代码不能运行。对点击劫持来说这个方法很有局限性-因为没有 cookie 在子框架重传送，会话控制变得很困难。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.8</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">沙箱属性<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">最近，浏览器开发商开始以iframe标志新的沙箱属性的形式来标准话IE的限制域特性。这个属性是由HTML5所指定的并且现在应用与chrome浏览器中；可被用来在限制域中禁用javascrip；然而因为在子框架中传送了cookie，攻击者能够凭借此来劫持会话来完成攻击。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.9</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">设计模式<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">Stone 显示在框架页面重设计模式能够被开启（通过document.designMode），而后在顶部子域框架来禁用 javascript。Cookie 再次在子框架重分发，。设计模式已经在firefox和 IE8 中得到应用。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><br></p><section label="Copyright © 2015 playhudong All Rights Reserved." style="border-width: medium; border-color: currentcolor; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; border-style: none; margin: 1em auto; text-align: center; width: 18em;"><section style="display: inline-block; text-align: left; background-color: rgb(229, 229, 229);"><section class="" style="height: 1.8em; min-width: 1em; background-color: rgb(34, 172, 56); font-size: 1.125em; vertical-align: bottom; line-height: 1.8em; text-align: center; padding: 0px 0.5em; color: rgb(255, 255, 255); display: inline-block;"><p class="" style="margin: 0px;">3.10</p></section><section style="border-width: 0.4em 0.5em 0.4em 0px; border-style: solid; border-color: transparent rgb(229, 229, 229) transparent transparent; -moz-border-top-colors: none; -moz-border-right-colors: none; -moz-border-bottom-colors: none; -moz-border-left-colors: none; vertical-align: middle; margin-left: -0.4em; display: inline-block;"></section><section style="height: 1.8em; text-align: center; line-height: 1.8em; font-size: 1.125em; padding: 0px 0.8em 0px 0.5em; vertical-align: middle; display: inline-block;"><p style="margin: 0px;">移动端站点<br></p></section></section></section><h2 style="margin-top: 15px; margin-bottom: 15px; line-height: normal;"><span style="font-size: 15px;"></span><br></h2><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">许多站点都在主页上提供可供选择的移动端界面，使用如m.example.com 或者 mobile.example.com,这些站点转发全部重要的功能子集，这些与他们的真实点击动作相关。</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;">不幸的是许多站点在他们的主域中使用了framebusting技术但是在移动端页面并没有使用这项技术，事实上，在我们的调查中只有一家站点这么做。只有很少的网站实际上由用户代理自动呈现，使我们能够在所有浏览器中构建就像我们常规网站样的移动界面。更严重的问题是，许多站点不区分是否是来自移动端的流量，这就是说，如果你在www.example.com上登陆的话你也同时登陆了mobile.example.com。这就能够使攻击者能够对移动端站点进行点击劫持攻击以此来控制整个站点。</span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);">本文由 看雪翻译小组 wangrin 编译，来源Stanford Web Security Research</span></p><p style="line-height: normal; margin-top: 15px; margin-bottom: 15px; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);"></span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(255, 104, 39);">明日系列2~</span></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em; text-align: center;"><span style="font-size: 15px; color: rgb(255, 104, 39);">如果你喜欢的话，不要忘记点个赞哦！</span><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><br></p><p style="margin-top: 15px; margin-bottom: 15px; line-height: 1.75em;"><span style="font-size: 15px;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(79, 138, 187); box-sizing: border-box !important; overflow-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;">热门阅读文章：<br></strong></span></p><hr style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="list-style-type: circle;"><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283127&amp;idx=1&amp;sn=a456b8495b438499ab68d1a2c32e543c&amp;chksm=b1815cfd86f6d5eb01205cf7c3052d428b2e9105d34523a276bdfb774c7adbbcbd197210f286&amp;scene=21#wechat_redirect" target="_blank">看雪 CTF 2017 攻击篇 6月强势来袭！</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283184&amp;idx=2&amp;sn=32f3a9e70e3504ed2cd68f1c0a2c8f3d&amp;chksm=b1815c3a86f6d52ca5b25dfb1b6d120712007f74f6d57d062881bcbc3b3b9b0ed31232a1c530&amp;scene=21#wechat_redirect" target="_blank">虚拟机逃逸——QEMU的案例分析（二）</a><br></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283175&amp;idx=2&amp;sn=6e8fb6db8c328707308758a8791029b0&amp;chksm=b1815c2d86f6d53b885885136b9b9c0685c72006ff6fe96150e060a6ba56aa8c63651f0daee5&amp;scene=21#wechat_redirect" target="_blank">虚拟机逃逸——QEMU的案例分析（一）</a><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458282703&amp;idx=3&amp;sn=bfa728ff73cd389cd9258ca32008c6e2&amp;chksm=b1815a4586f6d353468f3adf9545aab3ffdce4f4c3e0e47c967298eca045db0558e37865c3a7&amp;scene=21#wechat_redirect" target="_blank" style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283005&amp;idx=2&amp;sn=2fc411b70549c789085e517ef6dfc3e9&amp;chksm=b1815b7786f6d261975cd000d4ddf2c4cffe3cf2d8ab06d870e7971e862c29c7278996bdfb6c&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283017&amp;idx=3&amp;sn=745024d678707b6dcf0cdc94ff5472a5&amp;chksm=b1815c8386f6d59538bfeeb8d3837007f07b0b4d3cd77b439f7856edd391127b6b2f36fb105d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 15px; text-decoration: none;"><span style="font-size: 15px;"></span></a><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283290&amp;idx=3&amp;sn=209c746a4a7748d44fead391622be552&amp;chksm=b1815d9086f6d4863c529c675d6f8949f29274dc58513882958a7a3d786850d5209a94e113ff&amp;scene=21#wechat_redirect" target="_blank">用 Frida 入侵Android App III （一）</a></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NTc2MDYxMw==&amp;mid=2458283303&amp;idx=2&amp;sn=7a20cc7f14b0ea237aa81c6e045c5e64&amp;chksm=b1815dad86f6d4bb64d7f631ee85fbfefae13d652b25a8d79e51f47f499e2dbf24aed1865685&amp;scene=21#wechat_redirect" target="_blank">用Frida入侵Android App III （二）</a><br></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; line-height: normal; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">......<br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p></li></ul><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">更多优秀文章，长按下方二维码，“<span style="max-width: 100%; color: rgb(0, 122, 170);">关注看雪学院公众号</span>”查看！</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/1UG7KPNHN8E4ItLe4LX3YbLUffeV86icpcBApdQiakmEMuy4q8mVAaBjA0P1wez6NzO52zvKNlQQQ4siaztZDYhBg/640?wx_fmt=jpeg" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 140px !important; height: 140px !important;"></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span><span style="max-width: 100%; color: rgb(178, 178, 178); box-sizing: border-box !important; overflow-wrap: break-word !important; font-size: 15px;">看雪论坛：http://bbs.pediy.com/</span><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 14px; box-sizing: border-box !important; overflow-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; overflow-wrap: break-word !important;"></span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微信公众号 ID：ikanxue</span></p><p style="margin-top: 15px; margin-bottom: 15px; max-width: 100%; min-height: 1em; line-height: 1.75em; box-sizing: border-box !important; overflow-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">微博：看雪安全</span></p><p><span style="max-width: 100%; color: rgb(178, 178, 178); font-size: 15px; box-sizing: border-box !important; overflow-wrap: break-word !important;">投稿、合作：www.kanxue.com</span></p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1497276357&src=3&ver=1&signature=aHg31JU*BGTH2xoiR2ftYl-Za4Tj4F9-ES3676R*Lz9d4Q2l*LGr82CxAl3XSPMV3mvK5fPXVrwmme1QdzvmJSiS3PhrlioiNPbM9ClfYuj4vVEF58x4CikhLRDEDfP884op6k6Tp5zQDkRxyth6q96Ww3pGTmBgFVaWf5RC6OU=">微信地址</a> | <a href="http://bbs.pediy.com/thread-217315.htm">阅读原文</a>
{% endraw  %}

