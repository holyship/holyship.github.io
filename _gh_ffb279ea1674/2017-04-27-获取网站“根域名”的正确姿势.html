---
title: 获取网站“根域名”的正确姿势
author: 文蔺
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1493342586&src=3&ver=1&signature=L9XD8GAQyzHEmNm3CARkqe2fEyPlGR*lEB62jDgEnGPx-ZS2mQXLVpA*0Sz09LeJzLYy2OuSPxmmuY*qVipsH7-X8NOLrdBFvUJZl8Vhye27GaxNHussRtNFHT-7-PWhqGGFMCHZwrikPXmYfDuk-fOZtZ*pzYGglmSEFix6nok=
date: '2017-04-27 00:00:00 +0000'

---

{% raw  %}
<p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;"></span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;"></span></p><p><img src="/gh_ffb279ea1674/images/b6e87caabcd9cc2d60ad2e5581ccd7fd590db0b8.gif" style="width: 500px !important; height: 500px !important; visibility: visible !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;"></span><br></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">首先声明，这里所说的“根域名”，并不是指“全球共有13台根逻辑域名服务器”这句话中的“根域名”。而是指某一个站点的“根域名”。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">百度搜索是“www.baidu.com”，百度翻译的域名是“fanyi.baidu.com”，百度地图的域名则是“map.baidu.com”。这些域名有共同的部分“baidu.com”。在本文中，我们将“baidu.com”这样的域名称为“根域名”。前端同学应该都知道，在“.baidu.com”这一域下的 cookie 可以在其他子站点下拿到（当然，前提是端口号和协议都保持一致）。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">最近开发的过程中遇上了一个小问题。无论访问哪个子站点，都要通过 js 将 cookie 存放到根域名下。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">一开始比较大意，直接拿正则匹配。问题是忽略了这世界上还存在“www.xxx.edu.cn”这样的站点。在这种情况下，显然我们不能认为”edu.cn“是根域名。想在一个叫“edu.cn”的域下存 cookie？对不起，浏览器做不到。（这句话很重要。）</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">正则匹配是做不到了。搜索了一下，网上也没有什么特别好的解决方案。无非是枚举出国内常见的一些顶级域名，然后再进行处理，如下面这个 PHP 的例子：</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/a7ac9cf9ba2b1017ff3d71e34e7d410f1cc27ed6.jpeg" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 509.769px !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">但如何确保我们枚举出的例子一定是完全的无遗漏的呢？不完美，放弃。</span></p><h2 style=" margin-bottom: 20px; color: rgb(51, 51, 51); font-size: 18px; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 18px;"><strong>PSL</strong></span></h2><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">接着上 github 上去找例子。倒是发现了一些解决域名的工具。比如一个名为&nbsp;</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">psl</span></a><span style="font-size: 16px;">&nbsp;的仓库。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">PSL</span></a><span style="font-size: 16px;">&nbsp;是 “Public Suffix List” 的缩写，这个“公共域名后缀列表”项目本来是供浏览器厂商使用的。可以访问</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">官网</span></a><span style="font-size: 16px;">，另外建议看看这篇</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">《域名小知识：Public Suffix List》</span></a><span style="font-size: 16px;">。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/bd2147907888c85f549a8996bb95d8f619172549.jpeg" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 224.653px !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">我搜索到的这个 psl 仓库正是基于 PSL、使用 js 来解析域名的。粗略看了下，存放域名的 json 文件有 108 KB。吓死了。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/046a6ad53d4cf15b46afbca188784075f2e5684d.jpeg" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 245.376px !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">另一款叫做&nbsp;</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">parse-domain</span></a><span style="font-size: 16px;">&nbsp;的，光是生成的正则表达式文件就有 203 KB。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/dfa74bd693b8c71c0f2520e48b40fa82ff3a3175.jpeg" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 270.458px !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">没办法，一个跑到浏览器上的前端脚本，本身不到 1500 行，为了一个判断引入上百 KB 的外部依赖，实在不划算。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">于是只能自己另起炉灶，想想别的办法。</span></p><h2 style=" margin-bottom: 20px; color: rgb(51, 51, 51); font-size: 18px; line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 18px;">document.domain</span></strong></h2><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">首先想到的是&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">document.domain</span></code><span style="font-size: 16px;">。在一些需要跨域的场景中，可能会见到这货的身影。比如</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">这篇文章</span></a><span style="font-size: 16px;">&nbsp;所描述的，“相同主域名不同子域名下的页面，可以设置 document.domain 让它们同域”。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">经过测试发现，对于域名</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">c.example.edu.cn</span></code><span style="font-size: 16px;">下的页面，可以执行下面这句：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code class="" style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">document.domain = </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'example.edu.cn'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">;</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">而在 Chrome 下，下面这句则无法执行：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code class="" style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 16px; color: rgb(102, 116, 123);">// DOMException<br></span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">document.domain = </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'edu.cn'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">;</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">浏览器会抛出</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">DOMException</span></code><span style="font-size: 16px;">：</span></p><blockquote style=" margin-bottom: 20px; padding: 10px 6px; quotes: none; background: rgb(229, 229, 229); border-left-width: 10px; border-left-color: rgb(204, 203, 203); color: rgb(99, 99, 101) ; ; ; ; ; "><p style="color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all;"><span style="font-size: 16px;">1 Uncaught DOMException: Failed to set the 'domain' property on 'Document': 'edu.cn' is not a suffix of 'c.example.edu.cn'.</span></p></blockquote><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">IE 也会报出“参数无效”的错误；Firefox 下同样会抛出错误：</span></p><blockquote style=" margin-bottom: 20px; padding: 10px 6px; quotes: none; background: rgb(229, 229, 229); border-left-width: 10px; border-left-color: rgb(204, 203, 203); color: rgb(99, 99, 101) ; ; ; ; ; "><p style="color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all;"><span style="font-size: 16px;">NS_ERROR_DOM_BAD_DOCUMENT_DOMAIN: Illegal document.domain value</span></p></blockquote><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">从报错信息可以看到， DOMException 是可以捕获到的。那就好办了。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">将域名（或页面当前的&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">document.domain</span></code><span style="font-size: 16px;">） split 成数据&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">['x', 'example', 'edu', 'cn']</span></code><span style="font-size: 16px;">，从右向左逐次加上一个元素，每次将单词使用句点连接并赋值给&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">document.domain</span></code><span style="font-size: 16px;">。如果 catch 到错误，则进行下一次操作。一旦赋值成功，即可 break 循环。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">上代码：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code class="" style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> domain = document.domain;<br></span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> list = domain.split(</span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'.'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">);<br>let len = list.length;<br>let rootDomain = domain;<br><br></span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">while</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> (len--) {
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">try</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> {
 &nbsp; &nbsp;document.domain = list.slice(len).join(</span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'.'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">);
 &nbsp; &nbsp;rootDomain = document.domain;
 &nbsp; &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">break</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">;
 &nbsp;} </span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">catch</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> (e) {}<br>}<br> <br></span><span class="" style="font-size: 16px; color: rgb(102, 116, 123);">// 还得恢复原值，避免产生副作用<br></span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">document.domain = domain;<br>console.log(rootDomain);</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">很好，经过简单测试，Chrome、IE 妥妥的。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">然而 Firefox 挂了。挂在最后的还原阶段。也就是说，Firefox 允许修改&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">document.domain</span></code><span style="font-size: 16px;">，但不允许修改成上一级之后，再回退到下一级。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">此外（感谢老大），在 Safari 上测试发现，</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">document.domain = 'cn'</span></code><span style="font-size: 16px;">&nbsp;不会报错！什么鬼？请移步</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">《Webkit下最无敌的跨大域方案》</span></a><span style="font-size: 16px;">。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">功亏一篑。心好累啊。</span></p><h2 style=" margin-bottom: 20px; color: rgb(51, 51, 51); font-size: 18px; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 18px;"><strong>Cookie 救火</strong></span></h2><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">最后想起前面提到的一句，“想在一个叫 edu.cn 的域下存 cookie？对不起，浏览器做不到。”</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">要不咱试试 cookie？动手！</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">道理同上，每次尝试在手动拼接的 domain 下面存 cookie，然后检查 cookie 是否保存成功。一旦成功，则 break 循环，并清除该 cookie。没有副作用，只是多操作几次 cookie。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">换个思路，总算是解决了。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">代码被我放在了&nbsp;</span><a style="color: rgb(37, 136, 151); border-bottom: 1px solid rgb(37, 136, 151); font-size: 16px; text-decoration: underline;"><span style="font-size: 16px;">Github</span></a><span style="font-size: 16px;">&nbsp;上。顺手贴在这里：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code class="" style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> KEY = </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'__rT_dM__'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> + (+</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">new</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 16px; color: rgb(103, 140, 177);">Date</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">());<br></span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> R = </span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">new</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 16px; color: rgb(103, 140, 177);">RegExp</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">(</span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'(^|;)\\s*'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> + KEY + </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'=1'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">);<br></span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> Y1970 = (</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">new</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 16px; color: rgb(103, 140, 177);">Date</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">(</span><span class="" style="font-size: 16px; color: rgb(250, 205, 34);">0</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">)).toUTCString();<br></span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">module</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">.exports = </span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">function</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> getRootDomain() {
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> domain = document.domain || location.hostname;
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> list = domain.split(</span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'.'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">);
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> len = list.length;
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> temp = </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">''</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">;
 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">var</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> temp2 = </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">''</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">;

 &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">while</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> (len--) {
 &nbsp; &nbsp;temp = list.slice(len).join(</span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'.'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">);
 &nbsp; &nbsp;temp2 = KEY + </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">'=1;domain=.'</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> + temp;

 &nbsp; &nbsp;</span><span class="" style="font-size: 16px; color: rgb(102, 116, 123);">// try to set cookie</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;document.cookie = temp2;

 &nbsp; &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">if</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> (R.test(document.cookie)) {
 &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 16px; color: rgb(102, 116, 123);">// clear</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp;document.cookie = temp2 + </span><span class="" style="font-size: 16px; color: rgb(236, 118, 0);">';expires='</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> + Y1970;
 &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 16px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 16px; color: rgb(241, 242, 243);"> temp;
 &nbsp; &nbsp;}
 &nbsp;}<br>};</span></span></code></pre><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1493342586&src=3&ver=1&signature=L9XD8GAQyzHEmNm3CARkqe2fEyPlGR*lEB62jDgEnGPx-ZS2mQXLVpA*0Sz09LeJzLYy2OuSPxmmuY*qVipsH7-X8NOLrdBFvUJZl8Vhye27GaxNHussRtNFHT-7-PWhqGGFMCHZwrikPXmYfDuk-fOZtZ*pzYGglmSEFix6nok=">微信地址</a> | <a href="https://github.com/AngusFu/blog/blob/master/source/_posts/get-root-domain-of-a-site.md"/>阅读原文</a>
{% endraw  %}

