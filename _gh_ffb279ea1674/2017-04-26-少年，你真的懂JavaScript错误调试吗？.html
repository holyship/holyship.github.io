---
title: 少年，你真的懂JavaScript错误调试吗？
author: 踏歌 译
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1493342586&src=3&ver=1&signature=L9XD8GAQyzHEmNm3CARkqe2fEyPlGR*lEB62jDgEnGPx-ZS2mQXLVpA*0Sz09LeJzLYy2OuSPxmmuY*qVipsH10VbeqiW1BXiE6TO7w4vXGJ0I9-q9k4pAythWBmJiNee0un7cs-eP0kpSrbFLHxxRQgBfE-K8Sh4*RGYTJg8mY=
date: '2017-04-26 00:00:00 +0000'

---

{% raw  %}
<p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/744e573aaecf80a9083df94f26f563f40a5c19a9.gif" style="width: 770px !important; height: 577.5px !important; visibility: visible !important;"><br></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136);">(by @Jonas Mosesson )</span></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="color: rgb(255, 255, 255); font-size: 16px;  background-color: rgb(100, 159, 12);">编者按：本文由踏歌在众成翻译平台上翻译。</span></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">嗨，大家好！我已经数周没有写过关于 JavaScript 的文章，现在该是继续谈论这个话题的时候了。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">这次我们将讨论 Error 和堆栈追踪以及如何使用它们。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">有时候人们并不关注这些细节，但这方面的知识肯定有用，尤其是当你正在编写与测试或 Error 相关的库。例如这个星期我们的 Chai 中出现了一个令人惊叹的 Pull Request，它大大改进了我们处理堆栈跟踪的方式，并在用户断言失败时提供了更多的信息。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">操作堆栈记录可以让你清理无用数据，并集中精力处理重要事项。此外，当你真正弄清楚 Error 及其属性，你将会更有信心地利用它。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder;">本文开头部分或许太过于简单，但当你开始处理堆栈记录时，它将变得稍微有些复杂，所以请确保你在开始那部分之前已经充分理解前面的内容</span>。</p><h2 style=" box-sizing: inherit; margin-bottom: 0.5rem; margin-top: 20px; color: rgb(17, 17, 17); ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder; font-size: 18px;">堆栈调用如何工作</span></h2><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">在谈论 Error 之前我们必须明白堆栈调用如何工作。它非常简单，但对于我们将要深入的内容而言却是至关重要的。如果你已经知道这部分内容，请随时跳过本节。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder;">每当函数被调用，它都会被推到堆栈的顶部。函数执行完毕，便会从堆栈顶部移除。</span></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">这种数据结构的有趣之处在于<span style="box-sizing: inherit; font-weight: bolder;">最后一个入栈的将会第一个从堆栈中移除</span>，这也就是我们所熟悉的 LIFO(后进，先出)特性。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">这也就是说我们在函数&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">x&nbsp;</code>中调用函数&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">y，</code>那么对应的堆栈中的顺序为&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">x<span style="font-family:Helvetica Neue, Helvetica, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">，</span></code><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">y</code>。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">假设你有下面这样的代码：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> c</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'c'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'b'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;c</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> a</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'a'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;b</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);">a</span><span class="" style="color: rgb(241, 242, 243);">();</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">在上面这里例子中，当执行&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>函数时，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>便会添加到堆栈的顶部，然后当&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>函数在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>函数中被调用，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>会被添加到堆栈的顶部，依次类推，在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>中调用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c&nbsp;</code>也会发生同样的事情。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">当&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c&nbsp;</code>执行时，堆栈中的函数的顺序为&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a</code>&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b</code>&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c</code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c&nbsp;</code>执行完毕后便会从栈顶移除，这时控制流重新回到了&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>中，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>执行完毕同样也会从栈顶移除，最后控制流又回到了&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>中，最后&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>执行完毕，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>也从堆栈中移除。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">我们可以利用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">console<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span><span class="" style="box-sizing: inherit; color: rgb(221, 74, 104);">trace</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">()&nbsp;</span></code>来更好的演示这种行为，它会在控制台打印出当前堆栈中的记录。此外，通常而言你应该从上到下读取堆栈记录。想想下面的每一行代码都是在哪调用的。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> c</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'c'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">trace</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'b'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;c</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> a</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'a'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;b</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);">a</span><span class="" style="color: rgb(241, 242, 243);">();</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">在 Node REPL 服务器上运行上述代码会得到如下结果：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(103, 140, 177);">Trace</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at c </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">3</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">9</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at b </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">3</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at a </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">3</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(102, 116, 123);">// &lt;-- For now feel free to ignore anything below this point, these are Node's internals</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at realRunInThisContextScript </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">22</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">35</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at sigintHandlersWrap </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">98</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">ContextifyScript</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(103, 140, 177);">Script</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">runInThisContext </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">24</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">REPLServer</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">defaultEval </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">313</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">29</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at bound </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">domain</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">280</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">14</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">REPLServer</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">runBound </span><span class="" style="color: rgb(241, 242, 243);">[</span><span class="" style="color: rgb(147, 199, 99);">as</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">eval</span><span class="" style="color: rgb(241, 242, 243);">]</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">domain</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">293</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如你所见，当我们在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c&nbsp;</code>中打印堆栈，堆栈中的记录为&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a</code>,<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b</code>,<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c</code>。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如果我们现在在<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b</code>中并且在<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c</code>执行完之后打印堆栈，我们将会发现<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c</code>已经从堆栈的顶部移除，只剩下了<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a</code>和<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b</code>。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> c</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'c'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'b'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;c</span><span class="" style="color: rgb(241, 242, 243);">();</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">trace</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> a</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'a'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;b</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);">a</span><span class="" style="color: rgb(241, 242, 243);">();</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">正如你看到的那样，堆栈中已经没有<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">c</code>，因为它已经完成运行，已经被弹出去了。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(103, 140, 177);">Trace</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at b </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">4</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">9</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at a </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">3</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at repl</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">1</span><span class="" style="color: rgb(241, 242, 243);"> &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// &lt;-- For now feel free to ignore anything below this point, these are Node's internals</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at realRunInThisContextScript </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">22</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">35</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at sigintHandlersWrap </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">98</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">ContextifyScript</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(103, 140, 177);">Script</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">runInThisContext </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">vm</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">24</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">REPLServer</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">defaultEval </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">313</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">29</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at bound </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">domain</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">280</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">14</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">REPLServer</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">runBound </span><span class="" style="color: rgb(241, 242, 243);">[</span><span class="" style="color: rgb(147, 199, 99);">as</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">eval</span><span class="" style="color: rgb(241, 242, 243);">]</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">domain</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">293</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">12</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;at </span><span class="" style="color: rgb(103, 140, 177);">REPLServer</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">onLine </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">repl</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">js</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">513</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(250, 205, 34);">10</span><span class="" style="color: rgb(241, 242, 243);">)</span></code></pre><p><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(241, 242, 243);"><br></span></code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">总结：调用方法，方法便会添加到堆栈顶部，执行完毕之后，它就会从堆栈中弹出。</p><h2 style=" box-sizing: inherit; margin-bottom: 0.5rem; margin-top: 20px; color: rgb(17, 17, 17); ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder; font-size: 18px;">Error 对象和错误处理</span></h2><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">当程序发生错误时，通常都会抛出一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象。<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象也可以作为一个原型，用户可以扩展它并创建自定义错误。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>prototype&nbsp;</code>对象通常有以下属性：</p><ul style=" box-sizing: inherit; padding: 1rem; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; " class="list-paddingleft-2"><li><p><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">constructor</code>- 实例原型的构造函数。</p></li><li><p><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">message</code>&nbsp;- 错误信息</p></li><li><p><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">name</code>&nbsp;- 错误名称</p></li></ul><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">以上都是标准属性，（但）有时候每个环境都有其特定的属性，在例如 Node，Firefox，Chorme，Edge，IE 10+，Opera 和 Safari 6+ 中，还有一个包含错误堆栈记录的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">stack&nbsp;</code>属性。<span style="box-sizing: inherit; font-weight: bolder;">错误堆栈记录包含从（堆栈底部）它自己的构造函数到（堆栈顶部）所有的堆栈帧。</span></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如果想了解更多关于&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象的具体属性，我强烈推荐 MDN 上的这篇文章。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">抛出错误必须使用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">throw&nbsp;</span></code>关键字，你必须将可能抛出错误的代码包裹在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try&nbsp;</span></code>代码块内并紧跟着一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch&nbsp;</span></code>代码块来捕获抛出的错误。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">正如Java中的错误处理，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try</span><span class="" style="box-sizing: inherit; color: rgb(166, 127, 89);">/</span><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch&nbsp;</span></code>代码块后紧跟着一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally&nbsp;</span></code>代码块在JavaScript中也是同样允许的，无论&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try&nbsp;</span></code>代码块内是否抛出异常，<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally&nbsp;</span></code>代码块内的代码都会执行。在完成处理之后，最佳实践是在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally&nbsp;</span></code>代码块中做一些清理的事情，(因为)无论你的操作是否生效，都不会影响到它的执行。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">(鉴于)上面所谈到的所有事情对大多数人来讲都是小菜一碟，那么就让我们来谈一些不为人所知的细节。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try&nbsp;</span></code>代码块后面不必紧跟着&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch，</span></code>但(此种情况下)其后必须紧跟着&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally</span></code>。这意味着我们可以使用三种不同形式的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try&nbsp;</span></code>语句：</p><ul style=" box-sizing: inherit; padding: 1rem; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; " class="list-paddingleft-2"><li><p style="box-sizing: inherit; word-wrap: break-word; line-height: 27px;"><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">...</span><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch</span></code></p></li><li><p style="box-sizing: inherit; word-wrap: break-word; line-height: 27px;"><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">...</span><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally</span></code></p></li><li><p style="box-sizing: inherit; word-wrap: break-word; line-height: 27px;"><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">...</span><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">...</span><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally</span></code></p></li></ul><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">Try语句可以像下面这样互相嵌套：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Nested error.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(102, 116, 123);">// The error thrown here will be caught by its own `catch` clause</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">nestedErr</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Nested catch'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(102, 116, 123);">// This runs</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'This will not run.'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span></code></pre><p><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(241, 242, 243);"><br></span></code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">你甚至还可以在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">catch&nbsp;</span></code>和&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">finally&nbsp;</span></code>代码块中嵌套&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">try&nbsp;</span></code>语句：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'First error'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'First catch running'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Second error'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">nestedErr</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Second catch running.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span></code></pre><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'The try block is running...'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">finally</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Error inside finally.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Caught an error inside the finally block.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">还有很重要的一点值得注意，那就是我们甚至可以大可不必抛出&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象。尽管这看起来非常酷且非常自由，但实际并非如此，尤其是对开发第三方库的开发者来说，因为他们必须处理用户(使用库的开发者)的代码。由于缺乏标准，他们并不能把控用户的行为。你不能相信用户并简单的抛出一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象，因为他们不一定会那么做而是仅仅抛出一个字符串或者数字(鬼知道用户会抛出什么)。这也使得处理必要的堆栈跟踪和其他有意义的元数据变得更加困难。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">假设有以下代码：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> runWithoutThrowing</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">func</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;func</span><span class="" style="color: rgb(241, 242, 243);">();</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">e</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'There was an error, but I will not throw it.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'The error\'s message was: '</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">+</span><span class="" style="color: rgb(241, 242, 243);"> e</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">message</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> funcThatThrowsError</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">TypeError</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'I am a TypeError.'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);">runWithoutThrowing</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">funcThatThrowsError</span><span class="" style="color: rgb(241, 242, 243);">);</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如果你的用户像上面这样传递一个抛出&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象的函数给&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">runWithoutThrowing&nbsp;</code>函数(那就谢天谢地了)，然而总有些人偷想懒直接抛出一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">String</code>,那你就麻烦了：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> runWithoutThrowing</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">func</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;func</span><span class="" style="color: rgb(241, 242, 243);">();</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">e</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'There was an error, but I will not throw it.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'The error\'s message was: '</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">+</span><span class="" style="color: rgb(241, 242, 243);"> e</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">message</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> funcThatThrowsString</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'I am a String.'</span><span class="" style="color: rgb(241, 242, 243);">;<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);">runWithoutThrowing</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">funcThatThrowsString</span><span class="" style="color: rgb(241, 242, 243);">);</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">现在第二个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">console<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>log&nbsp;</code>会打印出 the error’s message is&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">undefined</code>. 这么看来也没多大的事(后果)呀，但是如果您需要确保某些属性存在于&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象上，或以另一种方式（例如&nbsp;<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">Chai的<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">throws</code>断言</a>&nbsp;）处理&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象的特定属性，那么你做需要更多的工作，以确保它会正常工作。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">此外，当抛出的值不是&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象时，你无法访问其他重要数据，例如&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">stack</code>，在某些环境中它是&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象的一个属性。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">Error 也可以像其他任何对象一样使用，并不一定非得要抛出他们，这也是它们为什么多次被用作回调函数的第一个参数(俗称 err first)。 在下面的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">fs<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span><span class="" style="box-sizing: inherit; color: rgb(221, 74, 104);">readdir</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">()&nbsp;</span></code>例子中就是这么用的。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">const</span><span class="" style="color: rgb(241, 242, 243);"> fs </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">require</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'fs'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);">fs</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">readdir</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'/example/i-do-not-exist'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> callback</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> dirs</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err </span><span class="" style="color: rgb(147, 199, 99);">instanceof</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// `readdir` will throw an error because that directory does not exist</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// We will now be able to use the error object passed by it in our callback function</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Error Message: '</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">+</span><span class="" style="color: rgb(241, 242, 243);"> err</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">message</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'See? We can use Errors without using try statements.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">else</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">dirs</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">});</span></code></pre><p><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(241, 242, 243);"><br></span></code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">最后，在 rejecting promises 时也可以使用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error&nbsp;</code>对象。这使得它更容易处理promise rejections：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Promise</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">resolve</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> reject</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;reject</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'The promise was rejected.'</span><span class="" style="color: rgb(241, 242, 243);">));<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}).</span><span class="" style="color: rgb(147, 199, 99);">then</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'I am an error.'</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}).</span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">err </span><span class="" style="color: rgb(147, 199, 99);">instanceof</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'The promise was rejected with an error.'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'Error Message: '</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">+</span><span class="" style="color: rgb(241, 242, 243);"> err</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">message</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">});</span></code></pre><h2 style=" box-sizing: inherit; margin-bottom: 0.5rem; margin-top: 20px; color: rgb(17, 17, 17); ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder; font-size: 18px;">操纵堆栈跟踪</span></h2><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">上面啰嗦了那么多，压轴的重头戏来了，那就是如何操纵堆栈跟踪。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">本章专门针对像 NodeJS 那种支持&nbsp;<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">Error.captureStackTrace&nbsp;</a>的环境。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>captureStackTrace&nbsp;</code>函数接受一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">object&nbsp;</code>作为第一个参数，第二个<span style="color: rgb(55, 58, 60); font-size: 16px;">可选</span>参数是一个函数。<span style="color: rgb(55, 58, 60); font-family: monospace; font-size: 16px;">captureStackTrace</span> 捕获当前堆栈跟踪，并在目标对象中创建一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">stack&nbsp;</code>属性来存储它。如果提供了第二个参数，则传递的函数将被视为调用堆栈的终点，因此堆栈跟踪将仅显示调用该函数之前发生的调用。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">让我们用例子来说明这一点。首先，我们将捕获当前堆栈跟踪并将其存储在公共对象中。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">const</span><span class="" style="color: rgb(241, 242, 243);"> myObj </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{};<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> c</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Here we will store the current stack trace into myObj</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">captureStackTrace</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">myObj</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;c</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> a</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;b</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// First we will call these functions <br></span><span class="" style="color: rgb(241, 242, 243);">a</span><span class="" style="color: rgb(241, 242, 243);">();<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// Now let's see what is the stack trace stored into myObj.stack<br></span><span class="" style="color: rgb(241, 242, 243);">console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">myObj</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">stack</span><span class="" style="color: rgb(241, 242, 243);">);<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// This will print the following stack to the console:<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at b (repl:3:7) &lt;-- Since it was called inside B, the B call is the last entry in the stack<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at a (repl:2:1)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at repl:1:1 &lt;-- Node internals below this line<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at realRunInThisContextScript (vm.js:22:35)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at sigintHandlersWrap (vm.js:98:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at ContextifyScript.Script.runInThisContext (vm.js:24:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.defaultEval (repl.js:313:29)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at bound (domain.js:280:14)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.runBound [as eval] (domain.js:293:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.onLine (repl.js:513:10)</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">不知道你注意到没，我们首先调用了&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a</code>(&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>入栈)，然后&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>中又调用了&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>(<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>入栈且在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>之上)。然后在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>中我们捕获了当前堆栈记录并将其存储在&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">myObj&nbsp;</code>中。因此在控制台中才会按照&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b<span style="font-family:Helvetica Neue, Helvetica, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif">，</span></code><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a&nbsp;</code>的顺序打印堆栈。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">现在让我们给&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>captureStackTrace&nbsp;</code>传递一个函数作为第二个参数，看看会发生什么：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">const</span><span class="" style="color: rgb(241, 242, 243);"> myObj </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{};<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> d</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Here we will store the current stack trace into myObj</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// This time we will hide all the frames after `b` and `b` itself</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">captureStackTrace</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">myObj</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> c</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;d</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> b</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;c</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> a</span><span class="" style="color: rgb(241, 242, 243);">()</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;b</span><span class="" style="color: rgb(241, 242, 243);">();<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// First we will call these functions<br></span><span class="" style="color: rgb(241, 242, 243);">a</span><span class="" style="color: rgb(241, 242, 243);">();<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// Now let's see what is the stack trace stored into myObj.stack<br></span><span class="" style="color: rgb(241, 242, 243);">console</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">log</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">myObj</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">stack</span><span class="" style="color: rgb(241, 242, 243);">);<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// This will print the following stack to the console:<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at a (repl:2:1) &lt;-- As you can see here we only get frames before `b` was called<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at repl:1:1 &lt;-- Node internals below this line<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at realRunInThisContextScript (vm.js:22:35)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at sigintHandlersWrap (vm.js:98:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at ContextifyScript.Script.runInThisContext (vm.js:24:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.defaultEval (repl.js:313:29)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at bound (domain.js:280:14)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.runBound [as eval] (domain.js:293:12)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at REPLServer.onLine (repl.js:513:10)<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// &nbsp; &nbsp;at emitOne (events.js:101:20)</span></code></pre><p><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(102, 116, 123);"><br></span></code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">当把&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>传给&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>captureStackTraceFunction&nbsp;</code>时，它隐藏了&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">b&nbsp;</code>本身以及它之后所有的调用帧。因此控制台仅仅打印出一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">a</code>。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">至此你应该会问自己：“这到底有什么用？”。这非常有用，因为你可以用它来隐藏与用户无关的内部实现细节。在 Chai 中，我们使用它来避免向用户显示我们是如何实施检查和断言本身的不相关的细节。</p><h2 style=" box-sizing: inherit; margin-bottom: 0.5rem; margin-top: 20px; color: rgb(17, 17, 17); ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder; font-size: 18px;">操作堆栈追踪实战</span></h2><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">正如我在上一节中提到的，Chai 使用堆栈操作技术使堆栈跟踪更加与我们的用户相关。下面将揭晓我们是如何做到的。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">首先，让我们来看看当断言失败时抛出的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">AssertionError&nbsp;</code>的构造函数：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(102, 116, 123);">// `ssfi` stands for "start stack function". It is the reference to the<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(102, 116, 123);">// starting point for removing irrelevant frames from the stack trace<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">AssertionError</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">message</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> _props</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssf</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> extend </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> exclude</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'name'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'message'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'stack'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'constructor'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'toJSON'</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> props </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> extend</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">_props </span><span class="" style="color: rgb(241, 242, 243);">||</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{});</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Default values</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">message </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> message </span><span class="" style="color: rgb(241, 242, 243);">||</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'Unspecified AssertionError'</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">showDiff </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">false</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Copy from properties</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">for</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> key </span><span class="" style="color: rgb(147, 199, 99);">in</span><span class="" style="color: rgb(241, 242, 243);"> props</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">[</span><span class="" style="color: rgb(241, 242, 243);">key</span><span class="" style="color: rgb(241, 242, 243);">]</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> props</span><span class="" style="color: rgb(241, 242, 243);">[</span><span class="" style="color: rgb(241, 242, 243);">key</span><span class="" style="color: rgb(241, 242, 243);">];</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Here is what is relevant for us:</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// If a start stack function was provided we capture the current stack trace and pass</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// it to the `captureStackTrace` function so we can remove frames that come after it</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;ssf </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> ssf </span><span class="" style="color: rgb(241, 242, 243);">||</span><span class="" style="color: rgb(241, 242, 243);"> arguments</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">callee</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">ssf </span><span class="" style="color: rgb(241, 242, 243);">&amp;&amp;</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">captureStackTrace</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">captureStackTrace</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssf</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">else</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// If no start stack function was provided we just use the original stack property</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">try</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Error</span><span class="" style="color: rgb(241, 242, 243);">();</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">catch</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">e</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">stack </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> e</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">stack</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如你所见，我们使用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Error<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>captureStackTrace&nbsp;</code>捕获堆栈追踪并将它存储在我们正在创建的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">AssertError&nbsp;</code>实例中（如果存在的话），然后我们将一个起始堆栈函数传递给它，以便从堆栈跟踪中删除不相关的调用帧，它只显示Chai的内部实现细节，最终使堆栈变得清晰明了。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">现在让我们来看看&nbsp;<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">@meeber&nbsp;</a>在这个<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">令人惊叹的PR&nbsp;</a>中提交的代码。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">在你开始看下面的代码之前，我必须告诉你&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">addChainableMethod&nbsp;</code>方法是干啥的。它将传递给它的链式方法添加到断言上，它也用包含断言的方法标记断言本身，并将其保存在变量&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi&nbsp;</code>(启动堆栈函数指示符)中。这也就意味着当前断言将会是堆栈中的最后一个调用帧，因此我们不会在堆栈中显示 Chai 中的任何进一步的内部方法。我没有添加整个代码，因为它做了很多事情，有点棘手，但如果你想读它，点我阅读。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">下面的这个代码片段中，我们有一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">lengthOf&nbsp;</code>断言的逻辑，它检查一个对象是否有一定的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">length</code>。我们希望用户可以像这样来使用它：<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(221, 74, 104);">expect</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">([</span><span class="" style="box-sizing: inherit; color: rgb(102, 153, 0);">'foo'</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">,</span> <span class="" style="box-sizing: inherit; color: rgb(102, 153, 0);">'bar'</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">]).</span>to<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>have<span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span><span class="" style="box-sizing: inherit; color: rgb(221, 74, 104);">lengthOf</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">(</span><span class="" style="box-sizing: inherit; color: rgb(153, 0, 85);">2</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">)</span></code>。</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> assertLength </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">n</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">msg</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'message'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> obj </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'object'</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssfi </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'ssfi'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// Pay close attention to this line</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Assertion</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">obj</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssfi</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">true</span><span class="" style="color: rgb(241, 242, 243);">).</span><span class="" style="color: rgb(241, 242, 243);">to</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">have</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">property</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'length'</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> len </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> obj</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">length</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// This line is also relevant</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(147, 199, 99);">assert</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;len </span><span class="" style="color: rgb(241, 242, 243);">==</span><span class="" style="color: rgb(241, 242, 243);"> n<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp; &nbsp; &nbsp;,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'expected #{this} to have a length of #{exp} but got #{act}'</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'expected #{this} to not have a length of #{act}'</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> n<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp; &nbsp; &nbsp;,</span><span class="" style="color: rgb(241, 242, 243);"> len &nbsp; &nbsp;<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp;);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}<br><br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(103, 140, 177);">Assertion</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">addChainableMethod</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(236, 118, 0);">'lengthOf'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> assertLength</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> assertLengthChain</span><span class="" style="color: rgb(241, 242, 243);">);</span></code></pre><p><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(241, 242, 243);"><br></span></code></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">在上面的代码片段中，我突出强调了与我们现在相关的代码。让我们从调用&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">this</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>assert&nbsp;</code>开始说起。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">以下是&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">this</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>assert&nbsp;</code>方法的源代码：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(103, 140, 177);">Assertion</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">prototype</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(147, 199, 99);">assert</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">expr</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> negateMsg</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> expected</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> _actual</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> showDiff</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> ok </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> util</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">test</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> arguments</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">false</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">!==</span><span class="" style="color: rgb(241, 242, 243);"> showDiff</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> showDiff </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">true</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">undefined</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">===</span><span class="" style="color: rgb(241, 242, 243);"> expected </span><span class="" style="color: rgb(241, 242, 243);">&amp;&amp;</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">undefined</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">===</span><span class="" style="color: rgb(241, 242, 243);"> _actual</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> showDiff </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">false</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">true</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">!==</span><span class="" style="color: rgb(241, 242, 243);"> config</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">showDiff</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> showDiff </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">false</span><span class="" style="color: rgb(241, 242, 243);">;</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">if</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(!</span><span class="" style="color: rgb(241, 242, 243);">ok</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;msg </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> util</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">getMessage</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> arguments</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">var</span><span class="" style="color: rgb(241, 242, 243);"> actual </span><span class="" style="color: rgb(241, 242, 243);">=</span><span class="" style="color: rgb(241, 242, 243);"> util</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">getActual</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> arguments</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// This is the relevant line for us</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">throw</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">new</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">AssertionError</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">msg</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;actual</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(241, 242, 243);"> actual<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;,</span><span class="" style="color: rgb(241, 242, 243);"> expected</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(241, 242, 243);"> expected<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;,</span><span class="" style="color: rgb(241, 242, 243);"> showDiff</span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(241, 242, 243);"> showDiff<br></span><span class="" style="color: rgb(241, 242, 243);"> &nbsp; &nbsp; &nbsp; &nbsp;},</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">config</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">includeStack</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">?</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(147, 199, 99);">assert</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">:</span><span class="" style="color: rgb(241, 242, 243);"> flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'ssfi'</span><span class="" style="color: rgb(241, 242, 243);">));</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(241, 242, 243);">}<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">};</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">assert&nbsp;</code>方法负责检查断言布尔表达式是否通过。如果不通过，我们则实例化一个&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">AssertionError</code>。不知道你注意到没，在实例化&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">AssertionError</code>时，我们也给它传递了一个堆栈追踪函数指示器(<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi</code>)，如果配置的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">includeStack&nbsp;</code>处于开启状态，我们通过将&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; "><span class="" style="box-sizing: inherit; color: rgb(0, 119, 170);">this</span><span class="" style="box-sizing: inherit; color: rgb(153, 153, 153);">.</span>assert&nbsp;</code>本身传递给它来为用户显示整个堆栈跟踪。反之，我们则只显示&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi&nbsp;</code>标记中存储的内容，隐藏掉堆栈跟踪中更多的内部实现细节。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">现在让我们来讨论下一行和我们相关的代码吧：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(236, 118, 0);">new Assertion(obj, msg, ssfi, true).to.have.property('length');</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如你所见，我们在创建嵌套断言时将从&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi&nbsp;</code>标记中的内容传递给了它。这意味着新创建的断言会使用那个方法作为起始调用帧，从而可以从堆栈追踪中清除没有的调用栈。顺便也看下&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">Assertion&nbsp;</code>的构造器吧：</p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.298039) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span class="" style="color: rgb(147, 199, 99);">function</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Assertion</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(241, 242, 243);">obj</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssfi</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> lockSsfi</span><span class="" style="color: rgb(241, 242, 243);">)</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(241, 242, 243);">{</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="color: rgb(102, 116, 123);">// This is the line that matters to us</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'ssfi'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> ssfi </span><span class="" style="color: rgb(241, 242, 243);">||</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(103, 140, 177);">Assertion</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'lockSsfi'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> lockSsfi</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'object'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> obj</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">
 &nbsp; &nbsp;flag</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> </span><span class="" style="color: rgb(236, 118, 0);">'message'</span><span class="" style="color: rgb(241, 242, 243);">,</span><span class="" style="color: rgb(241, 242, 243);"> msg</span><span class="" style="color: rgb(241, 242, 243);">);</span><span class="" style="color: rgb(241, 242, 243);">

 &nbsp; &nbsp;</span><span class="" style="color: rgb(147, 199, 99);">return</span><span class="" style="color: rgb(241, 242, 243);"> util</span><span class="" style="color: rgb(241, 242, 243);">.</span><span class="" style="color: rgb(241, 242, 243);">proxify</span><span class="" style="color: rgb(241, 242, 243);">(</span><span class="" style="color: rgb(147, 199, 99);">this</span><span class="" style="color: rgb(241, 242, 243);">);<br></span><span class="" style="color: rgb(241, 242, 243);"></span><span class="" style="color: rgb(241, 242, 243);">}</span></code></pre><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">不知道你是否还记的我先前说过的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">addChainableMethod&nbsp;</code>方法，它使用自己的父级方法设置&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi&nbsp;</code>标志，这意味着它始终处于堆栈的底部，我们可以删除它之上的所有调用帧。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">通过将&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi&nbsp;</code>传递给嵌套断言，它只检查我们的对象是否具有长度属性，我们就可以避免重置我们将要用作起始指标器的调用帧，然后在堆栈中可以看到以前的&nbsp;<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">addChainableMethod</code>。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">这可能看起来有点复杂，所以让我们回顾一下我们想从栈中删除无用的调用帧时 Chai 中所发生的事情：</p><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p>当我们运行断言时，我们将它自己的方法作为移除堆栈中的下一个调用帧的参考</p></li><li><p>断言失败时，我们会移除所有我们在参考帧之后保存的内部调用帧。</p></li><li><p>如果存在嵌套的断言。我们必须依旧使用当前断言的父方法作为删除下一个调用帧的参考点，因此我们把当前的<code class="" style=" box-sizing: inherit; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">ssfi</code>（起始函数指示器）传递给我们所创建的断言，以便它可以保存。</p></li></ol><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder;">如果你想更深入的了解它， 我也强烈推荐你阅读<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">@米贝的评论</a></span></p><h2 style=" box-sizing: inherit; margin-bottom: 0.5rem; margin-top: 20px; color: rgb(17, 17, 17); ; ; ; ; ; ; ; ; ; ; ; ; ; ; ; ">保持联系</h2><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; ">如果你有任何疑问，想法或者不认同我写的任何内容，你都可以在下面的评论中分享你的想法，或者在<a style="box-sizing: inherit; background-color: transparent; color: purple; touch-action: manipulation; vertical-align: baseline;">twitter</a>)上和我交流。如果我犯了错误，我很乐意听到你要说的话，并做出任何改正。</p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder;">感谢阅读!</span></p><p style=" box-sizing: inherit; margin-top: 20px; margin-bottom: 1rem; word-wrap: break-word; font-size: 16px; line-height: 27px; color: rgb(55, 58, 60); ; ; ; ; ; ; ; ; ; ; ; ; "><span style="box-sizing: inherit; font-weight: bolder;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(68, 68, 68); box-sizing: border-box !important; word-wrap: break-word !important;">奇舞周刊</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(68, 68, 68); box-sizing: border-box !important; word-wrap: break-word !important;">———<span style="max-width: 100%; color: rgb(136, 136, 136); line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">————————————</span>———</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(68, 68, 68); box-sizing: border-box !important; word-wrap: break-word !important;">领略前端技术 阅读奇舞周刊</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; text-align: center; line-height: 1.5em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 13px; color: rgb(68, 68, 68); box-sizing: border-box !important; word-wrap: break-word !important;">长按二维码，关注奇舞周刊</span></p><p style="max-width: 100%; min-height: 1em; font-size: 16px; white-space: normal; color: rgb(32, 32, 32); text-align: center; line-height: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 10px; color: rgb(68, 68, 68); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">▼</strong></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/gh_ffb279ea1674/images/c90ddd430cc349648caf4c4ff107fc8767904250.jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 200px !important;"></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1493342586&src=3&ver=1&signature=L9XD8GAQyzHEmNm3CARkqe2fEyPlGR*lEB62jDgEnGPx-ZS2mQXLVpA*0Sz09LeJzLYy2OuSPxmmuY*qVipsH10VbeqiW1BXiE6TO7w4vXGJ0I9-q9k4pAythWBmJiNee0un7cs-eP0kpSrbFLHxxRQgBfE-K8Sh4*RGYTJg8mY=">微信地址</a> | <a href="http://zcfy.baomitu.com/article/javascript-errors-and-stack-traces-in-depth-2640.html"/>阅读原文</a>
{% endraw  %}

