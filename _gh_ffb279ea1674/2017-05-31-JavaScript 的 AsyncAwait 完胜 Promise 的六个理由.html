---
title: JavaScript 的 Async/Await 完胜 Promise 的六个理由
author: 网络埋伏纪事 译
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1496459157&src=3&ver=1&signature=Nemr66ffk*GtagkzYwHqqihuMRf*r4I*G9CUPPmEipcSA75lNdAp-fwbSTOOmx5-kT-kJaB-Z4J-WLg82TJT7dktlZiwLKRff4jq71AxGx6MOzGUJ891Cf*wFHoCcN2QKr7ex8s0y*iLcT9r27tfQmLXTW3HlGyhWMbUvUkvnkc=
date: '2017-05-31 00:00:00 +0000'

---

{% raw  %}
<p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px; background-color: rgb(255, 254, 213); color: rgb(255, 41, 65);">编者按：本文由网络埋伏纪事在众成翻译平台翻译。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">提醒一下各位，Node 现在从版本 7.6 开始就支持 async/await 了。如果你还没有试过它，这里有一堆带有示例的理由来说明为什么你应该马上采用它，并且再也不会回头。</span><br></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">[编者按]：貌似嵌入 gist 上的代码在 medium 原生 app 中不行，但是在移动浏览器上可以。如果你是在 app 中读本文，请点击共享图标，选择“在浏览器中打开”，才看得到代码片段。</span></p><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 16px;">Async/await 101</span></strong></h3><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">对于那些从未听说过这个话题的人来说，如下是一个简单的介绍：</span></p><ul style="list-style-type: circle;" class="list-paddingleft-2"><li><p><span style="font-size: 16px;">Async/await 是一种编写异步代码的新方法。之前异步代码的方案是回调和 promise。</span></p></li><li><p><span style="font-size: 16px;">Async/await 实际上是建立在 promise 的基础上。它不能与普通回调或者 node 回调一起用。</span></p></li><li><p><span style="font-size: 16px;">Async/await 像 promise 一样，也是非阻塞的。</span></p></li><li><p><span style="font-size: 16px;">Async/await 让异步代码看起来、表现起来更像同步代码。这正是其威力所在。</span></p></li></ul><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;"><br></span></h3><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 16px;">语法</span></strong></h3><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">假设函数&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">getJSON</span></code><span style="font-size: 16px;">&nbsp;返回一个</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">promise</span></code><span style="font-size: 16px;">，而该</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">promise</span></code><span style="font-size: 16px;">的完成值是一些JSON对象。我们只想调用它，并输出该JSON，然后返回</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">"done"</span></code><span style="font-size: 16px;">。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">如下是用 promise 实现的代码：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = () =&gt; &nbsp;
 &nbsp;getJSON() &nbsp;
 &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(data =&gt; { &nbsp;
 &nbsp; &nbsp;console.log(data) &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(236, 118, 0);">"done"</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> <br> }) &nbsp;<br> <br> makeRequest()</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">而这就是用</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">async/await</span></code><span style="font-size: 16px;">看起来的样子：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = async () =&gt; { &nbsp;
 &nbsp; &nbsp;console.log(await getJSON()) &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(236, 118, 0);">"done"</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> &nbsp;<br> } &nbsp;<br> <br> makeRequest()</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">这里有一些区别：</span></p><ol style=" margin-bottom: 20px; margin-left: 24px; list-style-position: initial; list-style-image: initial; color: rgb(99, 99, 101) ; ; ; ; ; ; " class="list-paddingleft-2"><li><p><span style="font-size: 16px;">函数前面有一个关键字&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">async</span></code><span style="font-size: 16px;">。</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">await</span></code><span style="font-size: 16px;">&nbsp;关键字只用在用&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">async</span></code><span style="font-size: 16px;">&nbsp;定义的函数内。所有&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">async</span></code><span style="font-size: 16px;">&nbsp;函数都会隐式返回一个 promise，而 promise 的完成值将是函数的返回值（本例中是&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">"done"</span></code><span style="font-size: 16px;">）。</span></p></li><li><p><span style="font-size: 16px;">上面一点暗示我们不能在代码的顶层用&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">await</span></code><span style="font-size: 16px;">，因为这样就不是在&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">async</span></code><span style="font-size: 16px;">&nbsp;函数内。</span></p></li></ol><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// 这段代码在顶层不能执行 &nbsp;<br></span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"></span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// await makeRequest() &nbsp;<br></span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"></span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// 这段代码可以执行 &nbsp;<br><br></span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">makeRequest().</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">((result) =&gt; { &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// do something &nbsp;<br></span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">})</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">3.</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">await getJSON()</span></code><span style="font-size: 16px;">&nbsp;意味着&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">console.log</span></code><span style="font-size: 16px;">&nbsp;调用会一直等待，直到&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">getJSON()</span></code><span style="font-size: 16px;">&nbsp;promise 完成并打印出它的值。</span></p><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 16px;">为什么 Async/await 更好？</span></strong></h3><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; "><span style="font-size: 16px;">1. 简洁干净</span></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">看看我们少写了多少代码！即使在上面那个人为的示例中，很显然我们也是节省了不少代码。我们不必写&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">.then</span></code><span style="font-size: 16px;">，创建一个匿名函数来处理响应，或者给不需要用的变量一个名称&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">data</span></code><span style="font-size: 16px;">。我们还避免了代码嵌套。这些小小的优势会快速累积起来，在后面的代码中会变得更明显。</span></p><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; "><span style="font-size: 16px;">2. 错误处理</span></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">Async/await 会最终让我们用同样的结构（&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">try/catch</span></code><span style="font-size: 16px;">）处理同步和异步代码变成可能。在下面使用 promise 的示例中，如果&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">JSON.parse</span></code><span style="font-size: 16px;">&nbsp;失败的话，</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">try/catch</span></code><span style="font-size: 16px;">&nbsp;就不会处理，因为它是发生在一个 prmoise 中。我们需要在 promise 上调用&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">.catch</span></code><span style="font-size: 16px;">，并且重复错误处理代码。这种错误处理代码会比可用于生产的代码中的&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">console.log</span></code><span style="font-size: 16px;">&nbsp;更复杂。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = () =&gt; { &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">try</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> { &nbsp;
 &nbsp; &nbsp;getJSON() &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(result =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// this parse may fail &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> data = JSON.parse(result) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;console.log(data) &nbsp;
 &nbsp; &nbsp;}) &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// uncomment this block to handle asynchronous errors &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// .catch((err) =&gt; { &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// console.log(err) &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// }) &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp;} </span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">catch</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> (err) { &nbsp;
 &nbsp; &nbsp;console.log(err) &nbsp;
 &nbsp;} <br>}</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">现在看看用 async/await 实现的代码。现在&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">catch</span></code><span style="font-size: 16px;">&nbsp;块会处理解析错误。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = async () =&gt; { 
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">try</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> { </span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// 这个解析会失败 &nbsp; </span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> data = JSON.parse(await getJSON()) console.log(data) 
 &nbsp;} 
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">catch</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> (err) { 
 &nbsp; &nbsp;console.log(err)
 &nbsp;}<br>}</span></span></code></pre><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; ">3. 条件句<br></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">假设想做像下面的代码一样的事情，获取一些数据，并决定是否应该返回该数据，或者根据数据中的某些值获取更多的细节。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = () =&gt; { &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> getJSON() &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(data =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">if</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> (data.needsAnotherRequest) { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeAnotherRequest(data) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(moreData =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(moreData) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> moreData &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;} </span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">else</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;console.log(data) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> data &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;} &nbsp;
 &nbsp;}) &nbsp;<br>}</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">这些代码看着就让人头疼。它只需将最终结果传播到主 promise，却很容易让我们迷失在嵌套（ 6 层）、大括号和返回语句中。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">把这个示例用async / await 重写，就变得更易于阅读。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">onst makeRequest = async () =&gt; { &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> data = await getJSON() &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">if</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> (data.needsAnotherRequest) { &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> moreData = await makeAnotherRequest(data); &nbsp;
 &nbsp; &nbsp;console.log(moreData) &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> moreData &nbsp;
 &nbsp;} </span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">else</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> { &nbsp;
 &nbsp; &nbsp;console.log(data) &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> data &nbsp;
 &nbsp;} &nbsp;<br>}</span></span></code></pre><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; "><span style="font-size: 16px;">4. 中间值</span></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">你可能发现自己处于一种状态，即调用你 promise1，然后用它的返回值来调用promise2，然后使用这两个 promise 的结果来调用 promise3。你的代码很可能看起来像这样：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = () =&gt; { &nbsp;
 &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise1() &nbsp;
 &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(value1 =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// do something &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise2(value1) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(value2 =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// do something &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise3(value1, value2) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp;
 &nbsp; &nbsp; &nbsp;}) &nbsp;<br> }</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">如果&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">promise3</span></code><span style="font-size: 16px;">&nbsp;不需要&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">value1</span></code><span style="font-size: 16px;">，那么很容易就可以把 promise 嵌套变扁平一点。如果你是那种无法忍受的人，那么可能就会像下面这样，在一个&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">Promise.all</span></code><span style="font-size: 16px;">中包含值 1 和 2，并避免更深层次的嵌套：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">onst makeRequest = () =&gt; { &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise1() &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(value1 =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// do something &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(103, 140, 177);">Promise</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">.all([value1, promise2(value1)]) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;}) &nbsp;
 &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(([value1, value2]) =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// do something &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise3(value1, value2) &nbsp;
 &nbsp; &nbsp;}) &nbsp;}</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">这种方法为了可读性而牺牲了语义。除了为了避免 promise 嵌套，没有理由将&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">value1</span></code><span style="font-size: 16px;">和</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">value2</span></code><span style="font-size: 16px;">并入一个数组。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">不过用 async/await 的话，同样的逻辑就变得超级简单直观了。这会让你对你拼命让 promise 看起来不那么可怕的时候所做过的所有事情感到怀疑。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = async () =&gt; { &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> value1 = await promise1() &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> value2 = await promise2(value1) &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> promise3(value1, value2) &nbsp;}</span></span></code></pre><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; "><span style="font-size: 16px;">5. 错误栈</span></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">假如有一段链式调用多个 promise 的代码，在链的某个地方抛出一个错误。</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = () =&gt; { &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">return</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> callAPromise() &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(() =&gt; callAPromise()) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(() =&gt; callAPromise()) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(() =&gt; callAPromise()) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(() =&gt; callAPromise()) &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">then</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(() =&gt; { &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">throw</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">new</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(103, 140, 177);">Error</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(</span><span class="" style="font-size: 14px; color: rgb(236, 118, 0);">"oops"</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">); &nbsp;
 &nbsp; &nbsp;}) &nbsp;} &nbsp;makeRequest() &nbsp;
 &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">catch</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(err =&gt; { &nbsp;
 &nbsp; &nbsp;console.log(err); &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// output &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// Error: oops at callAPromise.then.then.then.then.then (index.js:8:13) &nbsp;<br><br></span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">})</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">从 promise 链返回的错误栈没有发现错误发生在哪里的线索。更糟糕的是，这是误导的；它包含的唯一的函数名是</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">callAPromise</span></code><span style="font-size: 16px;">，它完全与此错误无关（不过文件和行号仍然有用）。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">但是，来自async / await的错误栈会指向包含错误的函数：</span></p><pre class="" style="margin-top: 0px; margin-bottom: 20px; padding: 1em; background-color: rgb(56, 64, 71); border-radius: 0.3em; color: rgb(248, 248, 242); direction: ltr; hyphens: none; overflow: auto; tab-size: 4; text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; word-break: normal;"><code style=" background: none; border-width: 0px; border-style: none; border-color: initial; border-radius: 0px; font-stretch: normal; font-size: 0.8rem; line-height: 1.4; ; ; "><span style="font-size: 16px;"><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">const</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> makeRequest = async () =&gt; { &nbsp;
 &nbsp; &nbsp;await callAPromise() &nbsp;
 &nbsp; &nbsp;await callAPromise() &nbsp;
 &nbsp; &nbsp;await callAPromise() &nbsp;
 &nbsp; &nbsp;await callAPromise() &nbsp;
 &nbsp; &nbsp;await callAPromise() &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">throw</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">new</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);"> </span><span class="" style="font-size: 14px; color: rgb(103, 140, 177);">Error</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(</span><span class="" style="font-size: 14px; color: rgb(236, 118, 0);">"oops"</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">); &nbsp;} &nbsp;makeRequest() &nbsp;
 &nbsp; &nbsp;.</span><span class="" style="font-size: 14px; color: rgb(147, 199, 99);">catch</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">(err =&gt; { &nbsp;
 &nbsp; &nbsp;console.log(err); &nbsp;
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// output &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">
 &nbsp; &nbsp;</span><span class="" style="font-size: 14px; color: rgb(102, 116, 123);">// Error: oops at makeRequest (index.js:7:9) &nbsp;</span><span class="" style="font-size: 14px; color: rgb(241, 242, 243);">})</span></span></code></pre><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">当在本地环境中开发并在编辑器中打开文件时，这不是啥大事，但是当想搞清楚来自生产服务器的错误日志时，就相当有用了。在这种情况下，知道错误发生在</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">makeRequest</span></code><span style="font-size: 16px;">中比知道错误来自一个又一个的&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">then</span></code><span style="font-size: 16px;">&nbsp;要好。</span></p><h4 style=" margin-bottom: 16px; color: rgb(88, 90, 91); font-size: 14px ; ; ; ; ; "><span style="font-size: 16px;">6. 调试</span></h4><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">最后但是同样重要的是，在使用 async/await 时，一个杀手级优势是调试更容易。调试 promise 一直是如此痛苦，有两个原因：</span></p><ol style=" margin-bottom: 20px; margin-left: 24px; list-style-position: initial; list-style-image: initial; color: rgb(99, 99, 101) ; ; ; ; ; ; " class="list-paddingleft-2"><li><p><span style="font-size: 16px;">没法在返回表达式（无函数体）的箭头函数中设置断点。</span></p></li></ol><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/ff28bcb501907da61a05e48c83b1b8a418db16b6.png" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 271.425px !important;"></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">试着在此处设置断点</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">2.如果在</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">.then</span></code><span style="font-size: 16px;">块中设置断点，并使用像单步调试这类调试快捷方式，调试器不会移动到后面的&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">.then</span></code><span style="font-size: 16px;">&nbsp;，因为它只单步调试同步代码。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">有了 async/await，我们就不再需要那么多箭头函数，您可以像正常的同步调用一样单步调试 await 调用。</span></p><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><img src="/gh_ffb279ea1674/images/b82cc089448e90f14833cc62e7e15746cfa7a1df.png" style="border-width: 0px; border-style: none; border-color: initial; width: 770px !important; height: 261.8px !important;"></p><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 16px;">总结</span></strong></h3><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">Async/await 是过去几年中添加到 JavaScript 中的最具革命性的功能之一。它让我们意识到 promise 的语法有多混乱，并提供了直观的替代。</span></p><h3 style=" margin-bottom: 20px; color: rgb(88, 90, 91); line-height: 1.8; word-break: break-all ; ; ; ; ; "><strong><span style="font-size: 16px;">关注</span></strong></h3><p style=" margin-bottom: 20px; color: rgb(88, 90, 91); font-size: 1.14286rem; line-height: 1.8; word-break: break-all ; ; ; ; ; "><span style="font-size: 16px;">您可能对使用此功能有一些正当的怀疑：</span></p><ul style="list-style-type: circle;" class="list-paddingleft-2"><li><p><span style="font-size: 16px;">它让异步代码变得不那么明显：我们的眼睛已经学会了只要看到回调或者&nbsp;</span><code style="padding: 1px 4px; background-color: rgb(242, 242, 242); border-width: 1px; border-style: solid; border-color: rgb(222, 222, 222); border-radius: 2px; font-stretch: normal; font-size: 0.8em; line-height: normal; font-family: Monaco, monospace;"><span style="font-size: 16px;">.then</span></code><span style="font-size: 16px;">就认出是异步代码，还需要花上几周的时间才能适应新的标志。不过 C＃已经有这个功能多年了，熟悉它的人都知道这是这种小的、暂时的不便是值得的。</span></p></li><li><p><span style="font-size: 16px;">Node 7 现在还不是 LTS 版本：是的，不过 Node 8 下个月就会出来，而将我们的代码库迁移到新版本很有可能不费吹灰之力。</span></p></li></ul><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1496459157&src=3&ver=1&signature=Nemr66ffk*GtagkzYwHqqihuMRf*r4I*G9CUPPmEipcSA75lNdAp-fwbSTOOmx5-kT-kJaB-Z4J-WLg82TJT7dktlZiwLKRff4jq71AxGx6MOzGUJ891Cf*wFHoCcN2QKr7ex8s0y*iLcT9r27tfQmLXTW3HlGyhWMbUvUkvnkc=">微信地址</a> | <a href="http://www.zcfy.cc/article/6-reasons-why-javascript-s-async-await-blows-promises-away-tutorial-2786.html">阅读原文</a>
{% endraw  %}

