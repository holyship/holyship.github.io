---
title: 新年新语言，WCDB Swift
author: sanhuazhang
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1515989662&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siO2oBl7-LTTBZRFPhrotzYqfUx-VDDQOrcWk4b*CpSdMKBSI1l7h4hynUSi4oQ7A3Bh9Z8TXXpu5HZsW32lvpl-7-BrtmqpVgyfYVfMj87zEeQztosumnI3WxQz-M8ZiCECnxfHTcID5zGXIrt-W5jU=
date: '2018-01-02 00:00:00 +0000'

---

{% raw  %}
<p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">WCDB 作为微信的终端数据库，从 2017.6 开源至今，共迭代了 5 个版本。我们一直关注开发者们的需求，并不断优化性能，新增如全文搜索等常用的功能。而这其中，呼声最高的莫过于 对 Swift 的支持。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">WCDB ObjC 版本的实现中，由于引入了 C++ 代码，并不能直接 bridge 到 Swift。因此，我们从 9 月份开始就着手使用原生的 Swift，重写 WCDB。并于 10.10 和 11.8 分别在开发者群内发布了 alpha 和 beta 版进行测试。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">今天，终于可以正式发布 WCDB Swift 的第一个正式版本了。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;"><span style="font-size: 18px;">WCDB Swift 约有 1.5w 行代码，使用 Pure Swift 编写，几乎不包含 Cocoa 的代码。且与 ObjC 版保持完全一致的功能。</span></span></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>模型绑定</strong></span></p><hr><p style="line-height: 1.75em;text-align: left;margin-top: 25px;margin-bottom: 20px;"><span style="font-size: 18px;">WCDB Swift 的模型绑定，基于 Swift 4.0 的 </span><span style="font-size: 18px;"><span style="box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Codable</code></span></span><span style="font-size: 18px;">&nbsp;协议实现。通过建立 Swift 类型与数据库表之间的映射关系，使得开发者可以通过类对象直接操作数据库。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HasCfRb3KPpavMj4NHiccBfaTtVa8CEzHxe5rdnXWL0XXbCKhvD08SUw/0?wx_fmt=png" style="width: 770px !important; height: 529.169px !important; visibility: visible !important;"></p><p style="text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>语言集成查询</strong></span></p><hr><p style="text-align: left;margin-bottom: 20px;margin-top: 25px;line-height: 1.75em;"><span style="font-size: 18px;">语言集成查询深度结合了 Swift 和 SQL 的语法，使得纯字符串的 SQL 可以以代码的形式表达出来。结合代码提示及纠错，极大地提高开发效率。</span></p><p style="line-height: 1.75em;margin-bottom: 25px;"><span style="font-size: 18px;">同时，由于 Swift 的语法 比 Objective-C 更加简洁，并有更强大的范型和类型推导，使得 WCDB 接口不仅更易编写，而且更易读易维护。</span></p><p style="line-height: 1.75em;margin-bottom: 25px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21H22Nq4U8kftMvLdnu7nCzcY0sjhpYYYiau211lm8iaiaKOPUDfibo9iaq8Dg/0?wx_fmt=png" style="width: 770px !important; height: 62.7745px !important;"></p><p style="line-height: 1.75em;margin-bottom: 25px;"><span style="font-size: 18px;">类似&nbsp;</span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Sample.Properties.identifier &gt; 0</code></span></span>&nbsp;<span style="font-size: 18px;">的语法，其返回值并不为 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Bool</code></span></span><span style="font-size: 18px;">，而是语言集成查询的 <span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Expression</code></span> 对象，WCDB 会根据这个语句，去进行 SQL 的查询。同时，通过类型的定义，Swift 即可推导出 WCDB 查询的结果为 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Sample</code></span></span><span style="font-size: 18px;"> 类。</span></p><blockquote><p style="margin-top: 5px;margin-bottom: 20px;line-height: 1.75em;"><span style="font-size: 18px;">语言集成查询同时内建了反注入机制，可以避免第三方从输入框注入 SQL，进行预期之外的恶意操作。</span></p></blockquote><p style="text-align: center;margin-top: 25px;margin-bottom: 5px;line-height: 1.75em;"><span style="font-size: 20px;"><strong>深入 SQLite 源码的性能优化</strong></span></p><hr><p style="margin-bottom: 20px;text-align: left;margin-top: 25px;line-height: 1.75em;"><span style="font-size: 18px;">WCDB 基于 SQLite 开发，我们在<a href="http://mp.weixin.qq.com/s?__biz=MzAwNDY1ODY2OQ==&amp;mid=2649286361&amp;idx=1&amp;sn=78bbcda7f41a14291ad71289e4821f71&amp;scene=21#wechat_redirect" target="_blank">之前的文章介绍过其对 SQLite 源码进行的性能优化</a>，以适配移动终端的场景。同样地，这部分优化 Swift 版本也能享受到。</span><br></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>线程安全且并发</strong></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">WCDB Swift 不仅可以安全地在任意线程进行数据库操作，且其内部会智能地根据操作类型调配资源，使其能够并发执行，进一步提升效率。</span><br></p><p style="text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>加密</strong></span></p><hr><p style="margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">基于 SQLCipher 的加密机制，可以为客户端数据安全提供一定程度的保障。</span><br></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>字段升级</strong></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">数据库模型与类定义绑定，使得字段的增加、删除、修改都与类变量的定义保持一致，不需要开发者额外地管理字段的版本。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HPGnibXC4wSOpgqHEDJflibmR6dUKDtMnppBX0SUpyqLzicO92an5DmtgA/0?wx_fmt=png" style="width: 770px !important; height: 434.477px !important;"></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">模型绑定中新增了 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">newColumn</code></span></span><span style="font-size: 18px;">&nbsp;字段，该字段也会被自动创建到数据库表中，开发者不需要手动管理。</span></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>全文搜索</strong></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">WCDB Swift 提供简单易用的全文搜索接口，并包含适配多种语言的分词器，使得数据搜索更精准。</span><br></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>损坏修复</strong></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">内建的修复工具可以在系统错误、磁盘故障等情况下，尽最大限度地将损坏的数据找回并导出。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;"></span></p><p style="margin-top: 5px;text-align: center;margin-bottom: 5px;"><span style="font-size: 30px;"><strong>Pure Swift</strong></span></p><hr><p style="margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">模型绑定对语言的依赖性很大。由于 ObjC 其强大的消息转发机制，使得 WCDB 实现起来并没有太大的问题。然而，动态性却恰恰是 Swift 一直为人诟病的地方。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">最省事的解决方案就是，直接引入 Cocoa，所有的问题都将不再是问题。然而，这并不是我们所期望的。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">理性分析可以得出，一方面，全面的动态化会拖累 Swift 的性能，另一方面，这也会使得 Swift 的原生类型难以享受到模型绑定。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">但我们的理由可能更感性一些 --- 情怀。称之为强迫症也好，代码洁癖也罢，Swift with Cocoa 总让人心里有那么一丝别扭。因此，我们决定寻找 Swift 原生的解决方案。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">WCDB 的模型绑定对语言有两点依赖：</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">1. Accessor。ObjC 版本使用&nbsp;</span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">selector</code></span></span><span style="font-size: 18px;">&nbsp;的 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">IMP</code></span></span><span style="font-size: 18px;">&nbsp;指针，使得 WCDB 可以获取变量的值，并插入到数据库中，或从数据库中获取数据写入到变量。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">2. 数据库字段的映射。ObjC 版本使用宏定义，使得 WCDB 可以通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">className.propertyName</code></span></span><span style="font-size: 18px;">&nbsp;的方式进行语言集成查询的操作。</span></p><p style="text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>KeyPath</strong></span></p><hr><p style="margin-bottom: 20px;text-align: left;margin-top: 25px;text-indent: 0em;"><span style="font-size: 18px;">我们最初盯上的是 Swift 的 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;的机制，它通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">\</code></span></span><span style="font-size: 18px;">&nbsp;的语法，可以直接对变量进行读写操作，且语法上也与 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">className.propertyName</code></span></span><span style="font-size: 18px;">&nbsp;类似。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HvyoSCGeV23INy5nugceAINm0PGW8WrIf240N6FD9936NKaH401EOcg/0?wx_fmt=png" style="width: 770px !important; height: 117.857px !important;"></p><p style="margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">一个难题是，</span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;在不引入 Cocoa 的情况下，是并不提供 property 的名称，这就无法通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;直接映射数据库的字段。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HynuZMZ1NiaZfC5MMCC9oSrgiczCVHNyEaZfa6yjqPfISsmo6ecSLKrcQ/0?wx_fmt=png" style="width: 770px !important; height: 400.77px !important;"></p><blockquote><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">Swift 也有一个相关的 SR 在讨论这个问题。</span></p></blockquote><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">显然，我们不可能等待这个特性实现了再去做 WCDB Swift。因此我们尝试使用“不常规”的方法，获取到 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;对应的 property 名称。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Mirror</code></span></span><span style="font-size: 18px;">&nbsp;是 Swift 里的反射类型，它可以遍历每个变量，获取其名称和值，但不能对变量写入数据。因此我们可以通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;对变量设一个独一无二的特征值，然后再通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Mirror</code></span></span><span style="font-size: 18px;">&nbsp;遍历变量，导出与特征值相同的 property 名称。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HzMjHNLAZKwCuv7ds960LJ4qDBZ9qhUctS8hEib7hFQKSTZ2jMBD7DaQ/0?wx_fmt=png" style="width: 770px !important; height: 216.087px !important;"></p><p style="margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">这个“不常规”的用法在大部分情况下能够生效，但对于 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">class</code></span></span><span style="font-size: 18px;">&nbsp;和 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">struct</code></span></span><span style="font-size: 18px;">&nbsp;相互嵌套的变量，容易因为内存混乱导致 crash。</span></p><p style="line-height: 1.75em;text-align: center;margin-top: 25px;margin-bottom: 5px;"><span style="font-size: 20px;"><strong>Codable</strong></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">在 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">KeyPath</code></span></span><span style="font-size: 18px;">&nbsp;的方案不够完善的情况下，我们转投了 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Codable</code></span></span><span style="font-size: 18px;">&nbsp;协议。它是 Swift 4.0 新增的特性，本质是编译前根据定义生成代码，以完成序列化和反序列化的任务。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HXJlYSvBX4yDETQLU4VhFBTvGjibFbEibJzd8tBja60cAR1HnYrJzer0Q/0?wx_fmt=png" style="width: 770px !important; height: 570.617px !important;"></p><p style="margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">对应到 WCDB，将数据库的字段读写到变量中，其本质就是一个序列化和反序列化的过程，而&nbsp;</span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">CodingKeys</code></span></span><span style="font-size: 18px;">&nbsp;也可能可以用于语言集成查询中的字段映射。<br></span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">然而，由于这个特性还很新，还没有太多文档对其进行深入介绍，尤其是自定义 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Encoder</code></span></span><span style="font-size: 18px;">&nbsp;和 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">Decoder</code></span></span><span style="font-size: 18px;">&nbsp;这部分。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">所幸的是，Swift 本身就是开源的。因此，我们参考 swift-corelibs-foundation 中的 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">JSONEncoder</code></span></span><span style="font-size: 18px;">&nbsp;和 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">JSONDecoder</code></span></span><span style="font-size: 18px;">，实现了 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">TableEncoder</code></span></span><span style="font-size: 18px;">&nbsp;和 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">TableDecoder</code></span></span><span style="font-size: 18px;">，并通过 </span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;">CodingKeys</code></span></span><span style="font-size: 18px;">&nbsp;的定义，映射数据库中的字段。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">最终维护了我们对 Pure Swift 的坚持。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21HB8LRV1YVnbPfnRErr9OBUIy2UtcnSrJPyXibLl6Y1YNI35XPJ79iaKBA/0?wx_fmt=png" style="width: 770px !important; height: 353.989px !important;"></p><p style="margin-bottom: 20px;text-align: center;margin-top: 25px;"><span style="font-size: 30px;"><strong>微信也转向 Swift 开发了吗？</strong></span><br></p><hr><p style="margin-bottom: 20px;text-align: left;margin-top: 25px;"><span style="font-size: 18px;">相信这会是大家非常关心的问题。然而，很遗憾，目前还没有。不仅微信，国内外大部分 app 都还没有完全转向Swift，但显然这是个趋势。</span><br></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><img src="https://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9Mcss8BJNK1aKab7jPkQXl21H8Fzeuw5KdtazPRz83ZfRhPZwO2NWphemWSAIWCliaVV5epP77k8r7WA/0?wx_fmt=png" style="width: 552px !important; height: 154px !important;"></p><blockquote><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">Google 在 11 月 fork 了 Swift。</span></p></blockquote><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">大家犹豫不定的原因都大同小异：ABI不稳定，需要将二进制打包进去，增大app体积；某些方面性能还不够好，而且现在多数是与 ObjC 混编，将进一步拉低性能 等等。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">而这其中一个很重要的原因就是，Swift 的基础设施还不完善，还难以支撑其大型 app 的开发。而 WCDB Swift 就是这类基础设施之一。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">因此，先有 WCDB Swift，未来才有用 Swift 编写微信的可能，这逻辑没毛病。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;">另一方面，没有微信的上线机制的保护和庞大的用户量的验证，我们需要确保 WCDB Swift 的稳定性。因此，在 WCDB Swift 的第一版本，我们就提供了相对完善的测试用例，用例的<strong>代码覆盖率为 91.34%</strong>，能够触达绝大部分使用场景。</span></p><p style="line-height: 1.75em;margin-top: 5px;margin-bottom: 20px;"><span style="font-size: 18px;"></span></p><hr><p style="line-height: 1.75em;margin-bottom: 20px;margin-top: 25px;"><span style="font-size: 18px;">更多 WCDB Swift 的教程文档、代码样例，包括源码，都可以点【阅读原文】，或直接到 Github 的 Tencent/wcdb 了</span><span style="font-size: 18px;"><span style="font-size: 18px;box-sizing: border-box;color: rgb(51, 51, 51);background-color: rgb(214, 214, 214);"><code style="box-sizing: border-box;"></code></span></span><span style="font-size: 18px;">解。</span></p><p style="line-height: 1.75em;margin-bottom: 20px;margin-top: 25px;"><span style="font-size: 18px;">我们一起期待 Swift 成为开发者的首选的那一天。</span><br><span style="font-size: 18px;"></span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1515989662&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siO2oBl7-LTTBZRFPhrotzYqfUx-VDDQOrcWk4b*CpSdMKBSI1l7h4hynUSi4oQ7A3Bh9Z8TXXpu5HZsW32lvpl-7-BrtmqpVgyfYVfMj87zEeQztosumnI3WxQz-M8ZiCECnxfHTcID5zGXIrt-W5jU=">微信地址</a> | <a href="https://github.com/Tencent/wcdb/wiki/Swift-关于%20WCDB%20Swift">阅读原文</a>
{% endraw  %}

