---
title: 微信移动端数据库组件WCDB系列（三） — WINQ原理篇
author: sanhuazhang
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1498052765&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ4-HiCbVGjE0gR-2o1d1M*MY48nqNmiBv2r6DzykYQl3fvTZc7EMIgnaeiluKD1fhMQ*It2gbUCvwzlFn5Lzom8v9t*8WZi0lrZRFsdyuyowEHpOH*hRWIxmHnx6kn9oATkXI9il266hYcPU0SnZpNI=
date: '2017-06-15 00:00:00 +0000'

---

{% raw  %}
<h1 cid="c5" mdtype="heading" class="" style="box-sizing: border-box; font-size: 2.25em; margin-bottom: 1rem; font-weight: bold; line-height: 1.2; cursor: text; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 24px;">背景</span></h1><p cid="c8" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c9" mdtype="line" style="display: block; box-sizing: border-box;">高效、完整、易用是WCDB的基本原则。前几篇文章分享了WCDB的基本用法和修复工具，接下来将更深入地聊聊WCDB在易用性上的思考和实践。</span></p><p cid="c10" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c11" mdtype="line" style="display: block; box-sizing: border-box;">对于各类客户端数据库，似乎都绕不开拼接字符串这一步。即便在Realm这样的NoSQL的数据库中，在进行查询时，也依赖于字符串的语法：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUMh0icI9cExLmMoTZkj2ae41gm0gHgfAuNLEs12oY4d31YqictYypic05Q/0?wx_fmt=png" style="width: 577px !important; height: 48px !important; visibility: visible !important;"></p><p cid="c13" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c14" mdtype="line" style="display: block; box-sizing: border-box;">别看小小的字符串拼接，带来的麻烦可不小：</span></p><ul class="list-paddingleft-2" cid="c15" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c17" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c18" mdtype="line" style="display: block; box-sizing: border-box;">代码冗余。为了拼接出匹配的SQL语句，业务层往往要写许多胶水代码来format字符串。这些代码冗长且没有什么“营养”。</span></p></li><li><p cid="c20" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c21" mdtype="line" style="display: block; box-sizing: border-box;">难以查错。对于编译器而言，SQL只是一个字符串。这就意味着即便你只写错了一个字母，也得在代码run起来之后，通过log或断点才能发现错误。倘若SQL所在的代码文件依赖较多，即使改正一个敲错的字母，就得将整个工程重新编译一遍，简直是浪费生命。</span></p></li><li><p cid="c23" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c24" mdtype="line" style="display: block; box-sizing: border-box;">SQL注入。举一个简单的例子：</span></p></li></ul><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nU66E3zibHIGrt0IU6eicNpZodiaibiaYyxGUmY8hPYHf6V7s2ibesgiaGibD2qw/0?wx_fmt=png" style="width: 770px !important; height: 88.0158px !important; visibility: visible !important;"></p><p><span md-inline="plain" class="" style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap;">这是插入消息的SQL。倘若对方发来这样的消息：<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">');DELETE FROM message;--</code>，那么这个插入的SQL就会被分成三段进行解析：</span></p><p><span md-inline="plain" style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUG3icN3ibASsf3aXNibDWSfMOn2Uwx4ic8iczCibFpQoZYicduOcQhU3gBnS2A/0?wx_fmt=png" style="width: 474px !important; height: 105px !important;"></p><p cid="c29" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c30" mdtype="line" style="display: block; box-sizing: border-box;">它会在插入一句空消息后，将message表内的所有消息删除。若App内存在这样的漏洞被坏人所用，后果不堪设想。</span></p><p cid="c31" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c32" mdtype="line" style="display: block; box-sizing: border-box;">反注入的通常做法是，</span></p><ul class="list-paddingleft-2" cid="c33" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c35" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c36" mdtype="line" style="display: block; box-sizing: border-box;">利用SQLite的绑定参数。通过绑定参数避免字符串拼接。</span></p></li></ul><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUFXrpvIM4oiaZeVeejuLGVh4ZmvygicibvQRdXdTria10eptIal92Y3bA8w/0?wx_fmt=png" style="width: 770px !important; height: 93.203px !important;"></p><ul class="list-paddingleft-2" cid="c38" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c40" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c41" mdtype="line" style="display: block; box-sizing: border-box;">对于不适用绑定参数的SQL，则可以将单引号替换成双单引号，避免传入的单引号提前截断SQL。</span></p></li></ul><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUEN4pOcgNgBYBhLQV4uv98Ndq3DtzrO210D9iaLPzicgLkmuiagnsB5glg/0?wx_fmt=png" style="width: 770px !important; height: 105.533px !important;"></p><p cid="c43" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c44" mdtype="line" style="display: block; box-sizing: border-box;">尽管反注入并不难，但要求业务开发都了解、并且在开发过程中时时刻刻都警惕着SQL注入，是不现实的。</span></p><p cid="c45" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c46" mdtype="line" style="display: block; box-sizing: border-box;">一旦错过了在框架层统一解决这些问题的机会，后面再通过代码规范、Code Review等等人为的方式去管理，就难免会发生疏漏。</span></p><p cid="c47" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c48" mdtype="line" style="display: block; box-sizing: border-box;">因此，WCDB的原则是，问题应当更早发现更早解决。</span></p><ul class="list-paddingleft-2" cid="c49" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c51" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c52" mdtype="line" style="display: block; box-sizing: border-box;">能在编译期发现的问题，就不要拖到运行时；</span></p></li><li><p cid="c54" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c55" mdtype="line" style="display: block; box-sizing: border-box;">能在框架层解决的问题，就不要再让业务去分担。</span></p></li></ul><p cid="c56" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c57" mdtype="line" style="display: block; box-sizing: border-box;">基于这个原则，我开始进行对SQLite的接口的抽象。</span></p><h1 cid="c59" mdtype="heading" class="" style=" box-sizing: border-box; font-size: 2.25em;  margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.2; cursor: text; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="box-sizing: border-box; font-size: 24px;">SQL的组合能力</span></h1><p cid="c60" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c61" mdtype="line" style="display: block; box-sizing: border-box;">思考的过程注定不会是一片坦途，我遇到的第一个挑战就是：</span></p><h3 cid="c62" mdtype="heading" class="" style="box-sizing: border-box; font-size: 1.5em; margin-bottom: 1rem; font-weight: bold; line-height: 1.43; cursor: text; width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 18px;">问题一：SQL应该怎么抽象？</span></h3><p cid="c63" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c64" mdtype="line" style="display: block; box-sizing: border-box;">SQL是千变万化的，它可以是一个很简单的查询，例如：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nU1WWRUicrpQHYJCuqXPLp2r6VRRGrBBhVzmFLndG1OkxolDibulSHhQkA/0?wx_fmt=png" style="width: 366px !important; height: 48px !important;"></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">这个查询只是取出message表中的所有元素。假设我们可以封装成接口：</span></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUzzCHYw7Wna7Xd8KgM5sxiczt8SFUg1HdSpztUfGLN5nJicUQ5PQDGXjQ/0?wx_fmt=png" style="width: 770px !important; height: 39.3953px !important;"></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">但SQL也可以是一个很复杂的查询，例如：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUZNu4CDfdjLovqUibVfbw6ZaOcyZJa5Hn09NXFe6t9gSnr8X3291I57w/0?wx_fmt=png" style="width: 770px !important; height: 338.408px !important;"></p><p cid="c72" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c73" mdtype="line" style="display: block; box-sizing: border-box;">这个查询包含了条件、分组、分组过滤、排序、限制、聚合函数、子查询，多表查询。什么样的接口才能兼容这样的SQL？</span></p><p cid="c74" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c75" mdtype="line" style="display: block; box-sizing: border-box;">遇到这种两极分化的问题，我的思路通常是二八原则。即</span></p><ul class="list-paddingleft-2" cid="c76" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c78" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c79" mdtype="line" style="display: block; box-sizing: border-box;">封装常用操作，覆盖80%的使用场景。</span></p></li><li><p cid="c81" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c82" mdtype="line" style="display: block; box-sizing: border-box;">暴露底层接口，适配剩余20%的特殊情况。</span></p></li></ul><p cid="c83" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c84" mdtype="line" style="display: block; box-sizing: border-box;">但更多的问题出现：</span></p><h3 cid="c85" mdtype="heading" class="" style="box-sizing: border-box; font-size: 1.5em; margin-bottom: 1rem; font-weight: bold; line-height: 1.43; cursor: text; width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 18px;">问题二：怎么定义常用操作？</span></h3><ul class="list-paddingleft-2" cid="c86" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c88" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c89" mdtype="line" style="display: block; box-sizing: border-box;">对于微信常用的操作，是否也适用于所有开发者？</span></p></li><li><p cid="c91" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c92" mdtype="line" style="display: block; box-sizing: border-box;">现在不使用的操作，以后是否会变成常用？</span></p></li></ul><h3 cid="c93" mdtype="heading" class="" style="box-sizing: border-box; font-size: 1.5em; margin-bottom: 1rem; font-weight: bold; line-height: 1.43; cursor: text; width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 18px;">问题三：常用操作与常用操作的组合，是否仍属于常用操作？</span></h3><p cid="c94" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">查询某个字段的最大值或最小值，应该属于常用操作的：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUictKV2Fnia51euCbPcJoNPaUjD3WDh9gHAhA6BnApvb4thh8icHKPLCvQ/0?wx_fmt=png" style="width: 515px !important; height: 81px !important;"></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">假设可以封装为</span></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUwWKP51ib8JmibwC2n5oUbL5QZbrHj7L0guiarHLmX6TOow7T2B7CjbtKQ/0?wx_fmt=png" style="width: 770px !important; height: 47.6835px !important;"></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">但，SQL是存在组合的能力的。同时查询最大值和最小值，是否仍属于常用操作？</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUhUw7YIzichP0BCtyTnO5Sh3RMhDQyQ7mFUQt1zM876z4Hy9QwXjHlKQ/0?wx_fmt=png" style="width: 770px !important; height: 37.7612px !important;"></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">若以此规则，继续封装为：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUgZxFx9DFqLfjh8Tx3F6YcrVicRMK83ibwzjkHZsRZ8KNatMwpvVR02Ag/0?wx_fmt=png" style="width: 770px !important; height: 24.946px !important;"></p><p cid="c109" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c110" mdtype="line" style="display: block; box-sizing: border-box;">显然，“常用接口”的定义在不断地扩大，接口的复杂性也在增加。以后维护起来，就会疲于加新接口，并且没有边界。</span></p><h3 cid="c111" mdtype="heading" class="" style="box-sizing: border-box; font-size: 1.5em; margin-bottom: 1rem; font-weight: bold; line-height: 1.43; cursor: text; width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 18px;">问题四：特殊场景所暴露的底层接口，应该以什么形式存在？</span></h3><p style="display: block; box-sizing: border-box; margin-top: 5px;">若底层接口还是接受字符串参数的传入，那么前面所思考的一切都是徒劳。</p><p><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: bold; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><br></span></p><p><span style="font-size: 24px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-weight: bold; white-space: pre-wrap; background-color: rgb(255, 255, 255);">SQL语法规则</span><br></p><p cid="c122" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">显然，基于上述问题，我需要一个理论基础，去支持我的封装是合理的，而不仅仅是堆砌接口。</span></p><p cid="c122" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">于是，我找到造成<span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">SQL千变万化组合的根源 --- SQL</span>语法规则：http://www.sqlite.org/lang.html</span><br></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">例如，这是一个</span><code style="color: rgb(51, 51, 51); white-space: pre-wrap; box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">SELECT</code><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">语句的语法规则：</span><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUgicaNwhMT2ItgqqElawM3CtTyUyVOLlVqibLagRbow2pSyxc37nnxDicg/0?wx_fmt=png" style="width: 619px !important; height: 855px !important;"></p><p cid="c128" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c129" mdtype="line" style="display: block; box-sizing: border-box;">SQLite按照图示箭头流向的语法规则解析传入的SQL字符串。每个箭头都有不同的流向可选。</span></p><p cid="c130" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c131" mdtype="line" style="display: block; box-sizing: border-box;">例如，<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">SELECT</code>后，可以直接接<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">result-column</code>，也可以插入<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">DISTINCT</code>或者<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">ALL</code>。</span></p><p cid="c132" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c133" mdtype="line" style="display: block; box-sizing: border-box;">语法规则中的每个字段都有其对应涵义，其中</span></p><ul class="list-paddingleft-2" cid="c134" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c136" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c137" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">SELECT</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">DISTINCT</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">ALL</code>等等大写字母是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">keyword</code>，属于SQL的保留字。</span></p></li><li><p cid="c139" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c140" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">result-column、``table-or-subquery</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>等等小写字母是token。token可以再进一步地展开其构成的语法规则。</span></p></li></ul><p cid="c141" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c142" mdtype="line" style="display: block; box-sizing: border-box;">例如，在<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">WHERE</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">GROUP BY</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">HAVING</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">LIMIT</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">OFFSET</code>后所跟的参数都是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>，它的展开如下：</span></p><p><span class="" cid="c125" mdtype="line" style="display: block; box-sizing: border-box;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nU5SibxVUKREY9gE0OfEdKq37Itr8ct8y1146bmMEmRsZpQVYQhIUqUmA/0?wx_fmt=png" style="width: 770px !important; height: 971.967px !important;"></p><p cid="c145" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c146" mdtype="line" style="display: block; box-sizing: border-box;">可以看到，<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>有很多种构成方式，例如：</span></p><ul class="list-paddingleft-2" cid="c147" mdtype="list" data-mark="*" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c149" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c151" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>: <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">literal-value</code>。<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">literal-value</code>可以进一步展开，它是纯粹的数值。</span></p></li><ul class="list-paddingleft-2" cid="c150" mdtype="list" data-mark="*" style="list-style-type: square;"><li><p cid="c153" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c154" mdtype="line" style="display: block; box-sizing: border-box;">如数字1、数字30、字符串"Hello"等都是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">literal-value</code>，因此它们也是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>。</span></p></li></ul><li><p cid="c156" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c158" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>: <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr (binary operator) expr</code>。两个<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>通过二元操作符进行连接，其结果依然属于<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>。</span></p></li><ul class="list-paddingleft-2" cid="c157" mdtype="list" data-mark="*" style="list-style-type: square;"><li><p cid="c160" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c161" mdtype="line" style="display: block; box-sizing: border-box;">如1+"Hello"。1和"Hello"都是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">literal-value</code>，因此它们都是<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>，通过二元操作符"+"号连接，其结果仍然是一个<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>。尽管1+"Hello"看上去没有实质的意义，但它仍是SQL正确的语法。</span></p></li></ul></ul><p cid="c162" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c163" mdtype="line" style="display: block; box-sizing: border-box;">以刚才那个复杂的SQL中的查询语句为例：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUUqIu5hbj1iaWyk1vNx3JiaqtjGWEkFDyrS9VyeFViaoIqnRRWfnq26uuA/0?wx_fmt=png" style="width: 426px !important; height: 95px !important;"></p><ol class="list-paddingleft-2" start="" cid="c165" mdtype="list" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c167" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c168" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">content IS NOT NULL</code>，符合 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr IS NOT NULL</code>的语法，因此其可以归并为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code></span></p></li><li><p cid="c170" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c171" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">createTime!=modifiedTime</code>，符合 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr (binary operator) expr</code>的语法，因此其可以归并为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code></span></p></li><li><p cid="c173" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c174" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">type NOT BETWEEN 0 AND 2</code>，符合 <code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr NOT BETWEEN expr AND expr</code>的语法，因此其可以归并为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code></span></p></li><li><p cid="c176" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c177" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">1. AND 2.</code>，符合<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr (binary operator) expr</code>的语法，因此其可以归并为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code></span></p></li><li><p cid="c179" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c180" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">4. OR 3.</code>，符合<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr (binary operator) expr</code>的语法，因此其可以归并为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code></span></p></li></ol><p cid="c181" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c182" mdtype="line" style="display: block; box-sizing: border-box;">最终，这么长的条件语句归并为了一个<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>，符合<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">SELECT</code>语法规则中<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">WHERE expr</code>的语法，因此是正确的SQL条件语句。</span></p><p cid="c183" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c184" mdtype="line" style="display: block; box-sizing: border-box;">也正是基于此，可以得出：只要按照SQL的语法封装，就可以保留其组合的能力，就不会错过任何接口，落入疲于加接口的陷阱。</span></p><p cid="c185" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c186" mdtype="line" style="display: block; box-sizing: border-box;">WCDB的具体做法是：</span></p><ol class="list-paddingleft-2" start="" cid="c187" mdtype="list" style="box-sizing: border-box; margin-top: 0.8em; margin-bottom: 0.8em; padding-left: 30px; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><li><p cid="c189" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c190" mdtype="line" style="display: block; box-sizing: border-box;">将固定的keyword，封装为函数名，作为连接。</span></p></li><li><p cid="c192" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.5rem; margin-bottom: 0.5rem; width: inherit;  "><span class="" cid="c193" mdtype="line" style="display: block; box-sizing: border-box;">将可以展开的token，封装为类，并在类内实现其不同的组合。</span></p></li></ol><p cid="c194" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c195" mdtype="line" style="display: block; box-sizing: border-box;">以SELECT语句为例：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUfqLCoGZIic9GCZXjJMIKWtxZYibQmKgDttGPGCwwFAfoZL1aiaphxQJwA/0?wx_fmt=png" style="width: 731px !important; height: 239px !important;"></p><p><span class="" cid="c125" mdtype="line" style="box-sizing: border-box; display: block; font-size: 16px; white-space: pre-wrap;">在语法规则中，<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">WHERE</code>、<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">LIMIT</code>等都接受<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">expr</code>作为参数。因此，不管SQL多么复杂，<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">StatementSelect</code>也只接受<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">Expr</code>的参数。而其组合的能力，则在<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">Expr</code>类内实现。</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUNqneNjwiaPLMm5nzY0vjaemiaXlXhbfia2po4OCJGSkTK8E8tPDKgiayhQ/0?wx_fmt=png" style="width: 770px !important; height: 460.808px !important;"></p><p cid="c200" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c201" mdtype="line" style="display: block; box-sizing: border-box;"><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">Expr</code>通过构造函数和C++的偏特化模版，实现了从字符串和数字等进行初始化的效果。同时，通过C++运算符重载的特性，可以将SQL的运算符无损地移植到过来，使得语法上也可以更接近于SQL。</span></p><p cid="c202" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c203" mdtype="line" style="display: block; box-sizing: border-box;">在对应函数里，再进行SQL的字符串拼接即可。同时，所有传入的字符串都会在这一层预处理，以防注入。如：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUErJmdK30Ee37PlTeHNuxichsmY5vnPVEE0PjJvXEMGasE6DxeUE3TsQ/0?wx_fmt=png" style="width: 770px !important; height: 332.92px !important;"></p><p><span class="" cid="c203" mdtype="line" style="box-sizing: border-box; display: block;"><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">基于这个抽象方式，就可以对复杂查询中的条件语句进行重写为：</span><span md-inline="plain" style="box-sizing: border-box;"></span><br><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"></span></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUaH50Fp7ibM4R0VqoQrwricCTQuUYEiaOcGPJtfJNCZNyccWhia1Ywpz0vQ/0?wx_fmt=png" style="width: 765px !important; height: 391px !important;"></p><p cid="c208" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c209" mdtype="line" style="display: block; box-sizing: border-box;">首先通过<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">Column</code>创建对应数据库字段的映射，再转换为<code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">Expr</code>，调用对应封装的函数或运算符，即可完成字符串拼接操作。</span></p><p cid="c210" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c211" mdtype="line" style="display: block; box-sizing: border-box;">这个抽象便是WCDB的语言集成查询的特性 --- WINQ（<strong style="box-sizing: border-box;"><span md-inline="plain" style="box-sizing: border-box;">W</span></strong>CDB <strong style="box-sizing: border-box;"><span md-inline="plain" style="box-sizing: border-box;">In</span></strong>tegrated <strong style="box-sizing: border-box;"><span md-inline="plain" style="box-sizing: border-box;">Q</span></strong>uery）。</span><span class="" cid="c211" mdtype="line" style="display: block; box-sizing: border-box;"><br></span><span style="font-weight: bold; font-size: 24px;">WINQ+ORM</span></p><hr><p cid="c210" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">更进一步，由于WCDB在接口层的ORM封装，使得开发者可以直接通过</span><code style="box-sizing: border-box; font-family: Consolas, 'Liberation Mono', Courier, monospace; font-size: 0.9em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; padding-top: 2px; padding-right: 4px; padding-left: 4px; background-color: rgb(248, 248, 248);">className.propertyName</code><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">的方式，拿到字段的映射。因此连上述的转换操作也可以省去，查询代码可以在一行代码内完成。</span><br><span style="font-weight: bold; font-size: 24px;"></span></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);">以下是WCDB在接口层和WINQ的支持下，对前面所提到的SQL语句的代码示例：</span><br></p><p><span class="" cid="c203" mdtype="line" style="box-sizing: border-box; display: block; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUFM6pTanhdpOKgDM4HCzCwexBcaicDZicjWCA3eOrQicaFWiamdia1ianZtug/0?wx_fmt=png" style="width: 770px !important; height: 319.932px !important;"></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUv9YUeryRXzo6XmdbOHQBFVQuV4Q6dVrbXYt0RmWyVvF2FlGbtnVibAw/0?wx_fmt=png" style="width: 770px !important; height: 329.06px !important;"></p><p><br></p><h1 cid="c220" mdtype="heading" class="" style="box-sizing: border-box; font-size: 2.25em; margin-bottom: 1rem; font-weight: bold; line-height: 1.2; cursor: text; padding-bottom: 0.3em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); width: inherit; color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; white-space: pre-wrap; background-color: rgb(255, 255, 255); margin-top: 5px;"><span style="box-sizing: border-box; font-size: 24px;">总结</span></h1><p cid="c221" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span style="font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;">WCDB通过WINQ抽象SQLite语法规则，使得开发者可以告别字符串拼接的胶水代码。通过和接口层的ORM结合，使得即便是很复杂的查询，也可以通过一行代码完成。并借助IDE的代码提示和编译检查的特性，大大提升了开发效率。同时还内建了反注入的保护。</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUHymWGP3GsDibO7az9uwGJO7ldTfbSeia74VE0T4w2bCUV2B5cc7iaMoicw/0?wx_fmt=png" style="width: 770px !important; height: 91.3813px !important;"></p><p>（代码提示）</p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McsL8spIZOpvu7KMl6jdR4nUc2iaB5z8qSxTnONIMApotLTVqoPH7z0TM8gVFvAo2pYMC4R98sVrkHg/0?wx_fmt=png" style="width: 770px !important; height: 184.569px !important;"></p><p><span class="" cid="c203" mdtype="line" style="box-sizing: border-box; display: block;">（编译时检查）<br></span></p><p><br></p><p><span class="" cid="c125" mdtype="line" style="box-sizing: border-box; display: block;"></span></p><p cid="c231" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c232" mdtype="line" style="box-sizing: border-box; display: block;"><span md-inline="plain" class="" style="box-sizing: border-box;">虽然WINQ在实现上使用了C++11特性和模版等，但在使用过程并不需要涉及。对于熟悉SQL的开发，只需按照本能即可写出SQL对应的WINQ语句。最终达到提高WCDB易用性的目的。</span>同时，基于C++的实现也使得WINQ在性能可以期待。</span></p><p cid="c233" mdtype="paragraph" style=" box-sizing: border-box; -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; margin-top: 0.8em; margin-bottom: 0.8em; width: inherit;  color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255); "><span class="" cid="c234" mdtype="line" style="box-sizing: border-box; display: block;"><span md-inline="plain" style="box-sizing: border-box;">后续我们还将分享WCDB在多线程管理上的思考。</span></span><span class="" cid="c234" mdtype="line" style="box-sizing: border-box; display: block;"><span md-inline="plain" style="box-sizing: border-box;"><br></span></span><span class="" cid="c234" mdtype="line" style="box-sizing: border-box; display: block;"><span md-inline="plain" style="box-sizing: border-box;"></span></span></p><hr><p><span class="" cid="c234" mdtype="line" style="box-sizing: border-box; display: block;"><span md-inline="plain" style="box-sizing: border-box;"></span>扫码关注WCDB，来Github给我们 star 吧！<br></span></p><p><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McvgYsBSDMUAdEibvxr3BhiaTRT4YUKnTVD4lf9ufehmvAWic2EvpIwUPCuB5OoJ1TO4kSYHHnF7e3jHQ/0?wx_fmt=png" style="width: 222px !important; height: 222px !important;"></p><p><span class="" cid="c234" mdtype="line" style="box-sizing: border-box; display: block;"><br></span></p><p><br></p><p><span class="" cid="c125" mdtype="line" style="box-sizing: border-box; display: block;"><br></span></p><p><br></p><p><span style="color: rgb(51, 51, 51); font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; white-space: pre-wrap; background-color: rgb(255, 255, 255);"><br></span><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1498052765&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ4-HiCbVGjE0gR-2o1d1M*MY48nqNmiBv2r6DzykYQl3fvTZc7EMIgnaeiluKD1fhMQ*It2gbUCvwzlFn5Lzom8v9t*8WZi0lrZRFsdyuyowEHpOH*hRWIxmHnx6kn9oATkXI9il266hYcPU0SnZpNI=">微信地址</a> | <a href="https://github.com/WeMobileDev/article/blob/master/微信移动端数据库组件WCDB系列（三）%20—%20WINQ原理篇.md">阅读原文</a>
{% endraw  %}

