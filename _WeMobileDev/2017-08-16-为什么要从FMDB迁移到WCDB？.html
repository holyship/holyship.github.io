---
title: 为什么要从FMDB迁移到WCDB？
author: sanhuazhang
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1503371640&src=3&ver=1&signature=YIMX93zfyMzYzME-Y*uq2TH8N4Gp7WeUUuK0sswExibssM5h5ghmUN*OWE9LwW67XaMLXy6IcIIEeRL*w99ig8QIOqGZpkcf4YBkMBHEH95yr6kSS*unMd-HYniv0BNpdOtwS6-IcLuk1u4ZKx9AfMD-pnd3kWwfnu7sR9wg7d4=
date: '2017-08-16 00:00:00 +0000'

---

{% raw  %}
<p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><strong><span style="font-size: 24px;">背景</span></strong></p><hr><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 15px;">WCDB 开源至今已两个月有余，我们在不断迭代功能、完善文档的同时，也与来自世界各地的开发者进行交流，帮助他们更快地了解、掌握 WCDB 。这其中，也不乏使用 FMDB 的开发者。他们正准备将项目的数据库模块改为 WCDB 。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于一个已经上线运行的项目，数据库这类基础组件与业务的耦合通常较多，迁移有一定工作量的。因此，开发者通常会做很多预研，以确定是否进行迁移。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB 在 Github 的 wiki 上提供了专门的教程，帮助使用FMDB的开发者进行迁移。同时，也希望通过本文全面地介绍 WCDB 和 FMDB 在使用方式、性能等方面的差异，以及迁移中可能遇到的问题，帮助开发者决定是否进行迁移。</p><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 25px;"><strong><span style="font-size: 24px;">平滑迁移</span></strong></p><hr><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 20px;">文件格式</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 15px;">由于 FMDB 和 WCDB 都基于 SQLite ，因此两者在数据库的文件格式上一致。用 FMDB 创建、操作的数据库，可以直接通过 WCDB 打开、使用。因此开发者无需做额外的数据迁移。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 20px;">表结构</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB 提供了 ORM 的功能，将类的属性绑定到数据库表的字段。在日常实践中，类的属性名和表的字段名通常不一致。因此，WCDB 提供了&nbsp;<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_SYNTHESIZE_COLUMN(className, propertyName, columnName</span>) 宏，用于映射属性名。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于</p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">表：<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">CREATE TABLE message (db_id INTEGER, db_content TEXT)</span></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">类：</p></li></ul><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrqw1mb3fumUxnMYDadzicHUXCKEhE1snRNOkYVToZaLXupzMktufgtRg/0?wx_fmt=png" style="width: 653px !important; height: 355px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">这里表字段都加了"db_"的前缀，并且使用了不一样的字段名。通过 WCDB 的 ORM，可以映射为</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrStaLoXE6pmbqOqZCEIWHO8cW8MwWhicbrD0pFt1fBqtteeiabY8xkNmA/0?wx_fmt=png" style="width: 770px !important; height: 512.725px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">通过 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_SYNTHESIZE_COLUMN</span> 宏映射后，WCDB 同样能兼容 FMDB 的表结构，开发者也不需要做数据迁移。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">因此，开发者可以平滑地从&nbsp;FMDB 迁移到 WCDB 。</p><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 25px;"><strong><span style="font-size: 24px;">性能比较</span></strong></p><hr><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 15px;">对于已经上线运行的项目，解决性能瓶颈会是一个常见的迁移理由。相较于 FMDB 直白的封装， WCDB 上到 OC 层的 ORM ，下到 SQLite 源码，都做了各类性能优化。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">为了验证优化效果，我们提供了 benchmark ，并将性能测试结果和测试代码上传到了 Github 。同时， benchmark 中也加入了 FMDB 的测试代码，用于横向比较。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">以下性能测试均为 WAL 模式、缓存大小2000字节、页大小 4 KB：</p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">PRAGMA cache_size=-2000</span></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">PRAGMA page_size=4096</span></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">PRAGMA journal_mode=WAL</span></p></li></ul><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">测试数据均为含有一个整型和一个二进制数据的表：&nbsp;<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">CREATE TABLE benchmark(key INTEGER, value BLOB) </span>，二进制数据长度为 100 字节。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">读操作性能测试</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrosoW9ib2gPqyuUTiaYXCr09Syq2HRMQt6UOORs5cRUW1I5jY2uicIYw2A/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">写操作性能测试</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWruqicI86HnGW3uweqKkoxCkK027UlicKUDh5gWDibmd1icItOeAlAHtD3MQ/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">批量写操作性能测试 (事务)</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrfXIVaMiahmad8ZicIJ4NrRVWdiaRlfo0v1zuD9aXzHw3XHQibLzRfibGvLQ/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于读操作，SQLite 速度很快，因此封装层的消耗占比较多。 FMDB 只做了最简单的封装， 而 WCDB 还包括 ORM 、 WINQ 等操作，因此执行的指令会比 FMDB 多，从而导致 <strong>WCDB 在读操作上性能劣于 FMDB 5%</strong>&nbsp;。<br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">而写操作通常是性能的瓶颈，我们重点对其做了许多针对性的优化，使得 &nbsp;<strong>WCDB 写操作优于 FMDB 28%、批量写操作优于 FMDB 180%</strong> 。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">多线程读并发性能测试</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWr8DXFt17Yc4z8e7iaSQHJkJia0wWnYzl0PQEuEFzUlH9fhXYW0fg4AZkQ/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">多线程读写并发性能测试</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWribfq6gzvtnWBUx8lMr1ROwyAz7TsyLXNictv38L65RQX6iaJoKAJeiaDLQ/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">多线程写并发性能测试</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrrY9MLFwaI4vlmsy9TP4CnJmRb9pCCqLXNHOOVqA9yLghVAUg8dMhpw/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB 多线程并发的优势，将读操作的性能劣势拉了回来，使得在&nbsp;<strong>读操作 WCDB 的性能与 FMDB 基本持平</strong> ，而 <strong>多线程读写性能则优于 FMDB 62%</strong> 。<br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><strong>在多线程写操作的测试中， FMDB 直接返回错误 SQLITE_BUSY，无法完成</strong>。<br></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">初始化性能测试</span><br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrCsAV9H5mIhxY1hfugicBWVnLy41ibpYUzHUx3RTU20lYJLmIojq6OtVQ/0?wx_fmt=png" style="width: 770px !important; height: 96.3073px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">SQLite 连接的初始化速度会随着数据库内表的数量增加而逐渐上升， WCDB 也针对这个场景做了优化。相较于没有优化的 FMDB ，&nbsp;<strong>WCDB 的初始化速度有 107% 的性能优势</strong>。</p><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 25px;"><strong><span style="font-size: 24px;">易用性比较</span></strong></p><hr><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 15px;">与已经上线运行项目不同，新项目更关注开发的效率。此时数据库的易用和便捷更重要。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于等价的功能， WCDB 所需的代码量往往会比 FMDB 少很多。而更少的代码量通常意味着更快的开发效率和更少的错误。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 20px;">基础操作</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">ORM 是现代客户端数据库比较普遍的功能。 CoreData 、 Realm 都支持 ORM ， WCDB 也不例外。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">FMDB 因其直白的封装，没有提供该功能。但在设计数据库表时，开发者通常会对数据进行建模。因此开发者只需将已有建模用 WCDB 的 ORM 表达出来即可。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于在 FMDB 的一组定义：</p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">表：<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">CREATE TABLE message (localID INTEGER PRIMARY KEY AUTOINCREMENT, content TEXT, createTime INTEGER, modfiedTime INTEGER)</span></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">索引：<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">CREATE INDEX message_index ON message(createTime)</span></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">类：</p></li></ul><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWraibXHjW3L0buyhhhrSib2BEWKQdfsdHAO130bibq3cQN4yUx72sj3ud5g/0?wx_fmt=png" style="width: 606px !important; height: 387px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB需要对其建模，可以定义为<br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrDQ6cUspd9ibtUKNgDE1Q8ex0QZkhgLMhUwbFMzGoatkCyCSoR3bWAUA/0?wx_fmt=png" style="width: 770px !important; height: 659.081px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">其中：<br></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_IMPLEMENTATION(className)</span> 用于定义进行绑定的类<br></p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_PROPERTY(propertyName)</span> 和 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_SYNTHESIZE(className, propertyName)</span> 用于声明和定义字段。</p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_PRIMARY_AUTO_INCREMENT(className, propertyName)</span> 用于定义主键且自增。</p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_INDEX(className, indexNameSubfix, propertyName)</span> 用于定义索引。</p></li></ul><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">虽然 WCDB 多了一步 ORM 的操作，但这是一劳永逸的，并且会给我们后续的使用带来很大的便利。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">经过 ORM 的类，大部分操作都只需要一行代码即可完成。 Talk is cheap，直接看代码对比：</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">查询操作</span></p><p style="text-align: left; line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWr31gRILTyqicEqwwSKez7aN8rI1BnG3Kb4SlWL2MRzNGywqSITw54A3g/0?wx_fmt=png" style="width: 770px !important; height: 198.248px !important;"></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrccnZufhP8eiaaSODrjUxV4TS69Rt6NNWleNFbvQK4UmsguRibAItOeUA/0?wx_fmt=png" style="width: 770px !important; height: 71.5898px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">插入操作</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrWSSbdxaeic5DN8icluxlLOnWF4Fhibn8tu4uzgDjLR0whbBjOHfUatq8A/0?wx_fmt=png" style="width: 770px !important; height: 180.412px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrpdkLh3qL6iac03iaJgWkSHzvavADepLxtV7SzX5mRZo26WVbNmkjH8Pw/0?wx_fmt=png" style="width: 659px !important; height: 132px !important;"></p><p>可以看到，<br></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于查询操作， FMDB 需要进行很多拼装组合，而 WCDB 只需要一行代码就能完成。</p></li><li><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">对于插入操作， FMDB 也只用了一行代码，但其需要将 property 逐个拆分为最基本的类型。而 WCDB 所需要关注的只有 object 和表名两个参数。</p></li></ul><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 20px;">数据库升级</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">SQLite 的数据库升级一直是一个比较繁杂的问题。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">通常的做法是，开发者自行定义一个版本号，并保存下来。数据库创建时每次检查版本号，若版本号较低，则对其字段进行升级，并更新版本号。但在多个版本的增增减减之后，版本的处理逻辑会越来越复杂，甚至可能弄错表内哪些字段是新增的，哪些是废弃的。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB 将数据库升级和 ORM 结合起来，对于需要增删改的字段，只需直接在 ORM 层面修改，并再次调用&nbsp;<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">createTableAndIndexesOfName:withClass: </span>接口即可自动升级。以下是一个数据库升级的例子。</p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWr4RLekA05m4elLYvxRWTXufCEkQlBEmdESLLWU9ptlblIej7WRGH6WQ/0?wx_fmt=png" style="width: 770px !important; height: 749.063px !important;"></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWricPRHAd2eniaXgOiabCTWg4WdjVvFAoODtAdhxrHSBbE2iaCvah31JVpEQ/0?wx_fmt=png" style="width: 770px !important; height: 57.1484px !important;"></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">删除字段</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的&nbsp;<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">createTime</span>&nbsp;字段，删除字段只需直接将 ORM 中的定义删除即可。<br></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">增加字段</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">aNewProperty</span>&nbsp;字段，增加字段只需直接添加 ORM 的定义即可。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">修改字段类型</span><br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">content</span>&nbsp;字段，字段类型可以直接修改，但需要确保新类型与旧类型兼容。<br></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">修改字段名称</span><br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">aNewModifiedTime</span>&nbsp;，字段名称可以通过 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_SYNTHESIZE_COLUMN(className, propertyName, columnName) </span>重新映射。<br></p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">增加约束</span><br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_UNIQUE(Message, aNewModifiedTime)</span>&nbsp;，新的约束只需直接在 ORM 中添加即可。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 10px;"><span style="font-size: 18px;">增加索引</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">如例子中的&nbsp;<span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">WCDB_INDEX(Message, "_newIndex", aNewProperty)</span>&nbsp;，新的索引只需直接在 ORM 添加。</p><p style="text-align: center; line-height: 1.5em; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 20px;">多线程操作</span></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">WCDB 与 FMDB 都支持多线程操作。<br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">在 FMDB 内，当开发者需要进行多线程操作时，需要使用另外一个类 <span style="color: rgb(51, 51, 51); font-family: Consolas, 'Liberation Mono', Courier, monospace; white-space: pre-wrap; background-color: rgb(248, 248, 248); font-size: 16px;">FMDatabasePool</span>来进行操作。<br></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">而 WCDB 基础的 CRUD 接口都支持多线程，因此开发者不需要额外关心线程安全的问题。同样的， WCDB 多线程使用的代码量也比 FMDB 少得多。<br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWr13VoQrc5BibjQtveTOE6a4UuZqy4Zo3JZvR0XNnibjOkjdU7LaeBa5zg/0?wx_fmt=png" style="width: 770px !important; height: 486.515px !important;"></p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;"><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrZ9JPZmQcFsz9kXBZo8PCgWb0YziaDHdR2biavJHhZxCxicU6m67mTwibHw/0?wx_fmt=png" style="width: 770px !important; height: 214.774px !important;"></p><p style="line-height: 1.5em; margin-bottom: 5px; margin-top: 15px;"><strong><span style="font-size: 24px;">功能完整性比较</span></strong></p><hr><p style="line-height: 1.5em; text-align: center; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 18px;">加密</span><br></p><p style="margin-top: 5px; margin-bottom: 5px;">WCDB 基于 SQLCipher 提供了加密功能<br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWr1ZBFEbO6w8ju0Diaxibk52qn5oNVvqcadnIr7ibo3ExHJAhglOuZF7m3g/0?wx_fmt=png" style="width: 444px !important; height: 45px !important;"></p><p style="line-height: 1.5em; text-align: center; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 18px;">统计</span></p><p style="margin-top: 5px; margin-bottom: 5px;">WCDB 内提供统计的接口注册获取数据库操作的 SQL 、性能、错误等，开发者可以将这些信息打印到日志或上报到后台，以调试或统计<br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrOzbibe9lxESwHD5PAZbrVw3KSOHR7hmF8ibhuiae6zATYZLM5MxTiadL9A/0?wx_fmt=png" style="width: 770px !important; height: 255.038px !important;"></p><p style="line-height: 1.5em; text-align: center; margin-top: 15px; margin-bottom: 15px;"><span style="font-size: 18px;">修复</span></p><p style="margin-top: 5px; margin-bottom: 5px;">WCDB 提供了数据库修复工具，以应对数据库损坏无法使用的极端情况。<br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/csvJ6rH9McspjXe8cibHiaJtveNTd7QxWrfvFyqY0JFpg6oUmC6pDfzictoGibjyR3BboDQK24h3G9iaMDUibbdo7kcg/0?wx_fmt=png" style="width: 770px !important; height: 162.913px !important;"></p><p style="margin-top: 15px;"><strong><span style="font-size: 24px;">总结</span></strong></p><hr><p style="margin-bottom: 5px; margin-top: 15px;">与 FMDB 对比， WCDB 使得开发者可以写更少的代码，但能获得更高的性能。开发者不需要额外关注数据库升级和多线程操作的问题。同时， WCDB 还提供了加密、统计、修复等功能。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">因此，对于新项目，我们推荐使用 WCDB ，以获得更好的性能和开发效率。对于已经上线、稳定运行的项目，如果遇到性能瓶颈，或者对加密、统计、修复等功能有需求，我们建议参考 Github 上的文档进行迁移。</p><p style="line-height: 1.5em; margin-top: 5px; margin-bottom: 5px;">后续我们还将加入更多的功能，欢迎来 Github 关注我们。</p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1503371640&src=3&ver=1&signature=YIMX93zfyMzYzME-Y*uq2TH8N4Gp7WeUUuK0sswExibssM5h5ghmUN*OWE9LwW67XaMLXy6IcIIEeRL*w99ig8QIOqGZpkcf4YBkMBHEH95yr6kSS*unMd-HYniv0BNpdOtwS6-IcLuk1u4ZKx9AfMD-pnd3kWwfnu7sR9wg7d4=">微信地址</a> | <a href="https://github.com/WeMobileDev/article/blob/master/%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BB%8EFMDB%E8%BF%81%E7%A7%BB%E5%88%B0WCDB.md">阅读原文</a>
{% endraw  %}

