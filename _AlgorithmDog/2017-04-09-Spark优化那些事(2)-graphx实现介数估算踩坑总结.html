---
title: Spark优化那些事(2)-graphx实现介数估算踩坑总结
author: bourneli
date: '2017-04-09 00:00:00 +0000'

---

{% raw  %}
<h2>作者 bourneli 出身于湖北武汉。23岁时离开武汉，独自一人来到深圳实习并工作，一直到现在。bourneli 在鹅厂工作，工种是（大）数据民工，俗称“提包工程师”，用户包的“包”。业余时间爱写点技术博客，将碰到的问题和解决方案记录下来，方便后面回顾。博客地址: http://bourneli.github.io/</h2><p><br></p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">背景</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">最近一段时间在使用spark graphx实现介数估算。介数（betweenness）可分为点介数和边介数，在图中衡量一个点或边的重要程度，后面的讨论均是针对点介数，边介数实现方式类似。这个指标虽然好，但是计算开销非常之大，如果没有优化，纯粹按照定义计算，复杂度为<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; box-sizing: content-box !important;">O</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">n</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: 0.513em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.361em; padding-bottom: 0.361em; box-sizing: content-box !important;">3</span></span></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><mi>O</mi><mo stretchy="false">(</mo><msup><mi>n</mi><mn>3</mn></msup><mo stretchy="false">)</mo></span></span>(n是节点数)，定义如下:</p><p><span class="" style=" display: block; line-height: 0; text-align: center; font-size: 16px; word-wrap: normal; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; margin-top: 1em; margin-bottom: 1em; color: rgb(17, 17, 17) ; ; ; ; "><span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>B</mi><mi>e</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munder><mo movablelimits=&quot;false&quot;>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mo>&amp;#x2260;</mo><mi>t</mi><mo>&amp;#x2260;</mo><mi>v</mi><mo>&amp;#x2208;</mo><mi>V</mi></mrow></munder><mfrac><mrow><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub></mfrac><mo>,</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.259em; box-sizing: content-box !important;">B</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">e</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.105em; padding-bottom: 0.31em; box-sizing: content-box !important;">=</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: inline-table; width: auto; box-sizing: content-box !important;"><span class="" style="display: table-row; box-sizing: content-box !important;"><span class="" style="display: table-cell; box-sizing: content-box !important;"><span class="" style="display: block; padding-left: 0.801em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-size2-R, MJXc-TeX-size2-Rw; padding-top: 0.72em; padding-bottom: 0.72em; box-sizing: content-box !important;">∑</span></span></span></span></span><span class="" style="display: table-row; box-sizing: content-box !important;"><span class="" style="display: table-cell; font-size: 13.8006px; padding-top: 0.236em; padding-bottom: 0.141em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.412em; padding-bottom: 0.566em; box-sizing: content-box !important;">≠</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.412em; padding-bottom: 0.566em; box-sizing: content-box !important;">≠</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.259em; padding-bottom: 0.361em; box-sizing: content-box !important;">∈</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; padding-right: 0.186em; box-sizing: content-box !important;">V</span></span></span></span></span></span></span></span><span class="" style="display: inline-block; margin-left: 0.167em; box-sizing: content-box !important;"><span class="" style=" display: inline-block; height: 0px;  width: 2.656em; padding-right: 0.12em; padding-left: 0.12em; box-sizing: content-box !important; "><span class="" style=" display: block; text-align: center; box-sizing: content-box !important;  width: 2.656em; top: -1.52em; "><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" style=" display: block; text-align: center; box-sizing: content-box !important;  width: 2.656em; bottom: -0.861em; "><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span></span><span class="" style=" display: block;  height: 0px; border-bottom-width: 1.2px; border-bottom-style: solid; top: -0.282em; width: 2.656em; box-sizing: content-box !important; "></span></span><span class="" style="display: inline-block; width: 0px; height: 2.381em; vertical-align: -0.861em; box-sizing: content-box !important;"></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; margin-top: -0.151em; padding-bottom: 0.515em; box-sizing: content-box !important;">,</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none; width: 206.906px;  padding-top: 1px !important; border: 0px !important; height: 1px !important; overflow: hidden !important; display: block !important; "><mi>B</mi><mi>e</mi><mi>t</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo movablelimits="false">∑</mo><mrow class=""><mi>s</mi><mo>≠</mo><mi>t</mi><mo>≠</mo><mi>v</mi><mo>∈</mo><mi>V</mi></mrow></munder><mfrac><mrow><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub></mfrac><mo>,</mo></span></span></span></p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">其中<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub></span></span>是s，t之间最短路径的数量，<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></span></span>是s，t最短路径中包含节点v的数量。</p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">根据<a style="color: rgb(23, 86, 169);">Brandes的快速介数计算</a>，可以将复杂度降到<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mo stretchy=&quot;false&quot;>(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; box-sizing: content-box !important;">O</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">m</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.31em; padding-bottom: 0.412em; box-sizing: content-box !important;">+</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">n</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">n</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><mi>O</mi><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo><mi>n</mi><mo stretchy="false">)</mo></span></span>(m，n分别是边数和节点数)。但是，即使是spark，面对此计算量计算上百万节点的图仍然不太现实。所以，只能采取折中的方法，也就是估算每个点的介数。最后，仍然是采用<a style="color: rgb(23, 86, 169);">Brandes的介数估算算法</a>，才使复杂度降到可接受的<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; box-sizing: content-box !important;">O</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">m</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.31em; padding-bottom: 0.412em; box-sizing: content-box !important;">+</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">n</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></span></span>。虽然牺牲了部分精度，但是在样本达到一定数据量时，误差可以降到可接受的范围。</p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">本文主要介绍实现该算法时，遇到的性能问题以及解决方法，不会涉及过多算法细节，需要详细了解的读者可以参考文章最后的<strong>参考资料</strong>中的相关论文。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">算法框架</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">首先需要从精确计算介数谈起，首先定义一个变量，称之为dependency，简单来讲，在原始定义中，将源点s固定，v和t变化，形式的定义如下：</p><p><span class="" style=" display: block; line-height: 0; text-align: center; font-size: 16px; word-wrap: normal; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; margin-top: 1em; margin-bottom: 1em; color: rgb(17, 17, 17) ; ; ; ; "><span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>&amp;#x03B4;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mo>&amp;#x2219;</mo></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><munder><mo movablelimits=&quot;false&quot;>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>&amp;#x2260;</mo><mi>v</mi><mo>&amp;#x2208;</mo><mi>V</mi></mrow></munder><mfrac><mrow><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><mi>v</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><msub><mi>&amp;#x03C3;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>t</mi></mrow></msub></mfrac></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.007em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.515em; padding-bottom: 0.31em; padding-right: 0.007em; box-sizing: content-box !important;">δ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.156em; padding-bottom: 0.31em; box-sizing: content-box !important;">∙</span></span></span></span></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.105em; padding-bottom: 0.31em; box-sizing: content-box !important;">=</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: inline-table; width: auto; box-sizing: content-box !important;"><span class="" style="display: table-row; box-sizing: content-box !important;"><span class="" style="display: table-cell; box-sizing: content-box !important;"><span class="" style="display: block; padding-left: 0.36em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-size2-R, MJXc-TeX-size2-Rw; padding-top: 0.72em; padding-bottom: 0.72em; box-sizing: content-box !important;">∑</span></span></span></span></span><span class="" style="display: table-row; box-sizing: content-box !important;"><span class="" style="display: table-cell; font-size: 13.8006px; padding-top: 0.236em; padding-bottom: 0.141em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.412em; padding-bottom: 0.566em; box-sizing: content-box !important;">≠</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.259em; padding-bottom: 0.361em; box-sizing: content-box !important;">∈</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; padding-right: 0.186em; box-sizing: content-box !important;">V</span></span></span></span></span></span></span></span><span class="" style="display: inline-block; margin-left: 0.167em; box-sizing: content-box !important;"><span class="" style=" display: inline-block; height: 0px;  width: 2.656em; padding-right: 0.12em; padding-left: 0.12em; box-sizing: content-box !important; "><span class="" style=" display: block; text-align: center; box-sizing: content-box !important;  width: 2.656em; top: -1.52em; "><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">v</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" style=" display: block; text-align: center; box-sizing: content-box !important;  width: 2.656em; bottom: -0.861em; "><span class="" style="display: inline-block; text-align: left; box-sizing: content-box !important;"><span class="" style="display: inline-block; margin-right: -0.001em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; padding-right: 0.001em; box-sizing: content-box !important;">σ</span></span></span><span class="" style="display: inline-block; font-size: 13.8006px; vertical-align: -0.212em; padding-right: 0.071em; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">s</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.412em; padding-bottom: 0.31em; box-sizing: content-box !important;">t</span></span></span></span></span></span></span><span class="" style=" display: block;  height: 0px; border-bottom-width: 1.2px; border-bottom-style: solid; top: -0.282em; width: 2.656em; box-sizing: content-box !important; "></span></span><span class="" style="display: inline-block; width: 0px; height: 2.381em; vertical-align: -0.861em; box-sizing: content-box !important;"></span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none; width: 176.516px;  padding-top: 1px !important; border: 0px !important; height: 1px !important; overflow: hidden !important; display: block !important; "><msub><mi>δ</mi><mrow class=""><mi>s</mi><mo>∙</mo></mrow></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo movablelimits="false">∑</mo><mrow class=""><mi>t</mi><mo>≠</mo><mi>v</mi><mo>∈</mo><mi>V</mi></mrow></munder><mfrac><mrow><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><msub><mi>σ</mi><mrow class=""><mi>s</mi><mi>t</mi></mrow></msub></mfrac></span></span></span></p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">Brandes的快速介数计算算法中，每计算一轮会将所有v针对固定s的dependency计算出来，计算n轮，然后针对每个v，合并所有dependency，就可以计算每个点介数值。每一轮的计算量包括：一个单源最短路径，一个前置节点搜集，一个依赖合并过程，需要三个pregel过程和一个vertexLeftJoin过程，每一轮的复杂度为<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>O</mi><mo stretchy=&quot;false&quot;>(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; box-sizing: content-box !important;">O</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">(</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">m</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.31em; padding-bottom: 0.412em; box-sizing: content-box !important;">+</span></span><span class="" style="display: inline-block; margin-left: 0.222em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">n</span></span><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.464em; padding-bottom: 0.566em; box-sizing: content-box !important;">)</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></span></span>。介数估算的方法是随机抽取k节点，计算对应的dependency，然后计算每个v的平均dependency并乘以n，得到最终估算结果，理论依据是<a style="color: rgb(23, 86, 169);">霍夫丁不等式</a>(有届随机变量样本均值与均值期望的误差可以控制在一定范围内)。由于<span class="" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>k</mi><mo>&amp;#x226A;</mo><mi>m</mi></math>" role="presentation" style=" display: inline-block; line-height: 0; font-size: 19.52px; word-wrap: normal; word-spacing: normal;  float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding-top: 1px; padding-bottom: 1px;  "><span class="" aria-hidden="true" style="display: inline-block; border-collapse: separate; border-spacing: 0px;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: inline-block; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.464em; padding-bottom: 0.31em; box-sizing: content-box !important;">k</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-main-R, MJXc-TeX-main-Rw; padding-top: 0.259em; padding-bottom: 0.412em; box-sizing: content-box !important;">≪</span></span><span class="" style="display: inline-block; margin-left: 0.278em; box-sizing: content-box !important;"><span class="" style="display: block; white-space: pre; font-family: MJXc-TeX-math-I, MJXc-TeX-math-Ix, MJXc-TeX-math-Iw; padding-top: 0.207em; padding-bottom: 0.31em; box-sizing: content-box !important;">m</span></span></span></span><span class="" role="presentation" style=" top: 0px; left: 0px; clip: rect(1px 1px 1px 1px); -webkit-user-select: none;  padding-top: 1px !important; border: 0px !important; height: 1px !important; width: 1px !important; overflow: hidden !important; display: block !important; "><mi>k</mi><mo>≪</mo><mi>m</mi></span></span>，所以最终复杂度不变。以上就是计算介数估算的大体框架，具体细节请参考<a style="color: rgb(23, 86, 169);">Brades介数估算论文</a>，里面有估算的误差估计证明以及实验效果。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">性能瓶颈</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">算法过程虽然不复杂，但是在实现时却遇到了性能瓶颈。经过排查，每一轮dependency计算开销相对稳定，主要不稳定的开销在最后按点聚合dependency的过程中。在百万点，千万边的无标度图中，该过程有时候只需要<strong>几分钟</strong>，但是大多数时候却需要<strong>几小时甚至更多</strong>！所以，主要的优化点就是如何提高聚合这块的性能。此过程经过了几轮改造，最后将此步骤的耗时稳定在几分钟，下面分享此过程的演进过程。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">版本1：逐步聚合 vs 合并后聚合</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">聚合的第一个版本，可以用下面简化代码演示，</p><p><br></p><figure class="" style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; "><pre style="margin-top: 0px; margin-bottom: 15px; padding: 8px 12px; font-size: 15px; border: 1px solid rgb(232, 232, 232); border-radius: 3px; overflow-x: auto; background-color: rgb(238, 238, 255);"><code class="" data-lang="scala" style="border: 0px; border-radius: 3px; padding-top: 1px; padding-bottom: 1px;"><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 计算依赖<br></span><span class="" style="font-weight: bold;">def</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Int</span><span class="" style="font-weight: bold;">,</span> <span class="">graph</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">])</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">RDD</span><span class="" style="font-weight: bold;">[(</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Long</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">)]</span> <br><span class="" style="font-weight: bold;"> &nbsp; &nbsp;=</span> <span class="" style="font-weight: bold;">{</span> <span class="" style="font-weight: bold;">...</span> <span class="" style="font-weight: bold;">}</span> &nbsp;<br><span class="" style="font-weight: bold;">val</span> <span class="">data</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">...</span> <br><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// loading from hdfs<br><br></span><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 随机抽样<br></span><span class="" style="font-weight: bold;">val</span> <span class="">idList</span> <span class="" style="font-weight: bold;">=</span> <span class="">data</span><span class="" style="font-weight: bold;">.</span><span class="">vertices</span><span class="" style="font-weight: bold;">.</span><span class="">takeSample</span><span class="" style="font-weight: bold;">(</span><span class="" style="color: rgb(0, 153, 153);">10</span><span class="" style="font-weight: bold;">)<br><br></span><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 方案1：全部聚合，然后统一reduceByKey，只有一次shuffle<br></span><span class="" style="font-weight: bold;">val</span> <span class="">rst1</span> <span class="" style="font-weight: bold;">=</span> <span class="">idList</span><span class="" style="font-weight: bold;">.</span><span class="">map</span><span class="" style="font-weight: bold;">(</span><span class="">id</span> <span class="" style="font-weight: bold;">=&gt;</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">,</span> <span class="">data</span><span class="" style="font-weight: bold;">))</span><span class="" style="font-weight: bold;">.</span><span class="">reduce</span><span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">_</span> <span class="">union</span> <span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">).</span><span class="">reduceByKey</span><span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">+</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">)</span>	<br>		 <br><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 方案2：每一步都聚合，减少内存使用，但有多次shuffle<br></span><span class="" style="font-weight: bold;">val</span> <span class="">rst2</span> <span class="" style="font-weight: bold;">=</span> <span class="">idList</span><span class="" style="font-weight: bold;">.</span><span class="">map</span><span class="" style="font-weight: bold;">(</span><span class="">id</span> <span class="" style="font-weight: bold;">=&gt;</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">,</span> <span class="">data</span><span class="" style="font-weight: bold;">))</span><span class="" style="font-weight: bold;">.</span><span class="">reduce</span><span class="" style="font-weight: bold;">((</span><span class="">l</span><span class="" style="font-weight: bold;">,</span><span class="">r</span><span class="" style="font-weight: bold;">)</span> <span class="" style="font-weight: bold;">=&gt;</span> <span class="" style="font-weight: bold;">(</span><span class="">l</span> <span class="">union</span> <span class="">r</span><span class="" style="font-weight: bold;">).</span><span class="">reduceByKey</span><span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">+</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">))</span></code></pre></figure><p><br></p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">在第一个版本中，尝试过上面两个方案:1)先全部union，然后一次shuffle，这样在聚合的时会对内存要求过高；2)逐步聚合，虽然有多次shuffle，但是减少内存使用。两个方案可以理解为空间与实践的置换，前置空间换时间，后者用时间换空间。但很不幸，两方案均有性能瓶颈！后来经过分析与网上求助，最终找到问题所在：两个方案都使血缘(lineage)变长了。比如第一个方案，第一个dependency的结果在最后的结果中，会经过9次血缘，第二个dependency经过了8此，以此类推。而第二个方案，更加可怕，第一个经过了18次，第二个是16次。这么长的血缘，出错的几率是非常大的，所以需要大量的重跑，这也是导致最后shuffle不稳定的原因，有大量出错导致重计算。网上有个类似问题，可以参考<a style="color: rgb(23, 86, 169);">Stackoverflow due to long RDD Lineage</a>。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">版本2：批量union，减少血缘</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">spark context对象提供一个union方法，用于批量聚合若干个rdd，并且没有血缘叠加效果，最终，将代码改为如下：</p><p><br></p><figure class="" style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; "><pre style="margin-top: 0px; margin-bottom: 15px; padding: 8px 12px; font-size: 15px; border: 1px solid rgb(232, 232, 232); border-radius: 3px; overflow-x: auto; background-color: rgb(238, 238, 255);"><code class="" data-lang="scala" style="border: 0px; border-radius: 3px; padding-top: 1px; padding-bottom: 1px;"><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 计算依赖<br></span><span class="" style="font-weight: bold;">def</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Int</span><span class="" style="font-weight: bold;">,</span> <span class="">graph</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">])</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">RDD</span><span class="" style="font-weight: bold;">[(</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Long</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">)]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">{</span> <span class="" style="font-weight: bold;">...</span> <span class="" style="font-weight: bold;">}</span> &nbsp;<br><span class="" style="font-weight: bold;">val</span> <span class="">data</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">...</span> <br><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// loading from hdfs<br><br></span><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 随机抽样<br></span><span class="" style="font-weight: bold;">val</span> <span class="">idList</span> <span class="" style="font-weight: bold;">=</span> <span class="">data</span><span class="" style="font-weight: bold;">.</span><span class="">vertices</span><span class="" style="font-weight: bold;">.</span><span class="">takeSample</span><span class="" style="font-weight: bold;">(</span><span class="" style="color: rgb(0, 153, 153);">10</span><span class="" style="font-weight: bold;">)<br><br></span><span class="" style="font-weight: bold;">val</span> <span class="">rst1</span> <span class="" style="font-weight: bold;">=</span> <span class="">sc</span><span class="" style="font-weight: bold;">.</span><span class="">union</span><span class="" style="font-weight: bold;">(</span><span class="">idList</span><span class="" style="font-weight: bold;">.</span><span class="">map</span><span class="" style="font-weight: bold;">(</span><span class="">id</span> <span class="" style="font-weight: bold;">=&gt;</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">,</span> <span class="">data</span><span class="" style="font-weight: bold;">))).</span><span class="">reduceByKey</span><span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">+</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">)</span> 	 </code></pre></figure><p><br></p><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">上面的代码虽然减少了每个dependency RDD的血缘，但是shuffle还是很慢且不稳定。shuffle阶段有时需要几分钟，有时需要数个小时。不知道是不是由于需要同时容纳数个rdd，占据了大量内存，然后不断出现错误，进而导致重新计算，最终shuffle变得不稳定，这一点还有待证实。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">版本3：RDD合并取代graphx leftJoin合并</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">版本2的问题是需要在内存中保存过多的中间节点，导致内存被拜拜浪费掉。所以，版本3在每一轮都有一个按点合并结果的过程。一开始使用graph对象的joinVertices方法合并中间结果，但是会导致每一轮的时间莫名奇妙得增加，而且是呈指数增长（这个坑后面可能还会遇到）。改用RDD规避，避免了这个问题。简化代码如下：</p><p><br></p><figure class="" style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; "><pre style="margin-top: 0px; margin-bottom: 15px; padding: 8px 12px; font-size: 15px; border: 1px solid rgb(232, 232, 232); border-radius: 3px; overflow-x: auto; background-color: rgb(238, 238, 255);"><code class="" data-lang="scala" style="border: 0px; border-radius: 3px; padding-top: 1px; padding-bottom: 1px;"><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// 计算依赖<br></span><span class="" style="font-weight: bold;">def</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">id</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Int</span><span class="" style="font-weight: bold;">,</span> <span class="">g</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">])</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">RDD</span><span class="" style="font-weight: bold;">[(</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">VertexId</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">)]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">{</span> <span class="" style="font-weight: bold;">...</span> <span class="" style="font-weight: bold;">}</span> <br><span class="" style="font-weight: bold;"><br>val</span> <span class="">data</span><span class="" style="font-weight: bold;">:</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Graph</span><span class="" style="font-weight: bold;">[</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">...</span> <br><span class="" style="color: rgb(153, 153, 136); font-style: italic;">// loading from hdfs<br><br></span><span class="" style="font-weight: bold;">val</span> <span class="">sampleVertices</span> <span class="" style="font-weight: bold;">=</span> <span class="">data</span><span class="" style="font-weight: bold;">.</span><span class="">vertices</span><span class="" style="font-weight: bold;">.</span><span class="">takeSample</span><span class="" style="font-weight: bold;">(</span><span class="" style="color: rgb(0, 153, 153);">10</span><span class="" style="font-weight: bold;">)<br></span><span class="" style="font-weight: bold;">var</span> <span class="">rst</span><span class="" style="font-weight: bold;">:</span> <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">RDD</span><span class="" style="font-weight: bold;">[(</span><span class="" style="color: rgb(68, 85, 136); font-weight: bold;">VertexId</span>, <span class="" style="color: rgb(68, 85, 136); font-weight: bold;">Double</span><span class="" style="font-weight: bold;">)]</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">null</span><span class="" style="font-weight: bold;">for</span><span class="" style="font-weight: bold;">(</span><span class="">source</span> <span class="" style="font-weight: bold;">&lt;-</span> <span class="">sampleVertices</span><span class="" style="font-weight: bold;">)</span> <span class="" style="font-weight: bold;">{<br></span><span class="" style="font-weight: bold;"> &nbsp; &nbsp;val</span> <span class="">newDep</span> <span class="" style="font-weight: bold;">=</span> <span class="">dependency</span><span class="" style="font-weight: bold;">(</span><span class="">source</span><span class="" style="font-weight: bold;">,</span> <span class="">data</span><span class="" style="font-weight: bold;">).</span><span class="">persist</span><span class="" style="font-weight: bold;">(</span><span class="">cacheLevel</span><span class="" style="font-weight: bold;">)<br></span><span class="" style="font-weight: bold;"> &nbsp; &nbsp;if</span> <span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">null</span> <span class="" style="font-weight: bold;">==</span> <span class="">rst</span><span class="" style="font-weight: bold;">)</span> <span class="" style="font-weight: bold;">{<br></span><span class=""> &nbsp; &nbsp; &nbsp; &nbsp;rst</span> <span class="" style="font-weight: bold;">=</span> <span class="">newDep<br></span><span class="" style="font-weight: bold;"> &nbsp; &nbsp;}</span> <span class="" style="font-weight: bold;">else</span> <span class="" style="font-weight: bold;">{<br></span><span class=""> &nbsp; &nbsp; &nbsp; &nbsp;rst</span> <span class="" style="font-weight: bold;">=</span> <span class="" style="font-weight: bold;">(</span><span class="">rst</span> <span class="">union</span> <span class="">newDep</span><span class="" style="font-weight: bold;">).</span><span class="">reduceByKey</span><span class="" style="font-weight: bold;">(</span><span class="" style="font-weight: bold;">_</span> <span class="" style="font-weight: bold;">+</span> <span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">).</span><span class="">persist</span><span class="" style="font-weight: bold;">(</span><span class="">cacheLevel</span><span class="" style="font-weight: bold;">)<br></span><span class="" style="font-weight: bold;"> &nbsp; &nbsp;}<br></span><span class="" style="font-weight: bold;">}<br><br></span><span class="" style="font-weight: bold;">val</span> <span class="">finalRst</span> <span class="" style="font-weight: bold;">=</span> <span class="">rst</span><span class="" style="font-weight: bold;">.</span><span class="">mapVertices</span><span class="" style="font-weight: bold;">((</span><span class="" style="font-weight: bold;">_</span><span class="" style="font-weight: bold;">,</span> <span class="">attr</span><span class="" style="font-weight: bold;">)</span> <span class="" style="font-weight: bold;">=&gt;</span> <span class="">attr</span> <span class="" style="font-weight: bold;">*</span> <span class="">verticesNum</span> <span class="" style="font-weight: bold;">/</span> <span class="">sampleSize</span><span class="" style="font-weight: bold;">)</span> <br><span class="" style="font-weight: bold;">//</span> <span class="">合并</span></code></pre></figure><p><br></p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">计算效果</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">经过上面几轮优化后，效果有了大幅度提升。还有一些优化的小技巧，这里捎带提一下，比如使用EdgePartition2D的边分区策略可以进一步提高执行效率，合理的释放和缓存图对象也可以减少血缘，减少重算时间。现在使用100个executor，2核，每个executor 14G内存，对450,000,000点，1,253,792,736 边的图，随机迭代5轮，需要一千多分钟，每轮平均200分钟。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">spark优化总结</h2><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">spark底层api优化其实就两点 ：</p><ol style=" margin-bottom: 15px; margin-left: 30px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; " class="list-paddingleft-2"><li><p><strong>减少血缘</strong>&nbsp;合理仔细的利用persisit，checkpoint和unpersisit，缓存中间变量并去掉无用的对象，避免过长的血缘重计算与合理的利用内存。但是，如果不适当的释放内存，可能导致没有缓存对象，仍然导致过长的血缘，这一点可以参考<a style="color: rgb(23, 86, 169);">Spark优化那些事(1)-请在action之后unpersisit!</a>。</p></li><li><p><strong>减少shuffling</strong>&nbsp;shuffling需要网络开销，能少就少，能不用就不用。</p></li></ol><p style=" margin-bottom: 15px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; ">上面的迭代过程其实就遵循上面两个原则进行的，最后得到了不错的效果。graphx的api使用起来还是有一定的坑，后面还需要多注意，并且研究graphx底层实现细节，希望可以发现版本3中的那个坑。</p><h2 style=" margin-bottom: 15px; font-size: 32px; color: rgb(17, 17, 17) ; ; ; ; ; ">参考资料</h2><ul style=" margin-bottom: 15px; margin-left: 30px; color: rgb(17, 17, 17) ; ; ; ; ; ; ; " class="list-paddingleft-2"><li><p><a style="color: rgb(23, 86, 169);">Brandes的快速介数计算</a>&nbsp;</p><p>http://algo.uni-konstanz.de/publications/b-fabc-01.pdf</p></li><li><p><a style="color: rgb(23, 86, 169);">Brandes的介数估算算法</a></p><p><a style="color: rgb(23, 86, 169);">http://algo.uni-konstanz.de/publications/bp-celn-06.pdf</a></p></li><li><p><a style="color: rgb(23, 86, 169);">Stackoverflow due to long RDD Lineage</a></p><p><a style="color: rgb(23, 86, 169);">http://stackoverflow.com/questions/34461804/stackoverflow-due-to-long-rdd-lineage</a></p></li></ul><p>原文链接：</p><p><strong>http://bourneli.github.io/scala/spark/sns/graphx/graph/2016/06/24/betweenness-with-spark-graphx-optimazation.html</strong></p>
{% endraw  %}

