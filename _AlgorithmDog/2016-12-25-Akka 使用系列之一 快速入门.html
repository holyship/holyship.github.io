---
title: 'Akka 使用系列之一: 快速入门'
author: lietal
date: '2016-12-25 00:00:00 +0000'

---

{% raw  %}
<p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp; &nbsp; &nbsp;最近在看 Spark 相关的资料，准备整理一个 Spark 系列。Akka 是 Spark 实现内部通讯的组件，Spark 启动过程的第一步便是建立 Akka 的 ActorSystem。因此看了有几篇文章学习了下 Akka 相关知识。<span style="border: 0px; vertical-align: baseline; background: transparent;"></span></p><p><a rel="attachment wp-att-3677" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"><img src="/AlgorithmDog/images/78b591024347057b2e704a3a3e5727c5f57997c3.png" style="border: none; vertical-align: baseline; background: transparent; width: 770px !important; height: 49.8561px !important; visibility: visible !important;"></a></p><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;"><br></span></h3><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;">1 Actor 模型和 Akka 简介</span></h3><hr><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;"></span><br></h3><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actor 模型由 Carl Hewitt 于上世纪70年代早期提出，目的是为了解决分布式编程中一系列的编程问题。Actor 的要点包括：Actor 是一个个相互之间独立的实体; Actor 可以通过消息来通信，一个 Actor 收到其他Actor的信息后，可以根据需要作出各种相应反应；消息的类型可以是任意的，消息的内容也可以是任意的；当一个 Actor 收到多个消息时，它先建立一个消息队列，将接收到的消息就放入队列，每次从队列中取出一个消息体进行处理。</p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Akka 是一个用 Scala 编写的库，用于简化编写容错的、高可伸缩性的 Java 和 Scala 的 Actor 模型应用。Akka 使得开发人员可以更轻松地开发正确的具有容错性、可扩展性和跨平台的并发程序，在工业界得到了广泛应用。</p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; "><br></p><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;">2 Akka 入门</span></h3><hr><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;"></span><br></h3><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 下面我们将从一个学生老师例子出发，快速入门 Actor 模型。例子是从博客&nbsp;<a style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;">rerun&nbsp;</a>拿来的 (我就是看这个博客学习 Akka 的，强烈推荐英语好的同学看看)。这个例子有两个角色，一个是勤学好问的学生，一个是睿智的老师。每天早上，学生都会给老师发送一封邮件，向老师请教问题；而老师看到邮件之后，通过邮件给学生发送答案。在这个过程中，有几点需要注意：</p><blockquote style=" border: 0px; padding-right: 3em; padding-left: 3em; vertical-align: baseline; quotes: none; font-style: italic; color: rgb(51, 51, 51); ; ; ; ; ; ; "><p style="border: 0px; margin-bottom: 24px; vertical-align: baseline; background: transparent;">1. 邮件一旦发送，就不能改变；<br>2. 学生和老师都按照自己的工作节奏检查邮箱；<br>3. 学生发送邮件之后，可以不等老师的回复。即工作流程可以是阻塞，也可以是非阻塞；</p></blockquote><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Akka 用于简化编写容错的、高可伸缩性的 Actor 模型应用，即我们很容易用 Akka 实现上述学生老师的 Actor 模型。我们先建立老师 Actor, 将老师 Actor 实现成一个服务（我是不是想歪了），代码如下所示。</p><p><img src="/AlgorithmDog/images/644c9c6649259d144d1fe4cad79d79757002473c.png" style="width: 634px !important; height: 737px !important;"><br></p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">然后我们建立学生 Actor, 将学生 Actor 作为客户端。</p><p><img src="/AlgorithmDog/images/800e205362b23637e84139979024448c0d8d8bdf.png" style="width: 636px !important; height: 734px !important;"><br></p><p><br></p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">不管是服务端还是客户端，程序开始都从 lietal.conf 配置文件读入相应的配置。其中服务端读入 RemoteServerSideActor 的配置，而客户端读入 RemoteClientSideActor 的配置。lietal.conf 配置文件放在资源目录 src/main/resources，以便打包时打入包内。lietal.conf 的内容如下所示。</p><p><img src="/AlgorithmDog/images/66ccb4dbb6806ae558340109c471d500733364ae.png" style="width: 633px !important; height: 609px !important;"><br></p><p><br></p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">从配置文件来看，如果我们在服务端启动两个老师 Actor， 他们会共用一个端口。我们很容易理解，所有发往老师 Actor 的消息都发往了服务器的一个端口，Akka 内部有一套机制将消息分发到不同的 Actor 中。这套机制就是 Akka 的 dispatcher，负责分发不同的消息到不同的 Actor。</p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;完整项目代码已经上传到&nbsp;https://github.com/algorithmdog/AkkaUsageLearner&nbsp;上了，需要的同学自取。将完整项目打包之后，分别以 TearcherService 和 StudentClient 为主类运行程序，老师 Actor 和学生 Actor 之间的通信就运行起来了。下面是老师服务端运行的结果。</p><p><a rel="attachment wp-att-3684" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"><img src="/AlgorithmDog/images/cfd34cc6083bc4677631dab9fee810c5572ea06d.png" style="border: none; vertical-align: baseline; background: transparent; width: 770px !important; height: 49.8561px !important;"></a></p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">下面是学生客户端运行的结果。</p><p><a rel="attachment wp-att-3685" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"><img src="/AlgorithmDog/images/b1baaa390452d2e8b48457f43690ef0728e3fbae.png" style="border: none; vertical-align: baseline; background: transparent; width: 770px !important; height: 49.8561px !important;"></a></p><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;"><br></span></h3><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;">3 总结</span></h3><hr><h3 style=" border: 0px; margin-bottom: 10px; vertical-align: baseline; clear: both; line-height: 1.5em; ; ; ; ; "><span style="border: 0px; vertical-align: baseline; background: transparent;"></span><br></h3><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 一开始我只想实现一个单机版本的老师学生 Actor，实现之后发现不能体现 Akka 的特点，因此又实现一个网络版的老师学生 Actor。实现完网络版之后，稍微加深了对 Actor 之间消息传递的理解。完整项目代码已经上传到&nbsp;<span style=" color: rgb(51, 51, 51); ; ; ; ;  ; ">https://github.com/algorithmdog/AkkaUsageLearner&nbsp;</span>上啦。欢迎关注我的公众号，每两周的更新就会有提醒哦~</p><p><br></p><p><a rel="attachment wp-att-2360" style="border: 0px; vertical-align: baseline; color: rgb(116, 51, 153); background: transparent;"><img src="/AlgorithmDog/images/c39384a9c7388c734f113fcca04d22e5d5e34238.png" style="width: 702px !important; height: 330px !important;"><br></a><span style=" color: rgb(51, 51, 51); ; ; ; ; ; ">&nbsp; &nbsp; &nbsp;&nbsp;</span></p><p style=" border: 0px; margin-bottom: 24px; vertical-align: baseline; color: rgb(51, 51, 51); ; ; ; ; ; ; ">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 本文主要参考了 http://shiyanjun.cn/archives/1178.html 和 http://rerun.me/2014/09/11/introducing-actors-akka-notes-part-1/ 两篇博客。第一篇博客注重实战，代码比较完整；第二篇则深入浅出的解释了相关的概念原理。推荐大家阅读。</p><p><br></p>
{% endraw  %}

