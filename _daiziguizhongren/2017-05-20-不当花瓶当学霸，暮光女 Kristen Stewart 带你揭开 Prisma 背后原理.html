---
title: 不当花瓶当学霸，暮光女 Kristen Stewart 带你揭开 Prisma 背后原理
author: 待字闺中
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1495452014&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZeYVl3MPrfULvuQN3FOkNjyKsPiaoj23UV3Kd7-GA61ZsZXcn1BAwas1Y38gNphQGfrVKaY*E7czilC4AMBhzA9L6lxjtpp-C7CCJtSMaiAbs6O8Vt8P6XKQpaMUvCrMCDn3V1Sz976DeDKWpYOJjFLI=
date: '2017-05-20 00:00:00 +0000'

---

{% raw  %}
<p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">“基于人工智能”、“不同于传统滤镜”这些用词，加上看作品画风，让人联想起&nbsp;2016&nbsp;年大火、仅次于&nbsp;Pokeman Go&nbsp;的&nbsp;APP——Prisma。</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">之前看到一篇文章说，困扰 Prisma 团队最大问题就是 ---</p><blockquote style="margin-top: 20px; margin-bottom: 20px; padding-left: 1.2em; max-width: 100%; box-sizing: inherit; border-left-width: 4px; border-left-color: rgb(226, 227, 228); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; word-wrap: break-word !important;">我们没有在 marketing 投入过一分钱，但还是火得太快，我们的服务器承载能力完全跟不上用户的增长。</p></blockquote><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">火得太快，火得太快，火得太快，不得不说，这个装逼我必须给满分！</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">Prisma 背后的原理其实起源于论文&nbsp;<a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Gatys et al, “Image Style Transfer using Convolutional Neural Networks”, CVPR 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a>。这篇惊世之作一出，在学术界和工业界刮起来两股热潮。学术界陆续提出融合多种风格的算法，转换视频的算法，一次输出多种风格的算法，等等。工业界则做出网站，应用，小工具让人们给自己的照片加上梵高的风格。可以称得上是所有人的狂欢了。</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">什么？论文太高大上这辈子都和我没关系？ 女神 Kristen Stewart 你们认不认识？人家拍电影拍着拍着都拍进学术界了，在世界最顶级的计算机图像会议CVPR发了篇&nbsp;<a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Bringing Impressionism to Life with Neural Style Transfer in Come Swim<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a>。可见人人都能发 CVPR 啊，你还不赶紧来学吗？</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><img src="/daiziguizhongren/images/1cc2359cd62de618accd4981c75bb590da39006a.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: auto !important; height: auto !important;">那究竟这篇论文是做什么的呢？ 融合一张图片的内容，和一张图片的风格，生成一张新的图片。<img src="/daiziguizhongren/images/2fce1f4a18c140f648603bb086ecb99b1976c4b2.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 162px !important;"><br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">接下来就来详细说说这篇论文的算法原理，再给出一个我的实现，最后再说说学术界后续的一些研究和相关的其他算法。Prisma 真实使用的算法应该是在这篇论文的基础上发展过的更高效率的算法，因为这第一篇论文中的算法效率实在不怎么样，当然这丝毫不影响这篇论文的伟大。</p><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">量化问题</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">算法的任务很简单，输入一张内容图片，一张风格图片，输出风格化以后的内容图片。</p><ul class="list-paddingleft-2" style="margin-top: 20px; margin-bottom: 20px; padding-left: 24px; max-width: 100%; box-sizing: inherit; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">输入：Content Image，Style Image</p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">输出：Stylized Image</p></li></ul><blockquote style="margin-top: 20px; margin-bottom: 20px; padding-left: 1.2em; max-width: 100%; box-sizing: inherit; border-left-width: 4px; border-left-color: rgb(226, 227, 228); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; word-wrap: break-word !important;">风格化以后的内容图片</p></blockquote><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">这个表达很主观，算法需要一个客观的判断，一个可以量化的标准。这样才有前进的方向。换一个数学一点的表达，我们需要找一个图片，内容上和内容图片差不多，风格上和风格图片差不多。这两个表达我们也需要量化，也就是要有一个数字来衡量差不多，所以我们需要有两个函数来分别衡量内容和风格上的差异。<img src="/daiziguizhongren/images/74969d894660ff20331bbd1c0d626d72623e354e.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 222px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">最后我们需要找到图片来同时降低这两个差异。所以风格转化的问题变成了如下的优化问题（Optimization Problem）<img src="/daiziguizhongren/images/594e8c956750836d2e3c9ea0659ef6e6f56e6321.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 153px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">其中c代表 content image 内容图片，s代表 style image 风格图片，x代表 stylized image 合成图片。我们要找到使得整体偏差最小的x作为最后的结果。整体偏差就是内容偏差和风格偏差的加权平均。 α，β是两者的权重。希望风格更明显，风格的权重就大一些，希望内容更明显，内容的权重就大一些。</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">现在，有三个问题放在眼前</p><ol class="list-paddingleft-2" style="margin-top: 20px; margin-bottom: 20px; padding-left: 24px; max-width: 100%; box-sizing: inherit; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/daiziguizhongren/images/dece6c80785ae7ab29fd9c3dcb59680f0ffe2d62.png" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 57px !important; height: 34px !important;">如何定义？<span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;</span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/daiziguizhongren/images/47185fcf3223b5e5a7952011b796e1122b3a9a07.png" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 54px !important; height: 32px !important;"><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">如何定义？</span></p></li><li><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">如何最小化？</p></li></ol><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">我们一个个来搞定</p><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">卷积神经网络</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">所有的偏差函数都依赖卷积神经网络，所以必须要来简单介绍一下。时下最流行的深度学习模型就是卷积神经网络了。干嘛的呢？做常见的应用，他是做图片分类的。<img src="/daiziguizhongren/images/75ff387c93638671d2ffea04c0b08c5d86ef3a0c.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 233px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">我们用神经网络来表达一个函数，输入一张图片，输出各个类的概率。为什么叫神经网络我就不说了，他和人的神经系统其实最多只有半毛钱关系。重要的是，这个神奇的神经网络，分析了输入图片的多种特征。 底层的网络分析了细节特征，例如直线，曲线，三角，方块，等等。高层的网络分析了高层一些的特征，例如鼻子，眼睛，嘴巴等等。</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">我们来看一下一张汽车图片放到卷积神经网络里面，会是如何的样子？<img src="/daiziguizhongren/images/7d7251aa0601563c3d16498a61d4d16052f212f3.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 283px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">汽车图片进入网络后，会被在每一层会提取出它拥有的特征，并传递到下一个网络中。深度学习的科学家们很多时间都在研究如何训练这个神经网络使得他的分类能力最准确。幸运的事，我们这个问题我们不用去分类，用不着训练网络，我们只要用现有的已经训练好的网络就好了。我们需要的是每一层的特征，两个偏差函数，都是通过比较每一层的特征计算而得的。我们会使用下图所示的VGG16网络，其中包括13个卷积层，每一层的输出都是我们的所需要的特征。接着我们就会比较这些特征来计算偏差函数。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/daiziguizhongren/images/3aa64812981d271f16f484d41d5afcf801fcbbb6.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; color: rgb(51, 51, 51); word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 648px !important;"></p><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">计算内容偏差</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">要比较两个图片的内容差别，其实就看看他们最高层的特征是否一致就行。例如两个图片都有大桥这个特征，两个图片都有一个人等等共同特征，那么我们通常认为他们是一样内容的。<img src="/daiziguizhongren/images/43c9580fb3e1fd48815b19636850a5b2fedfe6e7.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 134px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">其中c，x代表内容图片和合成图片，$C_{i,j}^l, X_{i,j}^l$ 分别表示内容图片和合成图片的第l层，第i个特征，第j纬度的值。其实式子也没有分复杂，就是计算了两个向量的欧氏距离。</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">Tensorflow 代码实现</p><pre style="margin-top: 1em; margin-bottom: 1em; padding: 0px 1em; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); font-size: 16px; background-color: rgb(255, 255, 255); overflow: auto; word-wrap: break-word !important;"><code style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"></span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">def</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; color: rgb(153, 0, 0); word-wrap: break-word !important;">create_content_loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>

	<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_layer_names</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv3_1/conv3_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">]</span> <span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;"># we use the toppest layer for content loss </span>
	<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layers</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">get_layer_tensors</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_layer_names</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;	<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_dict</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">create_feed_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">image</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">session</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">run</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layers</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">feed_dict</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">constant</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">value</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">stylized_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layers</span> <span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#laybers will be evaluated during runtime</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">with</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">graph</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">as_default</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">():</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[]</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">for</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v1</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v2</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">in</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 128, 128); word-wrap: break-word !important;">zip</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_values</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">stylized_values</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mean_squared_error</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v1</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v2</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">append</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>

 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">total_loss</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">reduce_mean</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">return</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">total_loss</span></code></pre><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">计算风格偏差</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">比较两个图片的风格偏差会稍微复杂一点。如何用数学的式子体现两个内容完全不同的图片，风格一样呢？光光比较他们的特征是不够的，因为一个图里有桥，另一个图里可能没有。因此我们要比较两个图的特征互相之间的关系。这简直是一个天才的想法！我们用 Gram Matrix 来描述多个特征相互之间的关系，然后来比较两个图的 Gram Matrix 的距离来衡量风格的相似程度。如果 Gram Matrix 相近，即特征相互之间的关系相近，那也就说明风格相近。<img src="/daiziguizhongren/images/c411d6cea0d1bc7e22e0075ad4a9901d2d4fedf5.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 177px !important;">与内容偏差不同，风格偏差与宏观微观的都有关系，所以我们又算出每一层的风格偏差，再求一个加权平均就好了。<img src="/daiziguizhongren/images/3149c6e55ffe0f03deacb8d3e0fc57bf9a3eef8f.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 151px !important;"></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">Tensorflow 代码实现</p><pre style="margin-top: 1em; margin-bottom: 1em; padding: 0px 1em; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); font-size: 16px; background-color: rgb(255, 255, 255); overflow: auto; word-wrap: break-word !important;"><code style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"></span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">def</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; color: rgb(153, 0, 0); word-wrap: break-word !important;">gram_matrix</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tensor</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>
	<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#gram matrix is just a matrix multiply it's transpose</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">shape</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tensor</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">get_shape</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">()</span> &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">num_channels</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 128, 128); word-wrap: break-word !important;">int</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">shape</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">3</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">])</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">matrix</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">reshape</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tensor</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">shape</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">-</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">1</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">num_channels</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">])</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">matmul</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">transpose</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">matrix</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">),</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">matrix</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">return</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram</span> 
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">def</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; color: rgb(153, 0, 0); word-wrap: break-word !important;">create_content_loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>

	<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#we use all 13 conv layers in VGG16 to compute loss function</span>
	<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_layer_names</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv1_1/conv1_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv1_2/conv1_2'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv2_1/conv2_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv2_2/conv2_2'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv3_1/conv3_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv3_2/conv3_2'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv3_3/conv3_3'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv4_1/conv4_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv4_2/conv4_2'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv4_3/conv4_3'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv5_1/conv5_1'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv5_2/conv5_2'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(221, 51, 34); word-wrap: break-word !important;">'conv5_3/conv5_3'</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">]</span> 
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layers</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">get_layer_tensors</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_layer_names</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram_layers</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram_matrix</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layers</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_dict</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">create_feed_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">image</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">session</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">run</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram_layers</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">feed_dict</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">constant</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_values</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">stylized_values</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gram_layers</span> <span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#gram_layers will be evaluated during runtime</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">with</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">graph</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">as_default</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">():</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">[]</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">for</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v1</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v2</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">in</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 128, 128); word-wrap: break-word !important;">zip</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">stylized_values</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_values</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mean_squared_error</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v1</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">v2</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">append</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>

 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">total_loss</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">reduce_mean</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">layer_losses</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">return</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">total_loss</span></code></pre><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">如何最小化？</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">对于一个标准的优化问题，梯度下降（Gradient Descent） 一定是可以用的。我们只需要把三张图片全部输入网络，计算出对应的内容偏差(用最后一层)和风格偏差（用每一层），加权平均一下以后获得总偏差，再相对于合成图片求出梯度，用梯度去更新这个图片就可以了。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/daiziguizhongren/images/482aaea769564ec74971d582db58959f0c8dc9a8.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; color: rgb(51, 51, 51); word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 371px !important;"></p><pre style="margin-top: 1em; margin-bottom: 1em; padding: 0px 1em; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); font-size: 16px; background-color: rgb(255, 255, 255); overflow: auto; word-wrap: break-word !important;"><code style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"></span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">def</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; color: rgb(153, 0, 0); word-wrap: break-word !important;">style_transfer</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">weight_content</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">1.5</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">weight_style</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">10.0</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span>
 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">num_iterations</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">120</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">step_size</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">10.0</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">vgg16</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">VGG16</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">()</span> 
	 <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">session</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">InteractiveSession</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">graph</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">graph</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_content</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">create_content_loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_style</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">create_style_loss</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">style_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span> &nbsp; 
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_combined</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">weight_content</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">*</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_content</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">+</span> \ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">weight_style</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">*</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_style</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gradient_op</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">tf</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gradients</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">loss_combined</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">input</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp;

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;"># The mixed-image is initialized with random noise.</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;"># It is the same size as the content-image.</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#where we first init it</span>
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">np</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">random</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">rand</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">*</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">content_image</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">shape</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">+</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">128</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">for</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">i</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">in</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 128, 128); word-wrap: break-word !important;">range</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">num_iterations</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">):</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;"># Create a feed-dict with the mixed-image.</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_dict</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">model</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">create_feed_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">image</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp;
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#compute the gradient with predefined gradient_op</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">grad</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">session</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">run</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">gradient_op</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">feed_dict</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_dict</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">grad</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">np</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">squeeze</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">grad</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">step_size_scaled</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">step_size</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">/</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">np</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">std</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">grad</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">+</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">1e-8</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>

 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-style: italic; color: rgb(153, 153, 136); word-wrap: break-word !important;">#update the mixed_image</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">-=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">grad</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">*</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">step_size_scaled</span>
 &nbsp; &nbsp; &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span> <span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">=</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">np</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">clip</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">(</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">0.0</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">,</span> <span style="max-width: 100%; box-sizing: inherit; color: rgb(0, 153, 153); word-wrap: break-word !important;">255.0</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">)</span>

 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">session</span><span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">.</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">close</span><span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">()</span>
 &nbsp; &nbsp;
 &nbsp; &nbsp;<span style="max-width: 100%; box-sizing: inherit; font-weight: bold; word-wrap: break-word !important;">return</span> <span style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;">mixed_image</span></code></pre><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">效果如何？</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">除了稍微慢了一点，效果还是棒棒哒！代码已经提多了，直接上图！</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;"><span style="max-width: 100%; box-sizing: inherit; font-weight: 700; word-wrap: break-word !important;">内容偏差的权重较大时<img src="/daiziguizhongren/images/a6df9469fa2f4769de1cbef3b1e769ffd3fd3954.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 317px !important;"><img src="/daiziguizhongren/images/df79f9f6c11c032e414e2ce5d256bcf6957ea48f.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 643px !important;"></span><span style="max-width: 100%; box-sizing: inherit; font-weight: 700; word-wrap: break-word !important;">风格偏差的权重较大时</span><img src="/daiziguizhongren/images/f9336c4492d1e721727b155452e2a42c6e1a87a3.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 334px !important;"><img src="/daiziguizhongren/images/9bbcb079c84dc523e0ab6069bc002198ca5696fe.png" style="margin: 0.72em auto; box-sizing: inherit; overflow: hidden; display: block; cursor: -webkit-zoom-in; word-wrap: break-word !important; visibility: visible !important; width: 600px !important; height: 644px !important;"></p><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">更多的相关研究</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">Gatyes后续有发表了一些相关的论文，例如下面这个可以保存内容图片的颜色，只在亮度通道中进行风格转化&nbsp;<br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Gatys et al, “Preserving Color in Neural Artistic Style Transfer”, arXiv 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">Ruder在视频上进行风格转化，解决了针对不同像素，风格转化不连续的问题&nbsp;<br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Ruder et al, “Artistic style transfer for videos”, arXiv 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">在特征空间中使用局部匹配来计算风格偏差，效果比使用 Gram Matrix 更好&nbsp;<br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Li and Wand, “Combining Markov Random Fields and Convolutional Neural Networks for Image Synthesis”, CVPR 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">对于高分辨率图片的快速风格转化&nbsp;<br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Johnson et al, “Perceptual Losses for Real-Time Style Transfer and Super-Resolution”, ECCV 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">使用同一个网络同时进行多种风格的转化&nbsp;<br style="max-width: 100%; box-sizing: inherit; word-wrap: break-word !important;"><a style="color: rgb(34, 85, 153); max-width: 100%; box-sizing: inherit; border-bottom: 1px solid rgba(64, 64, 64, 0.72); cursor: pointer; word-wrap: break-word !important;" target="_blank" rel="nofollow noreferrer">Dumoulin et al, “A Learned Representation for Artistic Style”, arXiv 2016<span style="max-width: 100%; box-sizing: inherit; font-size: 24px; speak: none; line-height: 1; -webkit-font-smoothing: antialiased; word-wrap: break-word !important; font-family: icomoon !important;"></span></a></p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">这个话题现在很火，大家去读个几篇，可能就能有自己的想法了！和女神 Kristen 合作论文也指日可待了！</p><h3 style="margin-top: 20px; margin-bottom: 20px; font-weight: 700; font-size: 24px; max-width: 100%; box-sizing: inherit; color: rgb(62, 62, 62); white-space: normal; background-color: rgb(255, 255, 255); font-variant-numeric: inherit; font-stretch: inherit; line-height: inherit; word-wrap: break-word !important;">参考资料</h3><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">[1] Gatys et al, “Image Style Transfer using Convolutional Neural Networks”, CVPR 2016</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">[2] Stanford CS 20SI: Tensorflow for Deep Learning Research</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">[3] Convolutional neural networks for artistic style transfer by Harish Narayanan</p><p style="margin-top: 20px; margin-bottom: 20px; max-width: 100%; box-sizing: inherit; min-height: 1em; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); word-wrap: break-word !important;">[4] How to Do Style Transfer with Tensorflow by Siraj Raval</p><hr style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p><br></p><section style="max-width: 100%; box-sizing: border-box; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;" powered-by="xiumi.us"><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 24px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(2, 204, 186); box-sizing: border-box !important; word-wrap: break-word !important;">深</span></strong></span><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">度学习</strong>，是诸如Prisma的图像应用、人工智能、无人驾驶、机器自动翻译、人脸识别背后的<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">核心技术</strong>。如果说要预测未来5年最抢手、热门的技术人才，掌握深度学习的程序员、工程师，也一定会位于榜单前端。<br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">Udacity 联手 Youtube 技术网红色拉杰（Siraj Raval），全球同步推出的&nbsp;<span style="max-width: 100%; font-size: 18px; color: rgb(2, 179, 228); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">深度学习基石纳米学位&nbsp;</strong></span><span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">一经推出就广受好评。没有跟上第一，二轮班次？没关系，第三期报名机会现已展开！</span></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;">这门课将用充满活力的硅谷方式，通过每周更新的视频、实战项目和一对一辅导，带你由浅入深地探索这个领域，打好基础，让你17周变身成为深度学习超级魔法师，加入这场席卷全球的技术浪潮。毕业时，你将做好准备在更多人工智能、无人驾驶等应用方向上大展拳脚，并且<span style="max-width: 100%; color: rgb(2, 204, 186); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">获得100%可以加入 Udacity 无人车工程师纳米学位、人工智能工程师纳米学位的录取保证</strong></span>。</p></section></section></section></section><p><br></p><p><iframe width="770" height="577.5" class="video_iframe" frameborder="0" allowfullscreen="" data-src="https://v.qq.com/iframe/preview.html?vid=l1317h8nwo1&amp;width=500&amp;height=375&amp;auto=0" data-vidtype="2" src="http://v.qq.com/iframe/player.html?vid=l1317h8nwo1&amp;width=770&amp;height=577.5&amp;auto=0" style="width: 770px !important; height: 577.5px !important; overflow: hidden;" scrolling="no"></iframe><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">Siraj 是一名数据科学家、畅销书作家，以及 YouTube 红人。他在 YouTube 上发布了很多教学视频，教人们如何使用机器学习开发游戏机器人、聊天机器人、无人驾驶车、能自动生成艺术品和音乐的程序，以及股票预测模型等。在 Udacity 的这门课程中，他将带领你：</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">项目 1： 你的第一个神经网络</strong><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">创建你的第一个简单的神经网络，它将能够预测共享单车的使用情况。&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">项目 2： 识别图像&nbsp;</strong></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">现在，你的神经网络将学会如何识别图片中的物体。</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">项目 3：&nbsp;</strong>生成电视剧剧本&nbsp;</strong></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">借助深度学习的力量，你现在也可以是热门电视剧的编剧！</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">项目 4：&nbsp;开发翻译机器人&nbsp;</strong></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">创造一个可以在你与朋友聊天时即时翻译的机器人，再也不用担心语言成为友情的障碍。&nbsp;</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">项目 5：&nbsp;生成原创的人脸图像&nbsp;</strong></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">使用生成对抗网络（GAN）来生成原创的人脸图像，看看你会“画”出什么样的容颜？</p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(2, 179, 228); box-sizing: border-box !important; word-wrap: break-word !important;">想提前了解更具体的学习内容？点击文末“<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">阅读原文</strong>”，立即了解更多。</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/daiziguizhongren/images/3377d3d1649546ee59ca6d879e918cd3931d201e.png" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 556px !important; height: 307.537px !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p><br></p><section style="margin-top: -4px; padding: 10px; max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; background-color: rgb(239, 239, 239); box-sizing: border-box !important; word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;" powered-by="xiumi.us"><section style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><section style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><p style="max-width: 100%; min-height: 1em; box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><p><span style="font-size: 15px;">* &nbsp;课程报名请点击&nbsp;</span><strong style="font-size: 15px; max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(61, 170, 214); box-sizing: border-box !important; word-wrap: break-word !important;">阅读原文</span></strong><span style="font-size: 15px; max-width: 100%; color: rgb(61, 170, 214); box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;</span><span style="font-size: 15px;">，了解学费及课程安排，还能加入微信群，掌握第一手信息，关注课程后还可加入直播答疑分享。</span></p><p><span style="font-size: 15px;">*&nbsp;&nbsp;待字闺中独家福利：300元抵用券，可以在Udacity专业深度学习等认证课程中作为现金抵用，名额限20人。code：daiziguizhong</span><br></p><p><br></p></section></section></section></section><p><br></p><p><br></p><p><img src="/daiziguizhongren/images/5193f84fd4042a8bca698c06763744e93db47e53.jpeg" style="width: 770px !important; height: 770px !important;"></p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1495452014&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZeYVl3MPrfULvuQN3FOkNjyKsPiaoj23UV3Kd7-GA61ZsZXcn1BAwas1Y38gNphQGfrVKaY*E7czilC4AMBhzA9L6lxjtpp-C7CCJtSMaiAbs6O8Vt8P6XKQpaMUvCrMCDn3V1Sz976DeDKWpYOJjFLI=">微信地址</a> | <a href="http://cn.udacity.com/course/deep-learning-nanodegree-foundation--nd101/?utm_source=daiziguizhong&amp;utm_medium=wechat&amp;utm_campaign=DLND03">阅读原文</a>
{% endraw  %}

