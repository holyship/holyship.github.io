---
title: 《直播疑难杂症排查系列》之一 ：播放失败
author: 卢俊
date: '2017-04-20 00:00:00 +0000'

---

{% raw  %}
<p><span style="text-align: justify; background-color: rgb(255, 255, 255);"></span></p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em;">七牛直播云在 2016 年 6 月发布之后，帮助广大客户解决过形形色色的问题，如直播卡顿、马赛克、花屏、黑屏、杂音、音画不同步等等等等，这其中，有一些是网络原因，有一些是开发者的使用姿势问题，有一些是参数配置错误，当然，也有一些是 SDK 本身的问题。</p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255);"><br></p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em;">总结下来，如果开发者能够对直播领域的一些基础知识有更深入的了解，掌握一些基本的排障手段，很多问题是能够很快自行解决的，甚至也能够更好地防患于未然。</p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255);"><br></p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em;">因此，继<a href="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect"><span style="font-family: 微软雅黑; font-size: 16px;  background-color: rgb(255, 255, 255);">《直播技术详解》系列文章</span></a><span style="font-family: 微软雅黑; font-size: 16px;  background-color: rgb(255, 255, 255);">之后，</span>我们推出了这个新的系列<strong>《直播疑难杂症排查》</strong>，我们会把协助客户解决直播问题的经验逐步分享出来，同时也会穿插一些音视频开发的基础知识和优化经验，希望能够帮助到直播领域的开发者们。</p><p style="font-family: 微软雅黑; font-size: 16px; text-align: justify; white-space: normal; background-color: rgb(255, 255, 255); line-height: normal;"><br></p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="16401" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><p style="text-align: center; white-space: normal;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM10QN8BZMwa4WSsYEPlicYzuEicoyQQVIpKyT1wt36FTBSWQy7US6xX2xg/0?wx_fmt=jpeg" style="display: inline; width: 640px !important; height: 12px !important; visibility: visible !important;"></p></section></section><p><br></p><p>本系列会涵盖的内容包括但不限于如下一些主题：</p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="text-align: justify; line-height: 1.8; padding-right: 4px; padding-left: 4px; box-sizing: border-box;"><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p>播放失败</p></li><li><p>直播卡顿</p></li><li><p>首开慢</p></li><li><p>延时高</p></li><li><p>音画不同步</p></li><li><p>马赛克严重</p></li><li><p>播放黑屏、花屏、绿屏</p></li><li><p>播放杂音、噪音、回声</p></li><li><p>点播拖动不准</p></li><li><p>直播发热问题</p></li><li><p>其他问题（待续）</p></li></ul><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p>第一篇文章我们从播放开始，因为观看直播最重要的一个环节就是打开播放器，很多问题的直接反馈也是来自观众端。</p><p><br style="box-sizing: border-box;"></p><p>导致播放失败的原因有很多种，不一定是播放器本身的问题，不过通过播放器，我们很容易反过来排查服务端或者推流端的问题。下面我们会从播放失败的表现、播放问题排查工具、常见问题分析等多个方面展开讨论。</p><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">播放失败的表现</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM1rwzL8nmxsHWItLscMJoWfvDCAdgfj7zPo0ubTcbPT5Jq1I6R4GLnXg/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"> <section class="" style="clear: both; box-sizing: border-box;"></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="text-align: justify; line-height: 1.8; padding-right: 4px; padding-left: 4px; box-sizing: border-box;"><p>播放失败的表现总结下来包括但不限于以下这些：</p><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p>界面上一直显示「加载中」，或者提示播放失败的错误；</p></li><li><p>播放画面卡死不动，但 UI 按钮可以点击；</p></li><li><p>有声音没有画面，有画面没有声音。</p></li></ol><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p>这里并不讨论如播放卡顿、音画不同步、马赛克、延时、花屏等问题，这些话题，我们将会在后续的文章中探讨，本文重点关注的是：为啥无法顺利&nbsp;「打开」&nbsp;直播流 ？</p><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">播放问题的排查工具</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM1rwzL8nmxsHWItLscMJoWfvDCAdgfj7zPo0ubTcbPT5Jq1I6R4GLnXg/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"> <section class="" style="clear: both; box-sizing: border-box;"></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="text-align: justify; line-height: 1.8; padding-right: 4px; padding-left: 4px; box-sizing: border-box;"><p>一旦我们遇到视频播放不了，第一件事，就是要找几个别的播放器也播放看看，做一下对比测试，或者对码流做一些基础分析，以便更好地定位问题的源头，各个平台比较常见的播放/分析工具有如下几个：</p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-align: left;">命令行工具：ffplay、ffprobe、mediainfo、hls-analyzer 等</p></li><li><p>网页端工具</p><p style="text-align: left;"><span style="color: rgb(6, 163, 224);">http://www.cutv.com/demo/live_test.swf</span></p><p style="text-align: left;"><span style="color: rgb(6, 163, 224);">http://www.ossrs.net/players/srs_player.html</span></p></li><li><p>App 应用：VLC，VPlayer，MXPlayer 等</p></li><li><p>Windows 工具：mp4info、FlvParse、FLVMeta、Elecard StreamEye Studio 等</p></li></ul><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">常见播放失败问题排查</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM1rwzL8nmxsHWItLscMJoWfvDCAdgfj7zPo0ubTcbPT5Jq1I6R4GLnXg/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"> <section class="" style="clear: both; box-sizing: border-box;"></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="text-align: justify; line-height: 1.8; padding-right: 4px; padding-left: 4px; box-sizing: border-box;"><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">基础概念</span></p></section></section></section><p>从给播放器传入播放地址，到播放画面显示出来，一般有如下几个步骤：<br></p></section><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p>DNS 解析，将播放地址中的域名解析为对应的服务器 IP 地址；</p></li><li><p>连接服务器，完成 http 请求或者 rtmp 握手过程；</p></li><li><p>接收服务器发送的数据，解协议解封装，拿到音视频数据解码播放。</p></li></ol><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p>任何一个环节出了问题，都有可能导致播放失败，不同的协议，由于协议层原因，播放报错往往不太一样，我们下面的讨论，主要以 RTMP/HTTP 这两种协议为主，假设正常的播放测试地址如下：</p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-align: left;">香港卫视的 RTMP 直播流：<span style="color: rgb(6, 163, 224);">rtmp://live.hkstv.hk.lxdns.com/live/hks</span></p></li><li><p style="text-align: left;">W3C School 的测试 mp4 流：<span style="color: rgb(6, 163, 224);">http://www.w3school.com.cn/i/movie.mp4</span></p></li></ul><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">域名解析失败</span></p></section></section></section></section><p>如果播放地址的域名无法解析，会导致播放失败，一般断网了或者域名无效，则播放的时候，会有类似如下报错：</p><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="text-align: left;"><span style="font-family: 微软雅黑;">$ffplay&nbsp;<span style="font-family: 微软雅黑; color: rgb(0, 0, 0);">rtmp://live.hkstv.hk.lxdns.com1/live/hks</span></span></p><p><br></p><p style="text-align: left;"><span style="font-family: 微软雅黑;">Failed to resolve hostname live.hkstv.hk.lxdns.com1: nodename nor servname provided, or not known</span></p><p style="text-align: left;"><span style="font-family: 微软雅黑;">Failed to resolve hostname live.hkstv.hk.lxdns.com1: No address associated with hostname</span></p></section></section><p>当然，如果有网络，但是域名解析失败，一般 ISP 运营商可能会返回一些类似 404 页面，或者跳转到其他的默认网页，因此，对于 HLS，HTTP-FLV，HTTP-mp4 等码流，会因为读到一些「脏数据」从而返回一些其他的错误，例如：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal; text-align: left;">$ ffplay <span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn1/i/movie.m3u8</span></p><p style="white-space: normal; text-align: left;"><span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn1/i/movie.m3u8</span>: Operation timed out</p><p style="white-space: normal;"><br></p><p style="white-space: normal; text-align: left;">$ ffplay <span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn1/i/movie.mp4</span></p><p style="white-space: normal; text-align: left;"><span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn1/i/movie.mp4</span>: Invalid data found when processing input</p></section></section><p style="white-space: normal;"><span style="">遇到这类错误，一般可以通过 ping 一下域名试试，看看是否可以 ping 通，如果 ping 不通，则可能要检查下域名解析的配置了</span><span style="">。</span><br></p></section><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">服务器连接失败</span></p></section></section></section></section><p>如果域名正确，并且有网络连接的状态，多半是可以正常解析出服务器 ip 地址的，但是依然有连接失败的可能，比如，这台服务器相应的服务挂掉了，或者并没有在相应的端口提供服务，从而导致播放器连接失败，类似问题的报错如下：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal; text-align: left;">$ ffplay rtmp://<span style="color: rgb(0, 0, 0);">www.jhuster.com/live/hks</span></p><p style="white-space: normal; text-align: left;">Cannot open connection tcp://<span style="color: rgb(0, 0, 0);">www.jhuster.com:1935</span></p><p style="white-space: normal; text-align: left;">rtmp://<span style="color: rgb(0, 0, 0);">www.jhuster.com</span>/live/hks: Operation timed out</p></section></section></section><p>因为&nbsp;<span style="color: rgb(6, 163, 224);">www.jhuster.com</span>&nbsp;对应的服务器并没有提供 rtmp 拉流服务，因此通过 1935 连接该服务器会失败。</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal; text-align: left;">$ ffplay <span style="color: rgb(0, 0, 0);">https://www.w3school.com.cn/i/movie.mp4</span></p><p style="white-space: normal; text-align: left;">Connection to <span style="color: rgb(0, 0, 0);">tcp://www.w3school.com.cn:443</span> failed: Connection refused</p></section></section></section><p>因为&nbsp;<span style="color: rgb(6, 163, 224);">www.w3school.com.cn</span>&nbsp;并不支持 https 访问，因此通过 443 接口请求 https 连接失败。</p><p><br style="box-sizing: border-box;"></p><p>当然，也有可能是这台服务器虽然提供了 rtmp 拉流服务但是宕机了，因此，我们需要通过 dig 命令确定最终访问的是哪一台服务器，并排查下该服务器为什么无法连接，当然，最好是修改下 ffpmeg 源码，把解析出来的服务器 IP 地址打印出来，这样就可以直接看到所连接的服务器地址了。</p><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">请求的资源不存在</span></p></section></section></section></section><p>对于 http 协议的直播地址，请求的播放资源不存在，返回的错误还是比较快的，比如：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal; text-align: left;">$ ffplay <span style="color: rgb(0, 0, 0);">http://jhuster.com/live/hks.mp4</span></p><p style="white-space: normal; text-align: left;"><span style="color: rgb(0, 0, 0);">http://jhuster.com/live/hks.mp4</span>: Server returned 404 Not Found</p><p style="white-space: normal; text-align: left;">$ ffplay <span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn/i/movie2.mp4</span></p><p style="white-space: normal; text-align: left;"><span style="color: rgb(0, 0, 0);">http://www.w3school2.com.cn/i/movie2.mp4</span>: Invalid data found when processing input</p></section></section></section><p><span style="color: rgb(178, 178, 178); font-size: 14px;">注：由于读到 ISP 运营商返回的跳转页面的 「脏数据」，因此也有可能返回上面这种错误。</span></p><p><br style="box-sizing: border-box;"></p><p>而 RTMP 直播协议，跟 HTTP 协议的播放，有着一个很大的不同，就是播放器请求的数据，并不一定 「存放」在服务器，因此，服务器无法简单通过 URI 定位不到则返回 404，这些数据可能是在 RTMP 握手之后，由生产端逐步产生并由服务器转发到客户端，因此很难简单判断说 「资源不存在」。</p><p><br style="box-sizing: border-box;"></p><p>通常 RTMP 协议的直播流，如果推流端没有推流了，播放器这边一般是读数据超时后才会返回错误，例如：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="rgb(30, 155, 232)"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal; text-align: left;">$ ffplay rtmp://live.hkstv.hk.lxdns.com/live/hks1</p><p style="white-space: normal; text-align: left;">rtmp://live.hkstv.hk.lxdns.com/live/hks1: Input/output error</p></section></section></section><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">不支持的格式</span></p></section></section></section></section><p>视频流的采用的网络协议、编码格式、封装格式有很多种，网络协议比如 http/https/rtmp/rtsp 等等，编码格式比如 h.264，mpeg4，aac，speex 等等，封装格式比如 flv，mp4，avi，rmvb 等等，这些协议和格式的流，都是需要播放器专门添加支持的，因此，播放器遇到不支持的协议或者格式，也会导致播放失败，如下所示：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="overflow: auto; font-size: 15px; margin-bottom: 16px; line-height: 1.45; padding: 16px; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="white-space: normal;">https://www.jhuster.com/xxxx.mp4 Protocol not found</p><p style="white-space: normal;">https://www.jhuster.com/xxxx.rmvb Invalid data found when processing input</p></section></section></section><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">只有音频没有视频，或者只有视频没有音频</span></p></section></section></section></section><p>出现该错误的原因可能有如下几点：</p><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p>音频/视频的编码格式不支持，导致解码失败</p></li><li><p>音频/视频的数据内容异常，导致解码失败</p></li><li><p>基于 ffmpeg 的播放器的 `probesize` 设置太小，导致解析码流信息不足</p></li><li><p>码流/文件本身的前半段只有音频没有视频，或者只有视频没有音频</p></li></ol><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p>这个问题播放启动流程已经完成，只是出现了画面缺失、或者音频缺失，也算是一种播放失败，限于本文篇幅，该问题后面会抽出专门的章节来分析。</p><p style="white-space: normal; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" data-tools="135编辑器" data-id="1" style=" border-width: 0px; border-style: none; border-color: initial;  box-sizing: border-box; " data-color="#06A3E0 "><section class="" style="border-left: 5px solid rgb(6, 163, 224); font-weight: bold; line-height: 32px; color: rgb(102, 102, 102); padding: 5px 10px; margin-top: 10px; margin-bottom: 10px; box-sizing: border-box;"><p style="white-space: normal;"><span style="">其他播放失败</span></p></section></section></section></section><p>上面只分析了常见的播放失败问题，其实导致播放失败的原因还有很多种，这里无法一一都列出来，不过通过 ffplay 的报错，就可能知道大概的原因，再联合服务端一起调试调试，一般都是可以找到根本原因的。下面是 ffmpeg 常见的错误分类：</p><p><span style="color: rgb(6, 163, 224);">http://ffmpeg.org/doxygen/trunk/error_8h_source.html</span></p><p style="line-height: normal;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM1YEhESxMsyZxn9Htlynics8ictG4tQAIyYLfibbiboUwo6OcGpwruOpAfyg/0?wx_fmt=png" style="width: 762px !important; height: 317.5px !important;"></p><section><section powered-by="xiumi.us"><section><section><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section data-role="outer" label="Powered by 135editor.com" style="font-family:微软雅黑;font-size:16px;"><section class="" data-tools="135编辑器" data-id="87417" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><p style="text-align: center; white-space: normal; line-height: normal;"><br></p><p style="text-align: center; white-space: normal;"><img src="http://mmbiz.qpic.cn/mmbiz_gif/v6uP0lGcBZ6icXmP3OujrXcNxxuhVAMM1zicc4dL0ibTUCJSlRPTUtbeyibxCPP2bvETV2aB6mzlosz8UibdusMa59Q/0?wx_fmt=gif" style="display: inline; width: 22px !important; height: 10px !important;"></p></section></section><p><br></p><p>点击<strong>「阅读原文」</strong>查看直播技术详解系列文章。</p></section></section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="42" data-color="#06A3E0"><section data-style="font-size:14px"><p style="text-align: justify; white-space: normal; background-color: rgb(255, 255, 255);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect"></a></p><p style="text-align: justify; white-space: normal; background-color: rgb(255, 255, 255);"><a href="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=2652191628&amp;idx=1&amp;sn=9bcaecc65f11b4587f4ee3f3b03f003e&amp;chksm=bd010d198a76840ff84ac001f35d539c41be14cdf3e894f96ae33facc4d657c2bdad9b8ba808&amp;scene=21#wechat_redirect"></a></p></section></section></section></section></section></section></section></section></section></section></section>
{% endraw  %}

