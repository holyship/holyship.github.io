---
title: 动手实操：如何用七牛云 API 实现相片地图？
author: fooleap
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1499656823&src=3&ver=1&signature=Hv6rg8SdYuiUQmONS3uvW2Hpmz3aPkDsMR47SMTl55WKhaJyCYOlY4s7d93xZUMEMfcYfHv-0EWpPdCKow4Blu5ic--c9bVqgbnn6zq7dtDz2LMt2wcmW8BJSsrIOgwU67Vw3pvo4QzGwwBmPe6f5KKaFy3wH0wJHKsidmncEsU=
date: '2017-07-06 00:00:00 +0000'

---

{% raw  %}
<section class="" style="display:none;" data-tools="新媒体管家" data-label="powered by xmt.cn"></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section><section data-role="outer" label="Powered by 135editor.com"><section data-tools="135编辑器" data-id="86468"><section data-width="50%"><section data-width="100%"><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" powered-by="xiumi.us" style="box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="line-height: 1.8; font-size: 15px; text-align: justify; letter-spacing: 1px; box-sizing: border-box;"><p style="text-align: center;"><span style="font-family: 微软雅黑; letter-spacing: 1px; text-align: center;  color: rgb(38, 38, 38); font-size: 15px; background-color: rgb(255, 255, 255);">---</span><span style="font-family: 微软雅黑; font-size: 16px; letter-spacing: 1px; text-align: center;  color: rgb(6, 163, 224);"><span style="font-size: 15px; background-color: rgb(255, 255, 255);">&nbsp;<strong>本期</strong></span><span style="max-width: 100%; font-size: 15px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">玩家</strong></span></span><span style="font-family: 微软雅黑; letter-spacing: 1px; text-align: center;  max-width: 100%; font-size: 15px; background-color: rgb(255, 255, 255); color: rgb(171, 25, 66); box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">&nbsp;</strong></span><span style="font-family: 微软雅黑; letter-spacing: 1px; text-align: center;  color: rgb(38, 38, 38); font-size: 15px; background-color: rgb(255, 255, 255);">---</span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ4vrH6L76hjzVf7fCgDHHqoMTqdH0NI0sFUbiby9sD3rxOljEl8wrQmiac2bm2DH2KWTuqMjYZTO8dQ/0?wx_fmt=jpeg" style="width: 480px !important; height: 156px !important; visibility: visible !important;"></p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">在苹果手机上，我们只要打开定位服务，拍照后便能在相簿中找到地图，地图上显示着在各地拍摄的相片。网站上这种显示方式也并不少见，例如 Flickr、即将关闭的 Panoramio 等。<br></p><p style="box-sizing: border-box;"><br></p></section></section></section></section><p style="padding-right: 0em; padding-left: 0em; letter-spacing: 1px;"><span style="text-align: justify; font-size: 15px;">作为地图爱好者，每每看到地图就激动不已，就想若能在自己博客上也这么显示，那该多好</span><span style="text-align: justify;">！</span></p></section></section></section></section><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6lSHJBjlgLwvnk8y9FUFh7Z2jNQveAgdq9N6d1uHkp8v9uxyLnU345uURAAoQlsM0U86npepVTQQ/0?wx_fmt=png" style="width: 640px !important; height: 640px !important; visibility: visible !important;"></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 14px; color: rgb(136, 136, 136);">▲ 苹果手机上的相片地图</span></p><p style="box-sizing: border-box;"><br></p><p style="padding-right: 0em; padding-left: 0em; box-sizing: border-box; letter-spacing: 1px; text-align: justify;"><span style="font-size: 15px;">相片的地理位置信息，是通过手机等设备的 GPS 模块记录的，并在其图片文件的 EXIF 数据，保留了这些位置信息。</span></p><p style="padding-right: 0em; padding-left: 0em; box-sizing: border-box; letter-spacing: 1px;"><br style="box-sizing: border-box;"></p><p style="padding-right: 0em; padding-left: 0em; box-sizing: border-box; letter-spacing: 1px; text-align: justify;"><span style="font-size: 15px;">使用七牛做博客图床以来，其图片处理 API 为各种显示需求提供了便利，这其中有个可以获取图片 EXIF 信息的 API，可以很方便的获取到图片的 EXIF 信息，<span style="">而 EXIF 包含的 GPS 位置信息，则可以实现以上所提到的效果。</span></span></p><p style="padding-right: 0.5em; padding-left: 0.5em; box-sizing: border-box; letter-spacing: 1px; text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="padding-right: 0.5em; padding-left: 0.5em; box-sizing: border-box; letter-spacing: 1px; text-align: center;"><span style="color: rgb(6, 163, 224);"><strong><span style="font-size: 16px;">实现流程</span></strong></span></p></section></section></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="padding-right: 4px; padding-left: 4px; text-align: justify; font-size: 15px; line-height: 1.8; letter-spacing: 1px; box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">EXIF 为位置信息保留了经纬坐标、海拔等，将它转成实际地址信息，或者显示到地图上，还需要配合一个地图 API，在此就以高德地图为例。</p><p style="box-sizing: border-box;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6lSHJBjlgLwvnk8y9FUFh7v8nvic3eQXIQK5cIVG1plOIC2BGoob2dLy6HE0BUs6pZuar2C4103Xw/0?wx_fmt=png" style="width: 602px !important; height: 69px !important;"></p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;"><strong>实现流程大致如下</strong>：</p><ul class="list-paddingleft-2" style="width: 520.594px;"><li><p style="box-sizing: border-box;">请求数据：利用七牛 API 请求获取图片的 GPS 信息</p></li><li><p style="box-sizing: border-box;">转换坐标：因相片的坐标数据是以 WGS84 坐标系统为准的，得转换坐标</p></li><li><p style="box-sizing: border-box;">显示地址：通过高德地图 API 实现</p></li></ul><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 16px;"><strong><span style="color: rgb(6, 163, 224);">获取坐标</span></strong></span></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 16px;"><strong><span style="color: rgb(6, 163, 224);"><br></span></strong></span></p></section></section></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="padding-right: 4px; padding-left: 4px; text-align: justify; font-size: 15px; line-height: 1.8; letter-spacing: 1px; box-sizing: border-box;"><p style="box-sizing: border-box;">我们还是以一张图片为例，来分析下如何实现。</p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ6lSHJBjlgLwvnk8y9FUFh72yrO85pdfgFU1koTD0Bek7mKCaVWKO1ic6ULoibBXZQ0u1Kn4kCXYDYA/0?wx_fmt=jpeg" style="width: 762px !important; height: 508px !important;"></p><p style="box-sizing: border-box; text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px;">▲ 莲阳河畔，渡亭堤顶的花</span></p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">上图是在汕头市澄海区莲下镇渡亭村莲阳河畔拍的花，其图片地址如下：</p><p style="box-sizing: border-box;"><span style="background-color: rgb(255, 255, 255);"></span></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">http://source.fooleap.org/show-photo-location-on-map-with-qiniu-and-amap-api.jpg</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">那么，七牛图片 EXIF 信息的接口如下：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">http://source.fooleap.org/show-photo-location-on-map-with-qiniu-and-amap-api.jpg?exif</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">直接用浏览器打开，可以很方便地找到所有 GPS 开头的属性。其中，海拔等数据可以忽略掉，位置信息最为重要的是经纬坐标，即以下四个值：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">{<br>&nbsp; &nbsp;"GPSLatitude": {<br>&nbsp; &nbsp; &nbsp; &nbsp;"val": "23, 29, 10.91",<br>&nbsp; &nbsp; &nbsp; &nbsp;"type": 5<br>&nbsp; &nbsp;},<br>&nbsp; &nbsp;"GPSLatitudeRef": {<br>&nbsp; &nbsp; &nbsp; &nbsp;"val": "N",<br>&nbsp; &nbsp; &nbsp; &nbsp;"type": 2<br>&nbsp; &nbsp;},<br>&nbsp; &nbsp;"GPSLongitude": {<br>&nbsp; &nbsp; &nbsp; &nbsp;"val": "116, 46, 36.49",<br>&nbsp; &nbsp; &nbsp; &nbsp;"type": 5<br>&nbsp; &nbsp;},<br>&nbsp; &nbsp;"GPSLongitudeRef": {<br>&nbsp; &nbsp; &nbsp; &nbsp;"val": "E",<br>&nbsp; &nbsp; &nbsp; &nbsp;"type": 2<br>&nbsp; &nbsp;}</span></p><p><span style="font-size: 13px;">}</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">那么这个坐标为 23°29’10.91”N, 116°46’36.49”E，也就是北纬 24 度 29 分 10.91 秒，东经 116 度 46 分 36.49 秒。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">在各种互联网地图上，坐标是以度为单位的，东经北纬为正值，西经南纬为负值。这里需要将度分秒的经纬度转换以度为单位的，因度分秒之间为 60 进制，故转换公式为：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">度分秒 = 度 + 分 / 60 + 秒 / (60 * 60)</span></p></section></section><section data-role="paragraph" class="" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><p><br></p></section></section><p style="box-sizing: border-box;">计算后得出上面的坐标约为&nbsp;<span style="background-color: rgb(214, 214, 214);">116.776803, 23.486364</span>，这是一个 WGS84 坐标。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">坐标转换此前已经说过不少了，因在网页上使用，直接采用 coordtransform 模块[3]&nbsp;即可，以上坐标转换为 GCJ02 是&nbsp;<span style="background-color: rgb(214, 214, 214);">116.781381, 23.483788</span>。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">可以使用高德的坐标拾取系统，按坐标搜索一下，验证结果是否正确。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">以上过程使用 JS 实现代码如下，需引入 coordtransform 模块。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p style="text-align: left;"><span style="text-align: justify; font-size: 13px;">var xhr = new XMLHttpRequest();</span></p><p style="text-align: left;"><span style="text-align: justify; font-size: 13px;">xhr.open('GET', 'http://source.fooleap.org/show-photo-location-on-map-with-qiniu-and-amap-api.jpg?exif', true);</span></p><p style="text-align: left;"><span style="text-align: justify; font-size: 13px;">xhr.onreadystatechange = function() {<br>&nbsp; &nbsp;if (xhr.readyState == 4 &amp;&amp; xhr.status == 200)<br>&nbsp; &nbsp;{<br>&nbsp; &nbsp; &nbsp; &nbsp;var data = JSON.parse(xhr.responseText);<br>&nbsp; &nbsp; &nbsp; &nbsp;if ( !!data.GPSLongitude ) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var olat = data.GPSLatitude.val.split(', ');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var olng = data.GPSLongitude.val.split(', ');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;var lat=0, lng=0, coord;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for( var i = 0; i &lt; olat.length; i++ ){<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lat += olat[i] / Math.pow(60, i);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lng += olng[i] / Math.pow(60, i);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lat = data.GPSLatitudeRef.val == 'S' ? -lat: lat;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;lng = data.GPSLongitudeRef.val == 'W' ? -lng: lng;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;coord = coordtransform.wgs84togcj02(lng, lat).join(',');<br>&nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp;}</span></p><p style="text-align: left;"><span style="text-align: justify; font-size: 13px;">}</span></p><p style="text-align: left;"><span style="text-align: justify; font-size: 13px;">xhr.send();</span></p></section></section></section></section></section></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="padding-right: 4px; padding-left: 4px; text-align: justify; font-size: 15px; line-height: 1.8; letter-spacing: 1px; box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 16px;"><strong><span style="color: rgb(6, 163, 224);">获取图片地址信息</span></strong></span></p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box;">有了坐标就有了地理位置，有了地理位置就知道是什么地方。高德地图逆地理编码 API 正在招手：「<span style="background-color: rgb(255, 255, 255);">给我一个坐标，我将还你一个详细地址。</span>」</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">根据文档，最基本的只需&nbsp;location&nbsp;参数传个坐标即可返回地址信息。此 API 还可批量获取，可以根据自己需求传入可选的参数。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">以上面获取的坐标为例：</p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">http://restapi.amap.com/v3/geocode/regeo?location=116.781381,23.48378&amp;key=&lt;用户的key&gt;</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">请求后返回的 JSON 如下，具体返回的参数的详细说明参考文档。</p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">{<br>&nbsp; &nbsp;"status": "1",<br>&nbsp; &nbsp;"info": "OK",<br>&nbsp; &nbsp;"infocode": "10000",<br>&nbsp; &nbsp;"regeocode": {<br>&nbsp; &nbsp; &nbsp; &nbsp;"formatted_address": "广东省汕头市澄海区莲下镇渡亭村",<br>&nbsp; &nbsp; &nbsp; &nbsp;"addressComponent": {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"country": "中国",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"province": "广东省",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"city": "汕头市",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"citycode": "0754",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"district": "澄海区",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"adcode": "440515",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"township": "莲下镇",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"towncode": "440515102000",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"neighborhood": {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"name": [],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"type": []<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"building": {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"name": [],<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"type": []<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"streetNumber": {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"street": "文明路",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"number": "159号",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"location": "116.78592,23.48872",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"direction": "东北",<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"distance": "718.365"<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;},<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;"businessAreas": [<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[]<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;]<br>&nbsp; &nbsp; &nbsp; &nbsp;}<br>&nbsp; &nbsp;}</span></p><p><span style="font-size: 13px;">}</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">准确度一般般，到乡（镇、街道）这一级基本没问题。我们也不需要太准确的信息，毕竟定位信息有时候还是挺隐私的。</p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 16px;"><strong><span style="color: rgb(6, 163, 224);">显示相片地图</span></strong></span></p><p style="box-sizing: border-box; text-align: center;"><span style="font-size: 16px;"><strong><span style="color: rgb(6, 163, 224);"><br></span></strong></span></p></section></section></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="padding-right: 4px; padding-left: 4px; text-align: justify; font-size: 15px; line-height: 1.8; letter-spacing: 1px; box-sizing: border-box;"><p style="box-sizing: border-box;">将相片显示在地图上，这似乎才是初衷，在这里，我将它分成两部分，一部分是静态地图，一部分是动态地图。</p></section></section></section><section class="" powered-by="xiumi.us" style="white-space: normal; box-sizing: border-box;"><section class="" style="box-sizing: border-box;"><section class="" style="padding-right: 4px; padding-left: 4px; text-align: justify; font-size: 15px; line-height: 1.8; letter-spacing: 1px; box-sizing: border-box;"><p style="box-sizing: border-box;"><br></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="85988" data-color="#06A3E0" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section data-width="100%" style="margin-right: auto; margin-left: auto; border-width: initial; border-style: none; border-color: initial; display: inline-block; width: 548px; box-sizing: border-box;"><section style="font-size: 18px; letter-spacing: -2px; display: inline-block; box-sizing: border-box;"><span style="color: rgb(6, 163, 224); font-weight: bold;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.7;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.5;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.3;">&gt;</span></section><section style="margin-left: 10px; color: rgb(6, 163, 224); display: inline-block;"><p class="" data-brushtype="text" style="color: inherit;"><strong><span style="color: rgb(0, 0, 0); font-size: 15px;">静态地图</span></strong></p></section></section></section></section><p style="box-sizing: border-box;">将图片显示到静态地图上面，需要用到的高德地图 API 是静态地图 API。<br></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">根据高德的文档，自定义标注（marker）图片只能支持 PNG 格式，需要多来一张图片吗？不需要，这里可以直接用七牛图片处理 API，将原图调下大小并指定输出格式。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">http://source.fooleap.org/show-photo-location-on-map-with-qiniu-and-amap-api.jpg?imageView2/1/w/100/h/100/format/png</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">上面的链接是输出等比缩放并居中裁剪的 100x100 PNG 格式图片，然而应用到高德接口还是出错了。我尝试在最后再加上&nbsp;.png，结果成功，这意味着高德是以后缀名判断文件格式的，也是醉了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="86005" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section class="" style="margin-bottom: 16px; padding: 16px; overflow: auto; font-size: 15px; line-height: 1.45; border-radius: 3px; word-wrap: normal; color: rgb(51, 51, 51); box-sizing: border-box; background-color: rgb(247, 247, 247);"><p><span style="font-size: 13px;">http://restapi.amap.com/v3/staticmap?zoom=12&amp;size=640*427&amp;scale=2&amp;markers=-1,http://source.fooleap.org/show-photo-location-on-map-with-qiniu-and-amap-api.jpg?imageView2/1/w/100/h/100/format/png.png,0:116.781381,23.48378&amp;key=&lt;用户的key&gt;</span></p></section></section></section><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">以上拼凑出的链接显示如下。</p><p style="box-sizing: border-box;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ6lSHJBjlgLwvnk8y9FUFh77Uhde5DRic27N9OqegkukFNfQfNE0RBTIFn5P1BcbVk2JY3nibubTpWg/0?wx_fmt=png" style="width: 762px !important; height: 508.397px !important;"></p><p style="box-sizing: border-box; text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px;">▲ 高德静态地图 API 显示相片位置</span></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;">高德静态地图 API 一样支持批量，具体可查看文档。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;"></strong></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="85988" data-color="#06A3E0" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section data-width="100%" style="margin-right: auto; margin-left: auto; border-width: initial; border-style: none; border-color: initial; display: inline-block; width: 548px; box-sizing: border-box;"><section style="font-size: 18px; letter-spacing: -2px; display: inline-block; box-sizing: border-box;"><span style="color: rgb(6, 163, 224); font-weight: bold;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.7;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.5;">&gt;</span><span style="color: rgb(6, 163, 224); font-weight: 700; opacity: 0.3;">&gt;</span></section><section style="margin-left: 10px; color: rgb(6, 163, 224); display: inline-block;"><p class="" data-brushtype="text" style="color: inherit;"><strong><span style="color: rgb(0, 0, 0); font-size: 15px;">动态地图</span></strong></p></section></section></section></section><p style="box-sizing: border-box;">想要在网页中实现跟苹果相册地图差不多样式且可控的地图，这就得用到高德地图 JS API，主要是用到点标记，这里就不多废话了，直接上图。</p><p style="box-sizing: border-box;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_gif/v6uP0lGcBZ4vrH6L76hjzVf7fCgDHHqo9HacwQ5lAcBNEE7CKiavibLCrxjtrq9GFNYrRzGaBWEjO9syZViauPcgQ/0?wx_fmt=gif" style="width: 640px !important; height: 428px !important;"></p><p class="" style="text-align: center;"><span class=""></span></p><section data-role="outer" label="Powered by 135editor.com" style="font-family: 微软雅黑; font-size: 16px;"><section class="" data-tools="135编辑器" data-id="87417" style="border-width: 0px; border-style: none; border-color: initial; box-sizing: border-box;"><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" text-align: center; margin: 10px 0% 3px; font-size: 11px;  box-sizing: border-box; "><section class="" style="height: 3.8em; box-sizing: border-box;"><section style="padding-top: 1.1em; padding-right: 3px; padding-left: 3px; box-sizing: border-box;"><section style="width: 0.5em; height: 0.5em; border-width: 2px; border-style: solid; border-color: rgb(37, 162, 240); display: inline-block; vertical-align: middle; transform: rotate(45deg); box-sizing: border-box;"></section><section style="width: 100%; margin-right: -0.5em; margin-left: -0.5em; padding-right: 0.5em; padding-left: 0.5em; display: inline-block; vertical-align: middle; box-sizing: border-box;"><section style="width: 100%; border-top: 2px solid rgb(37, 162, 240); box-sizing: border-box;"></section></section><section style="width: 0.5em; height: 0.5em; border-width: 2px; border-style: solid; border-color: rgb(37, 162, 240); display: inline-block; vertical-align: middle; transform: rotate(45deg); box-sizing: border-box;"></section></section><section class="" style="width: 3.6em; height: 3.6em; display: inline-block; vertical-align: top; border-width: 5px; border-style: solid; border-color: white; margin-top: -2.48em; transform: rotate(0deg); border-radius: 100%; background-position: center center; background-repeat: no-repeat; background-size: cover; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ4vrH6L76hjzVf7fCgDHHqojHze7UWMjnvQnkRCV9B1Qaa95RAug7REwUR02U21T9BKibv6kBhmv0w/0?wx_fmt=jpeg&quot;); box-sizing: border-box;"><section class="" style="width: 100%; height: 100%; overflow: hidden; box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ4vrH6L76hjzVf7fCgDHHqojHze7UWMjnvQnkRCV9B1Qaa95RAug7REwUR02U21T9BKibv6kBhmv0w/0?wx_fmt=jpeg" style="opacity: 0; box-sizing: border-box; width: 29.5938px !important; height: 29.5938px !important;"></section></section></section></section></section></section><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4vrH6L76hjzVf7fCgDHHqoHRPQiaDonn9tWoAia284GRial3Bjd6on2vicqM4fJrdZI6Vpwx3z7qGiciaA/0?wx_fmt=gif" style="width: 600px !important; height: 250px !important;"></p><p style="text-align: center;"><br></p><p style="text-align: left;"><span style="font-size: 15px;">点击&nbsp;<strong><span style="color: rgb(6, 163, 224);">阅读原文&nbsp;</span></strong>，体验动态地图</span></p></section></section></section></section></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1499656823&src=3&ver=1&signature=Hv6rg8SdYuiUQmONS3uvW2Hpmz3aPkDsMR47SMTl55WKhaJyCYOlY4s7d93xZUMEMfcYfHv-0EWpPdCKow4Blu5ic--c9bVqgbnn6zq7dtDz2LMt2wcmW8BJSsrIOgwU67Vw3pvo4QzGwwBmPe6f5KKaFy3wH0wJHKsidmncEsU=">微信地址</a> | <a href="https://0x7.me/Q6pv">阅读原文</a>
{% endraw  %}

