---
title: 一篇文章告诉你，TLS 1.3 如何用性能为 HTTPS 正名
author: 张大贺
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1495452335&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZea5mlUJftA8xd9Y4VXhWJ-e3S1Enkw3VmGoZBBV4jx5ocewUbpxrmQCle8rx6WRCwlLUiEDccsT51FzDWnW*EWbIHI5sJ09jJSIc8Z8ooBvfUJ6vQfexZhoAARnYDZaUSAE9iApYSbo*j*UeSvWyOUg=
date: '2017-05-18 00:00:00 +0000'

---

{% raw  %}
<p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyaTXU1qwTmObvXgJLNhfY6DIW1YxqP7MvibWibB3NgFTOZbEWibV1PcL7A/0?wx_fmt=png" style="width: 722px !important; height: 225px !important; visibility: visible !important;"></p><p style="line-height: normal;"><br></p><section style="background-color: rgb(255, 255, 255); box-sizing: border-box;"><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">序•魔戒再现</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important; visibility: visible !important;"><br></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">几天前，<span style="color: rgb(6, 163, 224); box-sizing: border-box;">OpenSSL 官方宣布即将发布的新版本 （OpenSSL 1.1.1） 将会提供 TLS 1.3 的支持，而且还会和之前的 1.1.0 版本完全兼容，</span>这当然是个好消息。如果说 HTTP/2 是当前互联网 Web 发展的讨论热点之一，那么下一个热点应该就是 TLS 1.3 了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyrVG7n0qjVz3BIPgPpV8UcMWV55lBvFrUpmfc5zZ4iaIT8UsdZHeyuwA/0?wx_fmt=png" style="width: 770px !important; height: 392.791px !important; visibility: visible !important;"></p><p style="box-sizing: border-box; line-height: 1.75em;"><br></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">谈到 TLS 那么就不得不说回 HTTPS，2016 年应该算是国内站点使用 HTTPS 激增的一年，从 Google Trend 上也可以看出该关键词的搜索热度从 2016 年开始飙升。不光如此，所有从事互联网 Web 技术相关的开发人员，也应该能够明显感受到，身边使用 HTTPS 的网站越来越多了。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px; text-align: center;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy83aficfCcM5Fw8HHyicT6ib20VbLAHcNAOyEl4b8ptTslH2JAicserjraQ/0?wx_fmt=png" style="box-sizing: border-box; float: left; margin-right: -2em; text-align: start; width: 36px !important; height: 36px !important;"> <section class="" style="margin: 0.2em 0.5em -1.8em; padding-right: 5px; padding-left: 5px; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">为什么近两年来 HTTPS 被大家更广泛的应用？</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy5m8nyowY7xV3FsUO4D25M9ia3LnI7BIh5HeibGeS7Vxqhiamq3wn1X59A/0?wx_fmt=png" style="box-sizing: border-box; float: right; text-align: start; width: 36px !important; height: 36px !important;"> </section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">一方面得益于「中国特色」的网络安全环境，运营商层出不穷的各种劫持给所有的用户和开发者都上了生动的一课。</p><p style="box-sizing: border-box; line-height: 1.75em;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyKYYpEbq0vsfYxQyR0DRLccc24b9XXJZEvib5Irh3udOQiaKoOrk7Gcsg/0?wx_fmt=png" style="width: 770px !important; height: 374.595px !important;"></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyvwU9G3yfZJzKNMpericvgR3PvsKmxroZyRzicjZ3lzp7Dlnez02FuKAA/0?wx_fmt=png" style="width: 770px !important; height: 369.016px !important;"></p><p style="box-sizing: border-box; line-height: 1.75em;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyWIsDjGh9VMfOHZhD3SqSicvZ5nbNwWlCTJVchEMKexSQa66QZAPFyGg/0?wx_fmt=jpeg" style="width: 720px !important; height: 1280px !important;"></p><p style="box-sizing: border-box; line-height: 1.75em;"><br></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">用户每天被来自各种广告联盟漫天的牛皮癣广告和运营商话费余额查询所包围。不仅如此，随着公司流量不断的被劫持导流到其他地方。搞得很多公司连苦心经营的市场蛋糕都没办法安心的吃，终于大部分公司坐不住了。当然声讨和口诛笔伐是没有用的，<span style="color: rgb(6, 163, 224); box-sizing: border-box;">所以拥有业务上拥有 HTTPS 和 HTTP DNS 解决方案，也就顺理成章的成了技术公司在伟大防火墙内生存的必备技能之一。</span></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">另一方面，从安全角度讲，互联网上通过明文传输数据本身就是一件高风险的事情，什么数据泄露、中间人攻击、用户被盗号、被竞争对手背后捅刀子 App 下载被劫持.....也是屡见不鲜。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">那么说回主题，既然 HTTPS 可以一劳永逸的解决上述问题</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px; text-align: center;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy83aficfCcM5Fw8HHyicT6ib20VbLAHcNAOyEl4b8ptTslH2JAicserjraQ/0?wx_fmt=png" style="box-sizing: border-box; float: left; margin-right: -2em; text-align: start; width: 36px !important; height: 36px !important;"> <section class="" style="margin: 0.2em 0.5em -1.8em; padding-right: 5px; padding-left: 5px; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">而为什么大家之前不尽快的用起来？</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy5m8nyowY7xV3FsUO4D25M9ia3LnI7BIh5HeibGeS7Vxqhiamq3wn1X59A/0?wx_fmt=png" style="box-sizing: border-box; float: right; text-align: start; width: 36px !important; height: 36px !important;"> </section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">问题在于：考虑到 HTTPS 要比 HTTP 更加消耗服务器资源，而且相比于 HTTP 建立连接握手时需要消耗的大量时间影响用户端的体验，使得很多人望而却步，尤其是在移动网络下。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em;">当然，还有 SSL 证书的成本也要算进去。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><p style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; line-height: 1.75em; "><br></p><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">王者归来</strong></p></section><p><br></p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy1tric61QmDNicQAsg4acGGgj6Y8AvvibKibGFtB3ibInqq9NpMHUtg7WPqg/0?wx_fmt=png" style="width: 770px !important; height: 409.011px !important;"></p><p style="box-sizing: border-box; line-height: 1.75em;"><br></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">在 Web 领域，传输延迟（Transmission Latency）是 Web 性能的重要指标之一，低延迟意味着更流畅的页面加载以及更快的 API 响应速度。而一个完整的 HTTPS 链接的建立大概需要以下四步：<br></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><section style="border-left: 5px solid rgb(6, 163, 224); box-sizing: border-box;"><span style="width: 0px; display: inline-block; border-left: 5px solid rgb(6, 163, 224); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"> </span> <section class="" style="display: inline-block; vertical-align: middle; font-size: 18px; padding-left: 2px; box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">第一步：DNS 查询</strong></p></section></section></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">浏览器在建立链接之前，需要将域名转换为互联网 IP 地址。一般默认是由你的 ISP DNS提供解析。ISP 通常都会有缓存的，一般来说花费在这部分的时间很少。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><section style="border-left: 5px solid rgb(6, 163, 224); box-sizing: border-box;"><span style="width: 0px; display: inline-block; border-left: 5px solid rgb(6, 163, 224); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"> </span> <section class="" style="display: inline-block; vertical-align: middle; font-size: 18px; padding-left: 2px; box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">第二步：TCP 握手（ 1 RTT）</strong></p></section></section></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">和服务器建立 TCP 连接，客户端向服务器发送 SYN 包，服务端返回确认的 ACK 包，这会花费一个往返（1 RTT）</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><section style="border-left: 5px solid rgb(6, 163, 224); box-sizing: border-box;"><span style="width: 0px; display: inline-block; border-left: 5px solid rgb(6, 163, 224); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"> </span> <section class="" style="display: inline-block; vertical-align: middle; font-size: 18px; padding-left: 2px; box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">第三步：TLS 握手 （2 RTT）</strong></p></section></section></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em;">该部分客户端会和服务器交换密钥，同时设置加密链接，对于 TLS 1.2 或者更早的版本，这步需要 2 个 RTT</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><section style="border-left: 5px solid rgb(6, 163, 224); box-sizing: border-box;"><span style="width: 0px; display: inline-block; border-left: 5px solid rgb(6, 163, 224); border-top: 3px solid transparent !important; border-bottom: 3px solid transparent !important; box-sizing: border-box;"> </span> <section class="" style="display: inline-block; vertical-align: middle; font-size: 18px; padding-left: 2px; box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">第四步：建立 HTTP 连接（1 RTT）</strong></p></section></section></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;"><span style="letter-spacing: 0px; box-sizing: border-box;">一旦 TLS 连接建立，浏览器就会通过该连接发送加密过的 HTTP 请求。</span><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;"><span style="letter-spacing: 0px; box-sizing: border-box;"><br></span></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">我们假设 DNS 的查询时间忽略不计，那么从开始到建立一个完整的 HTTPS 连接大概一共需要 4 个 RTT，如果是浏览刚刚已经访问过的站点的话，通过 TLS 的会话恢复机制，第三步 TLS 握手能够从 2 RTT 变为 1 RTT。</p><p style="box-sizing: border-box; text-align: justify; line-height: normal;"><br></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="display: inline-block; width: 90%; border-width: 1px; border-style: solid; border-color: rgb(192, 200, 209); padding: 10px; background-color: rgb(239, 239, 239); box-sizing: border-box;"><section class="" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="text-align: left; box-sizing: border-box;"><p style="text-align: center; box-sizing: border-box;"><strong>总结：</strong><br></p><p style="text-align: center;">建立新连接 ：</p><p style="text-align: center;"><span style="color: rgb(6, 163, 224);">4 RTT + DNS 查询时间</span></p><p style="text-align: center;">访问刚浏览过的连接：</p><p style="text-align: center;"><span style="color: rgb(6, 163, 224);">3 RTT + DNS 查询时间</span></p></section></section></section></section><p><br></p></section><section class="" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px; text-align: center;  box-sizing: border-box; "><section class="" style="display: inline-block; box-sizing: border-box;"><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy83aficfCcM5Fw8HHyicT6ib20VbLAHcNAOyEl4b8ptTslH2JAicserjraQ/0?wx_fmt=png" style="box-sizing: border-box; float: left; margin-right: -2em; text-align: start; width: 36px !important; height: 36px !important;"> <section class="" style="margin: 0.2em 0.5em -1.8em; padding-right: 5px; padding-left: 5px; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">那么 TLS 1.3 以及 0-RTT 是如何减少延迟的?</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy5m8nyowY7xV3FsUO4D25M9ia3LnI7BIh5HeibGeS7Vxqhiamq3wn1X59A/0?wx_fmt=png" style="box-sizing: border-box; float: right; text-align: start; width: 36px !important; height: 36px !important;"> </section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em;"><strong style="box-sizing: border-box;"><span style="font-size: 18px; box-sizing: border-box;"><br style="box-sizing: border-box;"></span></strong></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">在此之前我们需要简单回顾一下 TLS 1.2 是如何工作的。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">TLS 1.2 建立新连接</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyro620eEsmkIoUTCxbUxebgFgfvyEgwpEQ95a5LwxiccaDpqOENH2OaQ/0?wx_fmt=png" style="width: 770px !important; height: 441.637px !important;"></section></section><p><br></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">在一次新的握手流程中，Client Hello 总是客户端发送的第一条消息，该消息包含客户端的功能和首选项，与此同时客户端也会将本身支持的所有密码套件（Cipher Suite）列表发送过去</p></li></ul><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">Server Hello 将服务器选择的连接参数传送回客户端，同时将证书链发送过去，进行服务器的密钥交换</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">进行客户端部分的密钥交换，此时握手已经完成，加密连接已经可以使用</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em;">客户端建立 HTTP 连接</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">TLS 1.2 会话恢复</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"> <section class="" style="clear: both; box-sizing: border-box;"></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; line-height: 1.75em;"><span style="font-size: 18px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCy4vSDAC3FgIHFNjVw1BBwtDc2NEDnKaDJUGZOK8oaUQ6dsV4VcL3JwQ/0?wx_fmt=png" style="width: 770px !important; height: 441.637px !important;"></p><p style="box-sizing: border-box; line-height: 1.75em;"><span style="font-size: 18px;"></span><br></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;"><span style="font-size: 18px;"><strong>会话恢复</strong></span></p><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">在一次完整协商的连接断开时，客户端和服务器都会将会话的安全参数保留一段时间。希望使用会话恢复的服务器会为会话指定唯一的标识，称为会话 ID。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">希望恢复会话的客户端将相应的会话 ID 放入 ClientHello 消息中，提交给服务器。</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">服务器如果愿意恢复会话，将相同的会话 ID 放入 Server Hello 消息返回，使用之前协商的主密钥生成一套新密钥，切换到加密模式，发送完成信息。</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; line-height: 1.75em; text-align: justify;">客户端收到会话已恢复的消息，也进行相同的操作。</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">TLS 1.3 建立新连接</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"> <section class="" style="clear: both; box-sizing: border-box;"></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyicRck7IOGUyXU7m3ZrePBXgVraQLGyW6OEoBPhLWggpoZgERIqnyozw/0?wx_fmt=png" style="width: 770px !important; height: 439.329px !important;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; text-align: justify;">在一次新的握手流程中，客户端不仅会发送 Client Hello 同时也会将支持的密码套件以及客户端密钥发送给服务端，相比于 TLS1.2，该步骤节约了一个 RTT。</p></li></ul><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p style="box-sizing: border-box; text-align: justify;">服务端发送 Server Hello ，服务端密钥和证书。</p></li></ul><p style="box-sizing: border-box;"><br></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; text-align: justify;">客户端接收服务端发过来的信息，使用服务端密钥，同时检查证书完整性，此时加密连接已经建立可以发送 HTTP 请求，整个过程仅仅一个 RTT。</p></section></section></section></li></ul></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="margin-top: 10px; margin-bottom: 10px; box-sizing: border-box; text-align: justify;"><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;"><span style="font-size: 18px; box-sizing: border-box;">TLS 1.3 0-RTT 会话恢复</span></strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"><br></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyrNs9ViaEvkrUL6NKCpVtRl2qbhicdl0gNvLl13K0cDNZCcRhsQE8Eddg/0?wx_fmt=png" style="width: 770px !important; height: 298.695px !important;"></p><p style="box-sizing: border-box;"><br></p><p style="box-sizing: border-box; text-align: justify;">TLS 1.2 中通过 1 个 RTT 即可完成会话恢复，那么 TLS 1.3 是如何做到 0 RTT 连接的？</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; text-align: justify;">当一个支持 TLS 1.3 的客户端连接到同样支持 TLS 1.3 的服务器时， 客户端会将收到服务器发送过来的 Ticket 通过相关计算，一起组成新的 预共享密钥，PSK （PreSharedKey）。客户端会将该 PSK 缓存在本地，在会话恢复时在 Client Hello 上带上 PSK 扩展，同时通过之前客户端发送的完成（finished）计算出恢复密钥 （Resumption Secret）通过该密钥加密数据发送给服务器。服务器会从会话 Ticket 中算出 PSK，使用它来解密刚才发过来的加密数据。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;">至此完成了该 0-RTT 会话恢复的过程。</strong></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; text-align: justify;">以上简单描述了 TLS 1.3 建立连接的大致流程，也解释了为什么 TLS 1.3 相比于之前的 TLS 1.2 会有更出色的性能表现。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; text-align: justify;">当然 TLS 1.3 还有非常非常多的细节以及安全特性，优点以及缺点（去除静态 RSA 和 DH 密钥协商、禁止 RC4、有副作用的 0-RTT 握手存在重放攻击，不支持前向保密.....），限于篇幅并没有更深入的去探讨。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="background-color: rgb(254, 255, 255); width: 100%; padding: 5px 10px; display: inline-block; text-align: center; font-size: 18px; box-sizing: border-box;"><p style="clear: none; box-sizing: border-box;"><strong style="box-sizing: border-box;">总结</strong></p></section><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyuxibeev3UdtpGr2p3icw2hIEJsxS0HS0g4AwetsKxp7ukH5XNBApVpXw/0?wx_fmt=png" style="margin-top: -1em; float: left; box-sizing: border-box; width: 770px !important; height: 74.5938px !important;"><br></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box; text-align: justify;">TLS 1.3 将是 Web 性能以及安全的一个新的里程碑，随之 TLS1.3 带来的 0-RTT 握手，淡化了大家之前对使用 HTTPS 性能上的隐忧。于此同时，在未来随着 HTTP/2 的不断普及，强制性使用 HTTPS 成为了一种必然。</p><p style="box-sizing: border-box;"><br></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/v6uP0lGcBZ4MmscYo8SAj6nM6wfiajHCyOH5lf1poLhNa349eBH0OUlMiaSkjkEHiaPnn9xj7Wj60j1Sp7Uf7JfGQ/0?wx_fmt=png" style="width: 770px !important; height: 404.865px !important;"></p><p style="box-sizing: border-box; text-align: center; line-height: normal;"><br></p><p style="box-sizing: border-box; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_gif/v6uP0lGcBZ4b1J4CLP8MNZJl4s5ZwKma1w1DX0myfWicnAnAGsS00ZFy0nxukEUDZt93ibPvhI8dKmwQUvKFYb1Q/0?wx_fmt=gif" style="color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255); display: inline; box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 22px !important; height: 10px !important;"></p><p style="box-sizing: border-box; text-align: center;"><br></p></section></section></section><section class="" style="   box-sizing: border-box; " powered-by="xiumi.us"><section class="" style=" margin-top: 10px; margin-bottom: 10px;  box-sizing: border-box; "><section class="" style="display: inline-block; width: 100%; border-width: 2px; border-style: dashed; border-color: rgb(192, 200, 209); padding: 10px; background-color: rgb(239, 239, 239); border-radius: 0.7em; box-sizing: border-box;"><section class="" style="box-sizing: border-box;" powered-by="xiumi.us"><section class="" style="   box-sizing: border-box; "><section class="" style="box-sizing: border-box;"><p style="box-sizing: border-box;"><strong style="box-sizing: border-box;"><span style="font-size: 18px; box-sizing: border-box;">广告时间：</span></strong></p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="box-sizing: border-box; text-align: justify;">SSL 证书是 HTTPS 中必不可少的一步，七牛云也于近日上线了一站式 SSL 证书申购服务，为更多的互联网企业以及个人开发者提供证书服务，也有为个人站长及开发者推出免费单域名 DV SSL 证书。</p><p style="box-sizing: border-box;"><br style="box-sizing: border-box;"></p><p style="text-align: center; box-sizing: border-box;"><strong style="box-sizing: border-box;"><span style="color: rgb(6, 163, 224); font-size: 18px; box-sizing: border-box;">即刻申购，最高可节省 66000 元哦！</span></strong></p></section></section></section></section></section></section></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1495452335&src=3&ver=1&signature=l12Tij*JEXuplVxFRWdZea5mlUJftA8xd9Y4VXhWJ-e3S1Enkw3VmGoZBBV4jx5ocewUbpxrmQCle8rx6WRCwlLUiEDccsT51FzDWnW*EWbIHI5sJ09jJSIc8Z8ooBvfUJ6vQfexZhoAARnYDZaUSAE9iApYSbo*j*UeSvWyOUg=">微信地址</a> | <a href="http://blog.qiniu.com/archives/8381?hmsr=weixin&amp;hmpl=sslzhengshu&amp;hmcu=sslzhengshu&amp;hmkw=&amp;hmci=">阅读原文</a>
{% endraw  %}

