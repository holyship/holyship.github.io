---
title: Facebook有没有可能部署到像AWS这样的公有云上？
author: 聊聊架构
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1499656728&src=3&ver=1&signature=Hv6rg8SdYuiUQmONS3uvWxnaSzyLxMLhJzn9jKm*dNZzNOL-qoOPpxfQXfebTvzD1HzIFuQ5ZU9OfhPLFxT67OQ2EztcOL2IdQN9ZBGVrhNEMrcnLpc2sz3NBWfd2DfzCvsW6UsxrMvjX7OI-Sj7ZuoRqwvX00MEafp5kB17ahY=
date: '2017-07-06 00:00:00 +0000'

---

{% raw  %}
<section style="color: rgb(63, 63, 63); font-size: 14px; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; box-sizing: border-box;"><section class="" style="box-sizing: border-box; text-align: left;">
		<img src="http://mmbiz.qpic.cn/mmbiz_jpg/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTSDz5OiaWuRianuXNmmCaWGp4oQUHQAZKdJwbxcrtqAbRFXVGJiczk80eQ/0?wx_fmt=jpeg" style="border-radius: 4px; margin-bottom: 25px; width: 100% !important; height: auto !important; visibility: visible !important;">
	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		作者｜SQLizer 官方博客	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		编辑｜大愚若智	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Facebook 大约在 2004 年成立，随着逐渐成为美国五大科技巨头之一，他们的基础架构也由大学寝室里的一台服务器发展成为遍布全球的七个定制数据中心。随着 Facebook 预计用户数将增长至 19.4 亿，他们很有可能还在规划新的数据中心。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">最近公布了一则消息：Snap 分别与 Google Cloud Platform 和 AWS（Amazon Web Services）签署价值 20 亿和 10 亿美元订单，这使得我们不禁好奇，以 Facebook 如此庞大的规模，能否在 AWS 之上运行。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">为了回答这个问题，我们从四个方面来考虑：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">服务器容量</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">服务器硬件性能</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">软件</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">成本</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">请注意，我们考虑的不是 Facebook 是否应该迁移至 AWS，只是在探讨这样做的可行性。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="margin-top: 38px; margin-bottom: 10px; height: 65px; line-height: 96px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanST5egxwRFjbUrrycKY4yVSPQTT4VAoJ6Tqmz14xUkd7mEZF6AibV9sEicQ/0?wx_fmt=png&quot;); background-position: 50% 50%; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; border-bottom: 2px solid rgb(27, 95, 160); background-size: 55px; display: inline-block;">服务器容量</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">由于 Facebook 已经很久没有公布过准确的服务器数量，很多人根据流传的假设进一步进行了猜测。不过这里肯定水分不少。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">Facebook 到底有多少台服务器？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">早在 2012 年，Data Center Knowledge 估计 Facebook 共有 180,000 台服务器。这个数值基于 2010 年发布的一组数据，通过这组数据精确计算得知，Facebook 在 2010 年共有 60,000 台服务器。假设 2012 年的估值是准确的，那么 Facebook 的服务器数量增速已经远远超过了摩尔定律。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><img src="http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTDcLSibP7ibgt7craHb4Ncsibial4IPlenG8d1FfibubFrTictMX2PiaQaEN8g/0?wx_fmt=png" style="width: 754px !important; height: 544.74px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Facebook 的用户增长情况，来源：The Next Web</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们想知道 Facebook 在五年（2012-2017）后的今天有多少台服务器。为了获得尽可能精确的估值，我们进行了三种计算。</p><section class="" style="box-sizing: border-box; font-size: 16px; text-align: left; margin-top: 30px; margin-left: 8px; color: rgb(60, 112, 198);"><span style="display: inline-block; width: 15px; height: 15px; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTlxJkPgT1ysmUWoq23iaaB8Yey2KyZFbwQo5XAWKibiacXA7rtCib4VrnBQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100% 100%; margin-right: 10px;"></span>
		计算一：每服务器用户数	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">首先通过“每服务器用户数”来计算 Facebook 的服务器数量。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2012 年，Facebook 用户数 10 亿，共有 18 万台服务器。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>1,000,000 用户 / 180,000 服务器 = 5,556 用户每服务器</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2017 年，Facebook 用户数接近 20 亿。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>2,000,000 用户 / 5,556 用户每服务器 = 360,000 台服务器</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">此外还需要考虑，Facebook 不仅用户数翻倍，每个人生成的数据量也增加了：照片、视频、直播等。另外现在 Facebook 还运营着 Instagram，那么服务器数量再翻一倍吧。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">360,000 * 2 = 720,000 服务器</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">按照这个计算方式，Facebook 在 2017 年拥有的服务器数量约为 72 万台。</p><section class="" style="box-sizing: border-box; font-size: 16px; text-align: left; margin-top: 30px; margin-left: 8px; color: rgb(60, 112, 198);"><span style="display: inline-block; width: 15px; height: 15px; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTlxJkPgT1ysmUWoq23iaaB8Yey2KyZFbwQo5XAWKibiacXA7rtCib4VrnBQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100% 100%; margin-right: 10px;"></span>
		计算二：每服务器营收	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">接下来通过“每服务器营收”来计算他们的服务器容量。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2012 年，Facebook 营收为 50.89 亿美元。将 2012 年的营收除以 2012 年的服务器总量，那么每服务器营收为 2.8 万美元。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>5,089,000,000 美元营收 / 180,000 服务器 = 28,272 美元营收每服务器</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2016 年，Facebook 营收为 276.38 亿美元，将其除以 28,272 美元，那么就是 977,575 台服务器。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>27,638,000,000 美元营收 / 28,272 美元营收每服务器 = 977,574.98 台服务器</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">按照这个计算方式，Facebook 在 2017 年拥有的服务器数量约为 97.8 万台。</p><section class="" style="box-sizing: border-box; font-size: 16px; text-align: left; margin-top: 30px; margin-left: 8px; color: rgb(60, 112, 198);"><span style="display: inline-block; width: 15px; height: 15px; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTlxJkPgT1ysmUWoq23iaaB8Yey2KyZFbwQo5XAWKibiacXA7rtCib4VrnBQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100% 100%; margin-right: 10px;"></span>
		计算三：每服务器对应的员工数	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">这个方式将使用员工数来计算服务器容量。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2012 年，Facebook 有 4,619 名员工，平均每位员工对应约 40 台服务器。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>180,000 服务器 / 4619 员工 = 38.96 台服务器每员工</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2016 年，Facebook 有 17,048 名员工。按照每位员工 40 台服务器来计算，约有 681,920 台服务器。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p>17,048 员工 * 40 服务器每员工 = 681,920 台服务器</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">按照这个计算方式，Facebook 在 2017 年拥有的服务器数量约为 68.2 万台。</p><section class="" style="box-sizing: border-box; font-size: 16px; text-align: left; margin-top: 30px; margin-left: 8px; color: rgb(60, 112, 198);"><span style="display: inline-block; width: 15px; height: 15px; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTlxJkPgT1ysmUWoq23iaaB8Yey2KyZFbwQo5XAWKibiacXA7rtCib4VrnBQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100% 100%; margin-right: 10px;"></span>
		不同数量之间的差异	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">三种计算方式的区间为 296,000。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">978,000 - 682,000 = 296,000</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">取中间值并将其作为我们最终的数量。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">296,000 / 2 = 148,000</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">682,000 + 148,000 = 830,000 或 978,000 - 148,000 = 830,000</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">所以我们估计 Facebook 在 2017 年共有 830,000 台服务器。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">AWS 又有多少台服务器？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><img src="http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTNNN0xFukNP1FmCIWQLQ9qiavQO2SSqcrUy4f4POeQB6ic5FlaMrUz8YQ/0?wx_fmt=png" style="width: 754px !important; height: 427.267px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">AWS 的全球基础架构，来源：AWS</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">AWS 可以按照下列方式分解：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">地区 – 一个完整包含的地理区域（如“欧洲”或“美国西部”）。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">可用区域（AZ） - 地区内由一个或多个数据中心组成的不同区域（如“伦敦”或“俄勒冈”）。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据中心 – 基本上就是一种大面积，造价高昂的仓库，每个数据中心承载 5 万至 8 万台服务器。</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">截止 2017 年，AWS 共有：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">16 个地区（还有 3 个在建）。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">42 个 AZ（新地区上线后还将增加 8 个）。</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">假设平均每个数据中心有 6.5 万台服务器，平均每个 AZ 有 1.5 个数据中心，那么服务器的总数为 409.5 万台。四舍五入一下，假设 AWS 共有 410 万台服务器。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">(42 AZ <span style="display: block; color: rgb(63, 63, 63); margin-left: 32px;"><span style="float: left; margin-left: -32px; display: block; width: 19px; height: 17px; margin-top: 5px; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTJbCtjIkbbZRSpRBw7CgckVCicZVUns9ZBKeLGAAVr1g94FE8FZmjjYQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100% 100%;"></span> 1.5 个数据中心) </span> 65,000 台服务器 = 4,095,000</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">2014 年，Enterprise Tech 进行过类似的计算（不过是基于 28 个 AZ，但道理是相通的），最终估计的服务器数量介于 280 万到 560 万台之间。他们的估算中，每个 AZ 包含三个数据中心，如果这个假设是准确的，那么 AWS 在全球范围内可能会有超过 800 万台服务器。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">在服务器净容量方面，根据上文（可能不准确的）计算，AWS 规模是 Facebook 的 5 倍。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">Facebook 需要 83 万台服务器</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">AWS 有 410 万台服务器</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">4,100,000 / 830,000 = 4.939</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">补充说明：上述计算并未考虑 AWS 目前的容量局限。AWS 的日常运营有多少预留容量？AWS 是否有 20% 的预留容量可以分配给 Facebook？我们打算忽略这些问题，直接假设 AWS 可以完全容纳 Facebook 目前的需求，但可能要牺牲灵活性作为代价。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">为了满足未来对服务器的需求，Facebook 和 AWS 都在服务器基础架构方面进行持续不断的投入，因此可以认为，未来的 AWS 也足以承载未来的 Facebook。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">那在服务器净容量方面，Facebook 有可能托管在 AWS 上吗？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我觉得是可以的。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="margin-top: 38px; margin-bottom: 10px; height: 65px; line-height: 96px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanST5egxwRFjbUrrycKY4yVSPQTT4VAoJ6Tqmz14xUkd7mEZF6AibV9sEicQ/0?wx_fmt=png&quot;); background-position: 50% 50%; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; border-bottom: 2px solid rgb(27, 95, 160); background-size: 55px; display: inline-block;">服务器硬件性能</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">不能直接假定 AWS 与 Facebook 的服务器性能是相等的，因此还要考虑服务器性能的问题。Facebook 在服务器基础架构方面已经投入了数十亿美元，随着规模逐渐增长，他们经历了一台笔记本充当服务器，从第三方租用服务器，再到自建数据中心的过程。当他们开始自行设计并构建数据中心时，拆箱即用的解决方案就不再适合了。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Facebook 七个数据中心在各方面都以最大化性能和效率为设计目标。从数据中心整体设计到各种细节，例如服务器机架和芯片，一切都是定制的。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">“为了优化成本，我们淘汰了你能在标准服务器上看到的大部分组件”，Facebook 服务器的设计者 Amir Michael 在 2009 年这样说过。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">“我们拆掉了所有没用的东西，只保留最必要的。”</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">011 年，Facebook 开源了自己有关数据中心和服务器的全部设计，借此表达对高效率设计的热爱。随后还有很多人对该项目做出了贡献，包括 Google。这些举措也推动了硬件成本的进一步降低，开始有第三方制造商生产相关组件，进一步降低了定制化数据中心的建设成本。你可以访问 Data Center Knowledge 查看完整的 Facebook 服务器硬件清单。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">因此 Facebook 现有的服务器基础架构已经得到了大幅优化，可以帮助 Facebook 尽可能高效地运营。例如，他们在服务器场中开辟了一块单独的“冷存储”，专门用来保存不再有人查看的照片和视频（通常都是 10 年前上传至 Facebook 的内容）。只有在有人想要查看这些照片或视频时，才会“唤醒”这种存储设备。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">下面这个视频展示了 Facebook 的冷存储装置。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">https://youtu.be/X9ELENWZqLE</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Facebook 多年的专精化运营与 AWS 截然不同，AWS 的存储在设计上就需要考虑不同用途（高负荷）的使用。但是与 Facebook 和 Google 类似，Amazon 也自行设计硬件。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">“没错，我们会自己制造服务器，”Amazon CTO Werner Vogels 说：“我们会通过自行制造的定制化存储和服务器满足这些（重量级）工作负载的需求。我们还与 Intel 合作制造以更高时钟频率运行的自用处理器。”</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">虽然 AWS 可能显得更加通用化，不过他们服务器的实际表现不可能比 Facebook 差。然而关于专用化以及效率，大家有很多不同看法，这些大型科技公司为什么要这样做？假设真的要迁移，为了能通过 AWS 获得与自己数据中心类似的性能，Facebook 很有可能需要更多服务器。为了体现这种因素，并在缺乏实际数据的情况下进行对比，我们假设 Facebook 迁移后需要的服务器数量会比目前增加 10%，因此服务器的数量将增至 91.3 万台。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">830,000 * 1.1 = 913,000</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">另外还要注意，Facebook 正打算将 WhatsApp 从 IBM 平台迁出，转移至自己的服务器上运行。WhatsApp 目前使用了 700 台裸机（类似于 Facebook 的）高端 IBM SoftLayer 服务器，这些服务器基本上可以提供与 Facebook 自有硬件类似的性能。但相比我们之前讨论的一切，这个数字（700！）实在是微不足道，那么可以假设这方面未来的增长完全可以包含在他们未来的扩展计划中。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">现实中，Facebook 完全不可能迁移至 AWS。因此这次开脑洞的过程并不考虑有关迁移的具体过程，我们只是想探讨一下这样做的可行性。实际上本文全文都基于这样的一个假设：Facebook 从开始自建基础架构的第一天开始就选择托管在 AWS，结果将会怎样。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">权且假设我们在一个平行宇宙中，那么迁移到 AWS 的工作是否顺利，需要多久？Facebook 在 2013 到 2014 年间将 Instagram 从 AWS 迁移到了自己的服务器上，整个过程用了一年，并且无人察觉。结合这件事来考虑，我们应该也可以在最终用户毫无察觉的情况下进行反向迁移。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">然而…… 我们要迁移的可是整个 Facebook，还包括 Instagram，因此整个过程肯定需要更长时间。相比这种理论上的迁移，Instagram 的迁移规模就小太多了，更无须说之前迁移后 Instagram 的规模也扩大了不少。另外别忘了 Netflix，他们花了八年才彻底迁移至 AWS。八年啊！</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">基于这些假设和猜测，迁移过程应该会很顺利，但可能需要多年时间才能完成。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">AWS 和 Facebook 都在定制数据中心、服务器设计，以及实施方面进行了大量投入。在所有设计均已开源的情况下，这两家的服务器性能很可能不相上下。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们认为 AWS 可以很轻松地提供 Facebook 所需的计算能力和性能。但因为 AWS 无法满足 Facebook 某些特殊需求，因此还需要保留一些余量。Facebook 用 830,000 台自有服务器可以做到的事情，换成 AWS 的服务器可能需要 913,000 台。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">AWS 能提供 Facebook 所需的服务器性能吗？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我觉得没问题。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="margin-top: 38px; margin-bottom: 10px; height: 65px; line-height: 96px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanST5egxwRFjbUrrycKY4yVSPQTT4VAoJ6Tqmz14xUkd7mEZF6AibV9sEicQ/0?wx_fmt=png&quot;); background-position: 50% 50%; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; border-bottom: 2px solid rgb(27, 95, 160); background-size: 55px; display: inline-block;">软件情况</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Facebook 曾经（并且目前依然）使用 OSS（开源软件）进行开发。与其他公司类似，他们的增长速度飞快，以如此大的规模来说，通常都需要自行开发定制工具，或对现有工具进行大量修改才能满足自己的需求。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">他们依然使用 PHP 开发应用程序代码，但为了提高性能，Facebook 开发了 HipHop Virtual Machine（HHVM），借此通过即时编译（JIT）的方式编译 PHP 代码。这意味着 Facebook 的代码可以通过配合使用 HHVM 和 nginx 的方式来运行。Facebook 的整个网站运行在 HHVM 之上（桌面、API、移动），开发和生产环境均是如此。而这恰恰就是定制化的软件。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">感觉上，AWS 与 PHP 和 HHVM 的关系让人担忧。但在 Facebook 自己的 HHVM GitHub 代码库中，有一个链接指向了 HHVM for AWS Linux 服务器。因此我们可以假设 Facebook 可以成功地在 AWS 上运行 HHVM，进而运行自己的网站。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><img src="http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTah0XIy6OxuPhRSXOvhkPCbZZxsOyEFztxh3M2D6fY1XHf134VE1SDg/0?wx_fmt=png" style="width: 754px !important; height: 407.16px !important;"></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">但是数据库呢？数据存储方面，在 SQL 与 NoSQL 对战中有一个臭名昭著的例子：Facebook 对 MySQL 进行了大刀阔斧的改动，用于存储自己的时间线数据，同时依赖 memcached 实现快速交付。有关 Facebook 的伸缩，建议阅读 High Scalability 的相关文章。Facebook 定制版 MySQL 的规范可参阅这里。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Amazon RDS（Relational Database Service）可以满足要求吗？有很多科技巨头都在使用 Amazon RDS，最著名的就是 Netflix。也许可以认为，如果 Netflix 以及他们公司的所有视频都可以成功地通过 RDS 运行，那么 Facebook 也可以？答案无法确定，不过 Facebook 的 MySQL 集群是极为庞大的，简单地迁移很可能根本无法满足需求。为了处理自己的负载，他们甚至创建了自己的 MySQL 分支！</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">目前 Facebook 也已构造出极为全面的技术栈。他们的 GitHub 代码库足以证明这一点。这不免让人更担心他们的基础架构与 AWS 的兼容性问题。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">这一过程到底会有多难，Netflix 的例子也许是最好的证明，随着迁移至分布式云环境，他们需要重建大部分技术组件。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">AWS 能够支持 Facebook 庞大的软件环境和复杂的数据需求吗？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">也许可以，但几乎可以肯定这样做会让性能大受影响，Facebook 甚至可能需要构建一个新的系统。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="margin-top: 38px; margin-bottom: 10px; height: 65px; line-height: 96px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanST5egxwRFjbUrrycKY4yVSPQTT4VAoJ6Tqmz14xUkd7mEZF6AibV9sEicQ/0?wx_fmt=png&quot;); background-position: 50% 50%; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; border-bottom: 2px solid rgb(27, 95, 160); background-size: 55px; display: inline-block;">托管成本</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">注意：这可能是本文准确性最差的内容。虽然 AWS 提供了丰富的成本计算方法，但我们无法获知 Facebook 对数据存储和计算的实际需求。再次提醒，这些数据完全基于猜测。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们好奇的最后一个问题：成本。虽然 AWS 已经帮助无数公司快速低成本地缩放，但他们中的绝大部分永远无法达到 Facebook 的规模。以 Facebook 的规模来说，自建基础架构可能更便宜（他们也正是这样做的，但我们就是想开个脑洞 ^.^）。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">在使用 AWS 自己的成本计算器进行计算前，先来看看一些全球化产品在云计算方面的成本。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Snapchat 的 IPO 文件中提到，Snap 公司计划在 5 年里向 Google 支付 20 亿美元，同时向 AWS 支付 10 亿美元。也就是说，每月 5 千万美元。如此巨大的数字让技术界有些吃惊，甚至有人编出了“支付高额费用存储并处理很快会被销毁的内容”这样的段子（译注：Snapchat 是一种“阅后即焚”应用，用户发送的文字和图片等内容会在收件人查看之后立刻销毁）。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">上文曾经提到，WhatsApp 依然托管在 IBM 的公有云服务器上，但 Facebook 计划尽快进行迁移。然而目前 WhatsApp 的托管成本依然高达每月 2 百万美元。对于一个只使用了 700 台服务器的应用来说，这个成本实在是有点高。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们可以假设 Facebook 的用量需求远高于 WhatsApp 和 Snapchat 的总合。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">下列计算较为简单，基于 1,000,000 台服务器，这些服务器分别运行 EC2 计算、Amazon S3、Amazon RDS，以及照片和视频等数据的存储和传输任务，每月传输的数据流量为 1,256.5PB（1,256,500TB）。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">计算中假设：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">每天上传 3 亿张照片，平均每张照片 4MB。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">每天上传 1 亿小时的视频，平均每个视频 200MB。</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">这些计算即不精确也不严谨。如果你有更好的计算方法，欢迎自己试一试！原始的 AWS 成本计算结果可参阅这里。链接：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">https://calculator.s3.amazonaws.com/index.html#r=IAD&amp;key=calc-03140D3B-00A9-404C-85D6-BA52A304BFC6</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">随后开始计算：</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">Amazon EC2</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">计算：Amazon EC2 实例（用于运行 PHP 代码等内容）</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">实例：713,000 个</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">每月 100% 利用率</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">r3.2xlarge 实例上运行 Linux</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">3 年全额预付</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">Amazon S3</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">存储（照片和视频）</strong></p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">标准存储：1256.5PB</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">PUT/COPY/POST/LIST 请求：2147483647 个</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">GET 和其他请求：2147483647 个</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">数据传输</strong></p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">区域间数据传出：314125</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据传出：628250</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据传入：1256500</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据传出至 CloudFront：1256500</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">Amazon RDS</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">Amazon RDS On-Demand DB 实例（用于运行 Facebook 的时间线）</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据库实例：200,000 个</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">每月 100% 利用率</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据库引擎和许可：MySQL</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">实例类型：db.r3.2xlarge</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">部署：多 AZ</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">存储：常规用途，1TB</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">数据传输</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">区域间数据传出：500TB</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据传出：500TB</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">数据传入：500TB</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">区域内数据传输：500TB</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">总额</strong></p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">一次性全额支付（3 年期预付）：3,933,846,000.00 美元（39 亿）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">一次性全额支付分摊至 36 个月：每月 109,273,500.00 美元（1.09 亿）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">排除一次性支付，额外的月成本：389,020,939.96 美元（3.89 亿）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">月总成本：109,273,500.000 美元（1.08 亿）+ 389,020,939.96 美元（3.89 亿） = 498,293,439.96 美元（4.98 亿）</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">年总成本：5,979,521,279.52 美元（59.7 亿）</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">理论上，如果托管在 AWS 上，Facebook 每年的成本高达 59.7 亿美元。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">年营收超过 280 亿美元，总市值 4340 亿美元，全球用户数超过 19.4 亿的 Facebook 无疑有着庞大而复杂的基础架构。有人预计 Facebook 在 2012 年时的自有服务器基础架构价值已高达 40 亿美元，目前这一数字很可能已经翻了三倍达到 120 亿美元。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">然而每年 59.7 亿美元的托管成本已经远远超过 Facebook 在 2017 年时的“营收成本”（3,789,000,000 美元），这个成本已包含数据中心以及其他方面的运营成本。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">另外需要注意，假设估算的 AWS 价格可能并非 Facebook 需要支付的。与 Snapchat 和 Netflix 类似，Facebook 也是有很大影响力的重量级用户，因此有能力协商并获得更低的价格。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">Facebook 能够支付 AWS 托管费用吗？</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">可以，但这样更贵。</p><section class="" style="box-sizing: border-box; font-size: 20px;">
		<span style="margin-top: 38px; margin-bottom: 10px; height: 65px; line-height: 96px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanST5egxwRFjbUrrycKY4yVSPQTT4VAoJ6Tqmz14xUkd7mEZF6AibV9sEicQ/0?wx_fmt=png&quot;); background-position: 50% 50%; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; border-bottom: 2px solid rgb(27, 95, 160); background-size: 55px; display: inline-block;">Facebook 有可能托管在 AWS 上吗？</span>
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们永远不可能知道这种开脑洞的假设是否准确，但可以这样看：</p><ol style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">在服务器净容量方面，AWS 应该可以满足 Facebook 的需求。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">服务器硬件的性能也许并非最优，但只要使用更多服务器获得更强计算能力就可以解决。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">软件部分最麻烦。需要考虑 Facebook 能否简单地将现有基础架构直接移植到 AWS。虽然有可行的解决方案，但可能需要在 AWS 现有基础架构的基础上构建新的系统。这样的做法不仅痛苦，而且不太可行。但如果 Facebook 在 2010/2011 年就选择托管到 AWS，那么可能已围绕 AWS 构建了自己的技术，这种情况下软件本身不再是问题，但依然棘手。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">Facebook 可以付得起托管费用，但相比目前的成本会高很多。毫无疑问，这些结论都是错的，因为我们无法获得计算所需的数据。但是……</p></li></ol><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">根据本文进行的计算和得到的结果，理论上可以将 Facebook 托管到 AWS 吗？可以，完全可以。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">原文链接：http://blog.sqlizer.io/posts/facebook-on-aws/</p><section class="" style="box-sizing: border-box; padding-top: 19px;">
		<h5 style="height: 51px; line-height: 52px; font-size: 18px; margin-top: 38px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTNc9kdgVu6jP9fZibsp3N2Pa3aaw6Az4w0H835mZ5yzZo5rBbYVwgZ9w/0?wx_fmt=png&quot;); background-position: center center; background-size: initial; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="display: inline-block; height: 51px; width: 37%; float: left; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTtS3PqPT5O2RSkC7tq0ibehdGqWayEcsnPeLybTbaHaJ6fmuIB3LrNjg/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100%;"></span>今日荐文<span style="display: inline-block; height: 51px; width: 37%; float: right; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTDYVvlPQKR87o6KQOR8BNibEmtYLOI9vcSH4XLiaT09icAsv7wvrqB2knw/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100%;"></span></h5>
		<p style="box-sizing: border-box; white-space: pre-line; line-height: 27px; font-size: 15px; color: rgb(200, 199, 199); padding-top: 28px; padding-bottom: 28px;">点击下方图片即可阅读</p>
		
		
		
		
		
		
				<a href="https://mp.weixin.qq.com/s?__biz=MzA5Nzc4OTA1Mw==&amp;mid=2659599387&amp;idx=1&amp;sn=d5590d23e92c6a09626127f75ab42f42&amp;scene=21#wechat_redirect" style="color: #5BACEB;">
			<img src="http://mmbiz.qpic.cn/mmbiz_jpg/LaW7jDBKBg1xiayAqWCIfYxCj71fRYD5fdlRpQEk53HNYYFp7tCKKwxYQAIGmaKDN5xeLuOfDFiaVNQrTZtPUHpw/640?wx_fmt=jpeg" style="color: inherit; float: left; width: 770px !important; height: 463.203px !important;">
		</a>
		<section class="" style="text-align: left; width: 100%; margin-top: -3em; margin-bottom: 29px; float: left; box-sizing: border-box; background-color: rgba(13, 14, 28, 0.8); max-width: 640px;">
			<section style="text-align: center; color: inherit; box-sizing: border-box;">
				<p style="font-size: 16px; line-height: 27px; text-align: left; color: rgb(255, 255, 255); box-sizing: border-box; white-space: normal; padding-top: 8px; padding-bottom: 8px; padding-left: 13px;"><span style="display: inline-block; width: 22px; height: 18px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTnRIMd3EeDZHM9icenEEPC0wK5TRfIiaG45Qd2rjtMLCwtO8vgCn4VaIg/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat; vertical-align: middle; margin-right: 8px;"></span>
					以 CockroachDB 为例，深入了解 CAP 定理				</p>
			</section>
		</section>
		<hr style="width: 100%; height: 1px; border-top-style: dotted; border-top-color: rgb(165, 165, 165);">
	</section><section class="" style="box-sizing: border-box; width: 100%; text-align: left;">
		<p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">近日，由 InfoQ 参与承办的以“在一起，梦飞扬”为主题的 2017 华为开发者大赛正式开赛，大赛设置百万现金奖励，面向参赛者征集采用华为 11 个领域开放能力的优秀作品，包括：云计算、大数据、物联网、企业云通信、eLTE、视频、CloudCaaS 、移动、开放工场、运营商运营管理、IES SmallCell。如果你是华为的合作伙伴，或者对华为合作伙伴生态感兴趣，可以点击“<span class="" style="text-align: left; color: rgb(91, 172, 235);">阅读原文</span>”链接报名，InfoQ 将提供全程赛事指导，提交作品更有开发者礼包相赠。</p>
		<img src="http://mmbiz.qpic.cn/mmbiz_jpg/LaW7jDBKBg0UgwV95l1ZdlvezWEKanSTQC5JCQy61HchvNZIQiabI4ISqowENLgak9TJzBq7f4Usaa78dKv7owA/0?wx_fmt=jpeg" style="padding-right: 8px; padding-left: 8px; margin-top: 28px; margin-right: auto; margin-left: auto; width: 770px !important; height: 418.219px !important;"></section></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1499656728&src=3&ver=1&signature=Hv6rg8SdYuiUQmONS3uvWxnaSzyLxMLhJzn9jKm*dNZzNOL-qoOPpxfQXfebTvzD1HzIFuQ5ZU9OfhPLFxT67OQ2EztcOL2IdQN9ZBGVrhNEMrcnLpc2sz3NBWfd2DfzCvsW6UsxrMvjX7OI-Sj7ZuoRqwvX00MEafp5kB17ahY=">微信地址</a> | <a href="http://infoqstatic.com/cn/zones/huawei/index.html#utm_source=InfoQ&amp;utm_medium=archtime&amp;utm_campaign=hdc&amp;utm_term=0703&amp;utm_content=01">阅读原文</a>
{% endraw  %}

