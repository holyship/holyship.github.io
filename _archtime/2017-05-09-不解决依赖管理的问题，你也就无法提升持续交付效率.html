---
title: 不解决依赖管理的问题，你也就无法提升持续交付效率
author: Mike McGarr
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1494425835&src=3&ver=1&signature=T3pUTKCUVTFXYE3cOj0PN5Pj7cnItpQYG26NZRn7R08Pw-hMmu8uxt9*QadJbd-YkoIvkgOWnOHggXxfr3M*LssKPUapH0e2AVLg0TIL5PV5WcGunlKrnrewCWyQgx5pYcGYHNBGDvA*mAso1HMo-NFCZXEncW4XHy5Hco7vn2I=
date: '2017-05-09 00:00:00 +0000'

---

{% raw  %}
<section style="color: rgb(63, 63, 63); font-size: 14px; font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif; text-align: center; box-sizing: border-box;"><section class="" style="box-sizing: border-box; text-align: left;">
		<img src="/archtime/images/e43fc06527e5514bc2c53695bdf5822429d16b32.jpeg" style="border-radius: 4px; margin-bottom: 25px; width: 770px !important; height: 512.307px !important; visibility: visible !important;">
	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		作者｜Mike McGarr	</section><section class="" style="box-sizing: border-box; color: rgb(145, 145, 145); text-align: left; line-height: 1em; margin-top: 13px; padding-left: 14px;">
		编辑｜薛命灯	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">微服务架构为软件开发带来了极大的灵活性，并加快了交付速度，但同时也带来了依赖管理问题。传统的解决方案虽然能够解决依赖管理问题，但都太极端，顾此失彼。于是，Netflix 尝试着寻找自己的解决方案，期待着在整个组织层面做到真正的持续集成。本文内容来自 Netflix 技术博客，且已获得翻译授权。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">在过去的 8 年间，Netflix 基于 AWS 构建了一套健壮的微服务架构，我们因此学会了如何在 AWS 上构建可靠的高性能服务。我们的微服务架构解耦了工程团队，让他们可以自由地构建、测试和部署他们的服务。这种灵活性最大化了团队的交付速度。在 Netflix，交付速度和可靠性是设计解决方案时首要的考虑点。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">基于我们的架构，微服务为它们的消费者提供了一个客户端软件包，用于处理所有的 IPC（进程间通信）逻辑。这同时为服务的提供者和消费者带来了很多好处。除了客户端，微服务的很大部分是基于我们的运行时平台而构建的，这个平台由内部的软件包和第三方开源的软件包组成。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">尽管服务开发团队有很大的发布灵活性，但他们的交付速度却受到了依赖软件包的影响。一项新增的产品特性可能要求很多微服务都用上最新版本的共享软件包或客户端，而更新依赖版本可能会带来风险。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><strong style="text-align: left;">简而言之，依赖管理是一项艰巨的任务。</strong></p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">更新项目的依赖可能带来潜在的问题，包括：</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);"><strong style="text-align: left;">具有阻断性的 API 变更</strong>。这是最典型的场景，一个编译错误导致整个构建失败。由依赖锁定（Dependency Locking）和动态版本选择器组成的语义版本控制（Semantic Versioning）可以帮助大部分团队避免发生这种错误。不过，锁定在一个主版本上会让整个公司的代码升级变得很困难，导致配置漂移（Configuration Drift），并且需要长期地维护旧软件包。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);"><strong style="text-align: left;">具有传递性的依赖更新</strong>。因为 JVM 的类路径是扁平结构，所以在一个应用程序里，一个类只能存在一个版本。像 Gradle 和 Maven 这类工具可以处理版本冲突，避免同一个软件包的多个版本被引入到项目当中。这也意味着，你的应用程序里有一些代码依赖了具有传递性特征的软件包，但你的代码并没有针对它们进行过测试。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);"><strong style="text-align: left;">具有阻断性的功能变更</strong>。理想情况下，这个问题可以通过执行适当的测试来缓解。软件包的所有者可以通过运行使用者的测试案例来了解他们对软件包功能的预期。</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们发现，为了解决大规模的依赖管理问题，很多公司使用了两种方案：共享最小化（Share Little）和单体仓库（MonoRepo）。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">共享最小化（或者干脆不使用共享软件包）最近在微服务领域很流行，它的核心论调是说，微服务之间不应该共享代码，服务之间只能通过 HTTP API 进行耦合。更有甚者，有人说直接使用拷贝加黏贴的方式来代替共享软件包。这是一种非常极端的解耦手段。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">单体仓库的核心论调是说，组织的所有代码应该全部保存在一个单独的仓库里。任何一个代码变更在提交到 HEAD 之前，都需要针对整个代码仓库进行编译和测试。内部软件包没有所谓的版本，只有 HEAD 代码。所有的提交在到达 HEAD 之前需要跨过一些门槛。第三方软件包需要通过“审批”才能被使用，而且仅限于一两个版本。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">这两种方式都能解决大规模的依赖管理问题，不过它们也带来了一些挑战。共享最小化促进了解耦，也加快了工程速度，但牺牲了代码的重用性和一致性。单体仓库保证了代码一致性，并降低了风险，但牺牲了灵活性。不管采用哪一种方式，我们都需要对 Netflix 的开发基础设施和运行时架构做出重大的调整。况且，这两种方案会破坏我们所推崇的自由和责任文化。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们给自己提出了一个很大的挑战目标：</p><blockquote style="padding-left: 0px; border-left: none; box-sizing: border-box; font-size: 15px;"><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; margin-top: 27px; padding-right: 20px; padding-left: 20px; color: rgb(91, 172, 235);">我们能否为 Netflix 的工程师们提供一种解决方案，它不但具有单体仓库的优势，还能保持分布式仓库的灵活性？</p><span style="display: block; clear: both;"></span></blockquote><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们以单体仓库为蓝本，另辟蹊径，希望找出能够达到相同目的的可替代方案。单体仓库所要解决的核心问题是什么？我们能否在传统的二元集成世界里开发出一种新的方案？</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们的解决方案，虽然还在试验阶段，不过可以从中归纳出三个关键的特性。</p><ul style="margin-top: 10px; line-height: 1em; text-align: left;" class="list-paddingleft-2"><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">向发布者反馈。直接或间接地向共享代码所有者快速地反馈使用者所遇到的问题。同时，允许团队因下游依赖的中断而暂停发布。目前，我们不会把这类问题的责任归咎到使用者身上。通过向软件包所有者反馈他们的问题给 Netflix 带来的影响，希望他们能够负起应有的责任。</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">来源管理。当有新版本发布时，为使用者提供一种安全的方式，用于自动增加软件包的版本。既然我们已经针对所有的下游依赖测试过每一个软件包，那为什么不直接让使用者知道新版本，从而加快新版本的采用速度呢！</p></li><li><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; color: rgb(74, 74, 74);">分布式重构。为共享代码的所有者提供一种方式，让他们可以全局地对 API 的使用者进行快速的重构。我们已经开始向使用了某些特定 Java API 的 Git 代码仓库发起了全面的拉取请求。我们已经做了一些试验，并希望在这方面有更多的投入。</p></li></ul><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">我们的旅程才刚刚开始。我们的发布者反馈服务目前正处于 alpha 测试阶段，我们计划后续会大规模采用这个服务，紧接着会进行来源管理。我们的分布式重构试验让我们了解到进行快速的全局重构是多么的重要。我们也看到了通过我们所构建的工具来降低依赖图复杂度的可能性。我们相信，通过扩展和培养这种能力，我们的 Netflix 团队将会在组织层面做到真正的持续集成，并减少（甚至免去）依赖管理的痛苦。</p><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);"><span style="font-size: 14px;">原文链接：</span><a style="color: rgb(91, 172, 235); word-break: break-all; font-size: 14px; text-decoration: underline;"><span style="font-size: 14px;">https://medium.com/netflix-techblog/towards-true-continuous-integration-distributed-repositories-and-dependencies-2a2e3108c051</span></a></p><section class="" style="box-sizing: border-box; padding-top: 19px;">
		<h5 style="height: 51px; line-height: 52px; font-size: 18px; margin-top: 38px; color: rgb(60, 112, 198); background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0LicxNibqfqIpGpzibUdqtJZ0MNhBIJypuxEmticNiabFeibNZWl7rlD8OPpeH3Pb1e7QPKCF5dia1RxOvw/0?wx_fmt=png&quot;); background-position: center center; background-size: initial; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial;"><span style="display: inline-block; height: 51px; width: 37%; float: left; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0LicxNibqfqIpGpzibUdqtJZ06g25K95Hmg47qE3XBWMkbexsOllAjrHcL6MWXCSicTiav0eDghicCcHrw/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100%; font-size: 14px;"></span>今日荐文<span style="display: inline-block; height: 51px; width: 37%; float: right; background-image: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0LicxNibqfqIpGpzibUdqtJZ0pXqckt7furia2fwALHU9W1UUytDWx3fWagfTHV290lQvNa3lYYnDMZQ/0?wx_fmt=png&quot;); background-position: center center; background-repeat: no-repeat; background-attachment: initial; background-origin: initial; background-clip: initial; background-size: 100%;"></span></h5>
		<p style="box-sizing: border-box; white-space: pre-line; line-height: 27px; font-size: 15px; color: rgb(200, 199, 199); padding-top: 28px; padding-bottom: 28px;">点击下方图片即可阅读</p>
		
		
		
		
		
		
				<a href="https://mp.weixin.qq.com/s?__biz=MzA5Nzc4OTA1Mw==&amp;mid=2659599230&amp;idx=1&amp;sn=cbf97ea56f956e23b3529ea81551b23c&amp;chksm=8be9966cbc9e1f7af97f670f4dcc16e3a2bd410ef634251e72c867bc6f7aca813ffed5da75a1#rd" style="color: #5BACEB;">
			<img src="/archtime/images/5d99e8fbde6784745eeca03fd15c97cabba27a87.jpeg" style="color: inherit; float: left; width: 770px !important; height: 559.533px !important;">
		</a>
		<section class="" style="text-align: left; width: 100%; margin-top: -3em; margin-bottom: 29px; float: left; box-sizing: border-box; background-color: rgba(13, 14, 28, 0.8); max-width: 640px;">
			<section style="text-align: center; color: inherit; box-sizing: border-box;">
				<p style="font-size: 16px; line-height: 27px; text-align: left; color: rgb(255, 255, 255); box-sizing: border-box; white-space: normal; padding-top: 8px; padding-bottom: 8px; padding-left: 13px;"><span style="display: inline-block; width: 22px; height: 18px; background: url(&quot;http://mmbiz.qpic.cn/mmbiz_png/LaW7jDBKBg0LicxNibqfqIpGpzibUdqtJZ05vANVBRK8XZB9fxfI3WwZXoicJoJGrtApPYE40FEiawa1Cxibl1rreo5Q/0?wx_fmt=png&quot;) center center / 100% 100% no-repeat; vertical-align: middle; margin-right: 8px;"></span>
					企业的应用架构到底该怎么演变才能合了 CEO 的愿？				</p>
			</section>
		</section>
		<hr style="width: 100%; height: 1px; border-top-style: dotted; border-top-color: rgb(165, 165, 165);">
	</section><p style="box-sizing: border-box; font-size: 16px; text-align: justify; white-space: pre-line; line-height: 27px; padding-top: 23px; padding-right: 8px; padding-left: 8px; color: rgb(74, 74, 74);">今年，架构师关注的技术点有何不同？从云计算、大数据、微服务、容器，到现在的人工智能，架构师应该怎么做？这里推荐一场会议，为你总结了 100+ 国内外技术专家现阶段的架构实践，8 折即将截止，点击<span class="" style="text-align: left; color: rgb(91, 172, 235);">“阅读原文”</span>，看看对你有何启发。</p><section class="" style="box-sizing: border-box; width: 100%; text-align: left;">
		
		<img src="/archtime/images/a0fc0f9f33f9ad0ffbaa475a14d98e9b72bfdf42.jpeg" style="padding-right: 8px; padding-left: 8px; margin-top: 28px; margin-right: auto; margin-left: auto; width: 770px !important; height: 418.889px !important;"></section></section><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1494425835&src=3&ver=1&signature=T3pUTKCUVTFXYE3cOj0PN5Pj7cnItpQYG26NZRn7R08Pw-hMmu8uxt9*QadJbd-YkoIvkgOWnOHggXxfr3M*LssKPUapH0e2AVLg0TIL5PV5WcGunlKrnrewCWyQgx5pYcGYHNBGDvA*mAso1HMo-NFCZXEncW4XHy5Hco7vn2I=">微信地址</a> | <a href="http://sz2017.archsummit.com/tracks?utm_source=wechat&amp;utm_medium=archtime&amp;utm_campaign=textads8">阅读原文</a>
{% endraw  %}

