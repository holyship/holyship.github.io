---
title: 什么是CONTAINERD？
author: 灵雀云译 Docker
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1503366162&src=3&ver=1&signature=OYewMZH60kmig22U24i7m6BES*V3LriXNMMmphuGIZ8fjf4LTup1kmopcJ3JzT-3fc*Rle2i*7SOZsuOSeK-v03zY*RsvAywaGtIgJfZzrwIhjCuBqlufZOiAPNMW5hs5FcJsUKCwcnWAlTpMK4A8uI1sLYY5xvc09curz6zRTc=
date: '2017-08-10 00:00:00 +0000'

---

{% raw  %}
<p style="margin-bottom: 12px; white-space: normal; text-align: justify; background: white;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">之前我们已经围绕</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的不同功能，设计方式，以及解决的一些问题进行了几次讨论。</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">&nbsp;Containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">由</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Docker</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Kubernetes CRI</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和其他几个项目使用，不过这个帖子是写给可能并不知道</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">在这些平台中具体做什么的人。将来我想围绕</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的功能集和设计上多写一些东西，但现在我们将从基础开始说起。</span><br></p><p style="white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">我认为容器系统有时有点让人难以理解，尤其是我们使用的术语。这是什么？运行时。这个呢？运行时</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">... containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">从名字上看，并不像有的人告诉我包含电脑迷之类的，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">是一个容器后台驻留程序。它最初是作为</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">OCI</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">运行时的集成点，例如</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">runC</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">。但在过去六个月里，它增加了很多功能，使其符合现代容器平台（例如</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Docker</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Kubernetes</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">）的需求。</span><br></p><p style="margin-bottom: 12px; white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/CiaJxoTn5Fwrs0XDo0Ad6YMqPESNSIAuF9S3KBYldwDB9UhFs6rmq4vc7xh9CLgDQSicia8ia27UAc10ibRuT3ap6rg/0?wx_fmt=png" style="width: 770px !important; height: 399.448px !important;"></p><p><br></p><p style="margin-bottom: 12px; white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">由于在内核空间中没有像</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Linux containers</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">这样的东西，容器就是将各种内核功能捆绑在一起。当构建一个大型平台或分布式系统时，您希望有一个抽象层来运行一个容器，这个抽象层把管理代码、系统调用和内核功能隔离开来。这个抽象层就是</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">发挥作用的地方。</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">提供了客户端层，平台在这个基础上搭建，而不必在内核层。与用</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">clone</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">（）或</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">mount</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">（）管理调用相比，使用</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Container, Task,</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Snapshot</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">类型的对象则要愉快的多。</span><br><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;"></span></p><p style="white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">是针对</span><span style="color: rgb(120, 172, 254);"><strong><span style="font-size: 14px; letter-spacing: 0px;">Docker</span></strong><strong><span style="font-size: 14px; letter-spacing: 0px;"></span></strong></span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和</span><span style="color: rgb(120, 172, 254);"><strong><span style="font-size: 14px; letter-spacing: 0px;">Kubernetes</span></strong></span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">以及任何其他容器平台使用而设计的，这些平台希望免除系统调用以及操作系统特定的功能，直接在</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">linux</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">windows</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">solaris</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">或其他操作系统上运行容器。考虑到这些用户，我们想确保</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">只有他们需要的功能，而没有其他不需要的功能。实际上这是不可能的，但至少这是我们努力的方向。像网络之类的，不在</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">考虑的范围。原因在于，当构建分布式系统时，网络是一个非常重要的方面。现在，有了</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">SDN</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和服务发现技术，网络是更细化的平台，而不只是在</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">linux</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">上抽出</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">netlink</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">调用。大多数新的覆盖网络是基于路由的，并且每当创建或删除新的容器时，需要更新路由表。服务发现、</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">DNS</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">等都必须被通知这些更改。如果我们向</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">添加了网络，将会有很繁重的大块代码来支持所有不同的网络接口，钩子和集成点。而我们做的，则是选择了</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">内部强大的事件系统，以便多个客户订阅他们关心的事件。我们还公开了一个任务的</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">API</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，允许用户创建一个正在运行的任务，并向容器的网络命名空间添加接口，然后启动容器的进程，而不用在容器生命周期的各个不同节点调用复杂的钩子。</span><br></p><p style="margin-bottom: 12px; white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">过去几个月里，在</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">里添加的另一个领域是完整的存储和分发系统，支持</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">OCI</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Docker</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的镜像格式。在</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd API</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">中有一个完整的内容寻址存储系统，不仅用于镜像，还用于连接到容器的元数据、检查点和任意数据。</span><br></p><p style="margin-bottom: 12px; white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">我们也花时间重新思考了</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">“graphdrivers”</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的工作原理。这些是覆盖或块级文件系统，允许镜像具有</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">layers</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，支持高效构建。</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Graphdrivers</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">最初是</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Solomon</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和我一起做的，当时添加了对</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">devicemapper</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的支持。那个时候，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">Docker</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">只支持</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">AUFS</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，因此我们模仿</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">overlay</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">文件系统做了</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">graphdrivers</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">。然而，做一个像</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">devicemapper/lvm</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">这样的块级文件系统，并且性能像</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">overlay</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">文件系统一样，从长远来看要更难一些。接口必须不断扩展，以支持不断增加的功能需要。对于</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，我们采取了一个截然不同的处理方法，使</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">overlay</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">文件系统像一个</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">snapshotter</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，而不是反过来的情况。我们这样做更容易，因为</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">overlay</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">文件系统比</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">BTRFS</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">ZFS</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">devicemapper</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">等给文件系统做快照的更灵活，因为后者没有严格的父</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">/</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">子关系。这有助于我们为</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">snapshotters</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">构建一个较小的接口，同时仍满足诸如构建之类的需求，并减少所需的代码量，因此从长远来看更易维护。</span><br></p><p style="white-space: normal; background: white; text-align: justify;"><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">那么，用</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">，能</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">get</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">到什么？您可以拉取镜像以及管理镜像。使用</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">API</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">去创建，执行和管理容器及其任务，从而获取容器的整个运行周期。一个专门用于快照管理的</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">API</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">。从本质上说，你只需要构建一个容器平台，而不必处理底层操作系统的细节。我认为</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">containerd</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">的最重要部分，是具有一个稳定的</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">API</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">版本，可以修复</span><span style="color: rgb(136, 136, 136); font-size: 14px; letter-spacing: 0px;">bug</span><span style="color: rgb(136, 136, 136); font-size: 14px; font-family: DengXian; letter-spacing: 0px;">和安全补丁反向移植。</span><br></p><p><span style="color: rgb(136, 136, 136);"><span style="font-size: 14px; font-family: DengXian; letter-spacing: 0px;"></span></span></p><hr><p><span style="color: rgb(136, 136, 136);"><span style="font-size: 14px; font-family: DengXian; letter-spacing: 0px;"></span></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/CiaJxoTn5Fwo05XycQqnzTvWIdL639OblycyABp2pYUiatm7bLz7FD6cgYPXscVQ6KmQPPvnAyqRWKficqoboMx5A/0?wx_fmt=jpeg" style="width: 770px !important; height: 581.711px !important;"></p><p><span style="color: rgb(136, 136, 136);"><span style="font-size: 14px; font-family: DengXian; letter-spacing: 0px;"></span></span><br></p><p><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1503366162&src=3&ver=1&signature=OYewMZH60kmig22U24i7m6BES*V3LriXNMMmphuGIZ8fjf4LTup1kmopcJ3JzT-3fc*Rle2i*7SOZsuOSeK-v03zY*RsvAywaGtIgJfZzrwIhjCuBqlufZOiAPNMW5hs5FcJsUKCwcnWAlTpMK4A8uI1sLYY5xvc09curz6zRTc=">微信地址</a>
{% endraw  %}

