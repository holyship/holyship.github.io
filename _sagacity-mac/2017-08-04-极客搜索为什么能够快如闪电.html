---
title: 极客搜索为什么能够快如闪电
author: 池建强
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1502118266&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiArENYr9kpNZ6uK0NQL1ugXOiehEugjJzKrNMaHOavEY07Hw4CmxK9RIvL*2XnerJxfj4zWvn9AhBqzaHU9ajJOnEP-tiV6lmn9zPqi7Mz1F3YUgyLWlJjS8hKpBw*vRbXas3G6YjgNBWComvG*AEnM4=
date: '2017-08-04 00:00:00 +0000'

---

{% raw  %}
<p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;"><span style="font-size: 14px; color: rgb(136, 136, 136);">题图：by click_vision from Instagram</span></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">产品周，继续唠产品。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">周一上线了「极客搜索」之后，很多朋友问我，虽然你们的数据量不大，但也不应该响应这么快吧，怎么做到的。这时候我一般会矜持的说，没啥，就是随便写写呗。当然，这种回复经常被朋友怼之为「不该腼腆的时候瞎腼腆」「你这个我给100分」云云。对此我的回复是「围笑」。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">微博和微信上的读者使用了极客搜索之后纷纷击节赞叹：</p><blockquote style="font-family: Avenir, sans-serif; border-width: 0px 0px 0px 0.3em; border-left-color: rgb(221, 221, 221); font-size: 16px; margin-top: 2px; margin-bottom: 22px; margin-left: 10px; outline: 0px; padding-right: 10px; padding-left: 5px; letter-spacing: 0.5px; quotes: none; color: rgb(51, 51, 51); white-space: normal;"><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;">文艺青年：当我的手指还没有从键盘上弹起，结果已经跃然屏幕之上。</p><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;">普通青年：快如闪电！</p><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;">二爷：真特么快！</p></blockquote><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">发布一款新产品，无论你长的多么花俏，功能多么繁复强大，用户最多能记住你三个特性，而真正印象深刻的，可能只有一个。一款垂直类的技术搜索引擎，而且1.0是针对自家资源的，什么特点最吸引人呢？有人说是内容好，但是内容好是一个没法量化的标准，很难界定，并且，一个垂直技术搜索引擎，你都垂直了，内容好意思不好吗？讨论了一圈，我们觉得，应该让用户记住这个「快」字。互联网时代，唯快不破，你快了几十毫秒，可能就能领先一个身位。而且快是可以度量的啊，比如我们就可以宣称，每个请求的返回不会超过50毫秒，界面的简洁优雅和快如闪电的反应速度，会给用户留下深刻的影响，并增加产品的留存。</p><h2 style="font-family: Avenir, sans-serif; border: 0px; font-size: 1.2em; margin-bottom: 12px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; line-height: 1.1em; padding-top: 2px; font-weight: bold; color: rgb(51, 51, 51); white-space: normal;">视觉体验</h2><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">如何让用户感觉到快呢？视觉和交互上都要下功夫。首先是 logo，我们被评价最多的一个词就是快如闪电，这可不是白来的。细心的读者可以看到，极客搜索的搜字，右上角我们做了个变体，用一个黄色的小闪电替换了正常的笔画，所以当交互足够快的时候，用户自然而然就会想到快如闪电这个词。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/JuJRyjO2zcb6bcCN882U4Nmytn3UBE4FZCjr9WoDjoL4AfwIXTtfWkBqtmdFCm9CvcBfn3Ly0tr7rLzmHvUwFw/0?wx_fmt=jpeg" style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; width: 750px !important; height: 416.667px !important;"></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">整个界面的设计和交互上尽可能做到最简，让每个点击和回车都自然而顺畅。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">其次，就是让你的系统真正的快起来。</p><h2 style="font-family: Avenir, sans-serif; border: 0px; font-size: 1.2em; margin-bottom: 12px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; line-height: 1.1em; padding-top: 2px; font-weight: bold; color: rgb(51, 51, 51); white-space: normal;">后端承担了很大的责任</h2><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">关于系统的实现，我在之前的文章里写过，事实上这个系统服务器端承担了大部分的功能特性，比如数据采集，要处理不同类型、格式和来源的数据集，然后要做数据的清洗，去重，筛选，处理存量和增量数据，然后进行数据存储，并进行数据的索引 —— Elasticsearch 使用的是倒排索引（inverted index）的结构来做快速的全文搜索。还要进行分词，选择分词器，自然语言处理等等，然后设计出简洁的 Restful 风格 API 供展示层调用。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">为了让后端有足够快的速度，我们在索引层面也采用了二八原则的设计，用最少的索引数据力图达到最大化的搜索结果。另外，搜索结果使用了 ES 默认的相关度算法 TF/IDF，也就是词频和反向文档频率，并未做人工干预（关于这个算法，有兴趣以后可以讲讲）。等做完这些之后，我们发现，后端已经不是瓶颈了，迅疾如风。现在来看前端。</p><h2 style="font-family: Avenir, sans-serif; border: 0px; font-size: 1.2em; margin-bottom: 12px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; line-height: 1.1em; padding-top: 2px; font-weight: bold; color: rgb(51, 51, 51); white-space: normal;">前端同样重要</h2><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">无论后端的速度多么快，API 设计的多么优美，如果前端臃肿，一样能让系统慢的死去活来。所以我们的快主要来自前端的体验。带着这个问题，我采访了快手神涛，涛哥一边在各种 IDE 中切换，一边编写代码，第三边抬起头慢吞吞的对我说，快吗？一般吧。我说少废话快说。涛哥说，咱们用了 Vue 嘛，Vue 就该这么快。然后又去写代码了。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">Vue 是我们的前端组选定的技术路线，在前端框架如满天繁星的时代，为什么会选择 Vue.js ？关于这个问题，是无法在这篇文章里写清楚的，我从「极客搜索」里找到了两篇文章，大家可以参考：</p><blockquote style="font-family: Avenir, sans-serif; border-width: 0px 0px 0px 0.3em; border-left-color: rgb(221, 221, 221); font-size: 16px; margin-top: 2px; margin-bottom: 22px; margin-left: 10px; outline: 0px; padding-right: 10px; padding-left: 5px; letter-spacing: 0.5px; quotes: none; color: rgb(51, 51, 51); white-space: normal;"><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;mid=2650994529&amp;idx=1&amp;sn=953bf1d92cc2a7b278d0761d3e433803&amp;chksm=bdbf0f328ac886245652735e4dfa1b39b1357b9f36ccf1b337714ac81810f8441d189ce89615&amp;scene=21#wechat_redirect" target="_blank">Vue.js作者尤雨溪：Vue 2.0——渐进式前端解决方案</a></p><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;"><a href="http://mp.weixin.qq.com/s?__biz=MzIwNjQwMzUwMQ==&amp;mid=2247484744&amp;idx=1&amp;sn=76c3d1a08838f53fefaae291f2d5a7d1&amp;chksm=9723678aa054ee9c8ad3f8837b77becee0f6b8376666cb37406d9d4e0b00b3d6f666a81e7d65&amp;scene=21#wechat_redirect" target="_blank">我们为什么选择Vue.js而不是React？</a></p></blockquote><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">为什么要有框架呢？尤老师是这么解释的：</p><blockquote style="font-family: Avenir, sans-serif; border-width: 0px 0px 0px 0.3em; border-left-color: rgb(221, 221, 221); font-size: 16px; margin-top: 2px; margin-bottom: 22px; margin-left: 10px; outline: 0px; padding-right: 10px; padding-left: 5px; letter-spacing: 0.5px; quotes: none; color: rgb(51, 51, 51); white-space: normal;"><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;">框架的存在是为了帮助我们应对复杂度。当我们需要解决一些前端上工程问题的时候，这些问题会有不同的复杂度。如果你用太简陋的工具应对非常复杂的需求，就会极大地影响你的生产力。所以，框架本身是帮我们把一些重复的并且已经受过验证的模式，抽象到一个已经帮你设计好的API封装当中，帮助我们去应对这些复杂的问题。</p><p style="border: 0px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px;">业务场景有复杂度，工具自身也有复杂度，如果要解决的问题并不复杂，但你却用了很复杂的框架，那么工具复杂度带来的副作用可能会影响你的生产效率。Pick the right tool for the job，一切都要看场景。</p></blockquote><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">Vue 的特点除了声明式渲染、组件化、状态管理和完整的构建工具之外，最大的特点就是快：Vue2.0 可以说是当前最快的框架之一。支持服务端流式渲染，渲染结果可以直接通过 pipe 方法把数据放到返回的请求里。这样一来，就可以更早地在浏览器中呈现内容，通过合理的缓存策略，可以极大的提快响应速度。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">除此之外，极客搜索还采用了单页面的应用技术，也就是说，你在浏览器访问 s.geekbang.org 的时候，就像在使用一个原生的 App，而不是跳来跳去的互联网服务。什么是单页面应用？</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">这并不是什么新概念，2004年出现的 Gmail 就是个单页应用，但这个概念火热起来在2010年 Backbone 问世之后。之后前端框架像下饺子一样一锅锅的出现，对单页应用的支持也越来越好。单页应用与传统的网页应用相比，就是把 MVC 前置到了浏览器端中：</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">1、控制器前置，单页应用将路由处理放在浏览器端，即在浏览器端直接响应浏览器地址的变化，分发到对应的路由，向用户呈现对应的界面。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">2、以小块组件为功能元件，类似于传统网页中的 Ajax 组件，单页应用以小的组件为功能元件，在路由变化时，不再刷新整个页面，而是组合这些小的组件，替换变化的部分。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">3、数据层前置，与 Ajax 组件一个明显的区别是，单页应用在浏览器端通常有一层实实在在的数据层，而服务端则退化成了完全的数据 API。浏览器端的数据层会封装服务端 API，供上层的视图层调用。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">关于单页应用，推荐一本线上的电子书《单页应用开发权威指南》，以上部分文字就引自这本书：<br></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;"><span style="color: rgb(0, 128, 255);">http://island205.github.io/Single-Page-App-Break/</span></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">从技术角度单页应用的好处当然很多了，但最主要的是快，没有刷新体验，就像原生应用一样，这是我们追求的效果。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">看到这二爷终于忍不住了「我就见过 Vue + SPA，慢的像一坨…」。我说，你看太祖长拳这门功夫，在乔峰手里就天下无敌，在你手里就等着被 KO，这个道理你能懂吧。重要的是要有牛叉的程序员……</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">二爷沉默不语。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">除了框架和应用层面，剩下的就是前端性能法则的东西，比如代码压缩，CSS 和图片处理，打包，推送 CDN 等等。整体看下来，没什么了不起的技术，能把这些普通的，常用的技术和规则掌握好，就可以打造出快如闪电的应用。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">第三，当然就是要告诉用户，我们很快，可能是史上最快的搜索引擎，快如闪电等等。当然了，这方面程序员们还是很矜持的，一如当年青涩的我。他们忧心忡忡的对我说：哥，你这样吹将来我们很难做的，万一功能增加了，逻辑复杂了，智能聚合了，会牺牲一些速度啊。我虽然心里说「多复杂也得这么快」，但表面上会若无其事的安慰他们「没事，到时候我们再设置新的产品指标呗」。他们说真的？我说真的。然后程序员们就继续编码去了。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal; text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_png/JuJRyjO2zcb6bcCN882U4Nmytn3UBE4F9gAhOgBIGOYpvVW5OT4FhAaxpygUuCCzAk72gVo4jlxAg1j4SnWtbg/0?wx_fmt=png" style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; width: 750px !important; height: 750px !important;"><span style="font-size: 14px; color: rgb(136, 136, 136);">识别二维码或访问 <span style="font-size: 14px; color: rgb(0, 128, 255);">s.geekbang.org</span> 体验极速搜索</span></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">极客搜索发布之后，反响还不错，就此从副产品扶正。未来我们会优化搜索结果，接入更多第三方资源，让搜索结果的展示更为友好……关于技术领域的垂直搜索，需求已经想到了2018年，敬请期待。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">看到这你应该是知道了，前端有多么重要。现在要给喜欢前端的童靴推荐一门极客邦科技策划的大前端进阶课程 ——《从前端小工到 BAT 中高级工程师的必备技能》，主要面向 1-3 年经验的前端工程师，培训技能对标：腾讯 T2.3／阿里 P6。</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">课程链接：<span style="color: rgb(0, 128, 255);">http://www.stuq.org/course/1194</span></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">添加下图小助手微信，注明来自「MacTalk」，报名可享优惠价格，并额外获得价值3000元的《前端最佳实践》等课程礼包！</p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/JuJRyjO2zcbPLRJkpFbRpdg76ETJxlWDAaFsZkXGGuVNYicq4P9WaUT3a8F2RO6vja9kuVaJeicvOBdKX9QgoiboA/0?wx_fmt=jpeg" style="font-family: &quot;Helvetica Neue&quot;, Helvetica, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; width: 750px !important; height: 1334px !important;"></p><p style="font-family: Avenir, sans-serif; border: 0px; font-size: 16px; margin-top: 2px; margin-bottom: 22px; outline: 0px; padding-right: 10px; padding-left: 10px; letter-spacing: 0.5px; color: rgb(51, 51, 51); white-space: normal;">点击<span style="color: rgb(0, 128, 255);">阅读原文</span>了解详情。</p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1502118266&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiArENYr9kpNZ6uK0NQL1ugXOiehEugjJzKrNMaHOavEY07Hw4CmxK9RIvL*2XnerJxfj4zWvn9AhBqzaHU9ajJOnEP-tiV6lmn9zPqi7Mz1F3YUgyLWlJjS8hKpBw*vRbXas3G6YjgNBWComvG*AEnM4=">微信地址</a> | <a href="http://www.stuq.org/course/1194">阅读原文</a>
{% endraw  %}

