---
title: 必备，前台与后台分离的架构实践
author: 58沈剑
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1515986097&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siBo3oPDK8DK*88F4CWijxQ5EFX6jGrv3BrjQoFMwQzo-*jiN8gkDoGNv71FTxFvM1BR8CJkhJbCEfpypGeGXwPtgjNdihQiq**smQWa0J*jz-LjbKHKjE2BdghsQFAO72YsGEPyjzGXpDjPAauDMb34=
date: '2018-01-12 00:00:00 +0000'

---

{% raw  %}
<p><span style="font-size: 14px;letter-spacing: 1px;">如果你经历过创业，经历过快速迭代业务，经历过用户量不断上涨，经历过访问并发越来越大，你一定会遇到以下系统问题：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">用户访问页面越来越<strong>慢</strong></span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">系统性能下降，<strong>数据库扛不住</strong>，连接数经常打满，最终数据库挂掉，重启后又快速挂掉</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">改了一个小地方，另外一个看似不相干的地方却挂了，<strong>严重耦合</strong></span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">如果你没有经历过，很可能是：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">没到这一步项目就死了</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">身在所谓的大公司，用着所谓先进的架构体系</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">创业初期遇到上述痛点，很容易想到</span><span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">“三个分离”</span><span style="font-size: 14px;letter-spacing: 1px;">的架构优化方案：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">动静分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：能够100倍以上的提升静态页面/资源的访问速度，详见《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960800&amp;idx=1&amp;sn=595842fb2dc75aa505f544b956f2d65c&amp;chksm=bd2d003c8a5a892ab497fbed42f37d852949e7d1ecbd9cc1bd249910be1c70da978c60ecfc0b&amp;scene=21#wechat_redirect" target="_blank"><span style="font-size: 14px;letter-spacing: 1px;">必备，动静分离架构实践</span></a>》</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">读写分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：能够快速的线性扩充数据库的读性能，详见《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960806&amp;idx=1&amp;sn=9d70e28a0962467495c3546d58720c40&amp;chksm=bd2d003a8a5a892ca4b1e5badd9938ffb0e18d6314b38d2cee6f2e25a7c6ffe0f73e5ce11074&amp;scene=21#wechat_redirect" target="_blank"><span style="font-size: 14px;letter-spacing: 1px;">必备，读写分离架构实践</span></a>》</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">前后分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：前台与后台的数据与访问分离，也就是<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">本文</span>将要重点介绍的内容</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="letter-spacing: 1px;">一、业务场景介绍</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">虚拟一个类似于“安居客”租房买房的业务场景，这个业务的<strong>数据有两大来源</strong>：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">用户发布</span><span style="font-size: 14px;letter-spacing: 1px;">的数据</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">爬虫从竞对<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">抓取</span>来的数据</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">这个业务对应的系统有<strong>两类使用者</strong>：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">普通用户</span><span style="font-size: 14px;letter-spacing: 1px;">，浏览与发布数据，俗称“前台用户”</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">后台用户</span><span style="font-size: 14px;letter-spacing: 1px;">，运营与管理数据，俗称“后台用户”</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FaHFn6WbibeG8d0ITONS0p0icjkfNsCHLmbh5BCaWchRdFxXQMBqzZ4vZw/0?wx_fmt=png" style="width: 344px !important; height: 187px !important;"></p><p><span style="font-size: 14px;letter-spacing: 1px;">在一个创业公司，为了快速迭代，系统架构如上：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">web层</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：前台web，后台web</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">任务层</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：抓取数据</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">数据层</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：存储数据</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="letter-spacing: 1px;">二、数据耦合的问题</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">系统两类数据源，一类是用户发布的数据，一类是爬虫抓取的数据，两类<strong>数据的特点不一样</strong>：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">自有</span></strong><span style="font-size: 14px;letter-spacing: 1px;">数据相对<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">结构化，变化少</span></span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">抓取</span></strong><span style="font-size: 14px;letter-spacing: 1px;">数据<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">源很多，数据结构变化快</span></span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">如果将自有数据和抓取数据耦合在一个库里，经常出现的情况是：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">-&gt; 抓取数据结构变化</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">-&gt; 需要修改数据结构</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">-&gt; 影响前台用户展现</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">-&gt; 经常被动修改前台用户展现逻辑，配合抓取升级</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">如果经历过这个过程，其中的痛不欲生，是谁都不愿意再次回忆起的。</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><strong><span style="font-size: 14px;letter-spacing: 1px;">优化思路</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">前台展现数据，后台抓取数据分离，解耦</span>。</span></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FayF53EIBpstVPJGQ4K0WIkiamhlTRkPricvqQOBicRdmkwGuNTz7bTlWKw/0?wx_fmt=png" style="width: 401px !important; height: 167px !important;"></p><p><span style="font-size: 14px;letter-spacing: 1px;">如上图所示：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">前台展现的稳定数据，库独立</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">后台抓取的多变数据，库独立</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">任务层新增一个异步转换的任务</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">如此这般：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">频繁变化的抓取程序，以及抓取的异构数据存储，解耦</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">前台数据与web都不需要被动配合升级</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">即使出现问题，前台用户的发布与展现都不影响</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="letter-spacing: 1px;">三、系统耦合的问题</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">上面解决了不同数据源写入的耦合问题，再来看看前台与后台用户访问的耦合问题。</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><strong><span style="font-size: 14px;letter-spacing: 1px;">用户侧</span></strong><span style="font-size: 14px;letter-spacing: 1px;">，前台访问的<strong>特点</strong>是：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">访问模式有限</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">访问量较大，DAU不达到百万都不好意思说是互联网C端产品</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">对访问时延敏感，用户如果访问慢，立马就流失了</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">对服务可用性要求高，系统经常用不了，用户还会再来么</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">对数据一致性的要求高，关乎用户体验的事情就是大事</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><strong><span style="font-size: 14px;letter-spacing: 1px;">运营侧</span></strong><span style="font-size: 14px;letter-spacing: 1px;">，后台访问的<strong>特点</strong>是：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">访问模式多种多样，运营销售各种奇形怪状的，大批量分页的，查询需求</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">用户量小，访问量小</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">访问延时不这么敏感，大批量分页，几十秒能出结果，也能接受</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">对可用性能容忍，系统挂了，10分钟之内重启能回复，也能接受</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">对一致性的要求始终，晚个30秒的数据，也能接受</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FaTKU7l0pHtj3t1QU6Mwd0ibukDrJpVF2OFwyNyWZDgXugbETR8hgkltg/0?wx_fmt=png" style="width: 210px !important; height: 148px !important;"></p><p><span style="font-size: 14px;letter-spacing: 1px;">前台和后台的模式与访问需求都不一样，但是，如果前台与后台混用同一套服务和结构化数据，会导致：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">后台的低性能访问，对前台用户产生巨大的影响，本质还是<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">耦合</span></span></p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FaQEmsWARUyXd98iaWsJ0ve4R6SJKVG38BM0XowfShwq3BqtLCVdyS3ibA/0?wx_fmt=png" style="width: 304px !important; height: 155px !important;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">随着数据量变大，为了保证前台用户的时延，质量，做一些类似与分库分表的升级，数据库一旦变化，可能很多后台的<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">需求难以满足</span></span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><strong><span style="font-size: 14px;letter-spacing: 1px;">优化思路</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">冗余数据，前台与后台服务与数据分离，解耦</span>。</span></p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FadEA8dib3QBCdJcxFc9rSCGUb1EggwjU0pOOWcibhaMzXb8b5APibX9Npg/0?wx_fmt=png" style="white-space: normal; width: 473px !important; height: 165px !important;"></p><p><span style="font-size: 14px;letter-spacing: 1px;">如上图所示：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">前台和后台独立服务与数据，解耦</span></p></li><li><p><span style="font-size: 14px;letter-spacing: 1px;">如果出现问题，相互不影响</span></p></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOy8drIRU2HjzlmTxrxxc5FaiazNibiaXyr3IsLquYsrkIlPQE2MxL0nmyvSX0sHEuiaTtfFJxD5FP7qoQ/0?wx_fmt=png" style="width: 499px !important; height: 157px !important;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;letter-spacing: 1px;">通过不同的技术方案，在不同容忍度，业务对系统要求不同的情况下，可以使用不同的技术栈来满足各自的需求，如上图，后台使用ES或者hive在进行数据存储，用以满足“售各种奇形怪状的，大批量分页的，查询需求”</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="letter-spacing: 1px;">四、总结</span></strong></span></p><p><span style="font-size: 14px;letter-spacing: 1px;">创业初期，快速实施架构优化，提升性能的“三大分离”优化利器：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">动静分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：能够100倍以上的提升静态页面/资源的访问速度</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">读写分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：能够快速的线性扩充数据库的读性能</span></p></li><li><p><strong><span style="font-size: 14px;letter-spacing: 1px;">前后分离</span></strong><span style="font-size: 14px;letter-spacing: 1px;">：前台与后台的数据与访问分离</span></p></li></ul><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">本文原计划昨天发布的，朋友做免费互联网技术分享，转了他一篇文章，不仅被骂得很惨，还取关了一大片，非常抱歉，也很遗憾。</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">相关文章：</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960800&amp;idx=1&amp;sn=595842fb2dc75aa505f544b956f2d65c&amp;chksm=bd2d003c8a5a892ab497fbed42f37d852949e7d1ecbd9cc1bd249910be1c70da978c60ecfc0b&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 14px;letter-spacing: 1px;white-space: normal;">必备，动静分离架构实践</a>》</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960806&amp;idx=1&amp;sn=9d70e28a0962467495c3546d58720c40&amp;chksm=bd2d003a8a5a892ca4b1e5badd9938ffb0e18d6314b38d2cee6f2e25a7c6ffe0f73e5ce11074&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 14px;letter-spacing: 1px;white-space: normal;">必备，读写分离架构实践</a>》</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">&nbsp;</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">另一种前后端分离：</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960501&amp;idx=1&amp;sn=a452bab31c0457063241df237f955332&amp;chksm=bd2d01698a5a887f9dfa5c6966d9e71bf492a040ab2dbe4e469ef38dd8ee5ab00b7c562a88e8&amp;scene=21#wechat_redirect" target="_blank">前后端分离架构实践</a>》</span></p><p><span style="font-size: 14px;letter-spacing: 1px;">《<a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960541&amp;idx=1&amp;sn=6e123e92e69f09c25ca1c8b81e6037d0&amp;chksm=bd2d01018a5a881735fb37045ed187325f1102f01eaee1e78147d6dc702dccb7d9f1899227ed&amp;scene=21#wechat_redirect" target="_blank">前后端分离的缺点</a>》</span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><br></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;letter-spacing: 1px;">技术人，谦虚一点，总是没错的。</span></span></p><p><span style="font-size: 14px;letter-spacing: 1px;"><span style="font-size: 14px;letter-spacing: 1px;">求帮<span style="font-size: 14px;letter-spacing: 1px;color: rgb(255, 76, 0);">转</span>。</span></span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1515986097&src=3&ver=1&signature=yyLj*6br2FUtW3BtBE3siBo3oPDK8DK*88F4CWijxQ5EFX6jGrv3BrjQoFMwQzo-*jiN8gkDoGNv71FTxFvM1BR8CJkhJbCEfpypGeGXwPtgjNdihQiq**smQWa0J*jz-LjbKHKjE2BdghsQFAO72YsGEPyjzGXpDjPAauDMb34=">微信地址</a> | <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960791&amp;idx=1&amp;sn=7b070e53b5890e08082ebf1bc2e65626&amp;chksm=bd2d000b8a5a891d7ed3bf83cd9c295ca6fa37a43f4ffedf762a21df17d27ebb3cfa071400cd#rd">阅读原文</a>
{% endraw  %}

