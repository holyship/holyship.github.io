---
title: CAS下ABA问题及优化方案 | 架构师之路
author: 58沈剑
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1498052271&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ1KJasWOsq8hSo-mm4SVBUqXpDLOmbKmY46mI-tH6ASrpLYSYQojdSaCl4vWp*Xp7aL1ZHhOLWYBQFZ-owvNMUe0kM68f2psMPXBXIX7R8dRKFU--brDSp4mHjmoaHCAbaIKakkiMTWyeleTQb00t-8=
date: '2017-06-21 00:00:00 +0000'

---

{% raw  %}
<p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">一、并发业务场景</span></strong></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">库存业务，</span>stock(sid, num)<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，其中：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">sid<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">为库存</span>id</span></p></li><li><p><span style="font-size: 14px;">num<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">为库存值</span></span></p></li></ul><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibwKBcibBiaRDwYo4D7biafG1ib1IMDmeRricAEpia6ySUEUj6QB8H5xvhr7n4A/0?wx_fmt=png" style="width: 341px !important; height: 198px !important; visibility: visible !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">如上图所示，两个<span style="font-size: 14px; font-family: 微软雅黑, sans-serif; color: rgb(255, 76, 0);">并发的查询库存操作</span>，同时从数据库都得到了库存是</span>5<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">接下来用户发生了<span style="font-family: 微软雅黑, sans-serif; font-size: 14px; color: rgb(255, 76, 0);">并发的库存扣减动作</span>：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibwWACw33gjL0Iqjh6XKFMOqNCuHpWJnaa7AWo0qNROjn1Sa5eYWTO1cg/0?wx_fmt=png" style="width: 351px !important; height: 208px !important; visibility: visible !important;"></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">如上图所示：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">用户</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">购买了</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">个库存，于是库存要设置为</span>2</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">用户</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">购买了</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">个库存，于是库存要设置为</span>3</span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">这两个设置库存的接口并发执行，</span><span style="font-size: 14px; color: rgb(255, 76, 0);"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">库存会先变成</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，再变成</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，导致数据不一致</span></span><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（实际卖出了</span>5<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">件商品，但库存只扣减了</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，最后一次设置库存会覆盖和掩盖前一次并发操作）</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">二、不一致原因分析</span></strong></span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">出现数据不一致的根本原因，是设置操作发生的时候，没有检查库存与查询出来的库存有没有变化，理论上：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">仅库存为</span>5<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的时候，用户</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的库存设置</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">才能成功</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">仅库存为</span>5<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的时候，用户</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的库存设置</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">才能成功</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">实际执行的时候：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">库存为</span>5<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，用户</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的</span>set stock 2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">确实应该成功</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">库存变为</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">了，用户</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的</span>set stock 3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">应该失败掉</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">三、</span>CAS<span style="font-family: 微软雅黑, sans-serif;">优化</span></strong></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">大家常说的“</span>Compare And Set<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">”（</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">），是一种常见的降低读写锁冲突，保证数据一致性的乐观锁机制。</span></span></p><p><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;"><br></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">针对上述库存扣减的例子，</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">升级很容易，将库存设置接口执行的</span>SQL<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：</span></span></p><p><span style="font-size: 12px;">update stock set num=$num_new where sid=$sid</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">升级为：</span></p><p><span style="font-size: 12px;">update stock set num=$num_new where sid=$sid<strong><span style="color: red;"> and num=$num_old</span></strong></span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">即可。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">四、什么是</span>ABA<span style="font-family: 微软雅黑, sans-serif;">问题</span></strong></span></p><p><span style="font-size: 14px;">CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁机制确实能够提升吞吐，并保证一致性，但在极端情况下可能会出现</span>ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题。</span></span></p><p><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;"><br></span></p><p><strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">什么是</span>ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题？</span></span></strong></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">考虑如下操作：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（上）：获取出数据的初始值是</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，后续计划实施</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁，期望数据仍是</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的时候，修改才能成功</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：将数据修改成</span>B</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：将数据修改回</span>A</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（下）：</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁，检测发现初始值还是</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，进行数据修改</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">上述并发环境下，</span><span style="font-size: 14px; color: rgb(255, 76, 0);"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">在修改数据时，虽然还是</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，但已经不是初始条件的</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">了</span></span><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，中间发生了</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">变</span>B<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，</span>B<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">又变</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">的变化，</span><strong><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">此</span>A<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">已经非彼</span>A</strong><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">，数据却成功修改，可能导致错误，这就是</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">引发的所谓的</span>ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">库存操作，出现</span>ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题并不会对业务产生影响。</span></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;"><br></span></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">再看一个堆栈操作的例子：</span></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibw4uap3yLVJzR3rmnn7uw4rOyNSy1Ul7a50Q52CNB4Dw6muL6EKoqRPA/0?wx_fmt=png" style="width: 173px !important; height: 158px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（上）：读取栈顶的元素为“</span>A1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">”</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibww0OOyD9ib1KnNdv4ydAsnMlHxWDoTibY3HGSCIblzgYFJTw4Y8MARpQQ/0?wx_fmt=png" style="width: 171px !important; height: 137px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：进行了</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">次出栈</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibw2up1jJGSBFsibTuA2XwxfroFul1kXEvhcKNzY7OPxvkNMVfLRZIhCZQ/0?wx_fmt=png" style="width: 161px !important; height: 108px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：又进行了</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">次出栈</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibwxr4uEDN1YI0c1aBwqfRNaWaibtD5ef1pB9aicuuicZFxSE3TSYlddzVrw/0?wx_fmt=png" style="width: 145px !important; height: 107px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">并发</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（下）：实施</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁，</span><span style="font-size: 14px; color: rgb(255, 76, 0);"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">发现栈顶还是“</span>A1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">”，于是修改为</span>A2</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibw8RAjmT2ZgZiaYqTjibW12I3gh3rQlYKuCicibyITOFWbjuwk3niaX4qlzrg/0?wx_fmt=png" style="width: 174px !important; height: 111px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">此时会出现<strong>系统错误</strong>，</span><span style="font-size: 14px; color: rgb(255, 76, 0);"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">因为此“</span>A1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">”非彼“</span>A1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">”</span></span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">五、</span>ABA<span style="font-family: 微软雅黑, sans-serif;">问题的优化</span></strong></span></p><p><span style="font-size: 14px;">ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题导致的原因，是</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">过程中只<span style="font-size: 14px; font-family: 微软雅黑, sans-serif; color: rgb(255, 76, 0);">简单进行了“值”的校验</span>，再有些情况下，“值”相同不会引入错误的业务逻辑（例如库存），有些情况下，“值”虽然相同，却已经不是原来的数据了。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">优化方向</span></strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">：</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">不能只比对“值”，<span style="font-size: 14px; font-family: 微软雅黑, sans-serif; color: rgb(255, 76, 0);">还必须确保的是原来的数据</span>，才能修改成功。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">常见实践</span></strong><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">：<span style="font-family: 微软雅黑, sans-serif; font-size: 14px; color: rgb(255, 76, 0);">“版本号”的比对</span>，<span style="font-family: 微软雅黑, sans-serif; font-size: 14px; color: rgb(255, 76, 0);">一个数据<span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">一个版本</span></span>，版本变化，即使值相同，也不应该修改成功。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">库存的并发读写例子，引入版本号的具体实践如下：</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（</span>1<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">）库存表由</span></span></p><p><span style="font-size: 12px;">stock(sid, num)</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">升级为</span></p><p><span style="font-size: 12px;">stock(sid, num, <span style="font-size: 12px; color: rgb(255, 76, 0);"><strong>version</strong></span>)</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（</span>2<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">）查询库存时同时查询版本号</span></span></p><p><span style="font-size: 12px;">select num from stock where sid=$sid</span></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">升级为</span></p><p><span style="font-size: 12px;">select num, <span style="font-size: 12px; color: rgb(255, 76, 0);"><strong>version</strong></span> from stock where sid=$sid</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibw8ibMrJMT1CxSUBEpFpXrR1PVfIHQOGn8rQrmkYLaz2YzP9LDaIVNoHQ/0?wx_fmt=png" style="width: 343px !important; height: 202px !important;"></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">假设有并发操作，都会将版本号查询出来</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">（</span>3<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">）设置库存时，必须版本号相同，并且版本号要修改</span></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">旧版本<strong>“值”比对</strong></span>CAS</span></p><p><span style="font-size: 12px;">update stock set num=$num_new where sid=$sid and <strong><span style="font-size: 12px; color: rgb(0, 82, 255);">num=$num_old</span></strong></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">升级为<strong>“版本号”比对</strong></span>CAS</span></p><p><span style="font-size: 12px;">update stock set num=$num_new, <strong><span style="font-size: 12px; color: rgb(255, 76, 0);">version=$version_new</span></strong></span></p><p><span style="font-size: 12px;">&nbsp;where sid=$sid and <span style="font-size: 12px; color: rgb(255, 76, 0);"><strong>version=$version_old</strong></span></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibw21TwTKiafnztAZ0Kjs9KrdckLJn86vEUHCZLIAnr6gIRoxD93KohYXw/0?wx_fmt=png" style="width: 364px !important; height: 189px !important;"></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">此时假设有并发操作，第一个操作，比对版本号成功，于是把库存和版本号都进行了修改。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOxaibcmRPuEJ2Oy3rficEE4ibwibBEYWb5pgGibickr1627RnU2mbFnTR5hbRcV8f1icaI5ic2NusHibmOWMug/0?wx_fmt=png" style="width: 384px !important; height: 191px !important;"></p><p><span style="font-family: 微软雅黑, sans-serif; font-size: 14px;">同时存在的第二个并发操作，比对版本号发生了变化，也是库存应该修改失败。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 微软雅黑, sans-serif;">六、总结</span></strong></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">select&amp;set<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">业务场景，在并发时会出现一致性问题</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">基于“值”的</span>CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁，可能导致</span>ABA<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">问题</span></span></p></li><li><p><span style="font-size: 14px;">CAS<span style="font-size: 14px; font-family: 微软雅黑, sans-serif;">乐观锁，必须保证修改时的“此数据”就是“彼数据”，应该由“值”比对，优化为“版本号”比对</span></span></p></li></ul><p><br></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;">相关文章：</span></span></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960197&amp;idx=1&amp;sn=2e5c17d521772d28d39f31af5d22b34a&amp;chksm=bd2d06598a5a8f4f9de2da89ba8fab711823935442fc632b65d461c923852485ff392c987568&amp;scene=21#wechat_redirect" target="_blank">库存扣多了，到底怎么整 | 架构师之路</a><br></span></span></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960200&amp;idx=1&amp;sn=fdec629caceee07b3946b6c338b8ceb7&amp;chksm=bd2d06548a5a8f424dd32be960222edf5cecc3c1e5a8fcbb4cfff35e7da6787e702861131597&amp;scene=21#wechat_redirect" target="_blank">库存扣减还有这么多方案？ | 架构师之路</a><br></span></span></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960223&amp;idx=1&amp;sn=121716347174eedd6636b1c2c0b96047&amp;chksm=bd2d06438a5a8f55d35add7dc99940c280264fa7caeacb21f7dc79884d00c050d0367a745f87&amp;scene=21#wechat_redirect" target="_blank">浅谈CAS在分布式ID生成方案上的应用 | 架构师之路</a><br></span></span></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;"><br></span></span></p><p><span style="font-family:微软雅黑, sans-serif"><span style="font-size: 14px; line-height: 22.4px;">如果了解到了ABA问题，帮忙转发哈。</span></span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1498052271&src=3&ver=1&signature=nULoNfhbsabgcFJEB9PUQ1KJasWOsq8hSo-mm4SVBUqXpDLOmbKmY46mI-tH6ASrpLYSYQojdSaCl4vWp*Xp7aL1ZHhOLWYBQFZ-owvNMUe0kM68f2psMPXBXIX7R8dRKFU--brDSp4mHjmoaHCAbaIKakkiMTWyeleTQb00t-8=">微信地址</a> | <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960197&amp;idx=1&amp;sn=2e5c17d521772d28d39f31af5d22b34a&amp;chksm=bd2d06598a5a8f4f9de2da89ba8fab711823935442fc632b65d461c923852485ff392c987568#rd">阅读原文</a>
{% endraw  %}

