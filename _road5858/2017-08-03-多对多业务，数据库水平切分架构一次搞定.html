---
title: 多对多业务，数据库水平切分架构一次搞定
author: 58沈剑
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1502117474&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAnRZsVXxOs0gAXsg8p-s5kcP1*tbWxXufSoWxKApRAks9nicJ6Cmyqx5-OFThEyASlNsFo1-wc9c0f*wdCwHbk3pKd3F2cwU9tMkoYcFMbE9Xt9Wa3wC6xGQ8353nflFzHyTay5QaUz9Njb97xqBspE=
date: '2017-08-03 00:00:00 +0000'

---

{% raw  %}
<p><span style="font-family: 宋体; font-size: 14px;">本文将以“好友中心”为例，介绍“多对多”类业务，随着数据量的逐步增大，数据库性能显著降低，数据库水平切分相关的架构实践。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">一、什么是多对多关系</span></strong></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">所谓的“多对多”，来自数据库设计中的“实体</span>-<span style="font-size: 14px; font-family: 宋体;">关系”</span>ER<span style="font-size: 14px; font-family: 宋体;">模型，用来描述实体之间的关联关系，一个学生可以选修多个课程，一个课程可以被多个学生选修，这里学生与课程时间的关系，就是多对多关系。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">二、好友中心业务分析</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">好友关系主要分为两类，<strong>弱好友关系</strong>与<strong>强好友关系</strong>，两类都有典型的互联网产品应用。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">弱好友关系的建立，不需要双方彼此同意</span><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">用户</span>A<span style="font-size: 14px; font-family: 宋体;">关注用户</span>B<span style="font-size: 14px; font-family: 宋体;">，不需要用户</span>B<span style="font-size: 14px; font-family: 宋体;">同意，此时用户</span>A<span style="font-size: 14px; font-family: 宋体;">与用户</span>B<span style="font-size: 14px; font-family: 宋体;">为弱好友关系，对</span>A<span style="font-size: 14px; font-family: 宋体;">而言，暂且理解为“关注”；</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">用户</span>B<span style="font-size: 14px; font-family: 宋体;">关注用户</span>A<span style="font-size: 14px; font-family: 宋体;">，也不需要用户</span>A<span style="font-size: 14px; font-family: 宋体;">同意，此时用户</span>A<span style="font-size: 14px; font-family: 宋体;">与用户</span>B<span style="font-size: 14px; font-family: 宋体;">也为弱好友关系，对</span>A<span style="font-size: 14px; font-family: 宋体;">而言，暂且理解为“粉丝”；</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;">微博粉丝是一个典型的弱好友关系应用。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">强好友关系的建立，需要好友关系双方彼此同意</span><span style="font-size: 14px; font-family: 宋体;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">用户</span>A<span style="font-size: 14px; font-family: 宋体;">请求添加用户</span>B<span style="font-size: 14px; font-family: 宋体;">为好友，用户</span>B<span style="font-size: 14px; font-family: 宋体;">同意，此时用户</span>A<span style="font-size: 14px; font-family: 宋体;">与用户</span>B<span style="font-size: 14px; font-family: 宋体;">则互为强好友关系，即</span>A<span style="font-size: 14px; font-family: 宋体;">是</span>B<span style="font-size: 14px; font-family: 宋体;">的好友，</span>B<span style="font-size: 14px; font-family: 宋体;">也是</span>A<span style="font-size: 14px; font-family: 宋体;">的好友；</span></span></p></li></ul><p><span style="font-size: 14px;">QQ<span style="font-size: 14px; font-family: 宋体;">好友是一个典型的强好友关系应用。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtccppl8rq6qKf9xDZWrbk1YQdC65V9ZmOIjjw0YWXtmDk3KNGLF2p2w/0?wx_fmt=png" style="width: 282px !important; height: 46px !important; visibility: visible !important;"></p><p><span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">好友中心是一个典型的多对多业务</span><span style="font-family: 宋体; font-size: 14px;">，一个用户可以添加多个好友，也可以被多个好友添加，其典型架构为：</span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtkP3IMXEZBMicPmAmfK54Lia0A0gjpazzVb8sY6OAiakU5YLtpgleeYibmQ/0?wx_fmt=png" style="width: 293px !important; height: 112px !important; visibility: visible !important;"></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">friend-service<span style="font-size: 14px; font-family: 宋体;">：好友中心服务，对调用者提供友好的</span>RPC<span style="font-size: 14px; font-family: 宋体;">接口</span></span></p></li><li><p><span style="font-size: 14px;">db<span style="font-size: 14px; font-family: 宋体;">：对好友数据进行存储</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">三、弱好友关系</span>-</strong><strong><span style="font-family: 宋体;">元数据简版实现</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">通过弱好友关系业务分析，很容易了解到，其核心元数据为：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 12px;">guanzhu(uid, guanzhu_uid);</span></p></li><li><p><span style="font-size: 12px;">fensi(uid, fensi_uid);</span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;">其中：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">guanzhu<span style="font-size: 14px; font-family: 宋体;">表，用户记录</span>uid<span style="font-size: 14px; font-family: 宋体;">所有关注用户</span>guanzhu_uid</span></p></li><li><p><span style="font-size: 14px;">fensi<span style="font-size: 14px; font-family: 宋体;">表，用来记录</span>uid<span style="font-size: 14px; font-family: 宋体;">所有粉丝用户</span>fensi_uid</span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">需要强调的是，<span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">一条弱关系的产生，会产生两条记录，一条关注记录，一条粉丝记录</span>。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">例如：用户</span>A(uid=1)<span style="font-size: 14px; font-family: 宋体;">关注了用户</span>B(uid=2)<span style="font-size: 14px; font-family: 宋体;">，</span>A<span style="font-size: 14px; font-family: 宋体;">多关注了一个用户，</span>B<span style="font-size: 14px; font-family: 宋体;">多了一个粉丝，于是：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">guanzhu<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{1, 2}<span style="font-size: 14px; font-family: 宋体;">这一条记录，</span>1<span style="font-size: 14px; font-family: 宋体;">关注了</span>2</span></p></li><li><p><span style="font-size: 14px;">fensi<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{2, 1}<span style="font-size: 14px; font-family: 宋体;">这一条记录，</span>2<span style="font-size: 14px; font-family: 宋体;">粉了</span>1</span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">如何查询一个用户关注了谁呢？</span></strong></p><p><strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">回答</span></span></strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">：在</span>guanzhu<span style="font-size: 14px; font-family: 宋体;">的</span>uid<span style="font-size: 14px; font-family: 宋体;">上建立索引：</span></span></p><p><span style="font-size: 12px;">select * from guanzhu where uid=1;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">即可得到结果，</span>1<span style="font-size: 14px; font-family: 宋体;">关注了</span>2<span style="font-size: 14px; font-family: 宋体;">。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">如何查询一个用户粉了谁呢？</span></strong></p><p><strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">回答</span></span></strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">：在</span>fensi<span style="font-size: 14px; font-family: 宋体;">的</span>uid<span style="font-size: 14px; font-family: 宋体;">上建立索引：</span></span></p><p><span style="font-size: 12px;">select * from fensi where uid=2;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">即可得到结果，</span>2<span style="font-size: 14px; font-family: 宋体;">粉了</span>1<span style="font-size: 14px; font-family: 宋体;">。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">四、强好友关系</span>-</strong><strong><span style="font-family: 宋体;">元数据实现一</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">通过强好友关系业务分析，很容易了解到，其核心元数据为：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 12px;">friend(uid1, uid2);</span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;">其中：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">uid1<span style="font-size: 14px; font-family: 宋体;">，强好友关系中一方的</span>uid</span></p></li><li><p><span style="font-size: 14px;">uid2<span style="font-size: 14px; font-family: 宋体;">，强好友关系中另一方的</span>uid</span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;">uid=1<span style="font-size: 14px; font-family: 宋体;">的用户添加了</span>uid=2<span style="font-size: 14px; font-family: 宋体;">的用户，双方都同意加彼此为好友，这个</span><strong><span style="font-size: 14px; font-family: 宋体;">强好友关系，在数据库中应该插入记录</span>{1, 2}<span style="font-size: 14px; font-family: 宋体;">还是记录</span>{2,1}<span style="font-size: 14px; font-family: 宋体;">呢？</span></strong></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">回答</span></strong><span style="font-family: 宋体; font-size: 14px;">：都可以</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">为了避免歧义，可以人为约定，插入记录时</span>uid1<span style="font-size: 14px; font-family: 宋体;">的值必须小于</span>uid2<span style="font-size: 14px; font-family: 宋体;">。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">例如：有</span>uid=1,2,3<span style="font-size: 14px; font-family: 宋体;">三个用户，他们互为强好友关系，那边数据库中可能是这样的三条记录</span></span></p><p><span style="font-size: 14px;">{1, 2}</span></p><p><span style="font-size: 14px;">{2, 3}</span></p><p><span style="font-size: 14px;">{1, 3}</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">如何查询一个用户的好友呢？</span></strong></p><p><strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">回答</span></span></strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">：假设要查询</span>uid=2<span style="font-size: 14px; font-family: 宋体;">的所有好友，只需在</span>uid1<span style="font-size: 14px; font-family: 宋体;">和</span>uid2<span style="font-size: 14px; font-family: 宋体;">上建立索引，然后：</span></span></p><p><span style="font-size: 12px;">select * from friend where uid1=2</span></p><p><span style="font-size: 12px;">union</span></p><p><span style="font-size: 12px;">select * from friend where uid2=2</span></p><p><span style="font-family: 宋体; font-size: 14px;">即可得到结果。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">作业，为何不使用：</span></strong></p><p><span style="font-size: 12px;">select * from friend uid1=2 or uid2=2</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">五、强好友关系</span>-</strong><strong><span style="font-family: 宋体;">元数据实现二</span></strong></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">强好友关系是弱好友关系的一个特例，</span>A<span style="font-size: 14px; font-family: 宋体;">和</span>B<span style="font-size: 14px; font-family: 宋体;">必须互为关注关系（也可以说，同时互为粉丝关系），即也可以使用关注表和粉丝表来实现：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 12px;">guanzhu(uid, guanzhu_uid);</span></p></li><li><p><span style="font-size: 12px;">fensi(uid, fensi_uid);</span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">例如：用户</span>A(uid=1)<span style="font-size: 14px; font-family: 宋体;">和用户</span>B(uid=2)<span style="font-size: 14px; font-family: 宋体;">为强好友关系，即相互关注：</span></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">用户</span>A(uid=1)<span style="font-size: 14px; font-family: 宋体;">关注了用户</span>B(uid=2)<span style="font-size: 14px; font-family: 宋体;">，</span>A<span style="font-size: 14px; font-family: 宋体;">多关注了一个用户，</span>B<span style="font-size: 14px; font-family: 宋体;">多了一个粉丝，于是：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">guanzhu<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{1, 2}<span style="font-size: 14px; font-family: 宋体;">这一条记录</span></span></p></li><li><p><span style="font-size: 14px;">fensi<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{2, 1}<span style="font-size: 14px; font-family: 宋体;">这一条记录</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">同时，用户</span>B(uid=2)<span style="font-size: 14px; font-family: 宋体;">也关注了用户</span>A(uid=1)<span style="font-size: 14px; font-family: 宋体;">，</span>B<span style="font-size: 14px; font-family: 宋体;">多关注了一个用户，</span>A<span style="font-size: 14px; font-family: 宋体;">多了一个粉丝，于是：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">guanzhu<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{2, 1}<span style="font-size: 14px; font-family: 宋体;">这一条记录</span></span></p></li><li><p><span style="font-size: 14px;">fensi<span style="font-size: 14px; font-family: 宋体;">表要插入</span>{1, 2}<span style="font-size: 14px; font-family: 宋体;">这一条记录</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">六、数据冗余是实现多对多关系水平切分的常用实践</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">对于强好友关系的两类实现：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">friend(uid1, uid2)<span style="font-size: 14px; font-family: 宋体;">表</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据冗余</span>guanzhu<span style="font-size: 14px; font-family: 宋体;">表与</span>fensi<span style="font-size: 14px; font-family: 宋体;">表（后文称正表</span>T1<span style="font-size: 14px; font-family: 宋体;">与反表</span>T2<span style="font-size: 14px; font-family: 宋体;">）</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;">在数据量小时，看似无差异，但<span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">数据量大时，数据冗余的优势就体现出来了</span>：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;">friend<span style="font-size: 14px; font-family: 宋体;">表，数据量大时，如果使用</span>uid1<span style="font-size: 14px; font-family: 宋体;">来分库，那么</span>uid2<span style="font-size: 14px; font-family: 宋体;">上的查询就需要遍历多库</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">正表</span>T1<span style="font-size: 14px; font-family: 宋体;">与反表</span>T2<span style="font-size: 14px; font-family: 宋体;">通过数据冗余来实现好友关系，</span>{1, 2}{2,1}<span style="font-size: 14px; font-family: 宋体;">分别存在于两表中，故两个表都使用</span>uid<span style="font-size: 14px; font-family: 宋体;">来分库，均只需要进行一次查询，就能找到对应的关注与粉丝，而不需要多个库扫描</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">数据冗余，是多对多关系，在数据量大时，数据水平切分的常用实践。</span></strong></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">七、如何进行数据冗余</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">接下来的问题转化为，好友中心服务如何来进行数据冗余，常见有三种方法。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法一：服务同步冗余</span></strong></p><p><span style="font-family: Arial, sans-serif; color: rgb(51, 51, 51); font-size: 14px; background: white;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtrsZvcFKnevqnEKbYEA2WtxQcNPM3GC5xlWb6yKqUnxH5cGOvM2cBicg/0?wx_fmt=png" style="width: 197px !important; height: 166px !important;"></p><p><span style="font-size: 14px; line-height: 1.6; font-family: 宋体; color: rgb(51, 51, 51); background: white;">顾名思义，由好友中心服务同步写冗余数据，如上图</span><span style="font-size: 14px; line-height: 1.6; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">1-4</span><span style="font-size: 14px; line-height: 1.6; font-family: 宋体; color: rgb(51, 51, 51); background: white;">流程：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">业务方调用服务，新增数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务先插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务再插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T2</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务返回业务方新增数据成功</span></span></p></li></ul><p><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;"><br></span></p><p><strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">优点</span></strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">不复杂，服务层由单次写，变两次写</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据一致性相对较高（因为双写成功才返回）</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">缺点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">请求的处理时间增加（要插入次，时间加倍）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据仍可能不一致，例如第二步写入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">完成后服务重启，则数据不会写入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T2</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">如果系统对处理时间比较敏感，引出常用的第二种方案</span></p><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法二：服务异步冗余</span></strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdteiaiapWo3feUwibEyezDASDXviboM0peMenZFCgjTVMekznSzg8GtZcjDg/0?wx_fmt=png" style="width: 369px !important; height: 165px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据的双写并不再由</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">好友中心服务</span><span style="font-size: 14px; font-family: 宋体;">来完成，服务层异步发出一个消息，通过消息总线发送给一个专门的数据复制服务来写入冗余数据，如上图</span>1-6<span style="font-size: 14px; font-family: 宋体;">流程：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">业务方调用服务，新增数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务先插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务向消息总线发送一个异步消息（发出即可，不用等返回，通常很快就能完成）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务返回业务方新增数据成功</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">消息总线将消息投递给数据同步中心</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据同步中心插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T2</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li></ul><p><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;"><br></span></p><p><strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">优点</span></strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">请求处理时间短（只插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">次）</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">缺点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">系统的复杂性增加了，多引入了一个组件（消息总线）和一个服务（专用的数据复制服务）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">因为返回业务线数据插入成功时，数据还不一定插入到</span>T2<span style="font-size: 14px; font-family: 宋体;">中，因此数据有一个不一致时间窗口（这个窗口很短，最终是一致的）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">在消息总线丢失消息时，冗余表数据会不一致</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">如果想解除“数据冗余”对系统的耦合，引出常用的第三种方案</span></p><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法三：线下异步冗余</span></strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtZrZccXY9ibumWy7VuJtYbXRPpocckCCibATicJtHWYvgic2HclXtkLGQXw/0?wx_fmt=png" style="width: 253px !important; height: 221px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据的双写不再由</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">好友中心服务</span><span style="font-size: 14px; font-family: 宋体;">来完成，而是由线下的一个服务或者任务来完成，如上图</span>1-6<span style="font-size: 14px; font-family: 宋体;">流程：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">业务方调用服务，新增数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务先插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">服务返回业务方新增数据成功</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据会被写入到数据库的</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">log</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">中</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">线下服务或者任务读取数据库的</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">log</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">线下服务或者任务插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">T2</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">数据</span></span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;"><br></span></span></p><p><strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">优点</span></strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据双写与业务完全解耦</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">请求处理时间短（只插入</span><span style="font-size: 14px; font-family: Arial, sans-serif; color: rgb(51, 51, 51); background: white;">1</span><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;">次）</span></span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体; color: rgb(51, 51, 51); background: white;"><br></span></span></p><p><strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">缺点</span></strong><span style="font-family: 宋体; color: rgb(51, 51, 51); font-size: 14px; background: white;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">返回业务线数据插入成功时，数据还不一定插入到</span>T2<span style="font-size: 14px; font-family: 宋体;">中，因此数据有一个不一致时间窗口（这个窗口很短，最终是一致的）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据的一致性依赖于线下服务或者任务的可靠性</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">上述三种方案各有优缺点，可以结合实际情况选取。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据冗余固然能够解决多对多关系的数据库水平切分问题，但又带来了新的问题，</span><strong><span style="font-size: 14px; font-family: 宋体;">如何保证正表</span>T1<span style="font-size: 14px; font-family: 宋体;">与反表</span>T2<span style="font-size: 14px; font-family: 宋体;">的数据一致性呢？</span></strong></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">八、如何保证数据的一致性</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">上一节的讨论可以看到，不管哪种方案，因为两步操作不能保证原子性，总有出现数据不一致的可能，<span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">高吞吐分布式事务是业内尚未解决的难题</span>，此时的<strong>架构优化方向</strong>，<span style="font-family: 宋体; font-size: 14px; color: rgb(255, 76, 0);">并不是完全保证数据的一致，而是尽早的发现不一致，并修复不一致。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="color: rgb(255, 76, 0);"><strong><span style="font-family: 宋体; font-size: 14px;">最终一致性，是高吞吐互联网业务一致性的常用实践。</span></strong></span><span style="font-family: 宋体; font-size: 14px;">更具体的，保证数据最终一致性的方案有三种。</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法一：线下扫面正反冗余表全部数据</span></strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtklRjffbvCy0ggXicxmIO53qMRzEWGS800bEq1Fzcliaffhfp8JK9L4Ow/0?wx_fmt=png" style="width: 192px !important; height: 186px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">如上图所示，<span style="font-size: 14px; color: red;">线下启动一个离线的扫描工具，不停的比对正表</span></span><span style="font-size: 14px; color: red;">T1</span><span style="font-size: 14px; font-family: 宋体; color: red;">和反表</span><span style="font-size: 14px; color: red;">T2</span><span style="font-size: 14px; font-family: 宋体; color: red;">，如果发现数据不一致，就进行补偿修复</span><span style="font-size: 14px; font-family: 宋体;">。</span></span></p><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">优点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">比较简单，开发代价小</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">线上服务无需修改，修复工具与线上服务解耦</span></span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;"><br></span></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">缺点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">扫描效率低，会扫描大量的“已经能够保证一致”的数据</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">由于扫描的数据量大，扫描一轮的时间比较长，即数据如果不一致，不一致的时间窗口比较长</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">有没有只扫描“可能存在不一致可能性”的数据，而不是每次扫描全部数据，以提高效率的优化方法呢？</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法二：线下扫描增量数据</span></strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtsVoWbLK2Mw1s1KcNCYhYeVXobJeNDIbq20E3W5POdmjOtVS554zzdQ/0?wx_fmt=png" style="width: 388px !important; height: 187px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">每次只扫描增量的日志数据，就能够极大提高效率，缩短数据不一致的时间窗口，如上图</span>1-4<span style="font-size: 14px; font-family: 宋体;">流程所示：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">写入正表</span>T1</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">第一步成功后，写入日志</span>log1</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">写入反表</span>T2</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">第二步成功后，写入日志</span>log2</span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">当然，我们<span style="font-size: 14px; color: red;">还是需要一个离线的扫描工具，不停的比对日志</span></span><span style="font-size: 14px; color: red;">log1</span><span style="font-size: 14px; font-family: 宋体; color: red;">和日志</span><span style="font-size: 14px; color: red;">log2</span><span style="font-size: 14px; font-family: 宋体; color: red;">，如果发现数据不一致，就进行补偿修复</span></span></p><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">优点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">虽比方法一复杂，但仍然是比较简单的</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">数据扫描效率高，只扫描增量数据</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">缺点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">线上服务略有修改（代价不高，多写了</span>2<span style="font-size: 14px; font-family: 宋体;">条日志）</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">虽然比方法一更实时，但时效性还是不高，不一致窗口取决于扫描的周期</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-family: 宋体; font-size: 14px;">有没有实时检测一致性并进行修复的方法呢？</span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">方法三：实时线上“消息对”检测</span></strong></p><p><img src="http://mmbiz.qpic.cn/mmbiz_png/YrezxckhYOw4DibJTPQ5ibBg0gRUDdbwdtUD5xMOft4hynZPfG6JuXdJEjBScPkWn9PCvpAichArKibvibdgSbkgCqw/0?wx_fmt=png" style="width: 419px !important; height: 117px !important;"></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">这次不是写日志了，而是向消息总线发送消息，如上图</span>1-4<span style="font-size: 14px; font-family: 宋体;">流程所示：</span></span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">写入正表</span>T1</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">第一步成功后，发送消息</span>msg1</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">写入反表</span>T2</span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">第二步成功后，发送消息</span>msg2</span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;">这次不是需要一个周期扫描的离线工具了，而是一个实时订阅消息的服务不停的收消息。</span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">假设正常情况下，</span>msg1<span style="font-size: 14px; font-family: 宋体;">和</span>msg2<span style="font-size: 14px; font-family: 宋体;">的接收时间应该在</span>3s<span style="font-size: 14px; font-family: 宋体;">以内，如果检测服务在收到</span>msg1<span style="font-size: 14px; font-family: 宋体;">后没有收到</span>msg2<span style="font-size: 14px; font-family: 宋体;">，就尝试检测数据的一致性，不一致时进行补偿修复</span></span></p><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">优点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">效率高</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">实时性高</span></span></p></li></ul><p><span style="font-family: 宋体; font-size: 14px;"><br></span></p><p><strong><span style="font-family: 宋体; font-size: 14px;">缺点</span></strong><span style="font-family: 宋体; font-size: 14px;">：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">方案比较复杂，上线引入了消息总线这个组件</span></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">线下多了一个订阅总线的检测服务</span></span></p></li></ul><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 14px;">however<span style="font-size: 14px; font-family: 宋体;">，技术方案本身就是一个投入产出比的折衷，可以根据业务对一致性的需求程度决定使用哪一种方法。</span></span></p><p><span style="font-size: 14px;">&nbsp;</span></p><p><span style="font-size: 16px;"><strong><span style="font-family: 宋体;">九、总结</span></strong></span></p><p><span style="font-family: 宋体; font-size: 14px;">文字较多，希望尽量记住如下几点：</span></p><ul class="list-paddingleft-2" style="list-style-type: disc;"><li><p><strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">好友业务是一个典型的多对多关系</span></span></strong><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">，又分为强好友与弱好友</span></span></p></li><li><p><span style="color: rgb(255, 76, 0);"><strong><span style="font-size: 14px; font-family: 宋体;">数据冗余</span></strong></span><strong><span style="font-size: 14px; font-family: 宋体;">是一个常见的多对多业务数据水平切分实践</span></strong></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">冗余数据的常见方案有三种</span></span></p><p><span style="font-size: 14px;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;（1）<span style="font-size: 14px; font-family: 宋体;">服务同步冗余</span></span></p><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; （2）<span style="font-size: 14px; font-family: 宋体;">服务异步冗余</span></span></p><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; （3）<span style="font-size: 14px; font-family: 宋体;">线下异步冗余</span></span></p></li><li><p><strong><span style="font-size: 14px; font-family: 宋体;">数据冗余会带来一致性问题</span></strong><span style="font-size: 14px; font-family: 宋体;">，高吞吐互联网业务，要想完全保证事务一致性很难，<strong>常见的实践是<span style="font-size: 14px; font-family: 宋体; color: rgb(255, 76, 0);">最终一致性</span></strong></span></p></li><li><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;">最终一致性的常见实践是，尽快找到不一致，并修复数据，常见方案有三种</span></span></p><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-size: 14px; line-height: 22.4px;">（1）</span><span style="font-size: 14px; font-family: 宋体;">线下全量扫描法</span></span></p><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-size: 14px; line-height: 22.4px;">（2）</span><span style="font-size: 14px; font-family: 宋体;">线下增量扫描法</span></span></p><p><span style="font-size: 14px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style="font-size: 14px; line-height: 22.4px;">（3）</span><span style="font-size: 14px; font-family: 宋体;">线上实时检测法</span></span></p></li></ul><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;"></span></span></p><p><span style="font-size: 14px;"><span style="font-size: 14px; font-family: 宋体;"><span style="font-size: 14px; line-height: 22.4px;  font-family: 宋体;">希望大家有收获，帮<span style="font-size: 14px; line-height: 22.4px; font-family: 宋体; color: rgb(255, 76, 0);">转</span>哟。</span></span></span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1502117474&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAnRZsVXxOs0gAXsg8p-s5kcP1*tbWxXufSoWxKApRAks9nicJ6Cmyqx5-OFThEyASlNsFo1-wc9c0f*wdCwHbk3pKd3F2cwU9tMkoYcFMbE9Xt9Wa3wC6xGQ8353nflFzHyTay5QaUz9Njb97xqBspE=">微信地址</a> | <a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651960274&amp;idx=1&amp;sn=81714a692f3c29395c6e2ff3e8f00350&amp;chksm=bd2d060e8a5a8f188c90253a496c97661da7f3bcab9d42c48b95665fae3916b2c2cdc2ea33e6#rd">阅读原文</a>
{% endraw  %}

