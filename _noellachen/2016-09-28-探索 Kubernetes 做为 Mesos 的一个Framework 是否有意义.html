---
title: 探索 Kubernetes 做为 Mesos 的一个Framework 是否有意义
author: 陈爱珍 译
date: '2016-09-28 00:00:00 +0000'

---

{% raw  %}
<p style="text-indent:48px"><span style="font-family:DengXian">在寻找容器编排平台时，开源社区提供一些如 </span>Kubernetes, Marathon-Mesos <span style="font-family:DengXian">或</span> Docker Swarm <span style="font-family:DengXian">等可行的选择。在很多寻找运行在线负载原生云的用户中，</span>Kubernetes <span style="font-family:DengXian">非常受欢迎，因为它内置支持一系列有用的特性，包括自动化部署，负载均衡，自动扩展，滚动升级等等 </span>DevOps <span style="font-family:DengXian">用户寻找的要素。但同时，在考虑企业运行环境的负载范围，处理多个框架间共同关心的问题时则需要一种更通用的资源管理器，而 </span>Apache Mesos <span style="font-family:DengXian">则解决了这个问题。</span>Mesos <span style="font-family:DengXian">是一个轻量的系统，只有</span>230K<span style="font-family:DengXian">行的代码，而 </span>Kubernetes <span style="font-family:DengXian">则有</span>1.3M+<span style="font-family:DengXian">，它专注于提供一种基础资源抽象层，这样可以按框架来分配资源，处理基于 </span>task <span style="font-family:DengXian">执行能力，同时处理如主机维护模式等管理操作。</span></p><p style="text-indent:48px"><span style="font-family:DengXian">在 </span>IBM<span style="font-family:DengXian">，我们探索了如何通过将 </span>Kubernetes <span style="font-family:DengXian">作为 </span>Mesos <span style="font-family:DengXian">的一个 </span>Framework <span style="font-family:DengXian">让 </span>Mesos&nbsp;<span style="font-family:DengXian">和 </span>Kubernetes <span style="font-family:DengXian">一起工作。虽然 </span>Mesos <span style="font-family:DengXian">和内置在 </span>Kubernetes <span style="font-family:DengXian">可用资源管理功能有一部分重叠</span>,<span style="font-family:DengXian">但依然可以使用这两个工具协同管理。这种模式的一个好处就是不仅有支持一部分类似大数据，</span>spark <span style="font-family:DengXian">负载的能力，也能让其他的分析系统可以受益于 </span>Mesos <span style="font-family:DengXian">支持的细粒度的资源分配。我们认为在运行高动态的业务负载时这将提升资源的使用和性能。</span></p><p style="text-indent:48px">Mesos <span style="font-family:DengXian">因为是轻量的，可以在生产环境中很容易调度成千上万的节点。另一方面虽然 </span>Kubernetes &nbsp;<span style="font-family:DengXian">在迅速改善的规模和性能，但仍限于</span>1000<span style="font-family:DengXian">个节点。可以通过把 </span>Kubernetes <span style="font-family:DengXian">运行在 </span>Mesos<span style="font-family:DengXian">，可以提供一个在 </span>Mesos <span style="font-family:DengXian">的基础上运行数倍的 </span>Kubernetes <span style="font-family:DengXian">节点的能力。</span></p><p style="text-indent:48px">Kubernetes <span style="font-family:DengXian">只专注容器，而 </span>Mesos <span style="font-family:DengXian">的目的更多的是在可以支持操作系统进程级别的负载。对企业来说把已存在的业务负载放到一个共同管理的环境更为重要。</span>Kubernetes <span style="font-family:DengXian">允许企业进入一个新的容器化业务负载的原生云，而 </span>Mesos <span style="font-family:DengXian">则是已存在的 </span>Windows,Unix <span style="font-family:DengXian">和</span>Linux <span style="font-family:DengXian">环境的桥梁。</span></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;作为探索的一部分，IBM 将率先在把Kubernetes 集成到Mesos 的项目中作出贡献。这里包括设法帮助kube-DNS 与外部的DNS（#28453），提高Kubernetes的调度算法（#31068）,让 Kubernetes 的命名空间可以和 Mesos（#31069）更好的工作，而且支持 Kubernetes 运行在异构硬件环境上（#29901）. 这项工作是额外贡献在 IBM 正在直接执行的 Kubernetes 和 Mesos 项目。</p><p>&nbsp; &nbsp; &nbsp;&nbsp; &nbsp; 对于如何用一种可消费的方式打包这些技术使普通企业用户为不同的工作负载轻松建立自己的容器管理平台，我们很快会分享更多的信息，请继续关注!</p><p style="border: none; padding: 0px 0px 1px;">&nbsp;</p><p style="border: none; padding: 0px 0px 1px;">源文连接：https://developer.ibm.com/opentech/2016/08/23/exploring-kubernetes-as-a-mesos-framework-does-it-make-sense/</p><p style="border: none; padding: 0px 0px 1px;"><br></p><p style="border: none; padding: 0px 0px 1px;">——————————————————————————————————</p><p>&nbsp;</p><p><span style="font-family:DengXian">译者说</span></p><p style="text-indent:48px">Mesos <span style="font-family:DengXian">的定义是用于调度成百上千个节点的超大规模集群管理平台，而</span>Kubernetes <span style="font-family:DengXian">的定义是专门用来管理，部署，调度容器化应用的开源系统。</span>2014<span style="font-family:DengXian">年</span>6<span style="font-family:DengXian">月</span><span style="color: windowtext">&nbsp;Google</span>&nbsp; <span style="font-family:DengXian">宣布 </span>Kubernetes&nbsp;<span style="font-family:DengXian">开源后，同年</span>7<span style="font-family:DengXian">月 </span><span style="color: windowtext">Google</span> <span style="font-family:DengXian">官方就宣布了和</span> &nbsp;Mesosphere <span style="font-family:DengXian">的合作，为用户提供可以让 </span>Kubernetes <span style="font-family:DengXian">和其他 </span>Framework<span style="font-family:DengXian">（如</span>Hadoop,Spark,Marathon,Chronos<span style="font-family:DengXian">等）共享 </span>Mesos&nbsp;<span style="font-family:DengXian">集群资源的能力。这个合作可以理解成将 </span><span style="font-family:Calibri">Kubernetes </span><span style="font-family:DengXian">作为 </span><span style="font-family:Calibri">Framework </span><span style="font-family:DengXian">整合到 </span><span style="font-family:Calibri">Mesosphere </span><span style="font-family:DengXian">生态系统中。从功能上看，</span>Mesos <span style="font-family:DengXian">自身更像是一个 </span>IaaS <span style="font-family:DengXian">层的资源管理工具，用来为上层框架提供共享底层资源的能力，再通过上面运行 </span>Framework <span style="font-family:DengXian">实现 </span>PaaS <span style="font-family:DengXian">层的应用管理，可以调度和管理不同的 </span>Framework<span style="font-family:DengXian">，而 </span>Kubernetesm <span style="font-family:DengXian">则只是一个调度管理容器的 </span>Framewo<span style="color: rgb(0, 0, 0); text-decoration: none;">rk<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">。文章中说 </span>Mesos <span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">只有</span>230K<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">行的代码，而 </span>Kubernetes&nbsp;<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">则有 </span>1.3M+<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">。</span>Mesos <span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">的代码要比 </span>Kubernetes <span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">少，是因为 </span>Mesos&nbsp;<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">框架不完整，还需要借助好多其他 </span>“Framework”<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">（比如 </span>Marathon<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">，</span>Aurora<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">，</span>Singularity<span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">）才能够像 </span>Kubernetes <span style="color: rgb(0, 0, 0); text-decoration: none; font-family: DengXian;">那样做调度。两个产品各自有优势，也各自有劣势，这个合作的目的是通过两者的结合进行互补提供一个满足用户更多需求的平台。</span></span></p><p style="text-indent:48px"><span style="color: rgb(0, 0, 0);"><span style="color: rgb(0, 0, 0); font-family: DengXian;">虽然这个项目在 </span>Kubernetes </span><span style="font-family: DengXian; color: rgb(0, 0, 0); text-decoration: none;">开源后就已经提出来，但两年多过去了，并没有在生产实践中得到有效的落地推广，现在这</span><span style="font-family:DengXian">个项目是 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">社区主导。</span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">社区贡献代码的主要是</span><span style="font-family:Calibri"> Mesospher</span><span style="font-family:DengXian">，</span><span style="font-family:Calibri">Twitter</span><span style="font-family:DengXian">，</span><span style="font-family:Calibri">IBM </span><span style="font-family:DengXian">和 </span><span style="font-family:Calibri">Intel</span><span style="font-family:DengXian">，而 </span><span style="font-family:Calibri">Kubernetes on Mesos </span><span style="font-family:DengXian">这个项目现在主要由 </span><span style="font-family:Calibri">IBM </span><span style="font-family:DengXian">在推进，</span><span style="font-family:Calibri">Intel </span><span style="font-family:DengXian">则在最近表示将继续投入资金支持 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">项目。他们认为虽然 </span>Kubernetes <span style="font-family:DengXian">获得了很大的突破，但他们并不认为 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">与 </span>Kubernetes <span style="font-family:DengXian">是竞争者的关系，</span>Kubernetes <span style="font-family:DengXian">是直接面向应用开发者，而 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">则是面向超大规模集群部署，更适合数据中心。就像文章中说的，</span>Kubernetes <span style="font-family:DengXian">目前还只能管理</span><span style="font-family:Calibri">1000</span><span style="font-family:DengXian">个节点，而通过运行在</span><span style="font-family:Calibri">&nbsp; Mesos </span><span style="font-family:DengXian">上可以数倍的扩展 </span>Kubernetes <span style="font-family:DengXian">的能力，做一个更大的资源管理平台。Intel 认为 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">的目标是大型数据中心的资源管理和编排，当把 </span><span style="font-family:Calibri">Kubernetes </span><span style="font-family:DengXian">运行在 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">管理的数据中心上时也将划清楚两者之间的区别。以下为 </span><span style="font-family:Calibri">Kubernetes </span><span style="font-family:DengXian">在 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">的一个结构图：</span></p><p><span style="font-family:Calibri">&nbsp;</span></p><p style="text-align:center"><img src="/noellachen/images/06ef78dada664ce37f10360e75d31706aeac4fff.png" style="width: 575px !important; height: 479px !important;"></p><p style="text-align:center"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center; white-space: pre-wrap; background-color: rgb(255, 255, 255);">图 1 Kubernetes on Meos &nbsp; &nbsp; &nbsp;来源 GitHub</span></p><p style="text-align:center">&nbsp;</p><p style="text-indent:48px"><span style="font-family:Calibri">Kubernetes on Mesos </span><span style="font-family:DengXian">并不是简单的在 </span><span style="font-family:Calibri">Mesos </span><span style="font-family:DengXian">平台上运行 </span><span style="font-family:Calibri">Kubernetes</span><span style="font-family:DengXian">，而是要把 </span>Kubernetes &nbsp;<span style="font-family:DengXian">集成到 </span>Mesos <span style="font-family:DengXian">项目里，并解决相应的问题。如文章中提到的 </span>IBM <span style="font-family:DengXian">正在处理的一些</span>issue<span style="font-family:DengXian">，如设法帮助 </span>kube-DNS <span style="font-family:DengXian">与外部的 </span>DNS<span style="font-family:DengXian">（</span>#28453<span style="font-family:DengXian">）等。</span></p><p style="text-indent:48px">&nbsp;</p><p><span style="font-family:DengXian">那么 </span>Kubernetes <span style="font-family:DengXian">做为</span> &nbsp;Mesos &nbsp;<span style="font-family:DengXian">的一个 </span>Framework <span style="font-family:DengXian">是否有意义？可以分析一下在生产实践中，两者的结合会有什</span>么优缺点优。</p><p style="text-indent:48px"><span style="font-family:DengXian"><br></span></p><p><span style="font-family:DengXian">优点：</span></p><p>1、Mesos <span style="font-family:DengXian">提供在生产环境中运行多个 </span>Framework<span style="font-family:DengXian">，当生产环境不仅需要运行容器编排 <span style="white-space: pre-wrap;">Kubernetes</span>，还需要运行其他的 </span>Framework 时<span style="font-family:DengXian">，这种模式可以让 &nbsp;</span>Kubernetes <span style="font-family:DengXian">和其它 </span>Framework <span style="font-family:DengXian">共享资源，对系统的资源利用率提升有一定帮助。</span></p><p><span style="font-family:DengXian">2、</span><span style="font-family: DengXian;"> 通过这种模式 </span>Mesos <span style="font-family: DengXian;">可以享受 </span>Kubernetes <span style="font-family: DengXian;">对微服务的抽象，并实现让一组容器运行在相同的 </span>slave <span style="font-family: DengXian;">节点上。</span></p><p><span style="font-family: DengXian;">2、同时 </span>Mesos <span style="font-family: DengXian;">可以根据负载自动扩展</span> &nbsp;Kubernetes &nbsp;<span style="font-family: DengXian;">的</span> &nbsp;Worker &nbsp;<span style="font-family: DengXian;">节点，而不需要手动去安装。</span></p><p>3、Kubernetes&nbsp;<span style="font-family: DengXian;">也可以不再受节点数量的限制可以得到数倍的扩展。</span></p><p>&nbsp;</p><p><span style="font-family:DengXian">然而站在现在这个时间节点上，这个方案缺点也十分明显：</span></p><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p><span style="font-family:DengXian">上述提到的优点只有在面对超大型数据中心（10W+物理节点）以上才能体现，但是国内能满足超大集群规模的企业能有几家?而国内 BAT 这样的公司又不使用，都会自己直接开发。</span></p></li><li><p><span style="font-family:DengXian"></span><span style="font-family: DengXian;">开源生态圈不稳定，本身 Docker 的三种 COEs 还处于发展中，功能都在逐步完善，产品迭代的很快。而且三种 &nbsp;COEs &nbsp;还存在着竞争的关系，目前结果并不明朗。</span></p></li><li><p><span style="font-family:DengXian">技术方案过于复杂，在生产实践中会比只使用一个产品更复杂更重，坑也会更多。两个产品本身就有功能重叠的地方，从某种角度上对用户来讲，这两个还是同类的产品，如果一个也能有满足用户需求，又何必同时用两个搞这么复杂。而且一般企业不会把自己弄这么重，都会是循序渐进的推行一些技术，否则会消化不良。复杂度小，能快速实践是企业在选择新技术落地的关键，太复杂的架构一般企业搞不定，只会导致实践周期变长，<span style="font-family: DengXian; white-space: pre-wrap;">会影响长期的稳定性，</span>落地将会变得更难。虽然这种模式功能更全面，但同时也增加了落地的难度，而部分企业在现阶段还不需要这多么的功能，选择单一的产品会适合。</span></p></li><li><p><span style="font-family:DengXian">文章中提到 Mesos 是轻量型，代码比 Kubernetes 的要少，但两者的结合又将增加彼此的重量，这是一个矛盾的设定。</span></p></li><li><p><span style="font-family:DengXian">Mesos 的架构与现在热门的 Openstack 定位也存在部分功能重叠，这样企业将更不知道如何选择落地方案，那么这种方案的选择度将会很低。</span></p></li></ol><p><br></p><p><span style="font-family: DengXian;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这种模式现在还在推行中，<span style="font-family: DengXian; white-space: pre-wrap; text-indent: 48px;">两种技术的集成带的挑战不小。目前</span>成熟的案例和方案极少，<span style="font-family: DengXian; text-indent: 48px; white-space: pre-wrap;">只有国内可以看到 IBM 的 Blue Dock 的概念及几篇测试文</span></span><span style="text-indent: 48px; font-family: DengXian;">。对于这种模式在 </span><span style="text-indent: 48px;">Mesos </span><span style="text-indent: 48px; font-family: DengXian;">社区的集成情况和在企业中的可行性后续发展到底如何，我们暂且拭目以待。</span></p><p><span style="text-indent: 48px; font-family: DengXian;"><br></span></p><p><span style="text-indent: 48px; font-family: DengXian;">仅个人观点，欢迎吐槽和交流。</span></p>
{% endraw  %}

