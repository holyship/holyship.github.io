---
title: 如何选择使用开源软件建立监控体系
author: 昌盛
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1503366004&src=3&ver=1&signature=OYewMZH60kmig22U24i7m9KATgmqVaMHgld42a4AbVw*ZdsI-1U0VHgIZB8eM2c5t*lRBBWGes32Ij-wSvxIugG3eQsqOI2-gs8NzrzHfL-mu2sM1ZyTbd9bmd2C02aKkyXgbt3BPDoS9sgL4nbPYO0GL3vrITVSEMbT*Xa*f7M=
date: '2017-08-10 00:00:00 +0000'

---

{% raw  %}
<p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: justify; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="-webkit-font-kerning: none;">昌盛，中国人寿上海数据中心工程师。</span><span style="line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">2009</span><span style="-webkit-font-kerning: none;">年加入中国人寿，先后负责多个重点应用系统项目的上线、推广、运维工作。</span><span style="line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">2015</span><span style="-webkit-font-kerning: none;">年起主导公司自主应用监控系统</span><span style="line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">“</span><span style="-webkit-font-kerning: none;">全球鹰</span><span style="line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="-webkit-font-kerning: none;">监控项目，填补了公司应用监控及业务实时展现的空白。在保险公司监控体系建设、智能预警及相关创新应用方面积累了一定的经验。现致力于智能监控、区块链等方面的研究。</span></span></p><p><span style="font-kerning: none"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0TlwczE2qzcjVKQ9eVPaUMrgQib6bJL22ibRteVIbibFYKdVMgmgicR8T9og/0?wx_fmt=jpeg" style="width: 184px !important; height: 259px !important; visibility: visible !important;"></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">提起监控，相信大家都不陌生。从马路上的监控探头、手机地图的实时路况到特斯拉的自动驾驶传感器，监控无处不在。设想有一天，路上的监控摄像头都消失了，你还放心让孩子一个人过马路吗？</span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">运维领域也是一样，为保证系统的正常运行，便于运维人员及时了解当前状态，必须建设一套完整的监控体系。假设</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">运维没有监控，必然导致事故频发（</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CPU/</span><span style="font-size: 14px; -webkit-font-kerning: none;">内存使用率、进程状态无从知晓）、</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">debug</span><span style="font-size: 14px; -webkit-font-kerning: none;">困难（无法定位问题原因）、产品推广缓慢（用户指标、实时业务无法知晓）。到头来，怎么死的都不知道！</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">笔者就职于中国人寿数据中心，负责智能监控系统建设，在长期的工作中对监控体系建设有一些心得体会，愿与大家分享。</span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC Semibold'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="line-height: normal; font-family: 'PingFang SC'; -webkit-font-kerning: none; font-size: 14px;"><strong>一、监控体系的金字塔结构</strong></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">我们先来谈谈</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">运维的监控结构。这里说的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">运维监控，是在机房基础建设之上的，不包括机房的风、水、电等基础建设的监控。</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">运维监控主要分为三大领域：基础环境监控、安全监控、应用监控。基础环境监控指针对数据中心所有运行的服务器、数据库、存储、网络设施的运行状态的监控，如</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CPU/</span><span style="font-size: 14px; -webkit-font-kerning: none;">内存</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">/</span><span style="font-size: 14px; -webkit-font-kerning: none;">磁盘空间使用率、网络延迟、带宽占用、数据库死锁、磁盘</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IOPS</span><span style="font-size: 14px; -webkit-font-kerning: none;">等，可理解为</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IaaS</span><span style="font-size: 14px; -webkit-font-kerning: none;">层的监控；安全监控包括对内网用户访问的审计和外部攻击的监控等。对于金融企业而言，信息安全永远是最重要的话题之一，所以要单独把安全监控列出来，作为单独的一个领域；应用监控是在基础和安全监控之上的领域，侧重应用系统的运行指标，如访问量、交易时长、交易占比、业务指标等，可理解为</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">PaaS</span><span style="font-size: 14px; -webkit-font-kerning: none;">或</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">SaaS</span><span style="font-size: 14px; -webkit-font-kerning: none;">层的监控。尤其是业务指标，每个系统的功能不一样，有业务系统、有客户服务系统、有办公系统，关注的业务指标也不一而足。因此，除了些共性的指标，针对每一个应用系统设计不同的监控指标，也是一件庞大而复杂的工作。</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">基础环境监控、安全监控、应用监控室最主要的三大领域，撑起这些领域的，是广泛部署的监控探针。就像汽车的传感器，道路的摄像头一样，探针作为监控系统的末梢，接入大量的被采集服务器，肩负起了获取最原始监控数据的重任。再好的监控算法、再牛</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">X</span><span style="font-size: 14px; -webkit-font-kerning: none;">的实时计算平台，若原始数据都无法准确、实时获取，都是白费。很多人问笔者如何衡量一套监控系统的好坏，笔者的回答是，先看探针！</span></span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0Tw9cZfDh7icTYvUD3j3wDRJBzZxkHGdInwkRcIoDGRaXyzhUVUBVorGw/0?wx_fmt=jpeg" style="width: 393px !important; height: 277px !important;"></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0); text-align: center;"><span style="font-size: 14px; font-family: 'PingFang SC'; text-align: center; -webkit-text-stroke-width: initial;">图一、监控系统的金字塔体系</span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0); text-align: center;"><span style="font-size: 14px; font-family: 'PingFang SC'; text-align: center; -webkit-text-stroke-width: initial;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>二、智能预警</strong></span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;"><strong>——</strong></span><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>金字塔顶的明珠</strong></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">探针、三大监控领域（基础环境、安全、应用）共同组成了中国人寿的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">IT</span><span style="font-size: 14px; -webkit-font-kerning: none;">监控金字塔体系，不过我们不能忘了，在塔的顶端，还有一个领域，这就是需要着重强调的智能预警。</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">前文提到的监控，均是在系统发生故障后或指标达到预设的阈值后才发出告警，阈值是事先固定的，例如</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">java</span><span style="font-size: 14px; -webkit-font-kerning: none;">进程</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">down</span><span style="font-size: 14px; -webkit-font-kerning: none;">，</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CPU</span><span style="font-size: 14px; -webkit-font-kerning: none;">使用率超过</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">85%</span><span style="font-size: 14px; -webkit-font-kerning: none;">等，是一个固定的值，不会随着系统及时间的变化而变化。固定值会有一个问题：<strong>假如我们设定</strong></span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;"><strong>CPU</strong></span><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>使用率超过</strong></span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;"><strong>85%</strong></span><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>就告警，那么请问系统在凌晨没什么人使用的时候，</strong></span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;"><strong>CPU</strong></span><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>使用率超过了</strong></span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;"><strong>50%</strong></span><span style="font-size: 14px; -webkit-font-kerning: none;"><strong>，系统是正常还是异常的？</strong>按照固定阈值算法，</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CPU</span><span style="font-size: 14px; -webkit-font-kerning: none;">使用率未超过</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">85%</span><span style="font-size: 14px; -webkit-font-kerning: none;">，系统正常，不触发告警。但是用常识想一想，业务闲时系统的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CPU</span><span style="font-size: 14px; -webkit-font-kerning: none;">使用率也超过</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">50%</span><span style="font-size: 14px; -webkit-font-kerning: none;">，明显不正常啊！</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">这个问题怎么破？有人会说，把告警阈值动态调整，闲时设低一点，忙时设高一点。这个想法不错，但是会有两个问题：</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">1</span><span style="font-size: 14px; -webkit-font-kerning: none;">、怎么识别闲时和忙时？</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">2</span><span style="font-size: 14px; -webkit-font-kerning: none;">、每个指标都动态调整的话，自定义的量太大。所以，智能预警就非常重要。简单地说，所谓智能预警，就是根据该指标历史数据，动态调整当前的告警阈值，做到早发现、早追踪、早处理。智能预警引入了时间的维度，利用大数据和实时计算技术，将之前几周甚至几个月的指标进行聚合计算，得出当前时间的动态告警阈值，并根据时间的变化而不断调整。如果说监控是看现在，那么智能预警就是观过去，测未来。别小看智能预警，中国人寿自主开发的智能预警系统</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">“</span><span style="font-size: 14px; -webkit-font-kerning: none;">响尾蛇</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; -webkit-font-kerning: none;">，在</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">2016</span><span style="font-size: 14px; -webkit-font-kerning: none;">年成功预测了</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">12</span><span style="font-size: 14px; -webkit-font-kerning: none;">起潜在的故障，避免了严重的生产事故。</span></span></p><p style="text-align: center; font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0TPBKf1J388fSIVgMiaUI6guHS0G60kYAfKlk1Jx8tt9IaUTaSibtrHCVQ/0?wx_fmt=jpeg" style="width: 415px !important; height: 226px !important;"></p><p style="text-align: center; font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-font-kerning: none;">图二、中国人寿预警系统</span><span style="font-size: 14px; -webkit-text-stroke-width: initial; line-height: normal; -webkit-font-kerning: none;">——“</span><span style="font-size: 14px; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-font-kerning: none;">响尾蛇</span><span style="font-size: 14px; -webkit-text-stroke-width: initial; line-height: normal; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-font-kerning: none;">智能预警系统</span></p><p style="text-align: center; font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-font-kerning: none;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC Semibold'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="line-height: normal; font-family: 'PingFang SC'; -webkit-font-kerning: none; font-size: 14px;"><strong>三、监控的平台化思路</strong></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">监控系统是一个统一的平台，其输入为各种原始监控数据和配置信息，输出为各类业务和告警信息，监控系统负责将输入数据经过处理和计算，输出需要的信息。监控系统平台化架构如下图所示：</span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0); text-align: center;"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">图三、监控系统的平台化思路</span></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">其中输入的监控数据可通过本地、远程或手工录入的方式获取，配置信息（服务器类别、用途、通知人、联系方式等）从</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">CMDB</span><span style="font-size: 14px; -webkit-font-kerning: none;">获取；输出的信息除发送至短信、邮件系统外，也可以通过</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">REST API</span><span style="font-size: 14px; -webkit-font-kerning: none;">供第三方系统调用，或对接自动化运维平台。</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">平台化架构的优势在于开放。除了监控系统配套的探针传来的数据，也可以通过</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">API</span><span style="font-size: 14px; -webkit-font-kerning: none;">接收合规的第三方的数据，大大拓展了监控平台的业务场景。</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC Semibold'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="line-height: normal; font-family: 'PingFang SC'; -webkit-font-kerning: none; font-size: 14px;"><strong>四、中国人寿的监控选型</strong></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">市场上的监控产品种类繁多，收费的有，开源的也有。中国人寿根据自身特点，结合长期的运维经验，走出了最适合自身的一条监控选型道路。</span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"><br></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">基础环境监控方面，我们选用了</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">zabbix</span><span style="font-size: 14px; -webkit-font-kerning: none;">。众所周知，在开源的服务器和网络监控产品中，</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">zabbix</span><span style="font-size: 14px; -webkit-font-kerning: none;">是较为突出的一个。它具有自主发现服务器、分布式监控、可视化配置等功能。同时</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">zabbix</span><span style="font-size: 14px; -webkit-font-kerning: none;">社区会员众多，一般的问题都可以直接解决。同时，我们针对</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">zabbix</span><span style="font-size: 14px; -webkit-font-kerning: none;">进行了二次开发，增加了诸如统一告警页面、对接</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">cmdb</span><span style="font-size: 14px; -webkit-font-kerning: none;">、对接云助理（一款内部办公软件）等功能。目前</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">zabbix</span><span style="font-size: 14px; -webkit-font-kerning: none;">已接入近万台服务器，为中国人寿基础环境稳定运行提供监控保障。</span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">安全监控方面，我们采用了</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ELK</span><span style="font-size: 14px; -webkit-font-kerning: none;">技术栈对大量的安全设备日志进行统一采集和管理。</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ELK</span><span style="font-size: 14px; -webkit-font-kerning: none;">是</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ElasticSearch</span><span style="font-size: 14px; -webkit-font-kerning: none;">、</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">Logstash</span><span style="font-size: 14px; -webkit-font-kerning: none;">、</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">Kibana</span><span style="font-size: 14px; -webkit-font-kerning: none;">三款开源系统的统称，其一般作为套件统一使用，提供日志检索服务。作为国内市值最大的保险集团，我们每天都会受到大量的外部网络攻击，部署的安全设备每天会生成大量的防护日志。因为品牌不同，日志格式不一致，监控界面也不尽相同。因此，我们以</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ELK</span><span style="font-size: 14px; -webkit-font-kerning: none;">为核心，将分布在各品牌安全设备中的日志统一收集，统一展现，统一管理，提高了公司整体的安全防护能力。</span></span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0TA0UR8RhNsTYmiba4ERARHuzAIiayczrY1sCiaicMsXZ6947jXpvO8ROzicQ/0?wx_fmt=jpeg" style="width: 415px !important; height: 197px !important;"></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">图四、中国人寿安全监控</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">——“</span><span style="font-size: 14px; -webkit-font-kerning: none;">大黄蜂</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; -webkit-font-kerning: none;">安全监控</span></span></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">应用监控方面，针对不同的业务场景，我们选用了两套不同的方案。对于运维人员，我们采用了和安全监控相同的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ELK</span><span style="font-size: 14px; -webkit-font-kerning: none;">方案，并在此基础上增加了</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">Filebeat</span><span style="font-size: 14px; -webkit-font-kerning: none;">作为</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">agent</span><span style="font-size: 14px; -webkit-font-kerning: none;">，采集应用系统的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">access log</span><span style="font-size: 14px; -webkit-font-kerning: none;">和</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">server log</span><span style="font-size: 14px; -webkit-font-kerning: none;">，并根据统一模板定制展示。</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">ElasticSearch</span><span style="font-size: 14px; -webkit-font-kerning: none;">强大的实时搜索能力可在毫秒内搜索上亿的业务日志信息，为告警和展现提供强有力的引擎支撑。同时，我们也自开发了远程采集接口，可以做到无</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">agent</span><span style="font-size: 14px; -webkit-font-kerning: none;">监控，减少对被管机的压力。</span></span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0T90VHxOdhttjIDiaMcbSWqefBophIFibNXAAVfLlNjhT0RLssSeqrvHAA/0?wx_fmt=jpeg" style="width: 415px !important; height: 248px !important;"></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">图五、中国人寿应用监控</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">——“</span><span style="font-size: 14px; -webkit-font-kerning: none;">全球鹰</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; -webkit-font-kerning: none;">应用监控（应用监控界面）</span></span></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">针对业务管理人员，我们自开发了业务监控系统，展现渠道保费、区域分布、用户数量、访问量等信息，便于管理层实时决策；同时大屏监控系统在每年开门红期间（保险业的</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">“</span><span style="font-size: 14px; -webkit-font-kerning: none;">双十一</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; -webkit-font-kerning: none;">）提供强大的业务决策支撑。</span></span></p><p style="font-size: 12px; line-height: normal; font-family: Helvetica; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;"></span></p><p style="text-align: center;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/8XkvNnTiapOMgiaTASDvoPZ08SzzD4hp0Tzsibal4UsekX49foSYVWATUUeAHmoSO1dnqmWJScgveGdicrxfjicZ9jw/0?wx_fmt=jpeg" style="width: 415px !important; height: 217px !important;"></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;">图六、中国人寿应用监控</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">——“</span><span style="font-size: 14px; -webkit-font-kerning: none;">全球鹰</span><span style="font-size: 14px; line-height: normal; font-family: Helvetica; -webkit-font-kerning: none;">”</span><span style="font-size: 14px; -webkit-font-kerning: none;">应用监控（业务监控界面）</span></span></p><p style="text-align: center; font-size: 10.5px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="font-size: 14px;"><span style="font-size: 14px; -webkit-font-kerning: none;"><br></span></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC Semibold'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="line-height: normal; font-family: 'PingFang SC'; -webkit-font-kerning: none; font-size: 14px;"><strong>五、结语</strong></span></p><p style="text-indent: 24px; font-size: 12px; line-height: normal; font-family: 'PingFang SC'; -webkit-text-stroke-width: initial; -webkit-text-stroke-color: rgb(0, 0, 0);"><span style="-webkit-font-kerning: none; font-size: 14px;">监控的目的是更早、更准确地预测及发现系统故障，为运维人员争取恢复时间。同时针对保险行业，监控系统也被赋予了安全监测、实时业务展现和智能预警等功能。不论是开源还是商业产品，在引入前都必须针对保险行业的特殊性进行本地化改造，打破单监控产品的壁垒，形成统一的体系。</span></p><p><br></p><p style="text-align: center;"><strong style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; text-align: center; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;">参考阅读</span></strong></p><p style="text-align: left;"><span style="-webkit-font-kerning: none; font-size: 14px; text-decoration: underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548916&amp;idx=1&amp;sn=ed50fae989b08eed3b9a5c754fa70b23&amp;chksm=813a60ecb64de9fa825c48af4f2036dc4d4f260327c7348ed1559bdeb87572bb86e1e85be9c3&amp;scene=21#wechat_redirect" target="_blank" style="-webkit-font-kerning: none; font-size: 14px; text-decoration: underline;">基于Falcon的滴滴内部监控系统</a></span></p><p style="text-align: left;"><span style="font-size: 14px; text-decoration: underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653547643&amp;idx=1&amp;sn=c06dc9b0f59e8ae3d2f9feb734da4459&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 14px; text-decoration: underline;">Mercury:唯品会全链路应用监控系统解决方案详解(含PPT)</a></span><br></p><p style="text-align: left;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=405484332&amp;idx=1&amp;sn=3c68a053ab3ef82f27c29a9ba942507b&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 14px; text-decoration: underline;"><span style="font-size: 14px;">小米开源监控系统OpenFalcon应对高并发7种手段</span></a><br></p><p style="text-align: left;"><span style="font-size: 14px; text-decoration: underline;"><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=207497106&amp;idx=1&amp;sn=dcd2196078c40f0eec268638de2b0b0d&amp;scene=21#wechat_redirect" target="_blank" style="font-size: 14px; text-decoration: underline;">看大众点评如何通过实时监控系统CAT打造7*24服务</a></span><br></p><p style="text-align: left;"><br></p><p style="text-align: left;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: pre-wrap; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">高可用架构</strong></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: pre-wrap; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">改变互联网的构建方式</strong></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; line-height: 25.6px; white-space: pre-wrap; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz/8XkvNnTiapOPOK9rQud9XibGhPOPsA3gA8Wr4CEnzmhfZQzSGu0Q09GOuk18S9icZtuVnQewvyqZtOWyDnJPBDn1A/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 200px !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></strong></span><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">长按二维码 关注「高可用架构」公众号</span></p><p style="text-align: left;"><br></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1503366004&src=3&ver=1&signature=OYewMZH60kmig22U24i7m9KATgmqVaMHgld42a4AbVw*ZdsI-1U0VHgIZB8eM2c5t*lRBBWGes32Ij-wSvxIugG3eQsqOI2-gs8NzrzHfL-mu2sM1ZyTbd9bmd2C02aKkyXgbt3BPDoS9sgL4nbPYO0GL3vrITVSEMbT*Xa*f7M=">微信地址</a>
{% endraw  %}

