---
title: Protobuf有没有比JSON快5倍？用代码来击破pb性能神话
author: 陶文
date: '2017-03-31 00:00:00 +0000'

---

{% raw  %}
<p><span style="font-size: 14px; color: rgb(136, 136, 136);">导读：Google 的 Protocol Buffers 在数据编码的效率上似乎被神化了，一直流传性能是 JSON 等本文格式 5 倍以上，本文通过代码测试来比较 JSON 与 PB 具体的性能差别到底是多少。作者陶文，转载请注明来自高可用架构「ArchNotes」</span></p><p><br></p><blockquote><p><img src="/ArchNotes/images/b22900978c27ff578fc31c985c2995b837f55c3f.png" style="float: left; width: 109px !important; height: 107px !important; visibility: visible !important;"><span style="font-size: 14px;">陶文，技术极简主义者。认为好的技术是应该是对开发者友好的。一直致力于用技术改进研发效率和开发者体验。jsoniter [4] 作者，jsoniter 就来自于要不要用 Thrift 替代 JSON 的思考。我认为通过引入 IDL 和高效率的编解码库，可以让 HTTP + JSON 这样对开发者体验有好处的技术长久地生存下去。</span></p></blockquote><p><br></p><p>拿 JSON 衬托 Protobuf 的文章真的太多了，经常可以看到文章中写道：“快来用 Protobuf 吧，JSON 太慢啦”。但是 Protobuf 真的有那么牛么？我想从 JSON 切换到 Protobuf 怎么也得快一倍吧，要不然对不起付出的切换成本？</p><p><br></p><p>然而，DSL-JSON 居然声称在 Java 语言里， JSON 可以和那些二进制的编解码格式性能不相上下 [1]！</p><p><br></p><p>这太让人惊讶了！虽然你可能会说，咱们能不用苹果和梨来做比较了么，两个东西根本用途完全不一样，用 Protobuf 是冲着跨语言无歧义的 IDL 的去的，才不仅仅是因为性能！这个我同意，但是仍然有那么多人盲目相信 Protobuf 一定会快很多，因此我觉得还是有必要通过本文彻底终结一下这个关于速度的传说。</p><p><br></p><p>DSL-JSON 的博客里只给了他们的测试结论，但是没有给出任何原因，以及优化的细节。这很难让人信服数据是真实的。你要说 JSON 比二进制格式更快，真的是很<strong>反直觉</strong>的事情。稍微琢磨一下这个问题，就可以列出好几个 Protobuf 应该更快的理由：</p><p><span class=""><br></span></p><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">更容容易绑定值到对象的字段上。JSON 的字段是用字符串指定的，相比之下字符串比对应该比基于数字的字段 tag 更耗时。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">JSON 是文本的格式，整数和浮点数应该更占空间而且更费时。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Protobuf 在正文前有一个大小或者长度的标记，而 JSON 必须全文扫描无法跳过不需要的字段。</span></p></li></ul><p><span class=""><br></span></p><p><span class="">但是仅凭这几点是不是就可以盖棺定论了呢？未必，也有相反的观点：</span></p><p><inherit style="display: block;"><br></inherit></p><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p>如果字段大部分是字符串，<strong>占到决定性因素的因素可能是字符串拷贝的速度，而不是解析的速度</strong>。在这个评测 [2] 中，我们看到不少库的性能是非常接近的。这是因为测试数据中大部分是由字符串构成的。</p></li><li><p><strong>影响解析速度的决定性因素是分支的数量</strong>。因为分支的存在，解析仍然是一个本质上串行的过程。虽然 Protobuf 里没有 [] 或者 {}，但是仍然有类似的分支代码的存在。如果没有这些分支的存在，解析不过就是一个 memcpy 的操作而已。只有 Parabix 这样的技术才有革命性的意义，而 Protobuf 相比 JSON 只是改良而非革命。</p></li><li><p>也许 Protobuf 是一个理论上更快的格式，但是实现它的库并不一定就更快。这取决于优化做得好不好，如果有不必要的内存分配或者重复读取，实际的速度未必就快。</p></li></ul><p><br></p><p>有多个 benchmark 都把 DSL-JSON 列到前三名里，有时甚至比其他的二进制编码更快。经过我仔细分析，<strong>原因出在了这些 benchmark 对于测试数据的构成选择上</strong>。因为构造测试数据很麻烦，所以一般评测只会对相同的测试数据，去测不同的库的实现。这样就使得结果是严重倾向于某种类型输入的。比如 <span style="color:#607fa6">[3]</span>&nbsp;选择的测试数据的结构是这样的</p><p><br></p><p><span class=""></span></p><p><img src="/ArchNotes/images/10be1f989eb79aa459c14112b12803a26ae33a90.png" style="width: 674px !important; height: 991px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px;">点击图片可以放大浏览</span></p><p><br></p><p><span class="">无论怎么去构造 small/medium/large 的输入，benchmark 仍然是存在特定倾向性的。而且这种倾向性是不明确的。比如 medium 的输入，到底说明了什么？medium 对于不同的人来说，可能意味着完全不同的东西。所以，在这里我想改变一下游戏的规则。不去选择一个所谓的最现实的配比，而是构造一些</span><span class=""><strong>极端的情况</strong></span><span class="">。这样，我们可以一目了然的知道，JSON 的强项和弱点都是什么。通过把这些缺陷放大出来，我们也就可以对最坏的情况有一个清晰的预期。具体在你的场景下性能差距是怎样的一个区间内，也可以大概预估出来。</span></p><p><span class=""><br></span></p><p><span class="">好了，废话不多说了。JMH 撸起来。benchmark 的对象有以下几个：</span></p><p><span class=""><br></span></p><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Jackson：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/FasterXML/jackson-databind</a></span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">&nbsp;</a></span><span class="">Java 程序里用的最多的 JSON 解析器。benchmark 中开启了 AfterBurner 的加速特性。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">DSL-JSON：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/ngs-doo/dsl-json</a></span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">&nbsp;</a></span><span class="">世界上最快的 Java JSON 实现</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Jsoniter：&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">http://jsoniter.com/index.cn.html</a></span><span class="" style="font-size: 11pt;">&nbsp;&nbsp;</span><span class="">我抄袭 DSL-JSON 写的实现。</span><span class=""><strong>特别申明：我是 Jsoniter 的作者。这里提到的所有关于Jsoniter 的评测数据都不应该被盲目相信</strong></span><span class="">。大部分的性能优化技巧是从 DSL-JSON 中直接抄来的。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Fastjson：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/alibaba/fastjson</a></span><span class="">&nbsp;在中国很流行的 JSON 解析器</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Protobuf：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/google/protobuf</a></span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">&nbsp;</a></span><span class="">在 RPC （远程方法调用）里非常流行的二进制编解码格式</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">Thrift：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://thrift.apache.org</a></span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">&nbsp;</a></span><span class="">另外一个很流行的 RPC 编解码格式。这里 benchmark 的是 TCompactProtocol</span></p></li></ul><p><inherit><br></inherit><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Integer</span></inherit></p><p><span class=""><br></span></p><p><span class="">先从一个简单的场景入手。毫无疑问，Protobuf 非常擅长于处理整数</span></p><p><br></p><p><img src="/ArchNotes/images/9e8490ade05822f62472e82d4caa1ab96683b958.png" style="width: 656px !important; height: 109px !important;"></p><p><br></p><p><a>https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_int</a></p><p><br></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">8.20</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">22124.431</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.6</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">27232.761</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.45</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">28131.009</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">4.48</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">40472.032</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">86555.965</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">181357.349</td></tr></tbody></table><p><br></p><p>从结果上看，似乎优势非常明显。但是因为只有 1 个整数字段，所以可能整数解析的成本没有占到大头。所以，我们把测试调整对象调整为 10 个整数字段。再比比看</p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/83ebde59cfa1c7da208139e923ec7bef2dfa2d19.png" style="width: 663px !important; height: 375px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p><a>https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_int_fields</a></p><p><br></p><p><br></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">8.51</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">71067.990</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.98</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">202921.616</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">187654.012</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.43</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">422839.151</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.4</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">432494.654</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">604894.752</td></tr></tbody></table><p><br></p><p><span class="">这下优势就非常明显了。毫无疑问，</span><span class=""><strong>Protobuf 解析整数的速度是非常快的，能够达到 Jackson 的 8 倍</strong></span><span class="">。</span></p><p><span class=""><br></span></p><p><span class="">DSL-JSON 比 Jackson 快很多，它的优化代码在这里</span></p><p><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;"><br></a></span></p><p><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p><br></p><p><img src="/ArchNotes/images/c395e42b32d939e89f7f15a1069652e400ac8352.png" style="width: 661px !important; height: 469px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>整数是直接从输入的字节里计算出来的，公式是&nbsp;value = (value &lt;&lt; 3) + (value &lt;&lt; 1) + ind;&nbsp;相比读出字符串，然后调用&nbsp;Integer.valueOf&nbsp;，这个实现只遍历了一遍输入，同时也避免了内存分配。</p><p><br></p><p><a>Jsoniter</a>&nbsp;在这个基础上做了循环展开</p><p><br></p><p><img src="/ArchNotes/images/473212b71f464081b242b4811d8d2edc8ed93fc2.png" style="width: 658px !important; height: 472px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Integer</span></inherit></p><p><span class=""><br></span></p><p><span class="">编码方面情况如何呢？和编码一样的测试数据，测试结果如下：</span></p><p><span class=""><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.9</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">121027.285</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.17</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2128221.323</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.02</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">173912.732</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.18</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">161038.645</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.81</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">431348.853</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">351430.048</td></tr></tbody></table><p><br></p><p><span class="">不知道为啥，Thrift 的序列化特别慢。而且别的 benchmark 里 Thrift 的序列化都是算慢的。我猜测应该是实现里有不够优化的地方吧，格式应该没问题。</span><span class=""><strong>整数编码方面，Protobuf 是 Jackson 的 3 倍。</strong></span><span class="">但是和 DSL-JSON 比起来，好像没有快很多。</span></p><p><span class=""><br></span></p><p><span class="">这是因为 DSL-JSON 使用了自己的优化方式，和 JDK 的官方实现不一样</span></p><p><br></p><p><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/f992608ad55ec91ead913ac3e8dc70051d15361a.png" style="width: 662px !important; height: 1114px !important;"></p><p style="text-align: center;"><span class=""></span><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>这段代码的意思是比较令人费解的。不知道哪里就做了数字到字符串的转换了。过程是这样的，假设输入了19823，会被分解为 19 和 823 两部分。然后有一个 `DIGITS` 的查找表，根据这个表把 19 翻译为 "19"，把 823 翻译为 "823"。其中 "823" 并不是三个byte分开来存的，而是把 bit 放到了一个integer里，然后在 writeBuf 的时候通过位移把对应的三个byte解开的<br></p><p><br></p><p><img src="/ArchNotes/images/0c074fdcaaea4e477e5bd16ad0bb73edf4129898.png" style="width: 655px !important; height: 179px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>这个实现比 JDK 自带的 Integer.toString 更快。因为查找表预先计算好了，节省了运行时的计算成本。</p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Double</span></inherit></p><p><span class=""><br></span></p><p><span class="">解析 JSON 的 Double 就更慢了。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/f9112715bbc6f0e31a3d7e2f9cfd34fb438ee0c9.png" style="width: 666px !important; height: 322px !important;"></p><p style="text-align: center;"><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></a></p><p style="text-align: center;"><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></a></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_double_fields</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">13.75</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">92447.958</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">7.30</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">174052.307</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">4.2</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">302453.323</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (base64)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.25</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">390812.895</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.53</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">502287.602</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.2</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1055454.855</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1271311.735</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 解析 double 是 Jackson 的 13 倍。</strong></span><span class="">毫无疑问，JSON 真的不适合存浮点数。</span></p><p><span class=""><br></span></p><p><span class="">DSL-Json 中对 Double 也是做了特别优化的&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/NumberConverter.java</a></span></p><p><br></p><p><img src="/ArchNotes/images/8f43344576057f3d26dbad5dbe49e3a66901714a.png" style="width: 655px !important; height: 805px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>浮点数被去掉了点，存成了 long 类型，然后再除以对应的 10 的倍数。如果输入是 3.1415，则会变成 31415/10000。</p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Double</span></inherit></p><p><span class=""><br></span></p><p><span class="">把 double 编码为文本格式就更困难了。</span></p><p><span class=""><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">12.71</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">143346.157</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.87</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2093533.015</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (6 digits)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.5</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">280252.226</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (base64)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.68</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">272843.205</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.23</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1483965.621</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.06</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1722392.219</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1822478.053</td></tr></tbody></table><p><br></p><p><span class=""><strong>解码 double 的时候，Protobuf 是 Jackson 的 13 倍。</strong></span><span class="">如果你愿意牺牲精度的话，</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;可以选择只保留 6 位小数。在这个取舍下，可以好一些，但是 Protobuf 仍然是&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;的两倍。</span></p><p><span class=""><br></span></p><p><span class="">保留 6 位小数的代码是这样写的。把 double 的处理变成了长整数的处理。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/0401270a748e675ef5b9daf9d09bbe1872a8c43a.png" style="width: 670px !important; height: 682px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>到目前来看，我们可以说 JSON 不是为数字设计的。如果你使用的是 Jackson，切换到 Protobuf 的话可以把数字的处理速度提高 10 倍。然而 DSL-Json 做的优化可以把这个性能差距大幅缩小，解码在 3x ~ 4x 之间，编码在 1.3x ~ 2x 之间（前提是牺牲 double 的编码精度）。</p><p><br></p><p><span class="">因为 JSON 处理 double 非常慢。所以&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;提供了一种把 double 的 IEEE 754 的二进制表示（64个bit）用 base64 编码之后保存的方案。如果希望提高速度，但是又要保持精度，可以使用&nbsp;</span>Base64FloatSupport.enableEncodersAndDecoders();</p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/e945565253c0eb23df9a846986a4e61cae43fb33.png" style="width: 658px !important; height: 637px !important;"></p><p style="text-align: center;"><span class=""></span><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>对于 0.123456789 就变成了 "OWNfmt03P78"<br></p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Object</span></inherit></p><p><span class=""><br></span></p><p><span class="">我们已经看到了 JSON 在处理数字方面的笨拙丑态了。在处理对象绑定方面，是不是也一样不堪？前面的 benchmark 结果那么差和按字段做绑定是不是有关系？毕竟我们有 10 个字段要处理那。这就来看看在处理字段方面的效率问题。</span></p><p><span class=""><br></span></p><p><span class="">为了让比较起来公平一些，我们使用很短的 ascii 编码的字符串作为字段的值。这样字符串拷贝的成本大家都差不到哪里去。所以性能上要有差距，必然是和按字段绑定值有关系。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/7bb3a888205fa9d2239d017c170457d60d9561ab.png" style="width: 653px !important; height: 112px !important;"><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_1_string_field</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.52</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">68666.658</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.74</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">63139.324</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.78</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">29887.361</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.32</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">32458.030</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.71</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">101107.721</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">172747.146</td></tr></tbody></table><p><br></p><p><span class=""><strong>如果只有一个字段，Protobuf 是 Jackson 的 2.5 倍。</strong></span><span class="">但是比 DSL-JSON 要慢。</span></p><p><span class=""><br></span></p><p><span class="">我们再把同样的实验重复几次，分别对应 5 个字段，10个字段的情况。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/c9af240b9c1d344010732b09cbcac1886d07e886.png" style="width: 651px !important; height: 203px !important;"></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_5_string_fields</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.3</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">276972.857</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.44</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">250016.572</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.5</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">143807.401</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.41</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">149261.728</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.39</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">259296.397</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">359868.351</td></tr></tbody></table><p><br></p><p><span class=""><strong>在有 5 个字段的情况下，Protobuf 仅仅是 Jackson 的 1.3x 倍。</strong></span><span class="">如果你认为 JSON 对象绑定很慢，而且会决定 JSON 解析的整体性能。对不起，你错了。</span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/3de4735b3ee7eec759512f6f0eb80791e67922e2.png" style="width: 654px !important; height: 317px !important;"></p><p><br></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_10_string_fields</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">462167.920</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.12</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">503725.605</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.04</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">277531.128</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.84</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">307569.103</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.18</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">477492.445</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">564942.726</td></tr></tbody></table><p><br></p><p><span class=""><strong>把字段数量加到了 10 个之后，Protobuf 仅仅是 Jackson 的 1.22 倍了。</strong></span><span class="">看到这里，你应该懂了吧。</span></p><p><span class=""><br></span></p><p><span class="">Protobuf 在处理字段绑定的时候，用的是 switch case：</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/f3c17c51640a1d0f5962a6553a52baded20f7d71.png" style="width: 665px !important; height: 991px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>这个实现比 Hashmap 来说，仅仅是稍微略快而已。DSL-JSON 的实现是先 hash，然后也是类似的分发的方式：</p><p><br></p><p><img src="/ArchNotes/images/eb447f0ff494da55d9cfdb394491480d15be6068.png" style="width: 657px !important; height: 759px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>使用的 hash 算法是 FNV-1a。</p><p><br></p><p><img src="/ArchNotes/images/13b3e608b1b8e7b0b4bc491d3b8ec01460b2bbc8.png" style="width: 649px !important; height: 199px !important;"></p><p><br></p><p><span class="">是 hash 就会碰撞，所以用起来需要小心。如果输入很有可能包含未知的字段，则需要放弃速度选择匹配之后再查一下字段是不是严格相等的。</span><span class=""><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;有一个解码模式&nbsp;</span></p><p>DYNAMIC_MODE_AND_MATCH_FIELD_STRICTLY，它可以产生下面这样的严格匹配的代码：<br></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/f1216827f6d30f84de5b0401f19dc3a8fa102417.png" style="width: 663px !important; height: 770px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>即便是严格匹配，速度上也是有保证的。DSL-JSON 也有选项，可以在 hash 匹配之后额外加一次字符串 equals 检查。</p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (hash mode)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.13</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">274949.346</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (strict mode)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.95</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">300524.989</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON (hash mode)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.91</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">305812.208</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON (strict mode)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">1.71</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">343203.344</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">585421.314</td></tr></tbody></table><p><br></p><p><span class="">关于对象绑定来说，只要字段名不长，基于数字的 tag 分发并不会比 JSON 具有明显优势，即便是相比最慢的 Jackson 来说也是如此。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Object</span></inherit></p><p><span class=""><br></span></p><p><span class="">废话不多说了，直接比较一下三种字段数量情况下，编码的速度</span></p><p><span class="" style="font-size: 11pt;">只有 1 个字段</span></p><p><span class="" style="font-size: 11pt;"><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">57502.775</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.86</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">137094.627</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.06</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">57081.756</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.46</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">47890.664</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.92</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">127421.715</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">117604.479</td></tr></tbody></table><p><br></p><p><span class="">有 5 个字段&nbsp;</span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.68</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">127933.179</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.46</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">467818.566</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.54</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">84702.001</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.68</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">80211.517</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.98</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">219373.346</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">214802.686</td></tr></tbody></table><p><br></p><p><span class="">有 10 个字段</span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.72</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">194371.476</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.38</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">888230.783</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.59</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">129305.086</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.56</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">130379.967</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.06</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">315267.365</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">334297.953</td></tr></tbody></table><p><br></p><p><span class=""><strong>对象编码方面，Protobuf 是 Jackson 的 1.7 倍。</strong></span><span class="">但是速度其实比 DSL-Json 还要慢。</span></p><p><span class=""><br></span></p><p><span class="">优化对象编码的方式是，一次性尽可能多的把控制类的字节写出去。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/d3b1d8f00605d0d97e2e7a0807c9e6f5db87e576.png" style="width: 668px !important; height: 498px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>可以看到我们把 "field1": 作为一个整体写出去了。如果我们知道字段是非空的，则可以进一步的把字符串的双引号也一起合并写出去。</p><p><br></p><p><img src="/ArchNotes/images/cdd0cfe39c463b60cb735ef706e73e52891c5e6d.png" style="white-space: normal; width: 657px !important; height: 403px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><br></p><p>从对象的编解码的 benchmark 结果可以看出，Protobuf 在这个方面仅仅比 Jackson 略微强一些，而比 DSL-Json 要慢。<br></p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Integer List</span></inherit></p><p><span class=""><br></span></p><p><span class="">Protobuf 对于整数列表有特别的支持，可以打包存储</span></p><p><span class=""><br></span></p><p><span class=""><img src="/ArchNotes/images/4e810cabbc37118145b7c9bd601b4b16971c165d.png" style="white-space: normal; width: 649px !important; height: 153px !important;"></span></p><p><br></p><p>设置 [packed=true]<br></p><p><br></p><p><img src="/ArchNotes/images/5b7943c90eaac3176f81451b79407c96da894af1.png" style="width: 656px !important; height: 108px !important;"></p><p><br></p><p><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_int_list</a></span></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.92</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">249888.105</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">201439.691</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.97</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">245837.298</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.97</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">370897.998</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.89</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">820099.921</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">730450.607</td></tr></tbody></table><p><br></p><p><span class=""><strong>对于整数列表的解码，Protobuf 是 Jackson 的 3 倍。</strong></span><span class="">然而比 DSL-Json 的优势并不明显。</span></p><p><span class=""><br></span></p><p><span class="">在&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;里，解码的循环被展开了：</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/de9a54ab7719e247928d2665bfe922f3ae33f106.png" style="width: 669px !important; height: 1259px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>对于成员比较少的情况，这样搞可以避免数组的扩容带来的内存拷贝。<br></p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Integer List</span></inherit></p><p><span class=""><br></span></p><p><span class="">Protobuf 在编码数组的时候应该有优势，不用写那么多逗号出来嘛。</span></p><p><span class=""><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.35</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">159337.360</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.45</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">472555.572</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.9</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">112770.811</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.19</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">97998.250</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.66</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">323194.122</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">214409.223</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 在编码整数列表的时候，仅仅是 Jackson 的 1.35 倍。</strong></span><span class="">虽然 Protobuf 在处理对象的整数字段的时候优势明显，但是在处理整数的列表时却不是如此。在这个方面，DSL-Json 没有特殊的优化，性能的提高纯粹只是因为单个数字的编码速度提高了。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Object List</span></inherit></p><p><span class=""><br></span></p><p><span class="">列表经常用做对象的容器。测试这种两种容器组合嵌套的场景，也很有代表意义。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/aded4fbcf979240db54352e58fa0c05b67f07727.png" style="width: 660px !important; height: 172px !important;"></p><p><br></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_object_list</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.26</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1118704.310</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.3</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1078278.555</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.91</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">483304.365</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">635179.183</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.12</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1260390.104</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1407116.476</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 处理对象列表是 Jackson 的 1.3 倍。</strong></span><span class="">但是不及 DSL-JSON。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Object List</span></inherit></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px; word-break: break-all;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">328219.768</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.38</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1885052.964</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">200420.923</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.87</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">187964.594</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.85</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">857771.520</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">727582.950</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 处理对象列表的编码速度是 Jackson 的 2 倍。</strong></span><span class="">但是 DSL-JSON 仍然比 Protobuf 更快。似乎 Protobuf 在处理列表的编码解码方面优势不明显。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode Double Array</span></inherit></p><p><span class=""><br></span></p><p><span class="">Java 的数组有点特殊，</span><span class="" style="font-size: 11pt;">double[]</span><span class="">&nbsp;是比&nbsp;</span><span class="" style="font-size: 11pt;">List&lt;Double&gt;</span><span class="">&nbsp;更高效的。使用 double 数组来代表时间点上的值或者坐标是非常常见的做法。然而，Protobuf 的 Java&nbsp; 库没有提供&nbsp;</span><span class="" style="font-size: 11pt;">double[]</span><span class="">&nbsp;的支持，repeated 总是使用&nbsp;</span><span class="" style="font-size: 11pt;">List&lt;Double&gt;</span><span class="">。我们可以预期 JSON 库在这里有一定的优势。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/fea138582711fa6f51293cc31567ea523338893e.png" style="width: 650px !important; height: 108px !important;"></p><p><br></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_double_array</a></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.18</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">207503.316</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.12</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">175678.703</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">4.83</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">222818.772</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (base64)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">296262.142</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.8</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">383549.289</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.58</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1866460.535</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1075423.265</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 在处理 double 数组方面，Jackson 与之的差距被缩小为 5 倍。</strong></span><span class="">Protobuf 与 DSL-JSON 相比，优势已经不明显了。所以如果你有很多的 double 数值需要处理，这些数值必须是在对象的字段上，才会引起性能的巨大差别，对于数组里的 double，优势差距被缩小。</span></p><p><span class="">在&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;里，处理数组的循环也是被展开的。</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/5338d7c5a74c484034e1e494592870004ddbb568.png" style="width: 675px !important; height: 1086px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>这避免了数组扩容的开销。</p><p><br></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode Double Array</span></inherit></p><p><span class="">再来看看 double 数组的编码</span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">15.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">107760.788</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.54</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3125678.472</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (6 digits)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.74</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">249945.866</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter (base64)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">7.11</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">236991.658</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.14</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1478332.248</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.08</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1562377.465</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1684935.837</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 可以飞快地对 double 数组进行编码，是 Jackson 的 15 倍。</strong></span><span class="">在牺牲精度的情况下，Protobuf 只是&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;的 2.3 倍。所以，再次证明了，JSON 处理 double 非常慢。如果用 base64 编码 double，则可以保持精度，速度和牺牲精度时一样。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Decode String</span></inherit></p><p><span class=""><br></span></p><p><span class="">JSON 字符串包含了转义字符的支持。Protobuf 解码字符串仅仅是一个内存拷贝。理应更快才对。被测试的字符串长度是 160 个字节的 ascii。</span></p><p><span class=""><img src="/ArchNotes/images/0f0fc40ca2014a8c52f5be6169fa66ded05ff18e.png" style="white-space: normal; width: 656px !important; height: 156px !important;"></span></p><p><a style="background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/with_long_string</a><br></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.85</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">173680.548</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.29</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">140635.170</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.4</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">134067.924</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.27</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">141419.108</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.14</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">281061.212</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">321406.155</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 解码长字符串是 Jackson 的 1.85 倍。</strong></span><span class="">然而，DSL-Json 比 Protobuf 更快。这就有点奇怪了，JSON 的处理负担更重，为什么会更快呢？</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">先尝试捷径</span></inherit></p><p><span class=""><br></span></p><p><span class="">DSL-JSON 给 ascii 实现了一个捷径：</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/ngs-doo/dsl-json/blob/master/library/src/main/java/com/dslplatform/json/JsonReader.java</a></span></p><p><img src="/ArchNotes/images/9f5f5e6ce553d86c61e2584d0f647e83c501cd6f.png" style="width: 653px !important; height: 423px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>这个捷径里规避了处理转义字符和utf8字符串的成本。</p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">JVM 的动态编译做了特殊优化</span></inherit></p><p><span class=""><br></span></p><p><span class="">在 JDK9 之前，java.lang.String 都是基于 `char[]` 的。而输入都是&nbsp;</span><span class="" style="font-size: 11pt;">byte[]</span><span class="">&nbsp;并且是 utf-8 编码的。所以这使得，我们不能直接用 memcpy 的方式来处理字符串的解码问题。</span></p><p><span class=""><br></span></p><p><span class="">但是在 JDK9 里，java.lang.String 已经改成了基于`byte[]`的了。从 JDK9 的源代码里可以看出：</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/083e0d021ea1e5d57a6e93f9e6d4899b29c014be.png" style="width: 662px !important; height: 586px !important;"></p><p style="text-align: center;"><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;">点击图片可以放大浏览</span></p><p><span style="color: rgb(136, 136, 136); font-size: 14px; text-align: center;"><br></span></p><p>使用这个虽然被废弃，但是还没有被删除的构造函数，我们可以使用 Arrays.copyOfRange 来直接构造 java.lang.String 了。然而，在测试之后，发现这个实现方式并没有比 DSL-JSON 的实现更快。</p><p><span class=""><br></span></p><p><span class="">似乎 JVM 的 Hotspot 动态编译时对这段循环的代码做了模式匹配，识别出了更高效的实现方式。即便是在 JDK9 使用 +UseCompactStrings 的前提下，理论上来说本应该更慢的 byte[] =&gt; char[] =&gt; byte[] 并没有使得这段代码变慢，DSL-JSON 的实现还是最快的。</span></p><p><span class=""><br></span></p><p><span class="">如果输入大部分是字符串，这个优化就变得至关重要了。Java 里的解析艺术，还不如说是字节拷贝的艺术。JVM 的 java.lang.String 设计实在是太愚蠢了。在现代一点的语言中，比如 Go，字符串都是基于 utf-8&nbsp;</span><span class="" style="font-size: 11pt;">byte[]</span><span class="">&nbsp;的。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">Encode String</span></inherit></p><p><span class=""><br></span></p><p><span class="">类似的问题，因为需要把 char[] 转换为 byte[]，所以没法直接内存拷贝。</span></p><p><span class=""><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.96</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">262077.921</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.99</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">252140.935</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.5</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">166381.978</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.38</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">181008.120</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.74</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">339919.707</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">250431.354</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 在编码长字符串时，比 Jackson 略微快一点点。</strong></span><span class="">一切都归咎于 char[]。</span></p><p><span class=""><br></span></p><p><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">跳过数据结构</span></inherit></p><p><span class=""><br></span></p><p><span class="">JSON 是一个没有 header 的格式。因为没有 header，JSON 需要扫描每个字节才可以定位到所需的字段上。中间可能要扫过很多不需要处理的字段。&nbsp;</span></p><p><span class=""><br></span></p><p><span class=""></span></p><p><img src="/ArchNotes/images/05de5623aec7ad366289bd5974040e41cf4c455d.png" style="width: 653px !important; height: 340px !important;"></p><p><br></p><p><span class="">消息用 PbTestWriteObject 来编码，然后用 PbTestReadObject 来解码。field1 和 field2 的内容应该被跳过。</span></p><p><span class=""><br></span></p><p><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">https://github.com/json-iterator/java-benchmark/tree/master/src/main/java/com/jsoniter/benchmark/skip_multi_levels</a></span></p><p><br></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">库</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">相比 Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">ns/op</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.05</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">152194.483</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Thrift</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.43</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">141467.209</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.75</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">204704.100</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">DSL-JSON</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.51</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">305784.845</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Fastjson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.4</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1949277.734</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jackson</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">768840.597</td></tr></tbody></table><p><br></p><p><span class=""><strong>Protobuf 在跳过数据结构方面，是 Jackson 的 5 倍。</strong></span><span class="">但是如果跳过长的字符串，JSON 的成本是和字符串长度线性相关的，而 Protobuf 则是一个常量操作。</span></p><p><inherit><br></inherit><inherit style="display: block;"><span class="" style="font-size: 18pt !important;">总结</span></inherit></p><p><br></p><p><span class="">最后，我们把所有的战果汇总到一起。</span></p><p><span class=""><br></span></p><p><span class="" style="border-spacing: 0px;"><span class=""></span></span></p><table cellspacing="0" cellpadding="0" width="-59"><thead></thead><tbody><tr><td style="border-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">场景</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf V.S. Jackson</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Protobuf V.S. Jsoniter</td><td style="border-top-color: initial; border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Jsoniter V.S Jackson</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Integer</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">8.51</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.64</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.22</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Integer</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.9</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.44</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.02</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Double</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">13.75</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.27</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">4.2</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Double</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">12.71</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.96 (只保留小数点后6位)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.5</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Object</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.6</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.04</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Object</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.72</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.67</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.59</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Integer List</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.92</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.98</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.97</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Integer List</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.35</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.71</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.9</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Object List</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.26</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.43</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.91</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Object List</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.22</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.61</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.63</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode Double Array</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.18</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.47</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">4.83</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode Double Array</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">15.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.32 (只保留小数点后6位)</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">6.74</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Decode String</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.85</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.77</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">2.4</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Encode String</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.96</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">0.63</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.5</td></tr><tr><td style="border-top-color: rgb(204, 204, 204); border-left-color: initial; border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">Skip Structure</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">5.05</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">1.35</td><td style="border-top-color: rgb(204, 204, 204); border-left-color: rgb(204, 204, 204); border-right-color: initial; border-bottom-color: initial; min-width: 50px; line-height: 16px; padding: 0px 4px;" height="22">3.75</td></tr></tbody></table><p><br></p><p><inherit style="display: block;"><br></inherit></p><p><inherit style="display: block;"><span class="" style="   display: block; width: 613px; min-height: 60px; border-width: 1px; border-style: solid; border-color: transparent; text-align: inherit; "><img src="/ArchNotes/images/ecff63d43adf9300df54149abad7d5a995efc227.png" style="border-width: 0px; border-style: initial; border-color: initial; cursor: pointer; width: 610px !important; height: 406.031px !important;"></span></inherit></p><p><span class=""><br></span></p><p><span class="">编解码数字的时候，JSON 仍然是非常慢的。</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter</a></span><span class="">&nbsp;把这个差距从 10 倍缩小到了 3 倍多一些。</span></p><p><span class=""><br></span></p><p><span class="">JSON 最差的情况是下面几种：</span></p><p><span class=""><br></span></p><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">跳过非常长的字符串：和字符串长度线性相关。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">解码 double 字段：Protobuf 优势明显，是&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter&nbsp;</a></span><span class="">的 3.27 倍，是 Jackson 的 13.75 倍。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">编码 double 字段：如果不能接受只保留 6 位小数，Protobuf 是 Jackson 的 12.71 倍。如果接受精度损失，Protobuf 是&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter&nbsp;</a></span><span class="">的 1.96 倍。</span></p></li></ul><ul class="list-paddingleft-2" style="padding-left: 2em; list-style-position: initial; list-style-image: initial; outline: none;"><li><p><span class="">解码整数：Protobuf 是&nbsp;</span><span class=""><a style="background: transparent; outline: none; color: rgb(112, 177, 231); cursor: pointer !important;">Jsoniter&nbsp;</a></span><span class="">的 2.64 倍，是 Jackson 的 8.51 倍。</span></p></li></ul><p><br></p><p><inherit style="display: block;"><span class="" style="   display: block; width: 613px; min-height: 60px; border-width: 1px; border-style: solid; border-color: transparent; text-align: inherit; font-size: 11pt; "><img src="/ArchNotes/images/0e6474822642844b1903214e2d66822a9d453c40.png" style="border-width: 0px; border-style: initial; border-color: initial; cursor: pointer; width: 610px !important; height: 527.336px !important;"></span></inherit></p><p><span class=""><br></span></p><p>如果你的生产环境中的 JSON 没有那么多的 double 字段，都是字符串占大头，那么基本上来说替换成 Protobuf 也就是仅仅比&nbsp;<a>Jsoniter</a>&nbsp;提高一点点，肯定在 2 倍之内。如果不幸的话，没准 Protobuf 还要更慢一点。</p><p><br></p><p>相关链接</p><p><br></p><ol class="list-paddingleft-2" style="list-style-type: decimal;"><li><p><a style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">https://blog.dsl-platform.com/improving-java-json-speed/</span></a><span style="font-size: 14px; color: rgb(0, 82, 255);">&nbsp;</span></p></li><li><p><a style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">https://github.com/fabienrenaud/java-json-benchmark</span></a><span style="font-size: 14px; color: rgb(0, 82, 255);">&nbsp;</span></p></li><li><p><a style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">https://github.com/eishay/jvm-serializers/wiki</span></a></p></li><li><p><a style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">http://jsoniter.com/index.cn.html</span></a></p></li></ol><p><br></p><p style="max-width: 100%; min-height: 1em; background-color: rgb(255, 255, 255); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 20px; box-sizing: border-box !important; word-wrap: break-word !important;">推荐阅读</span></strong></p><p style="max-width: 100%; min-height: 1em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><ul class="list-paddingleft-2" style="max-width: 100%; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548459&amp;idx=1&amp;sn=8c7b328b79b4ea34ce5c2f6234972818&amp;chksm=813a7e33b64df725a7eb72088b6e22734af859e70a5b6f864ffef41b54c07ebfe3bbf7646eba&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548459&amp;idx=1&amp;sn=8c7b328b79b4ea34ce5c2f6234972818&amp;chksm=813a7e33b64df725a7eb72088b6e22734af859e70a5b6f864ffef41b54c07ebfe3bbf7646eba&amp;scene=21#wechat_redirect" style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">模块化还是微服务 - 为什么说大部分团队微服务化都走入了陷阱</span></a></p></li><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548455&amp;idx=1&amp;sn=cf94a1414e51441ca9a89d45ddf6856a&amp;chksm=813a7e3fb64df72956c9a3af10572314d7e8abbbc8a0a0d21d1db2a4a10d03c4d916ca7be4a5&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548455&amp;idx=1&amp;sn=cf94a1414e51441ca9a89d45ddf6856a&amp;chksm=813a7e3fb64df72956c9a3af10572314d7e8abbbc8a0a0d21d1db2a4a10d03c4d916ca7be4a5&amp;scene=21#wechat_redirect" style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">容器与持久化存储:容器的开源分布式存储方案选型</span></a></p></li><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548432&amp;idx=1&amp;sn=ac120e1ffca7c2007c0bc5df51e03d7b&amp;chksm=813a7e08b64df71ec7b8b6afc2a36a8ff1d780db54a395b58a9f18f084080c09de514e999834&amp;scene=21#wechat_redirect" target="_blank" data_ue_src="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548432&amp;idx=1&amp;sn=ac120e1ffca7c2007c0bc5df51e03d7b&amp;chksm=813a7e08b64df71ec7b8b6afc2a36a8ff1d780db54a395b58a9f18f084080c09de514e999834&amp;scene=21#wechat_redirect" style="text-decoration: underline; font-size: 14px; color: rgb(0, 82, 255);"><span style="font-size: 14px; color: rgb(0, 82, 255);">Redis架构之防雪崩设计：网站不宕机背后的兵法</span></a><br></p></li></ul><p style="max-width: 100%; min-height: 1em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(136, 136, 136); font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><br></span></p><p style="max-width: 100%; min-height: 1em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(136, 136, 136); font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">本文作者陶文，转载请注明出处，技术原创及架构实践文章，欢迎通过公众号菜单「联系我们」进行投稿。</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; color: rgb(136, 136, 136); font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">高可用架构</strong></span></p><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">改变互联网的构建方式</strong></span></p><p style="max-width: 100%; min-height: 1em; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="/ArchNotes/images/f6d330d516dce1ccc8afa78eadcccb86f8851363.jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 200px !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></strong></span><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">长按二维码 关注「高可用架构」公众号</span></p>
{% endraw  %}

