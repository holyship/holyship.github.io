---
title: 爬虫工程师如何绕过验证码？寻找阿登高地之路
author: 候克雷
wechat_source: >-
  http://mp.weixin.qq.com/s?timestamp=1502116814&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAnUULkvryB4DXbE6sTjTCTqAU6Wo3FeIV0BwKDpBDcxRzySp9S3gfEatTuMceIQGw8y88Ejb4CLgxw4xSKJuK8moN79VG5-m1NTQEVao1ZZYjsp6qBb65UaB6hEyrI37BBkDOnnhtAFp0trcSH4Rkc0=
date: '2017-07-20 00:00:00 +0000'

---

{% raw  %}
<p><span style="font-size: 15px; color: rgb(136, 136, 136);">导读：马奇诺防线是二战前法国耗时十余年修建的防御工事，十分坚固，但是由于造价昂贵，仅修建了法德边境部分，绵延数百公里，而法比边界的阿登高地地形崎岖，不易运动作战，且比利时反对在该边界修建防线，固法军再次并没过多防备，满心期望能够依靠坚固的马奇诺防线来阻挡德军的攻势。没想到后来德军避开德法边境正面，通过阿登高地从防线左翼迂回，绕过了马奇诺防线，然后就是英法联军的敦克尔克大撤退了。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">网站验证码就如同马奇诺防线一样，阻挡了爬虫工程师的正面进攻。</span></p><p><br></p><p><span style="font-size: 15px;">随着爬虫和反爬虫双方围绕验证码的不断较量，最终导致了验证码识别难度的不断上升。现在复杂的验证码长这样：</span></p><p><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_png/NIoply441qDEqkPl6kiczOxaD96bfPOIFU3C8w37QhyjNYKy5OHX9tFUaD4r9ImF6tO7CrT16ibfXoYxLCf8hDtg/640?wx_fmt=png" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 496px !important; height: 401px !important;"></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">正面硬刚验证码，想要识别它，是件挺复杂的事，涉及到图像处理技术：二值化，降噪，切割，字符识别算法：KNN(K 邻近算法)和 SVM (支持向量机算法)，再复杂点还要借助 CNN(卷积神经网络)，还有什么机器学习啥的。</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">虽然现在有打码平台可以解决绝大多数的验证码问题，但如果爬取的数量特别庞大，单纯依赖打码平台也是不大行得通的，除了成本因素，还有打码平台也解决不了的验证码因素，比如滑动验证码：</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIF3ZxtQlvyTpLdSHeoHpM32gMWRhUOVFQHaXFwPORatmxicEiaOicD3qusw/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 295px !important; height: 192px !important;"></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">既然正面进攻费事费力，那能不能找到爬虫工程师眼中的阿登高地绕过验证码？</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">本文以各地工商网站为例，对常见的验证码绕过技巧做一个小总结，顺便解密下如何不借助模拟 js 拖动来绕过滑动验证码。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">各地工商网站（全称国家企业信用信息公示系统）因为包含大量企业真实信息，金融贷款征信等都用得到，天然吸引了很大部分来自爬虫的火力，因此反爬虫措施格外严格。一般的网站仅在登录注册等环节，或者访问频繁后才弹出验证码，而工商网站查询无需登录，每查一次关键字就需要一次验证码。同时各地工商网站由于各自独立开发，自主采用了各种不同的验证码机制，更是给全量爬取的爬虫增加了更多的障碍。因此，工商网站的验证码特别具有代表性。</span></p><p><br></p><p><span style="font-size: 15px;"><strong>首先，从最简单的分页角度入手。</strong></span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">分页的处理可以放在前端也可以放在后端，如果只放在后端，每次点击页码就需要发送一次查询请求，而一次验证码通常只能服务于一次请求，再次请求需要获取新的验证码，直接观察翻页操作是否弹出验证码输入框即可判断是否可以绕过。</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">如何判断分页处理放在前端还是后端的呢？很简单，F12 打开浏览器开发者工具，页面点下一页，有新的请求就说明放在后端，反之就是前端。</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">实践发现，四川和上海的工商网站翻页都放在后端，且翻页没有验证码输入框。说明这里的验证码可以绕过，但是绕过的原理却有些不同：</span></p><p style="text-align: justify;"><br></p><ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="text-align: justify;"><span style="font-size: 15px;">对比四川工商网站翻页前后请求的参数，除了页码参数外，多了一项：yzmYesOrNo=no。从变量名也猜得到，后端根据该参数的值判断是否需要检查验证码。</span></p></li><li><p style="text-align: justify;"><span style="font-size: 15px;">而上海工商网站的对比结果发现，除了页码参数外，少了验证码字段，因此我们可以大胆猜测：验证码的校验仅放在了前端，后端没有做二次校验，从页面上操作是绕不过的，但是不带验证码字段直接向后端发送请求，数据就拿到了。</span></p></li></ul><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">严格来说，上海工商网站这种算是漏洞，对待这种这种漏洞，爬虫工程师应有的态度是：悄悄的进村，打枪的不要。不过也不要利用的太狠了，笔者实验时没加限制，爬了十万数据后，ip 被封了。很长时间后才解封，同时页面改版并修复了漏洞。</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFvxfAtdqcB0p58G3eibAU0m3tbpicJ9ibXcQmiaOTj2gicTqGbXJiaZgLl5tQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 430px !important; height: 256px !important;"></p><p><br></p><p><span style="font-size: 15px;"><strong>其次，观察目标网站是否有多套验证码。</strong></span></p><p><span style="font-size: 15px;"><strong><br></strong></span></p><p style="text-align: justify;"><span style="font-size: 15px;">有些网站不知道出于什么样的考虑，会在不同的页面使用不同的验证码。一旦遇到这种情况，我们可就要捡软柿子捏了--从简单的验证码入手，移花接木，将识别的结果作为参数来向后端发送请求，从而达到绕过复杂验证码的目的。</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">举例来说，湖北工商的查询页面验证码是类似下图的九宫格验证码：</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIF7lFDCLZibw0sYm1YUOO3vV9cqibBhiaicHicicBCkIzWhIvJY7dx6rPnqNEA/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 160px !important;"></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">而电子营业执照登陆界面的验证码是这样的：</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFPJKjSqavaicGiapfA4XtaU8s4iaUOXk5fXXCVXuFt37xdjtNWL5ibkiadpQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 80px !important; height: 41px !important;"></p><p><br></p><p><span style="font-size: 15px;">即便要识别，也明显是后者的验证码要容易些，实例代码如下：</span></p><p><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFGO5YK44Ijb3iby6hsSHoewfnLxibYS0yT3aQ3qBOn0evOtmsYuRibKLmA/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 770px !important; height: 382.23px !important;"></p><p><br></p><p><span style="font-size: 15px;"><strong>再者，可以考虑从数据的存储id入手</strong></span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">专门针对移动端开发的 wap 页面限制一般要少得多。以北京工商网站来说，wap 界面不带验证码参数直接发送请求就可以得到数据的，原理类似于上海工商网站，但是其对单个ip日访问次数做了严格限制，因此该方式可以用但不好用。</span></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">继续观察，以搜索“山水集团”为例，从搜索页到列表页时，需要输入验证码，而从列表页进入详情页的时候，是不需要验证码的。最终详情页如图：</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFry20KEMibGJk4Dtrf1ZasBPwPcoRCtaJ2k8MBf3SAuYhzMbX8l8tUTA/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 770px !important; height: 241.947px !important;"></p><p style="text-align: justify;"><br></p><p style="text-align: justify;"><span style="font-size: 15px;">通常没人记得住各地工商网站的网址，我们会去搜索引擎里搜。当搜北京企业信用信息时，发现两个有价值的结果，除了国家企业信用信息公示系统外，还有个北京市企业信用信息信息网。进后者再操作一番可以得到下面的详情页：</span></p><p style="text-align: justify;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFaQ7jz5fNpEWjSmAWPyeFibLbJd1lIeWu2x4LPdQCkxde4xJ7BW0Hm4Q/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 770px !important; height: 174.706px !important;"></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">观察发现，企业 id 都是相同的，嘿嘿，这不是“两块牌子，一套班子”嘛！后者的访问量要小一些，虽有验证码，但是可以采用上海工商一样的方式绕过，只是返回的结果字段不太符合我们的要求。不过，我们可以去企业信息网获得企业id，再次采用移花接木的方式，去信息公示系统构造链接获得最终的详情页嘛！</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">用过数据库同学都晓得，数据库里的数据 id，默认是自增的。如果有个网站引用的数据是 xxx.com?id=1234567, 那我们很容易猜得到构造类似 1234568 这样的 id 去尝试！通常，使用这种 id 规律能够轻易猜出来的网站并不多，但不代表没有。比如甘肃省工商网站，结果页是拿企业注册号来查询的。</span></p><p><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p><span style="font-size: 15px;"><strong>最后，谈谈滑动验证码。</strong></span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">目前，工商网站已经全面改版，全部采用了滑动验证码，上面绝大多数思路都失效了。对于滑动验证码，网上能搜到的解决方案基本都是下载图片，还原图片，算出滑动距离，然后模拟 js 来进行拖动解决，我们来看下能否不模拟拖动来解决这个问题。</span></p><p><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p><span style="font-size: 15px;">以云南工商网站为例，首先抓包看过程。</span></p><p><br></p><p><span style="font-size: 15px;">1.&nbsp;<span style="font-size: 15px; color: rgb(0, 82, 255);">http://yn.gsxt.gov.cn/notice/pc-geetest/register?t=147991678609</span>，response：</span></p><p style="margin-left: 28px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIF9n9bdAlrN8aC2rKSfZcxOAS50jTbibBTNnzmawBUHjTdicag37gpRpnw/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 536px !important; height: 109px !important;"></p><p><span style="font-size: 15px;">2.&nbsp;下载验证码图片</span></p><p style="margin-left: 28px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFTH4hSKDW920NnXOmVdwgD8x4m13IhqHu1ibHiaUWGuhgsu7aQkgMFI6g/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 419px !important; height: 67px !important;"></p><p><span style="font-size: 15px;">3.&nbsp;<span style="font-size: 15px; color: rgb(0, 82, 255);">http://yn.gsxt.gov.cn/notice/pc-geetest/validate</span>， post 如下数据：</span></p><p style="margin-left: 28px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFbgeDBOFn8mHpWVoGNMsSDdGczoxUVtRnhAvlMviaIxkwUBorC32u9BQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 679px !important; height: 104px !important;"><span style="font-size: 15px;">4.&nbsp;<span style="font-size: 15px; color: rgb(0, 82, 255);">http://yn.gsxt.gov.cn/notice/search/ent_info_list</span>，post 如下数据：</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFP6lZNR6wRnCjsuSsg5v5sMdFTJPicenQURUibLQOqgHwrP9Own4ibptow/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 693px !important; height: 168px !important;"></p><p style="text-align: justify;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="text-align: justify;"><span style="font-size: 15px;">仔细分析，我们发现两处疑点：</span></p><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p style="text-align: justify;"><span style="font-size: 15px;">第一步并没有返回需要下载的图片地址，那么前端怎么知道要下载哪些图片？</span></p></li><li><p style="text-align: justify;"><span style="font-size: 15px;">第三步验证时，并没有告知后端下载了那些图片，后端是怎么验证 post 过去的数据是有效性的？</span></p></li></ol><p style="text-align: justify;"><span style="font-size: 15px;"><br></span></p><p style="text-align: justify;"><span style="font-size: 15px;">仔细阅读前端混淆的 js 代码，我们发现前端数据处理过程是这样的：</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFpQDlNfliciaLZSsBVWNSVsvRoicicSHICZNa9F91AGfLdNXpTiaqT5MFO4w/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 695px !important; height: 319px !important;"></p><p><br></p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p><span style="font-size: 15px;">从 0 到 6（不含）中取随机整数，赋值给 d， d=5；</span></p></li><li><p><span style="font-size: 15px;">从 0 到 300（不含）中取随机整数，赋值给 e， e=293；</span></p></li><li><p><span style="font-size: 15px;">将d转化为字符串并作 MD5 加密，加密字符串取前 9 位赋值给 f， f='e4da3b7fb'；</span></p></li><li><p><span style="font-size: 15px;">将 e 转化为字符串并作 MD5 加密，加密字符串从第 11 位开始取 9 位赋值给 g, g='43be4f209'；</span></p></li><li><p><span style="font-size: 15px;">取 f 的偶数位和 g 的奇数位组成新的 9 位字符串给 h, h='e3de3f70b'；</span></p></li><li><p><span style="font-size: 15px;">取 h 的后 4 位与 200 做 MOD 运算，其结果小于 40，则取 40，否则取其本身赋值给 x，x=51；</span></p></li><li><p><span style="font-size: 15px;">取 [x-3, x+3] 以内随机数赋值给 c，c=51；</span></p></li><li><p><span style="font-size: 15px;">分别取 c,d,e 跟 challenge 做 t 加密 (t(c,challenge), t(d, challenge), t(e,challenge)) 并用（_）拼接即为 geetest_validate, '9ccccc997288_999c9ccaa83_999cc9c9999990d'</span></p></li><li><p><span style="font-size: 15px;">这里 f, g 参数决定了下载图片地址：</span></p></li></ol><p><br></p><p><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFCAlbM2M2OPMPS7UPqmk9C5KsCXENyGNwmEEdxWziaOs8ZQLiaefC2IbQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 444px !important; height: 66px !important;"></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">而 x 为滑块拖动的横向偏移量，至此解答了疑问 1 中图片下载地址怎么来的问题。</span></p><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">前边提到的 t 加密过程是这样的：</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 15px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); line-height: 1.75em; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz_jpg/NIoply441qDEqkPl6kiczOxaD96bfPOIFT41490VMdf5iaEiboIwLkGUbqAh199QW12giaVeVe5meAa643RwtTebMQ/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 617px !important; height: 232px !important;"></p><p><br></p><p><span style="font-size: 15px;">t(a,b)，此处以 a=51 演示</span></p><p><br></p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p><span style="font-size: 15px;">challenge 为 34 位 16 进制字符串，取前 32 位赋值给 prefix，后 2 位赋值给 suffix，prefix='34173cb38f07f89ddbebc2ac9128303f', suffix='a8'</span></p></li><li><p><span style="font-size: 15px;">prefix 去重并保持原顺序，得到列表 &nbsp;['3', '4', '1', '7', 'c', 'b', '8', 'f', '0', '9', 'd', 'e', '2', 'a']</span></p></li><li><p><span style="font-size: 15px;">将 2 中列表循环顺序放入包含 5 个子列表的列表中，得到random_key_list：&nbsp; [['3', 'b', 'd'], ['4', '8', 'e'], ['1', 'f', '2'], ['7', '0', 'a'], ['c', '9']]</span></p></li><li><p><span style="font-size: 15px;">将 suffix 字符串（16 进制）逐位转化为 10 进制，得到 [10, 8]</span></p></li><li><p><span style="font-size: 15px;">将 4 中列表逐位与 [36,0] 做乘法和运算并与 a 的四舍五入结果相加， n= 51 + 36*10 + 0*8=419</span></p></li><li><p><span style="font-size: 15px;">q=[1,2,5,10,50], 用 q 对 n 做分解（n=50*13+10*0+5*1+2*1+1*1），将其因数倒序赋值给 p，p=[0,2,1,1,8]</span></p></li><li><p><span style="font-size: 15px;">从 random_key_list 右侧开始随机取值，次数为 p 中数值，拼成字符串 sub_key，sub_key='9ccccc997288'</span></p></li></ol><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-family: 微软雅黑; font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-indent: 28px; box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p><span style="font-size: 15px;">至此，我们完成了整个分析过程，我们又有了新发现：</span></p><p><br></p><ol class=" list-paddingleft-2" style="list-style-type: decimal;"><li><p style="text-align: justify;"><span style="font-size: 15px;">按照前边的抓包过程，其实不需要真的下载图片，只需执行 1、3、4 步就可以得到目标数据了。步骤 1 也可以不要，只需 3、4 即可，但是少了步骤 1， 我们还需要额外请求一次 cookie，所以还是保留 1, 这样也伪装的像一点嘛。</span></p></li><li><p style="text-align: justify;"><span style="font-size: 15px;">相同的 challenge，每次运算都可以得出不同的 validate 和 seccode，那么问题来了：<strong>到底服务端是怎么根据 challenge 验证其他数据是否有效呢</strong>？</span></p></li></ol><p><br></p><p style="text-align: justify;"><span style="font-size: 15px;">总结一下，<strong>对于验证码，本文只是提供了一种新的思路，利用了网站开发过程中的一点小疏漏，而最后的滑动验证码也只是分析了 offline 模式的验证方法。</strong>不要指望所有验证码都可以能绕过，没有阿登高地，二战德国就不打法国了么？只要觉得有价值，即使正面面对验证码，作为爬虫工程师建议也就一句话：不要怂，就是干！</span></p><p><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 20px; box-sizing: border-box !important; word-wrap: break-word !important;">推荐阅读</span></strong></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><ul class=" list-paddingleft-2" style="max-width: 100%; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; width: 728.641px; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653547274&amp;idx=1&amp;sn=52e5037b163146c1656eedce2da1ecd8&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline; font-size: 15px; color: rgb(0, 82, 255);"><span style="font-size: 15px; color: rgb(0, 82, 255);">为何大量网站不能抓取?爬虫突破封禁的6种常见方法</span></a><br></p></li><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548870&amp;idx=1&amp;sn=9dab4a1f06e57adb2ac0393bac479c0c&amp;chksm=813a60deb64de9c833b7e871b8c50148bb481f7b438c51f254e94faf44d3ad86be5d0b958128&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline; font-size: 15px; color: rgb(0, 82, 255);"><span style="font-size: 15px; color: rgb(0, 82, 255);">适合创业团队的必备工具栈</span></a></p></li><li><p><a href="http://mp.weixin.qq.com/s?__biz=MzAwMDU1MTE1OQ==&amp;mid=2653548867&amp;idx=1&amp;sn=f2a7f1a4f874d47a1ad97bf59f5ce696&amp;chksm=813a60dbb64de9cd71ffc194899bd72b6c69e1fba07a8c48278683d7bc69f3215863663dad97&amp;scene=21#wechat_redirect" target="_blank" style="text-decoration: underline; font-size: 15px; color: rgb(0, 82, 255);"><span style="font-size: 15px; color: rgb(0, 82, 255);">机器学习平台痛点与模型提升方法：基于Spark的机器学习平台在点融网风控应用介绍</span></a><br></p></li></ul><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="color: rgb(136, 136, 136); font-size: 14px;  background-color: rgb(255, 255, 255);">本文作者候克雷，由点融黑帮公众号（微信id: DianrongMafia）授权高可用架构发表</span><span style="max-width: 100%; color: rgb(136, 136, 136); font-size: 14px;  background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;">，</span><span style="color: rgb(136, 136, 136); font-size: 14px;  background-color: rgb(255, 255, 255);">技术原创及架构实践文章，欢迎通过公众号菜单「联系我们」进行投稿。</span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><br></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">高可用架构</strong></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">改变互联网的构建方式</strong></span></p><p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px; text-align: center; background-color: rgb(255, 255, 255); box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 18px; box-sizing: border-box !important; word-wrap: break-word !important;"><strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><img src="http://mmbiz.qpic.cn/mmbiz/8XkvNnTiapOPOK9rQud9XibGhPOPsA3gA8Wr4CEnzmhfZQzSGu0Q09GOuk18S9icZtuVnQewvyqZtOWyDnJPBDn1A/640?wx_fmt=jpeg" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 200px !important; height: 200px !important;"><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></strong></span><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">长按二维码 关注「高可用架构」公众号</span></p><hr/><a href="http://mp.weixin.qq.com/s?timestamp=1502116814&src=3&ver=1&signature=fMd4ZeYncDjRuvdiU8EiAnUULkvryB4DXbE6sTjTCTqAU6Wo3FeIV0BwKDpBDcxRzySp9S3gfEatTuMceIQGw8y88Ejb4CLgxw4xSKJuK8moN79VG5-m1NTQEVao1ZZYjsp6qBb65UaB6hEyrI37BBkDOnnhtAFp0trcSH4Rkc0=">微信地址</a>
{% endraw  %}

