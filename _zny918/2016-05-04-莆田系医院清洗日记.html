---
title: 莆田系医院清洗日记
author: 周宁奕
date: '2016-05-04 00:00:00 +0000'

---

{% raw  %}
<h2 style="margin: 1.3em 0px 1em; padding: 0px; font-weight: bold;font-size: 1.4em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">引子</h2><p style="margin: 0px 0px 1.2em !important;">一夜间，百度和莆田系的话题院占领了俺的朋友圈。</p><p style="margin: 0px 0px 1.2em !important;"><span style="line-height: 25.6px;">直到这几天我才幡然觉悟，从小的性病广告，到公交车站的整容广告，到各种一看就伪科学的网站广告，原来师出一派。</span></p><p style="margin: 0px 0px 1.2em !important;">本人不善口诛笔伐和道德说教，但好歹也被医院坑过一次，花了800做了个其实应该免费的婚检，自此才知道『军』字打头的医院未必是个好鸟。</p><p style="margin: 0px 0px 1.2em !important;">不过昨天我在github上看到了这个项目: https://github.com/langhua9527/BlackheartedHospital, 心头一震， 原来码农也能为这件事做点什么。</p><p style="margin: 0px 0px 1.2em !important;">github是一个分布式代码托管仓库(<span style="line-height: 25.6px;">有点装逼😄</span>)，简言之是大家可以在这里进行多人协作，比如我修改了一个片段，他修改了一个片段，github可以帮着做合并。</p><p style="margin: 0px 0px 1.2em !important;">现在github已经被玩坏了，比如这个找医院的项目，至今有57个人参与其中，3000多个star(👍)。</p><h2 style="margin: 1.3em 0px 1em; padding: 0px; font-weight: bold;font-size: 1.4em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">清洗数据</h2><p style="margin: 0px 0px 1.2em !important;">问题来了，目前只有500个野鸡医院的名字，你要取得这500个医院的电话、省份、 城市、地区、地址供研究，你会怎么做，是一个个去搜索吗？</p><p style="margin: 0px 0px 1.2em !important;">500个可以手动，如果是5000个呢，每次找到网站并刷出来需要15s，复制黏贴需要3s， 5个字段需要15s，加起来一条记录需要30s，5000条数据需要你一刻不停地高效率干一天半。</p><p style="margin: 0px 0px 1.2em !important;">码农就是暖男，暖男让你的工作更省心。</p><p style="margin: 0px 0px 1.2em !important;">如果我们用手机打开百度地图或者高德地图，随手输入一个地址，上海交大、上海交通大学、东川路800号，或在上海的视图搜索交大、交通大学，基本上你能找得到这个地方。</p><p style="margin: 0px 0px 1.2em !important;">虽然一个地址不是很标准，我们还是能找到标准的信息，有时候还能跳个小框出来，告诉你这个地方的联系电话是多少。</p><h2 style="margin: 1.3em 0px 1em; padding: 0px; font-weight: bold;font-size: 1.4em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">实现片段</h2><p style="margin: 0px 0px 1.2em !important;">如果我们打开chrome，然后打开控制台(windows用户按f12，mac用户 alt + command + r)，然后点击network。</p><p style="margin: 0px 0px 1.2em !important;">然后在搜索框搜索『上海交通大学』，打开控制台，你可以找到一条类似于这样的请求：</p><pre style="font-size: 0.85em; font-family: Consolas, Inconsolata, Courier, monospace;font-size: 1em; line-height: 1.2em;margin: 1.2em 0px;"><code style="font-size: 0.85em; font-family: Consolas, Inconsolata, Courier, monospace;margin: 0px 0.15em; padding: 0px 0.3em; white-space: pre-wrap; border: 1px solid rgb(234, 234, 234); border-radius: 3px; display: inline; background-color: rgb(248, 248, 248);white-space: pre; overflow: auto; border-radius: 3px; border: 1px solid rgb(204, 204, 204); padding: 0.5em 0.7em; display: block !important;">http://ditu.amap.com/service/poiInfo?query_type=TQUERY&amp;city=330100&amp;keywords=%E4%B8%8A%E6%B5%B7%E4%BA%A4%E9%80%9A%E5%A4%A7%E5%AD%A6&amp;pagesize=20&amp;pagenum=1&amp;qii=true&amp;cluster_state=5&amp;need_utd=true&amp;utd_sceneid=1000&amp;div=PC1000&amp;addr_poi_merge=true&amp;is_classify=true&amp;geoobj=119.917027%7C30.180823%7C120.390125%7C30.393979</code></pre><p style="margin: 0px 0px 1.2em !important;"><img src="/zny918/images/f140a404e0b6e47271d6982f75a99d895fb033da.png" style="width: 770px !important; height: 499.946px !important;"><br></p><p style="margin: 0px 0px 1.2em !important;">这个url有一段比较关键：&nbsp;keywords=%E4%B8%8A%E6%B5%B7%E4%BA%A4%E9%80%9A%E5%A4%A7%E5%AD%A6</p><p style="margin: 0px 0px 1.2em !important;">很多字符是不能存在于url中的，所以浏览器会自动转化，各种语言应该都有这种转化的办法，比如javascript提供了2个函数做转换，我们可以在console里对这堆乱码进行试验，我们用encodeURI函数把中文转乱码，又用decodeURI转换成中文:</p><p style="margin: 0px 0px 1.2em !important;"><img src="/zny918/images/c62297cc1fcf8507b95e66ffedf9aec3e1b868e3.png" style="line-height: 25.6px; width: 770px !important; height: 261.745px !important;"><br></p><p style="margin: 0px 0px 1.2em !important;"><br></p><p style="margin: 0px 0px 1.2em !important;">因此，如果我们有一堆可疑医院的列表，一条条告诉程序，程序把刚才url中key后面的乱码用下面的函数处理替换，就可以开始搜集信息了：</p><p style="margin: 0px 0px 1.2em !important;"><br></p><p><br></p><pre style="font-size: 0.85em; font-family: Consolas, Inconsolata, Courier, monospace;font-size: 1em; line-height: 1.2em;margin: 1.2em 0px;"><code class="" style="font-size: 0.85em; font-family: Consolas, Inconsolata, Courier, monospace;margin: 0px 0.15em; padding: 0px 0.3em; white-space: pre-wrap; border: 1px solid rgb(234, 234, 234); border-radius: 3px; display: inline; background-color: rgb(248, 248, 248);white-space: pre; overflow: auto; border-radius: 3px; border: 1px solid rgb(204, 204, 204); padding: 0.5em 0.7em; display: block !important;display: block; overflow-x: auto; padding: 0.5em; background: rgb(39, 40, 34);color: rgb(221, 221, 221);"><span class="" style="color: rgb(166, 226, 46);">encodeURI</span>(<span class="" style="color: rgb(166, 226, 46);">'你想要搜索的地址'</span>)</code></pre><p><br></p><p style="margin: 0px 0px 1.2em !important;"><br></p><p style="margin: 0px 0px 1.2em !important;">我们可以看看这个接口包含的信息：</p><p style="margin: 0px 0px 1.2em !important;"><img src="/zny918/images/555ef2c50f7dd52a461b315cc4c49883c115b3fb.png" style="width: 770px !important; height: 548.417px !important;"><br></p><p style="margin: 0px 0px 1.2em !important;"><br></p><h2 style="margin: 1.3em 0px 1em; padding: 0px; font-weight: bold;font-size: 1.4em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">随意下载</h2><p style="margin: 0px 0px 1.2em !important;">爬虫的细节就先略过了，如果调用太频繁，有时候会被高德封掉😄，最简单的方法可疑让任务排个队，每次完了休息一小会。</p><p style="margin: 0px 0px 1.2em !important;">这份数据大家可以免费地使用，也提供了json和csv的格式可供下载，因为初始数据修改过, 目前还没有合并到主项目中（可以点击原文）。</p><p style="margin: 0px 0px 1.2em !important;"><br>https://github.com/zhouningyi/BlackheartedHospital</p><p style="margin: 0px 0px 1.2em !important;">所有的数据都为网友采集，并不为准，大家可以利用互联网，开始进一步的调查。</p><p style="margin: 0px 0px 1.2em !important;">谢谢每天我们用来导航的地图服务，利用这个，我们批量清洗出了可疑医院的详细信息。</p><h2 style="margin: 1.3em 0px 1em; padding: 0px; font-weight: bold;font-size: 1.4em; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">可疑医院地图</h2><p style="margin: 0px 0px 1.2em !important;">对于这份数据，顺便做了一份简单的热力图，可以点击每个热点看详细信息：</p><p style="margin: 0px 0px 1.2em !important;">http://hotu.co/hospital/</p><p style="margin: 0px 0px 1.2em !important;"><img src="/zny918/images/2a10d831e7d8e63b33c81ee9fcb67fa25a274fd5.png" style="width: 280px !important; height: 280px !important;"><br><img src="/zny918/images/fd81419f95ce52dea30fd2509c132aca2d677a7d.png" style="width: 770px !important; height: 479.173px !important;"><br></p><p style="margin: 0px 0px 1.2em !important;"><img src="/zny918/images/e999161456be5e606456a409744ec005f8cea71d.png" style="width: 770px !important; height: 409.928px !important;"><br></p><p style="margin: 0px 0px 1.2em !important;"><br></p><h2 style="margin-top: 1.3em; margin-bottom: 1em; font-weight: bold; font-size: 1.4em; white-space: normal; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238);">广告</h2><p style="line-height: 25.6px; white-space: normal; margin-bottom: 1.2em !important;">兽脑的世界: &nbsp;记录一条代码狗下班后的发现之旅。</p><p style="line-height: 25.6px; white-space: normal; margin-bottom: 1.2em !important;">数据可视化 | 数据分析 | 图形学算法 | 数字艺术</p><p style="line-height: 25.6px; white-space: normal; margin-bottom: 1.2em !important;">如果觉得内容还行, 欢迎推荐给你的盆友圈😄😄</p><p style="line-height: 25.6px; white-space: normal; margin-bottom: 1.2em !important;"><img src="/zny918/images/ffa9ab54c9af30e4ccb6e91d7786492c4ecdc6e1.jpeg" style="width: 430px !important; height: 430px !important;"></p><p style="margin: 0px 0px 1.2em !important;"><br></p><p style="margin: 0px 0px 1.2em !important;"><br></p><p style="   width: 1px; height: 1px; overflow: hidden; left: -1000px; white-space: nowrap; top: 143px; "><span style="line-height: 25.6px; white-space: normal;">直到这几天我才幡然觉悟，从小的性病广告，到公交车站的整容广告，到各种一看就伪科学的网站广告，原来师出一派。</span></p><p style="   width: 1px; height: 1px; overflow: hidden; left: -1000px; white-space: nowrap; top: 143px; "><span style="line-height: 25.6px; white-space: normal;"><br></span></p>
{% endraw  %}

